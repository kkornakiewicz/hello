var P1=Object.defineProperty;var C1=(t,e,n)=>e in t?P1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var v=(t,e,n)=>(C1(t,typeof e!="symbol"?e+"":e,n),n);function x1(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var VU=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function cp(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var iv={exports:{}},J={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jo=Symbol.for("react.element"),I1=Symbol.for("react.portal"),M1=Symbol.for("react.fragment"),O1=Symbol.for("react.strict_mode"),k1=Symbol.for("react.profiler"),N1=Symbol.for("react.provider"),F1=Symbol.for("react.context"),D1=Symbol.for("react.forward_ref"),B1=Symbol.for("react.suspense"),U1=Symbol.for("react.memo"),L1=Symbol.for("react.lazy"),t_=Symbol.iterator;function z1(t){return t===null||typeof t!="object"?null:(t=t_&&t[t_]||t["@@iterator"],typeof t=="function"?t:null)}var sv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ov=Object.assign,av={};function _s(t,e,n){this.props=t,this.context=e,this.refs=av,this.updater=n||sv}_s.prototype.isReactComponent={};_s.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};_s.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function lv(){}lv.prototype=_s.prototype;function up(t,e,n){this.props=t,this.context=e,this.refs=av,this.updater=n||sv}var fp=up.prototype=new lv;fp.constructor=up;ov(fp,_s.prototype);fp.isPureReactComponent=!0;var n_=Array.isArray,cv=Object.prototype.hasOwnProperty,hp={current:null},uv={key:!0,ref:!0,__self:!0,__source:!0};function fv(t,e,n){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)cv.call(e,r)&&!uv.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:Jo,type:t,key:s,ref:o,props:i,_owner:hp.current}}function V1(t,e){return{$$typeof:Jo,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function dp(t){return typeof t=="object"&&t!==null&&t.$$typeof===Jo}function W1(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var r_=/\/+/g;function Ju(t,e){return typeof t=="object"&&t!==null&&t.key!=null?W1(""+t.key):e.toString(36)}function al(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Jo:case I1:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+Ju(o,0):r,n_(i)?(n="",t!=null&&(n=t.replace(r_,"$&/")+"/"),al(i,e,n,"",function(c){return c})):i!=null&&(dp(i)&&(i=V1(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(r_,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",n_(t))for(var a=0;a<t.length;a++){s=t[a];var l=r+Ju(s,a);o+=al(s,e,n,l,i)}else if(l=z1(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=r+Ju(s,a++),o+=al(s,e,n,l,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Sa(t,e,n){if(t==null)return t;var r=[],i=0;return al(t,r,"","",function(s){return e.call(n,s,i++)}),r}function j1(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var tt={current:null},ll={transition:null},H1={ReactCurrentDispatcher:tt,ReactCurrentBatchConfig:ll,ReactCurrentOwner:hp};function hv(){throw Error("act(...) is not supported in production builds of React.")}J.Children={map:Sa,forEach:function(t,e,n){Sa(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Sa(t,function(){e++}),e},toArray:function(t){return Sa(t,function(e){return e})||[]},only:function(t){if(!dp(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};J.Component=_s;J.Fragment=M1;J.Profiler=k1;J.PureComponent=up;J.StrictMode=O1;J.Suspense=B1;J.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=H1;J.act=hv;J.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=ov({},t.props),i=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=hp.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)cv.call(e,l)&&!uv.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:Jo,type:t.type,key:i,ref:s,props:r,_owner:o}};J.createContext=function(t){return t={$$typeof:F1,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:N1,_context:t},t.Consumer=t};J.createElement=fv;J.createFactory=function(t){var e=fv.bind(null,t);return e.type=t,e};J.createRef=function(){return{current:null}};J.forwardRef=function(t){return{$$typeof:D1,render:t}};J.isValidElement=dp;J.lazy=function(t){return{$$typeof:L1,_payload:{_status:-1,_result:t},_init:j1}};J.memo=function(t,e){return{$$typeof:U1,type:t,compare:e===void 0?null:e}};J.startTransition=function(t){var e=ll.transition;ll.transition={};try{t()}finally{ll.transition=e}};J.unstable_act=hv;J.useCallback=function(t,e){return tt.current.useCallback(t,e)};J.useContext=function(t){return tt.current.useContext(t)};J.useDebugValue=function(){};J.useDeferredValue=function(t){return tt.current.useDeferredValue(t)};J.useEffect=function(t,e){return tt.current.useEffect(t,e)};J.useId=function(){return tt.current.useId()};J.useImperativeHandle=function(t,e,n){return tt.current.useImperativeHandle(t,e,n)};J.useInsertionEffect=function(t,e){return tt.current.useInsertionEffect(t,e)};J.useLayoutEffect=function(t,e){return tt.current.useLayoutEffect(t,e)};J.useMemo=function(t,e){return tt.current.useMemo(t,e)};J.useReducer=function(t,e,n){return tt.current.useReducer(t,e,n)};J.useRef=function(t){return tt.current.useRef(t)};J.useState=function(t){return tt.current.useState(t)};J.useSyncExternalStore=function(t,e,n){return tt.current.useSyncExternalStore(t,e,n)};J.useTransition=function(){return tt.current.useTransition()};J.version="18.3.1";iv.exports=J;var W=iv.exports;const ze=cp(W);var dv={exports:{}},yt={},pv={exports:{}},gv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(L,H){var Y=L.length;L.push(H);e:for(;0<Y;){var re=Y-1>>>1,G=L[re];if(0<i(G,H))L[re]=H,L[Y]=G,Y=re;else break e}}function n(L){return L.length===0?null:L[0]}function r(L){if(L.length===0)return null;var H=L[0],Y=L.pop();if(Y!==H){L[0]=Y;e:for(var re=0,G=L.length,dn=G>>>1;re<dn;){var Ze=2*(re+1)-1,Xt=L[Ze],Qe=Ze+1,fe=L[Qe];if(0>i(Xt,Y))Qe<G&&0>i(fe,Xt)?(L[re]=fe,L[Qe]=Y,re=Qe):(L[re]=Xt,L[Ze]=Y,re=Ze);else if(Qe<G&&0>i(fe,Y))L[re]=fe,L[Qe]=Y,re=Qe;else break e}}return H}function i(L,H){var Y=L.sortIndex-H.sortIndex;return Y!==0?Y:L.id-H.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,f=null,h=3,d=!1,m=!1,T=!1,A=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,p=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(L){for(var H=n(c);H!==null;){if(H.callback===null)r(c);else if(H.startTime<=L)r(c),H.sortIndex=H.expirationTime,e(l,H);else break;H=n(c)}}function w(L){if(T=!1,_(L),!m)if(n(l)!==null)m=!0,yr(R);else{var H=n(c);H!==null&&$t(w,H.startTime-L)}}function R(L,H){m=!1,T&&(T=!1,g(k),k=-1),d=!0;var Y=h;try{for(_(H),f=n(l);f!==null&&(!(f.expirationTime>H)||L&&!j());){var re=f.callback;if(typeof re=="function"){f.callback=null,h=f.priorityLevel;var G=re(f.expirationTime<=H);H=t.unstable_now(),typeof G=="function"?f.callback=G:f===n(l)&&r(l),_(H)}else r(l);f=n(l)}if(f!==null)var dn=!0;else{var Ze=n(c);Ze!==null&&$t(w,Ze.startTime-H),dn=!1}return dn}finally{f=null,h=Y,d=!1}}var x=!1,M=null,k=-1,F=5,U=-1;function j(){return!(t.unstable_now()-U<F)}function X(){if(M!==null){var L=t.unstable_now();U=L;var H=!0;try{H=M(!0,L)}finally{H?$():(x=!1,M=null)}}else x=!1}var $;if(typeof p=="function")$=function(){p(X)};else if(typeof MessageChannel<"u"){var K=new MessageChannel,je=K.port2;K.port1.onmessage=X,$=function(){je.postMessage(null)}}else $=function(){A(X,0)};function yr(L){M=L,x||(x=!0,$())}function $t(L,H){k=A(function(){L(t.unstable_now())},H)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(L){L.callback=null},t.unstable_continueExecution=function(){m||d||(m=!0,yr(R))},t.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<L?Math.floor(1e3/L):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(L){switch(h){case 1:case 2:case 3:var H=3;break;default:H=h}var Y=h;h=H;try{return L()}finally{h=Y}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(L,H){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var Y=h;h=L;try{return H()}finally{h=Y}},t.unstable_scheduleCallback=function(L,H,Y){var re=t.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?re+Y:re):Y=re,L){case 1:var G=-1;break;case 2:G=250;break;case 5:G=1073741823;break;case 4:G=1e4;break;default:G=5e3}return G=Y+G,L={id:u++,callback:H,priorityLevel:L,startTime:Y,expirationTime:G,sortIndex:-1},Y>re?(L.sortIndex=Y,e(c,L),n(l)===null&&L===n(c)&&(T?(g(k),k=-1):T=!0,$t(w,Y-re))):(L.sortIndex=G,e(l,L),m||d||(m=!0,yr(R))),L},t.unstable_shouldYield=j,t.unstable_wrapCallback=function(L){var H=h;return function(){var Y=h;h=H;try{return L.apply(this,arguments)}finally{h=Y}}}})(gv);pv.exports=gv;var $1=pv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X1=W,mt=$1;function D(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var _v=new Set,To={};function Qr(t,e){Yi(t,e),Yi(t+"Capture",e)}function Yi(t,e){for(To[t]=e,t=0;t<e.length;t++)_v.add(e[t])}var Pn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),dh=Object.prototype.hasOwnProperty,Y1=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,i_={},s_={};function K1(t){return dh.call(s_,t)?!0:dh.call(i_,t)?!1:Y1.test(t)?s_[t]=!0:(i_[t]=!0,!1)}function q1(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Z1(t,e,n,r){if(e===null||typeof e>"u"||q1(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function nt(t,e,n,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var We={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){We[t]=new nt(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];We[e]=new nt(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){We[t]=new nt(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){We[t]=new nt(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){We[t]=new nt(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){We[t]=new nt(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){We[t]=new nt(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){We[t]=new nt(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){We[t]=new nt(t,5,!1,t.toLowerCase(),null,!1,!1)});var pp=/[\-:]([a-z])/g;function gp(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(pp,gp);We[e]=new nt(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(pp,gp);We[e]=new nt(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(pp,gp);We[e]=new nt(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){We[t]=new nt(t,1,!1,t.toLowerCase(),null,!1,!1)});We.xlinkHref=new nt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){We[t]=new nt(t,1,!1,t.toLowerCase(),null,!0,!0)});function _p(t,e,n,r){var i=We.hasOwnProperty(e)?We[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Z1(e,n,i,r)&&(n=null),r||i===null?K1(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var On=X1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ea=Symbol.for("react.element"),gi=Symbol.for("react.portal"),_i=Symbol.for("react.fragment"),mp=Symbol.for("react.strict_mode"),ph=Symbol.for("react.profiler"),mv=Symbol.for("react.provider"),yv=Symbol.for("react.context"),yp=Symbol.for("react.forward_ref"),gh=Symbol.for("react.suspense"),_h=Symbol.for("react.suspense_list"),vp=Symbol.for("react.memo"),Vn=Symbol.for("react.lazy"),vv=Symbol.for("react.offscreen"),o_=Symbol.iterator;function Cs(t){return t===null||typeof t!="object"?null:(t=o_&&t[o_]||t["@@iterator"],typeof t=="function"?t:null)}var Se=Object.assign,Gu;function Hs(t){if(Gu===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Gu=e&&e[1]||""}return`
`+Gu+t}var ef=!1;function tf(t,e){if(!t||ef)return"";ef=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){r=c}t.call(e.prototype)}else{try{throw Error()}catch(c){r=c}t()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var l=`
`+i[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{ef=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Hs(t):""}function Q1(t){switch(t.tag){case 5:return Hs(t.type);case 16:return Hs("Lazy");case 13:return Hs("Suspense");case 19:return Hs("SuspenseList");case 0:case 2:case 15:return t=tf(t.type,!1),t;case 11:return t=tf(t.type.render,!1),t;case 1:return t=tf(t.type,!0),t;default:return""}}function mh(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case _i:return"Fragment";case gi:return"Portal";case ph:return"Profiler";case mp:return"StrictMode";case gh:return"Suspense";case _h:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case yv:return(t.displayName||"Context")+".Consumer";case mv:return(t._context.displayName||"Context")+".Provider";case yp:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case vp:return e=t.displayName||null,e!==null?e:mh(t.type)||"Memo";case Vn:e=t._payload,t=t._init;try{return mh(t(e))}catch{}}return null}function J1(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return mh(e);case 8:return e===mp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function cr(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Tv(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function G1(t){var e=Tv(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function wa(t){t._valueTracker||(t._valueTracker=G1(t))}function Sv(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=Tv(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Ol(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function yh(t,e){var n=e.checked;return Se({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function a_(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=cr(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Ev(t,e){e=e.checked,e!=null&&_p(t,"checked",e,!1)}function vh(t,e){Ev(t,e);var n=cr(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Th(t,e.type,n):e.hasOwnProperty("defaultValue")&&Th(t,e.type,cr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function l_(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Th(t,e,n){(e!=="number"||Ol(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var $s=Array.isArray;function Di(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+cr(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function Sh(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(D(91));return Se({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function c_(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(D(92));if($s(n)){if(1<n.length)throw Error(D(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:cr(n)}}function wv(t,e){var n=cr(e.value),r=cr(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function u_(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Av(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Eh(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Av(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Aa,bv=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Aa=Aa||document.createElement("div"),Aa.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Aa.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function So(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var eo={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},eA=["Webkit","ms","Moz","O"];Object.keys(eo).forEach(function(t){eA.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),eo[e]=eo[t]})});function Rv(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||eo.hasOwnProperty(t)&&eo[t]?(""+e).trim():e+"px"}function Pv(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=Rv(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var tA=Se({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function wh(t,e){if(e){if(tA[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(D(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(D(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(D(61))}if(e.style!=null&&typeof e.style!="object")throw Error(D(62))}}function Ah(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var bh=null;function Tp(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Rh=null,Bi=null,Ui=null;function f_(t){if(t=ta(t)){if(typeof Rh!="function")throw Error(D(280));var e=t.stateNode;e&&(e=hu(e),Rh(t.stateNode,t.type,e))}}function Cv(t){Bi?Ui?Ui.push(t):Ui=[t]:Bi=t}function xv(){if(Bi){var t=Bi,e=Ui;if(Ui=Bi=null,f_(t),e)for(t=0;t<e.length;t++)f_(e[t])}}function Iv(t,e){return t(e)}function Mv(){}var nf=!1;function Ov(t,e,n){if(nf)return t(e,n);nf=!0;try{return Iv(t,e,n)}finally{nf=!1,(Bi!==null||Ui!==null)&&(Mv(),xv())}}function Eo(t,e){var n=t.stateNode;if(n===null)return null;var r=hu(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(D(231,e,typeof n));return n}var Ph=!1;if(Pn)try{var xs={};Object.defineProperty(xs,"passive",{get:function(){Ph=!0}}),window.addEventListener("test",xs,xs),window.removeEventListener("test",xs,xs)}catch{Ph=!1}function nA(t,e,n,r,i,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var to=!1,kl=null,Nl=!1,Ch=null,rA={onError:function(t){to=!0,kl=t}};function iA(t,e,n,r,i,s,o,a,l){to=!1,kl=null,nA.apply(rA,arguments)}function sA(t,e,n,r,i,s,o,a,l){if(iA.apply(this,arguments),to){if(to){var c=kl;to=!1,kl=null}else throw Error(D(198));Nl||(Nl=!0,Ch=c)}}function Jr(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function kv(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function h_(t){if(Jr(t)!==t)throw Error(D(188))}function oA(t){var e=t.alternate;if(!e){if(e=Jr(t),e===null)throw Error(D(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return h_(i),t;if(s===r)return h_(i),e;s=s.sibling}throw Error(D(188))}if(n.return!==r.return)n=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o)throw Error(D(189))}}if(n.alternate!==r)throw Error(D(190))}if(n.tag!==3)throw Error(D(188));return n.stateNode.current===n?t:e}function Nv(t){return t=oA(t),t!==null?Fv(t):null}function Fv(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Fv(t);if(e!==null)return e;t=t.sibling}return null}var Dv=mt.unstable_scheduleCallback,d_=mt.unstable_cancelCallback,aA=mt.unstable_shouldYield,lA=mt.unstable_requestPaint,Ae=mt.unstable_now,cA=mt.unstable_getCurrentPriorityLevel,Sp=mt.unstable_ImmediatePriority,Bv=mt.unstable_UserBlockingPriority,Fl=mt.unstable_NormalPriority,uA=mt.unstable_LowPriority,Uv=mt.unstable_IdlePriority,lu=null,cn=null;function fA(t){if(cn&&typeof cn.onCommitFiberRoot=="function")try{cn.onCommitFiberRoot(lu,t,void 0,(t.current.flags&128)===128)}catch{}}var Lt=Math.clz32?Math.clz32:pA,hA=Math.log,dA=Math.LN2;function pA(t){return t>>>=0,t===0?32:31-(hA(t)/dA|0)|0}var ba=64,Ra=4194304;function Xs(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Dl(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~i;a!==0?r=Xs(a):(s&=o,s!==0&&(r=Xs(s)))}else o=n&~i,o!==0?r=Xs(o):s!==0&&(r=Xs(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Lt(e),i=1<<n,r|=t[n],e&=~i;return r}function gA(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function _A(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-Lt(s),a=1<<o,l=i[o];l===-1?(!(a&n)||a&r)&&(i[o]=gA(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function xh(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Lv(){var t=ba;return ba<<=1,!(ba&4194240)&&(ba=64),t}function rf(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Go(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Lt(e),t[e]=n}function mA(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-Lt(n),s=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~s}}function Ep(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Lt(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var ie=0;function zv(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Vv,wp,Wv,jv,Hv,Ih=!1,Pa=[],Gn=null,er=null,tr=null,wo=new Map,Ao=new Map,$n=[],yA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function p_(t,e){switch(t){case"focusin":case"focusout":Gn=null;break;case"dragenter":case"dragleave":er=null;break;case"mouseover":case"mouseout":tr=null;break;case"pointerover":case"pointerout":wo.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ao.delete(e.pointerId)}}function Is(t,e,n,r,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=ta(e),e!==null&&wp(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function vA(t,e,n,r,i){switch(e){case"focusin":return Gn=Is(Gn,t,e,n,r,i),!0;case"dragenter":return er=Is(er,t,e,n,r,i),!0;case"mouseover":return tr=Is(tr,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return wo.set(s,Is(wo.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,Ao.set(s,Is(Ao.get(s)||null,t,e,n,r,i)),!0}return!1}function $v(t){var e=Cr(t.target);if(e!==null){var n=Jr(e);if(n!==null){if(e=n.tag,e===13){if(e=kv(n),e!==null){t.blockedOn=e,Hv(t.priority,function(){Wv(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function cl(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Mh(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);bh=r,n.target.dispatchEvent(r),bh=null}else return e=ta(n),e!==null&&wp(e),t.blockedOn=n,!1;e.shift()}return!0}function g_(t,e,n){cl(t)&&n.delete(e)}function TA(){Ih=!1,Gn!==null&&cl(Gn)&&(Gn=null),er!==null&&cl(er)&&(er=null),tr!==null&&cl(tr)&&(tr=null),wo.forEach(g_),Ao.forEach(g_)}function Ms(t,e){t.blockedOn===e&&(t.blockedOn=null,Ih||(Ih=!0,mt.unstable_scheduleCallback(mt.unstable_NormalPriority,TA)))}function bo(t){function e(i){return Ms(i,t)}if(0<Pa.length){Ms(Pa[0],t);for(var n=1;n<Pa.length;n++){var r=Pa[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Gn!==null&&Ms(Gn,t),er!==null&&Ms(er,t),tr!==null&&Ms(tr,t),wo.forEach(e),Ao.forEach(e),n=0;n<$n.length;n++)r=$n[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<$n.length&&(n=$n[0],n.blockedOn===null);)$v(n),n.blockedOn===null&&$n.shift()}var Li=On.ReactCurrentBatchConfig,Bl=!0;function SA(t,e,n,r){var i=ie,s=Li.transition;Li.transition=null;try{ie=1,Ap(t,e,n,r)}finally{ie=i,Li.transition=s}}function EA(t,e,n,r){var i=ie,s=Li.transition;Li.transition=null;try{ie=4,Ap(t,e,n,r)}finally{ie=i,Li.transition=s}}function Ap(t,e,n,r){if(Bl){var i=Mh(t,e,n,r);if(i===null)pf(t,e,r,Ul,n),p_(t,r);else if(vA(i,t,e,n,r))r.stopPropagation();else if(p_(t,r),e&4&&-1<yA.indexOf(t)){for(;i!==null;){var s=ta(i);if(s!==null&&Vv(s),s=Mh(t,e,n,r),s===null&&pf(t,e,r,Ul,n),s===i)break;i=s}i!==null&&r.stopPropagation()}else pf(t,e,r,null,n)}}var Ul=null;function Mh(t,e,n,r){if(Ul=null,t=Tp(r),t=Cr(t),t!==null)if(e=Jr(t),e===null)t=null;else if(n=e.tag,n===13){if(t=kv(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Ul=t,null}function Xv(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(cA()){case Sp:return 1;case Bv:return 4;case Fl:case uA:return 16;case Uv:return 536870912;default:return 16}default:return 16}}var Yn=null,bp=null,ul=null;function Yv(){if(ul)return ul;var t,e=bp,n=e.length,r,i="value"in Yn?Yn.value:Yn.textContent,s=i.length;for(t=0;t<n&&e[t]===i[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===i[s-r];r++);return ul=i.slice(t,1<r?1-r:void 0)}function fl(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Ca(){return!0}function __(){return!1}function vt(t){function e(n,r,i,s,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Ca:__,this.isPropagationStopped=__,this}return Se(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Ca)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Ca)},persist:function(){},isPersistent:Ca}),e}var ms={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Rp=vt(ms),ea=Se({},ms,{view:0,detail:0}),wA=vt(ea),sf,of,Os,cu=Se({},ea,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Pp,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Os&&(Os&&t.type==="mousemove"?(sf=t.screenX-Os.screenX,of=t.screenY-Os.screenY):of=sf=0,Os=t),sf)},movementY:function(t){return"movementY"in t?t.movementY:of}}),m_=vt(cu),AA=Se({},cu,{dataTransfer:0}),bA=vt(AA),RA=Se({},ea,{relatedTarget:0}),af=vt(RA),PA=Se({},ms,{animationName:0,elapsedTime:0,pseudoElement:0}),CA=vt(PA),xA=Se({},ms,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),IA=vt(xA),MA=Se({},ms,{data:0}),y_=vt(MA),OA={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kA={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},NA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function FA(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=NA[t])?!!e[t]:!1}function Pp(){return FA}var DA=Se({},ea,{key:function(t){if(t.key){var e=OA[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=fl(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?kA[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Pp,charCode:function(t){return t.type==="keypress"?fl(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?fl(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),BA=vt(DA),UA=Se({},cu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),v_=vt(UA),LA=Se({},ea,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Pp}),zA=vt(LA),VA=Se({},ms,{propertyName:0,elapsedTime:0,pseudoElement:0}),WA=vt(VA),jA=Se({},cu,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),HA=vt(jA),$A=[9,13,27,32],Cp=Pn&&"CompositionEvent"in window,no=null;Pn&&"documentMode"in document&&(no=document.documentMode);var XA=Pn&&"TextEvent"in window&&!no,Kv=Pn&&(!Cp||no&&8<no&&11>=no),T_=String.fromCharCode(32),S_=!1;function qv(t,e){switch(t){case"keyup":return $A.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Zv(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var mi=!1;function YA(t,e){switch(t){case"compositionend":return Zv(e);case"keypress":return e.which!==32?null:(S_=!0,T_);case"textInput":return t=e.data,t===T_&&S_?null:t;default:return null}}function KA(t,e){if(mi)return t==="compositionend"||!Cp&&qv(t,e)?(t=Yv(),ul=bp=Yn=null,mi=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Kv&&e.locale!=="ko"?null:e.data;default:return null}}var qA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function E_(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!qA[t.type]:e==="textarea"}function Qv(t,e,n,r){Cv(r),e=Ll(e,"onChange"),0<e.length&&(n=new Rp("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var ro=null,Ro=null;function ZA(t){lT(t,0)}function uu(t){var e=Ti(t);if(Sv(e))return t}function QA(t,e){if(t==="change")return e}var Jv=!1;if(Pn){var lf;if(Pn){var cf="oninput"in document;if(!cf){var w_=document.createElement("div");w_.setAttribute("oninput","return;"),cf=typeof w_.oninput=="function"}lf=cf}else lf=!1;Jv=lf&&(!document.documentMode||9<document.documentMode)}function A_(){ro&&(ro.detachEvent("onpropertychange",Gv),Ro=ro=null)}function Gv(t){if(t.propertyName==="value"&&uu(Ro)){var e=[];Qv(e,Ro,t,Tp(t)),Ov(ZA,e)}}function JA(t,e,n){t==="focusin"?(A_(),ro=e,Ro=n,ro.attachEvent("onpropertychange",Gv)):t==="focusout"&&A_()}function GA(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return uu(Ro)}function eb(t,e){if(t==="click")return uu(e)}function tb(t,e){if(t==="input"||t==="change")return uu(e)}function nb(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var jt=typeof Object.is=="function"?Object.is:nb;function Po(t,e){if(jt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!dh.call(e,i)||!jt(t[i],e[i]))return!1}return!0}function b_(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function R_(t,e){var n=b_(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=b_(n)}}function eT(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?eT(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function tT(){for(var t=window,e=Ol();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Ol(t.document)}return e}function xp(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function rb(t){var e=tT(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&eT(n.ownerDocument.documentElement,n)){if(r!==null&&xp(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!t.extend&&s>r&&(i=r,r=s,s=i),i=R_(n,s);var o=R_(n,r);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var ib=Pn&&"documentMode"in document&&11>=document.documentMode,yi=null,Oh=null,io=null,kh=!1;function P_(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;kh||yi==null||yi!==Ol(r)||(r=yi,"selectionStart"in r&&xp(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),io&&Po(io,r)||(io=r,r=Ll(Oh,"onSelect"),0<r.length&&(e=new Rp("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=yi)))}function xa(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var vi={animationend:xa("Animation","AnimationEnd"),animationiteration:xa("Animation","AnimationIteration"),animationstart:xa("Animation","AnimationStart"),transitionend:xa("Transition","TransitionEnd")},uf={},nT={};Pn&&(nT=document.createElement("div").style,"AnimationEvent"in window||(delete vi.animationend.animation,delete vi.animationiteration.animation,delete vi.animationstart.animation),"TransitionEvent"in window||delete vi.transitionend.transition);function fu(t){if(uf[t])return uf[t];if(!vi[t])return t;var e=vi[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in nT)return uf[t]=e[n];return t}var rT=fu("animationend"),iT=fu("animationiteration"),sT=fu("animationstart"),oT=fu("transitionend"),aT=new Map,C_="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function pr(t,e){aT.set(t,e),Qr(e,[t])}for(var ff=0;ff<C_.length;ff++){var hf=C_[ff],sb=hf.toLowerCase(),ob=hf[0].toUpperCase()+hf.slice(1);pr(sb,"on"+ob)}pr(rT,"onAnimationEnd");pr(iT,"onAnimationIteration");pr(sT,"onAnimationStart");pr("dblclick","onDoubleClick");pr("focusin","onFocus");pr("focusout","onBlur");pr(oT,"onTransitionEnd");Yi("onMouseEnter",["mouseout","mouseover"]);Yi("onMouseLeave",["mouseout","mouseover"]);Yi("onPointerEnter",["pointerout","pointerover"]);Yi("onPointerLeave",["pointerout","pointerover"]);Qr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Qr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Qr("onBeforeInput",["compositionend","keypress","textInput","paste"]);Qr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Qr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Qr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ys="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ab=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ys));function x_(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,sA(r,e,void 0,t),t.currentTarget=null}function lT(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;x_(i,a,c),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;x_(i,a,c),s=l}}}if(Nl)throw t=Ch,Nl=!1,Ch=null,t}function he(t,e){var n=e[Uh];n===void 0&&(n=e[Uh]=new Set);var r=t+"__bubble";n.has(r)||(cT(e,t,2,!1),n.add(r))}function df(t,e,n){var r=0;e&&(r|=4),cT(n,t,r,e)}var Ia="_reactListening"+Math.random().toString(36).slice(2);function Co(t){if(!t[Ia]){t[Ia]=!0,_v.forEach(function(n){n!=="selectionchange"&&(ab.has(n)||df(n,!1,t),df(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Ia]||(e[Ia]=!0,df("selectionchange",!1,e))}}function cT(t,e,n,r){switch(Xv(e)){case 1:var i=SA;break;case 4:i=EA;break;default:i=Ap}n=i.bind(null,e,n,t),i=void 0,!Ph||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function pf(t,e,n,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=Cr(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}Ov(function(){var c=s,u=Tp(n),f=[];e:{var h=aT.get(t);if(h!==void 0){var d=Rp,m=t;switch(t){case"keypress":if(fl(n)===0)break e;case"keydown":case"keyup":d=BA;break;case"focusin":m="focus",d=af;break;case"focusout":m="blur",d=af;break;case"beforeblur":case"afterblur":d=af;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":d=m_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":d=bA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":d=zA;break;case rT:case iT:case sT:d=CA;break;case oT:d=WA;break;case"scroll":d=wA;break;case"wheel":d=HA;break;case"copy":case"cut":case"paste":d=IA;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":d=v_}var T=(e&4)!==0,A=!T&&t==="scroll",g=T?h!==null?h+"Capture":null:h;T=[];for(var p=c,_;p!==null;){_=p;var w=_.stateNode;if(_.tag===5&&w!==null&&(_=w,g!==null&&(w=Eo(p,g),w!=null&&T.push(xo(p,w,_)))),A)break;p=p.return}0<T.length&&(h=new d(h,m,null,n,u),f.push({event:h,listeners:T}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",d=t==="mouseout"||t==="pointerout",h&&n!==bh&&(m=n.relatedTarget||n.fromElement)&&(Cr(m)||m[Cn]))break e;if((d||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,d?(m=n.relatedTarget||n.toElement,d=c,m=m?Cr(m):null,m!==null&&(A=Jr(m),m!==A||m.tag!==5&&m.tag!==6)&&(m=null)):(d=null,m=c),d!==m)){if(T=m_,w="onMouseLeave",g="onMouseEnter",p="mouse",(t==="pointerout"||t==="pointerover")&&(T=v_,w="onPointerLeave",g="onPointerEnter",p="pointer"),A=d==null?h:Ti(d),_=m==null?h:Ti(m),h=new T(w,p+"leave",d,n,u),h.target=A,h.relatedTarget=_,w=null,Cr(u)===c&&(T=new T(g,p+"enter",m,n,u),T.target=_,T.relatedTarget=A,w=T),A=w,d&&m)t:{for(T=d,g=m,p=0,_=T;_;_=si(_))p++;for(_=0,w=g;w;w=si(w))_++;for(;0<p-_;)T=si(T),p--;for(;0<_-p;)g=si(g),_--;for(;p--;){if(T===g||g!==null&&T===g.alternate)break t;T=si(T),g=si(g)}T=null}else T=null;d!==null&&I_(f,h,d,T,!1),m!==null&&A!==null&&I_(f,A,m,T,!0)}}e:{if(h=c?Ti(c):window,d=h.nodeName&&h.nodeName.toLowerCase(),d==="select"||d==="input"&&h.type==="file")var R=QA;else if(E_(h))if(Jv)R=tb;else{R=GA;var x=JA}else(d=h.nodeName)&&d.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(R=eb);if(R&&(R=R(t,c))){Qv(f,R,n,u);break e}x&&x(t,h,c),t==="focusout"&&(x=h._wrapperState)&&x.controlled&&h.type==="number"&&Th(h,"number",h.value)}switch(x=c?Ti(c):window,t){case"focusin":(E_(x)||x.contentEditable==="true")&&(yi=x,Oh=c,io=null);break;case"focusout":io=Oh=yi=null;break;case"mousedown":kh=!0;break;case"contextmenu":case"mouseup":case"dragend":kh=!1,P_(f,n,u);break;case"selectionchange":if(ib)break;case"keydown":case"keyup":P_(f,n,u)}var M;if(Cp)e:{switch(t){case"compositionstart":var k="onCompositionStart";break e;case"compositionend":k="onCompositionEnd";break e;case"compositionupdate":k="onCompositionUpdate";break e}k=void 0}else mi?qv(t,n)&&(k="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(k="onCompositionStart");k&&(Kv&&n.locale!=="ko"&&(mi||k!=="onCompositionStart"?k==="onCompositionEnd"&&mi&&(M=Yv()):(Yn=u,bp="value"in Yn?Yn.value:Yn.textContent,mi=!0)),x=Ll(c,k),0<x.length&&(k=new y_(k,t,null,n,u),f.push({event:k,listeners:x}),M?k.data=M:(M=Zv(n),M!==null&&(k.data=M)))),(M=XA?YA(t,n):KA(t,n))&&(c=Ll(c,"onBeforeInput"),0<c.length&&(u=new y_("onBeforeInput","beforeinput",null,n,u),f.push({event:u,listeners:c}),u.data=M))}lT(f,e)})}function xo(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Ll(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=Eo(t,n),s!=null&&r.unshift(xo(t,s,i)),s=Eo(t,e),s!=null&&r.push(xo(t,s,i))),t=t.return}return r}function si(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function I_(t,e,n,r,i){for(var s=e._reactName,o=[];n!==null&&n!==r;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,i?(l=Eo(n,s),l!=null&&o.unshift(xo(n,l,a))):i||(l=Eo(n,s),l!=null&&o.push(xo(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var lb=/\r\n?/g,cb=/\u0000|\uFFFD/g;function M_(t){return(typeof t=="string"?t:""+t).replace(lb,`
`).replace(cb,"")}function Ma(t,e,n){if(e=M_(e),M_(t)!==e&&n)throw Error(D(425))}function zl(){}var Nh=null,Fh=null;function Dh(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Bh=typeof setTimeout=="function"?setTimeout:void 0,ub=typeof clearTimeout=="function"?clearTimeout:void 0,O_=typeof Promise=="function"?Promise:void 0,fb=typeof queueMicrotask=="function"?queueMicrotask:typeof O_<"u"?function(t){return O_.resolve(null).then(t).catch(hb)}:Bh;function hb(t){setTimeout(function(){throw t})}function gf(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),bo(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);bo(e)}function nr(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function k_(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var ys=Math.random().toString(36).slice(2),sn="__reactFiber$"+ys,Io="__reactProps$"+ys,Cn="__reactContainer$"+ys,Uh="__reactEvents$"+ys,db="__reactListeners$"+ys,pb="__reactHandles$"+ys;function Cr(t){var e=t[sn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Cn]||n[sn]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=k_(t);t!==null;){if(n=t[sn])return n;t=k_(t)}return e}t=n,n=t.parentNode}return null}function ta(t){return t=t[sn]||t[Cn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Ti(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(D(33))}function hu(t){return t[Io]||null}var Lh=[],Si=-1;function gr(t){return{current:t}}function pe(t){0>Si||(t.current=Lh[Si],Lh[Si]=null,Si--)}function ce(t,e){Si++,Lh[Si]=t.current,t.current=e}var ur={},qe=gr(ur),at=gr(!1),Wr=ur;function Ki(t,e){var n=t.type.contextTypes;if(!n)return ur;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in n)i[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function lt(t){return t=t.childContextTypes,t!=null}function Vl(){pe(at),pe(qe)}function N_(t,e,n){if(qe.current!==ur)throw Error(D(168));ce(qe,e),ce(at,n)}function uT(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(D(108,J1(t)||"Unknown",i));return Se({},n,r)}function Wl(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||ur,Wr=qe.current,ce(qe,t),ce(at,at.current),!0}function F_(t,e,n){var r=t.stateNode;if(!r)throw Error(D(169));n?(t=uT(t,e,Wr),r.__reactInternalMemoizedMergedChildContext=t,pe(at),pe(qe),ce(qe,t)):pe(at),ce(at,n)}var Sn=null,du=!1,_f=!1;function fT(t){Sn===null?Sn=[t]:Sn.push(t)}function gb(t){du=!0,fT(t)}function _r(){if(!_f&&Sn!==null){_f=!0;var t=0,e=ie;try{var n=Sn;for(ie=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Sn=null,du=!1}catch(i){throw Sn!==null&&(Sn=Sn.slice(t+1)),Dv(Sp,_r),i}finally{ie=e,_f=!1}}return null}var Ei=[],wi=0,jl=null,Hl=0,Et=[],wt=0,jr=null,wn=1,An="";function Er(t,e){Ei[wi++]=Hl,Ei[wi++]=jl,jl=t,Hl=e}function hT(t,e,n){Et[wt++]=wn,Et[wt++]=An,Et[wt++]=jr,jr=t;var r=wn;t=An;var i=32-Lt(r)-1;r&=~(1<<i),n+=1;var s=32-Lt(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,wn=1<<32-Lt(e)+i|n<<i|r,An=s+t}else wn=1<<s|n<<i|r,An=t}function Ip(t){t.return!==null&&(Er(t,1),hT(t,1,0))}function Mp(t){for(;t===jl;)jl=Ei[--wi],Ei[wi]=null,Hl=Ei[--wi],Ei[wi]=null;for(;t===jr;)jr=Et[--wt],Et[wt]=null,An=Et[--wt],Et[wt]=null,wn=Et[--wt],Et[wt]=null}var _t=null,pt=null,ge=!1,Ft=null;function dT(t,e){var n=At(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function D_(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,_t=t,pt=nr(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,_t=t,pt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=jr!==null?{id:wn,overflow:An}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=At(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,_t=t,pt=null,!0):!1;default:return!1}}function zh(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Vh(t){if(ge){var e=pt;if(e){var n=e;if(!D_(t,e)){if(zh(t))throw Error(D(418));e=nr(n.nextSibling);var r=_t;e&&D_(t,e)?dT(r,n):(t.flags=t.flags&-4097|2,ge=!1,_t=t)}}else{if(zh(t))throw Error(D(418));t.flags=t.flags&-4097|2,ge=!1,_t=t}}}function B_(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;_t=t}function Oa(t){if(t!==_t)return!1;if(!ge)return B_(t),ge=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Dh(t.type,t.memoizedProps)),e&&(e=pt)){if(zh(t))throw pT(),Error(D(418));for(;e;)dT(t,e),e=nr(e.nextSibling)}if(B_(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(D(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){pt=nr(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}pt=null}}else pt=_t?nr(t.stateNode.nextSibling):null;return!0}function pT(){for(var t=pt;t;)t=nr(t.nextSibling)}function qi(){pt=_t=null,ge=!1}function Op(t){Ft===null?Ft=[t]:Ft.push(t)}var _b=On.ReactCurrentBatchConfig;function ks(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(D(309));var r=n.stateNode}if(!r)throw Error(D(147,t));var i=r,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(D(284));if(!n._owner)throw Error(D(290,t))}return t}function ka(t,e){throw t=Object.prototype.toString.call(e),Error(D(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function U_(t){var e=t._init;return e(t._payload)}function gT(t){function e(g,p){if(t){var _=g.deletions;_===null?(g.deletions=[p],g.flags|=16):_.push(p)}}function n(g,p){if(!t)return null;for(;p!==null;)e(g,p),p=p.sibling;return null}function r(g,p){for(g=new Map;p!==null;)p.key!==null?g.set(p.key,p):g.set(p.index,p),p=p.sibling;return g}function i(g,p){return g=or(g,p),g.index=0,g.sibling=null,g}function s(g,p,_){return g.index=_,t?(_=g.alternate,_!==null?(_=_.index,_<p?(g.flags|=2,p):_):(g.flags|=2,p)):(g.flags|=1048576,p)}function o(g){return t&&g.alternate===null&&(g.flags|=2),g}function a(g,p,_,w){return p===null||p.tag!==6?(p=wf(_,g.mode,w),p.return=g,p):(p=i(p,_),p.return=g,p)}function l(g,p,_,w){var R=_.type;return R===_i?u(g,p,_.props.children,w,_.key):p!==null&&(p.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===Vn&&U_(R)===p.type)?(w=i(p,_.props),w.ref=ks(g,p,_),w.return=g,w):(w=yl(_.type,_.key,_.props,null,g.mode,w),w.ref=ks(g,p,_),w.return=g,w)}function c(g,p,_,w){return p===null||p.tag!==4||p.stateNode.containerInfo!==_.containerInfo||p.stateNode.implementation!==_.implementation?(p=Af(_,g.mode,w),p.return=g,p):(p=i(p,_.children||[]),p.return=g,p)}function u(g,p,_,w,R){return p===null||p.tag!==7?(p=Dr(_,g.mode,w,R),p.return=g,p):(p=i(p,_),p.return=g,p)}function f(g,p,_){if(typeof p=="string"&&p!==""||typeof p=="number")return p=wf(""+p,g.mode,_),p.return=g,p;if(typeof p=="object"&&p!==null){switch(p.$$typeof){case Ea:return _=yl(p.type,p.key,p.props,null,g.mode,_),_.ref=ks(g,null,p),_.return=g,_;case gi:return p=Af(p,g.mode,_),p.return=g,p;case Vn:var w=p._init;return f(g,w(p._payload),_)}if($s(p)||Cs(p))return p=Dr(p,g.mode,_,null),p.return=g,p;ka(g,p)}return null}function h(g,p,_,w){var R=p!==null?p.key:null;if(typeof _=="string"&&_!==""||typeof _=="number")return R!==null?null:a(g,p,""+_,w);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case Ea:return _.key===R?l(g,p,_,w):null;case gi:return _.key===R?c(g,p,_,w):null;case Vn:return R=_._init,h(g,p,R(_._payload),w)}if($s(_)||Cs(_))return R!==null?null:u(g,p,_,w,null);ka(g,_)}return null}function d(g,p,_,w,R){if(typeof w=="string"&&w!==""||typeof w=="number")return g=g.get(_)||null,a(p,g,""+w,R);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Ea:return g=g.get(w.key===null?_:w.key)||null,l(p,g,w,R);case gi:return g=g.get(w.key===null?_:w.key)||null,c(p,g,w,R);case Vn:var x=w._init;return d(g,p,_,x(w._payload),R)}if($s(w)||Cs(w))return g=g.get(_)||null,u(p,g,w,R,null);ka(p,w)}return null}function m(g,p,_,w){for(var R=null,x=null,M=p,k=p=0,F=null;M!==null&&k<_.length;k++){M.index>k?(F=M,M=null):F=M.sibling;var U=h(g,M,_[k],w);if(U===null){M===null&&(M=F);break}t&&M&&U.alternate===null&&e(g,M),p=s(U,p,k),x===null?R=U:x.sibling=U,x=U,M=F}if(k===_.length)return n(g,M),ge&&Er(g,k),R;if(M===null){for(;k<_.length;k++)M=f(g,_[k],w),M!==null&&(p=s(M,p,k),x===null?R=M:x.sibling=M,x=M);return ge&&Er(g,k),R}for(M=r(g,M);k<_.length;k++)F=d(M,g,k,_[k],w),F!==null&&(t&&F.alternate!==null&&M.delete(F.key===null?k:F.key),p=s(F,p,k),x===null?R=F:x.sibling=F,x=F);return t&&M.forEach(function(j){return e(g,j)}),ge&&Er(g,k),R}function T(g,p,_,w){var R=Cs(_);if(typeof R!="function")throw Error(D(150));if(_=R.call(_),_==null)throw Error(D(151));for(var x=R=null,M=p,k=p=0,F=null,U=_.next();M!==null&&!U.done;k++,U=_.next()){M.index>k?(F=M,M=null):F=M.sibling;var j=h(g,M,U.value,w);if(j===null){M===null&&(M=F);break}t&&M&&j.alternate===null&&e(g,M),p=s(j,p,k),x===null?R=j:x.sibling=j,x=j,M=F}if(U.done)return n(g,M),ge&&Er(g,k),R;if(M===null){for(;!U.done;k++,U=_.next())U=f(g,U.value,w),U!==null&&(p=s(U,p,k),x===null?R=U:x.sibling=U,x=U);return ge&&Er(g,k),R}for(M=r(g,M);!U.done;k++,U=_.next())U=d(M,g,k,U.value,w),U!==null&&(t&&U.alternate!==null&&M.delete(U.key===null?k:U.key),p=s(U,p,k),x===null?R=U:x.sibling=U,x=U);return t&&M.forEach(function(X){return e(g,X)}),ge&&Er(g,k),R}function A(g,p,_,w){if(typeof _=="object"&&_!==null&&_.type===_i&&_.key===null&&(_=_.props.children),typeof _=="object"&&_!==null){switch(_.$$typeof){case Ea:e:{for(var R=_.key,x=p;x!==null;){if(x.key===R){if(R=_.type,R===_i){if(x.tag===7){n(g,x.sibling),p=i(x,_.props.children),p.return=g,g=p;break e}}else if(x.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===Vn&&U_(R)===x.type){n(g,x.sibling),p=i(x,_.props),p.ref=ks(g,x,_),p.return=g,g=p;break e}n(g,x);break}else e(g,x);x=x.sibling}_.type===_i?(p=Dr(_.props.children,g.mode,w,_.key),p.return=g,g=p):(w=yl(_.type,_.key,_.props,null,g.mode,w),w.ref=ks(g,p,_),w.return=g,g=w)}return o(g);case gi:e:{for(x=_.key;p!==null;){if(p.key===x)if(p.tag===4&&p.stateNode.containerInfo===_.containerInfo&&p.stateNode.implementation===_.implementation){n(g,p.sibling),p=i(p,_.children||[]),p.return=g,g=p;break e}else{n(g,p);break}else e(g,p);p=p.sibling}p=Af(_,g.mode,w),p.return=g,g=p}return o(g);case Vn:return x=_._init,A(g,p,x(_._payload),w)}if($s(_))return m(g,p,_,w);if(Cs(_))return T(g,p,_,w);ka(g,_)}return typeof _=="string"&&_!==""||typeof _=="number"?(_=""+_,p!==null&&p.tag===6?(n(g,p.sibling),p=i(p,_),p.return=g,g=p):(n(g,p),p=wf(_,g.mode,w),p.return=g,g=p),o(g)):n(g,p)}return A}var Zi=gT(!0),_T=gT(!1),$l=gr(null),Xl=null,Ai=null,kp=null;function Np(){kp=Ai=Xl=null}function Fp(t){var e=$l.current;pe($l),t._currentValue=e}function Wh(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function zi(t,e){Xl=t,kp=Ai=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(st=!0),t.firstContext=null)}function Ct(t){var e=t._currentValue;if(kp!==t)if(t={context:t,memoizedValue:e,next:null},Ai===null){if(Xl===null)throw Error(D(308));Ai=t,Xl.dependencies={lanes:0,firstContext:t}}else Ai=Ai.next=t;return e}var xr=null;function Dp(t){xr===null?xr=[t]:xr.push(t)}function mT(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,Dp(e)):(n.next=i.next,i.next=n),e.interleaved=n,xn(t,r)}function xn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Wn=!1;function Bp(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function yT(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Rn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function rr(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,ee&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,xn(t,n)}return i=r.interleaved,i===null?(e.next=e,Dp(r)):(e.next=i.next,i.next=e),r.interleaved=e,xn(t,n)}function hl(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Ep(t,n)}}function L_(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?i=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?i=s=e:s=s.next=e}else i=s=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Yl(t,e,n,r){var i=t.updateQueue;Wn=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var f=i.baseState;o=0,u=c=l=null,a=s;do{var h=a.lane,d=a.eventTime;if((r&h)===h){u!==null&&(u=u.next={eventTime:d,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=t,T=a;switch(h=e,d=n,T.tag){case 1:if(m=T.payload,typeof m=="function"){f=m.call(d,f,h);break e}f=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=T.payload,h=typeof m=="function"?m.call(d,f,h):m,h==null)break e;f=Se({},f,h);break e;case 2:Wn=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=i.effects,h===null?i.effects=[a]:h.push(a))}else d={eventTime:d,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=d,l=f):u=u.next=d,o|=h;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;h=a,a=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(1);if(u===null&&(l=f),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);$r|=o,t.lanes=o,t.memoizedState=f}}function z_(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(D(191,i));i.call(r)}}}var na={},un=gr(na),Mo=gr(na),Oo=gr(na);function Ir(t){if(t===na)throw Error(D(174));return t}function Up(t,e){switch(ce(Oo,e),ce(Mo,t),ce(un,na),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Eh(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Eh(e,t)}pe(un),ce(un,e)}function Qi(){pe(un),pe(Mo),pe(Oo)}function vT(t){Ir(Oo.current);var e=Ir(un.current),n=Eh(e,t.type);e!==n&&(ce(Mo,t),ce(un,n))}function Lp(t){Mo.current===t&&(pe(un),pe(Mo))}var ye=gr(0);function Kl(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var mf=[];function zp(){for(var t=0;t<mf.length;t++)mf[t]._workInProgressVersionPrimary=null;mf.length=0}var dl=On.ReactCurrentDispatcher,yf=On.ReactCurrentBatchConfig,Hr=0,Te=null,xe=null,Ne=null,ql=!1,so=!1,ko=0,mb=0;function He(){throw Error(D(321))}function Vp(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!jt(t[n],e[n]))return!1;return!0}function Wp(t,e,n,r,i,s){if(Hr=s,Te=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,dl.current=t===null||t.memoizedState===null?Sb:Eb,t=n(r,i),so){s=0;do{if(so=!1,ko=0,25<=s)throw Error(D(301));s+=1,Ne=xe=null,e.updateQueue=null,dl.current=wb,t=n(r,i)}while(so)}if(dl.current=Zl,e=xe!==null&&xe.next!==null,Hr=0,Ne=xe=Te=null,ql=!1,e)throw Error(D(300));return t}function jp(){var t=ko!==0;return ko=0,t}function nn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ne===null?Te.memoizedState=Ne=t:Ne=Ne.next=t,Ne}function xt(){if(xe===null){var t=Te.alternate;t=t!==null?t.memoizedState:null}else t=xe.next;var e=Ne===null?Te.memoizedState:Ne.next;if(e!==null)Ne=e,xe=t;else{if(t===null)throw Error(D(310));xe=t,t={memoizedState:xe.memoizedState,baseState:xe.baseState,baseQueue:xe.baseQueue,queue:xe.queue,next:null},Ne===null?Te.memoizedState=Ne=t:Ne=Ne.next=t}return Ne}function No(t,e){return typeof e=="function"?e(t):e}function vf(t){var e=xt(),n=e.queue;if(n===null)throw Error(D(311));n.lastRenderedReducer=t;var r=xe,i=r.baseQueue,s=n.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,n.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((Hr&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:t(r,c.action);else{var f={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=f,o=r):l=l.next=f,Te.lanes|=u,$r|=u}c=c.next}while(c!==null&&c!==s);l===null?o=r:l.next=a,jt(r,e.memoizedState)||(st=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do s=i.lane,Te.lanes|=s,$r|=s,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Tf(t){var e=xt(),n=e.queue;if(n===null)throw Error(D(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,s=e.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do s=t(s,o.action),o=o.next;while(o!==i);jt(s,e.memoizedState)||(st=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,r]}function TT(){}function ST(t,e){var n=Te,r=xt(),i=e(),s=!jt(r.memoizedState,i);if(s&&(r.memoizedState=i,st=!0),r=r.queue,Hp(AT.bind(null,n,r,t),[t]),r.getSnapshot!==e||s||Ne!==null&&Ne.memoizedState.tag&1){if(n.flags|=2048,Fo(9,wT.bind(null,n,r,i,e),void 0,null),De===null)throw Error(D(349));Hr&30||ET(n,e,i)}return i}function ET(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Te.updateQueue,e===null?(e={lastEffect:null,stores:null},Te.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function wT(t,e,n,r){e.value=n,e.getSnapshot=r,bT(e)&&RT(t)}function AT(t,e,n){return n(function(){bT(e)&&RT(t)})}function bT(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!jt(t,n)}catch{return!0}}function RT(t){var e=xn(t,1);e!==null&&zt(e,t,1,-1)}function V_(t){var e=nn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:No,lastRenderedState:t},e.queue=t,t=t.dispatch=Tb.bind(null,Te,t),[e.memoizedState,t]}function Fo(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Te.updateQueue,e===null?(e={lastEffect:null,stores:null},Te.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function PT(){return xt().memoizedState}function pl(t,e,n,r){var i=nn();Te.flags|=t,i.memoizedState=Fo(1|e,n,void 0,r===void 0?null:r)}function pu(t,e,n,r){var i=xt();r=r===void 0?null:r;var s=void 0;if(xe!==null){var o=xe.memoizedState;if(s=o.destroy,r!==null&&Vp(r,o.deps)){i.memoizedState=Fo(e,n,s,r);return}}Te.flags|=t,i.memoizedState=Fo(1|e,n,s,r)}function W_(t,e){return pl(8390656,8,t,e)}function Hp(t,e){return pu(2048,8,t,e)}function CT(t,e){return pu(4,2,t,e)}function xT(t,e){return pu(4,4,t,e)}function IT(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function MT(t,e,n){return n=n!=null?n.concat([t]):null,pu(4,4,IT.bind(null,e,t),n)}function $p(){}function OT(t,e){var n=xt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Vp(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function kT(t,e){var n=xt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Vp(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function NT(t,e,n){return Hr&21?(jt(n,e)||(n=Lv(),Te.lanes|=n,$r|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,st=!0),t.memoizedState=n)}function yb(t,e){var n=ie;ie=n!==0&&4>n?n:4,t(!0);var r=yf.transition;yf.transition={};try{t(!1),e()}finally{ie=n,yf.transition=r}}function FT(){return xt().memoizedState}function vb(t,e,n){var r=sr(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},DT(t))BT(e,n);else if(n=mT(t,e,n,r),n!==null){var i=et();zt(n,t,r,i),UT(n,e,r)}}function Tb(t,e,n){var r=sr(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(DT(t))BT(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(i.hasEagerState=!0,i.eagerState=a,jt(a,o)){var l=e.interleaved;l===null?(i.next=i,Dp(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}n=mT(t,e,i,r),n!==null&&(i=et(),zt(n,t,r,i),UT(n,e,r))}}function DT(t){var e=t.alternate;return t===Te||e!==null&&e===Te}function BT(t,e){so=ql=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function UT(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Ep(t,n)}}var Zl={readContext:Ct,useCallback:He,useContext:He,useEffect:He,useImperativeHandle:He,useInsertionEffect:He,useLayoutEffect:He,useMemo:He,useReducer:He,useRef:He,useState:He,useDebugValue:He,useDeferredValue:He,useTransition:He,useMutableSource:He,useSyncExternalStore:He,useId:He,unstable_isNewReconciler:!1},Sb={readContext:Ct,useCallback:function(t,e){return nn().memoizedState=[t,e===void 0?null:e],t},useContext:Ct,useEffect:W_,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,pl(4194308,4,IT.bind(null,e,t),n)},useLayoutEffect:function(t,e){return pl(4194308,4,t,e)},useInsertionEffect:function(t,e){return pl(4,2,t,e)},useMemo:function(t,e){var n=nn();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=nn();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=vb.bind(null,Te,t),[r.memoizedState,t]},useRef:function(t){var e=nn();return t={current:t},e.memoizedState=t},useState:V_,useDebugValue:$p,useDeferredValue:function(t){return nn().memoizedState=t},useTransition:function(){var t=V_(!1),e=t[0];return t=yb.bind(null,t[1]),nn().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Te,i=nn();if(ge){if(n===void 0)throw Error(D(407));n=n()}else{if(n=e(),De===null)throw Error(D(349));Hr&30||ET(r,e,n)}i.memoizedState=n;var s={value:n,getSnapshot:e};return i.queue=s,W_(AT.bind(null,r,s,t),[t]),r.flags|=2048,Fo(9,wT.bind(null,r,s,n,e),void 0,null),n},useId:function(){var t=nn(),e=De.identifierPrefix;if(ge){var n=An,r=wn;n=(r&~(1<<32-Lt(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=ko++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=mb++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Eb={readContext:Ct,useCallback:OT,useContext:Ct,useEffect:Hp,useImperativeHandle:MT,useInsertionEffect:CT,useLayoutEffect:xT,useMemo:kT,useReducer:vf,useRef:PT,useState:function(){return vf(No)},useDebugValue:$p,useDeferredValue:function(t){var e=xt();return NT(e,xe.memoizedState,t)},useTransition:function(){var t=vf(No)[0],e=xt().memoizedState;return[t,e]},useMutableSource:TT,useSyncExternalStore:ST,useId:FT,unstable_isNewReconciler:!1},wb={readContext:Ct,useCallback:OT,useContext:Ct,useEffect:Hp,useImperativeHandle:MT,useInsertionEffect:CT,useLayoutEffect:xT,useMemo:kT,useReducer:Tf,useRef:PT,useState:function(){return Tf(No)},useDebugValue:$p,useDeferredValue:function(t){var e=xt();return xe===null?e.memoizedState=t:NT(e,xe.memoizedState,t)},useTransition:function(){var t=Tf(No)[0],e=xt().memoizedState;return[t,e]},useMutableSource:TT,useSyncExternalStore:ST,useId:FT,unstable_isNewReconciler:!1};function kt(t,e){if(t&&t.defaultProps){e=Se({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function jh(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Se({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var gu={isMounted:function(t){return(t=t._reactInternals)?Jr(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=et(),i=sr(t),s=Rn(r,i);s.payload=e,n!=null&&(s.callback=n),e=rr(t,s,i),e!==null&&(zt(e,t,i,r),hl(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=et(),i=sr(t),s=Rn(r,i);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=rr(t,s,i),e!==null&&(zt(e,t,i,r),hl(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=et(),r=sr(t),i=Rn(n,r);i.tag=2,e!=null&&(i.callback=e),e=rr(t,i,r),e!==null&&(zt(e,t,r,n),hl(e,t,r))}};function j_(t,e,n,r,i,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!Po(n,r)||!Po(i,s):!0}function LT(t,e,n){var r=!1,i=ur,s=e.contextType;return typeof s=="object"&&s!==null?s=Ct(s):(i=lt(e)?Wr:qe.current,r=e.contextTypes,s=(r=r!=null)?Ki(t,i):ur),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=gu,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function H_(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&gu.enqueueReplaceState(e,e.state,null)}function Hh(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},Bp(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=Ct(s):(s=lt(e)?Wr:qe.current,i.context=Ki(t,s)),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(jh(t,e,s,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&gu.enqueueReplaceState(i,i.state,null),Yl(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function Ji(t,e){try{var n="",r=e;do n+=Q1(r),r=r.return;while(r);var i=n}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i,digest:null}}function Sf(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function $h(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Ab=typeof WeakMap=="function"?WeakMap:Map;function zT(t,e,n){n=Rn(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Jl||(Jl=!0,td=r),$h(t,e)},n}function VT(t,e,n){n=Rn(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){$h(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){$h(t,e),typeof r!="function"&&(ir===null?ir=new Set([this]):ir.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function $_(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new Ab;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=Ub.bind(null,t,e,n),e.then(t,t))}function X_(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Y_(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Rn(-1,1),e.tag=2,rr(n,e,1))),n.lanes|=1),t)}var bb=On.ReactCurrentOwner,st=!1;function Ge(t,e,n,r){e.child=t===null?_T(e,null,n,r):Zi(e,t.child,n,r)}function K_(t,e,n,r,i){n=n.render;var s=e.ref;return zi(e,i),r=Wp(t,e,n,r,s,i),n=jp(),t!==null&&!st?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,In(t,e,i)):(ge&&n&&Ip(e),e.flags|=1,Ge(t,e,r,i),e.child)}function q_(t,e,n,r,i){if(t===null){var s=n.type;return typeof s=="function"&&!Gp(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,WT(t,e,s,r,i)):(t=yl(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&i)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Po,n(o,r)&&t.ref===e.ref)return In(t,e,i)}return e.flags|=1,t=or(s,r),t.ref=e.ref,t.return=e,e.child=t}function WT(t,e,n,r,i){if(t!==null){var s=t.memoizedProps;if(Po(s,r)&&t.ref===e.ref)if(st=!1,e.pendingProps=r=s,(t.lanes&i)!==0)t.flags&131072&&(st=!0);else return e.lanes=t.lanes,In(t,e,i)}return Xh(t,e,n,r,i)}function jT(t,e,n){var r=e.pendingProps,i=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ce(Ri,ht),ht|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ce(Ri,ht),ht|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,ce(Ri,ht),ht|=r}else s!==null?(r=s.baseLanes|n,e.memoizedState=null):r=n,ce(Ri,ht),ht|=r;return Ge(t,e,i,n),e.child}function HT(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Xh(t,e,n,r,i){var s=lt(n)?Wr:qe.current;return s=Ki(e,s),zi(e,i),n=Wp(t,e,n,r,s,i),r=jp(),t!==null&&!st?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,In(t,e,i)):(ge&&r&&Ip(e),e.flags|=1,Ge(t,e,n,i),e.child)}function Z_(t,e,n,r,i){if(lt(n)){var s=!0;Wl(e)}else s=!1;if(zi(e,i),e.stateNode===null)gl(t,e),LT(e,n,r),Hh(e,n,r,i),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=Ct(c):(c=lt(n)?Wr:qe.current,c=Ki(e,c));var u=n.getDerivedStateFromProps,f=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==c)&&H_(e,o,r,c),Wn=!1;var h=e.memoizedState;o.state=h,Yl(e,r,o,i),l=e.memoizedState,a!==r||h!==l||at.current||Wn?(typeof u=="function"&&(jh(e,n,u,r),l=e.memoizedState),(a=Wn||j_(e,n,a,r,h,l,c))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,yT(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:kt(e.type,a),o.props=c,f=e.pendingProps,h=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=Ct(l):(l=lt(n)?Wr:qe.current,l=Ki(e,l));var d=n.getDerivedStateFromProps;(u=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||h!==l)&&H_(e,o,r,l),Wn=!1,h=e.memoizedState,o.state=h,Yl(e,r,o,i);var m=e.memoizedState;a!==f||h!==m||at.current||Wn?(typeof d=="function"&&(jh(e,n,d,r),m=e.memoizedState),(c=Wn||j_(e,n,c,r,h,m,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,m,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,m,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=m),o.props=r,o.state=m,o.context=l,r=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),r=!1)}return Yh(t,e,n,r,s,i)}function Yh(t,e,n,r,i,s){HT(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&F_(e,n,!1),In(t,e,s);r=e.stateNode,bb.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=Zi(e,t.child,null,s),e.child=Zi(e,null,a,s)):Ge(t,e,a,s),e.memoizedState=r.state,i&&F_(e,n,!0),e.child}function $T(t){var e=t.stateNode;e.pendingContext?N_(t,e.pendingContext,e.pendingContext!==e.context):e.context&&N_(t,e.context,!1),Up(t,e.containerInfo)}function Q_(t,e,n,r,i){return qi(),Op(i),e.flags|=256,Ge(t,e,n,r),e.child}var Kh={dehydrated:null,treeContext:null,retryLane:0};function qh(t){return{baseLanes:t,cachePool:null,transitions:null}}function XT(t,e,n){var r=e.pendingProps,i=ye.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),ce(ye,i&1),t===null)return Vh(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=yu(o,r,0,null),t=Dr(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=qh(n),e.memoizedState=Kh,t):Xp(e,o));if(i=t.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return Rb(t,e,o,r,a,i,n);if(s){s=r.fallback,o=e.mode,i=t.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=or(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=or(a,s):(s=Dr(s,o,n,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=t.child.memoizedState,o=o===null?qh(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=Kh,r}return s=t.child,t=s.sibling,r=or(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Xp(t,e){return e=yu({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Na(t,e,n,r){return r!==null&&Op(r),Zi(e,t.child,null,n),t=Xp(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Rb(t,e,n,r,i,s,o){if(n)return e.flags&256?(e.flags&=-257,r=Sf(Error(D(422))),Na(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=yu({mode:"visible",children:r.children},i,0,null),s=Dr(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&Zi(e,t.child,null,o),e.child.memoizedState=qh(o),e.memoizedState=Kh,s);if(!(e.mode&1))return Na(t,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(D(419)),r=Sf(s,r,void 0),Na(t,e,o,r)}if(a=(o&t.childLanes)!==0,st||a){if(r=De,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,xn(t,i),zt(r,t,i,-1))}return Jp(),r=Sf(Error(D(421))),Na(t,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=Lb.bind(null,t),i._reactRetry=e,null):(t=s.treeContext,pt=nr(i.nextSibling),_t=e,ge=!0,Ft=null,t!==null&&(Et[wt++]=wn,Et[wt++]=An,Et[wt++]=jr,wn=t.id,An=t.overflow,jr=e),e=Xp(e,r.children),e.flags|=4096,e)}function J_(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Wh(t.return,e,n)}function Ef(t,e,n,r,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function YT(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(Ge(t,e,r.children,n),r=ye.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&J_(t,n,e);else if(t.tag===19)J_(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(ce(ye,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&Kl(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),Ef(e,!1,i,n,s);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&Kl(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}Ef(e,!0,n,null,s);break;case"together":Ef(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function gl(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function In(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),$r|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(D(153));if(e.child!==null){for(t=e.child,n=or(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=or(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function Pb(t,e,n){switch(e.tag){case 3:$T(e),qi();break;case 5:vT(e);break;case 1:lt(e.type)&&Wl(e);break;case 4:Up(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;ce($l,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(ce(ye,ye.current&1),e.flags|=128,null):n&e.child.childLanes?XT(t,e,n):(ce(ye,ye.current&1),t=In(t,e,n),t!==null?t.sibling:null);ce(ye,ye.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return YT(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),ce(ye,ye.current),r)break;return null;case 22:case 23:return e.lanes=0,jT(t,e,n)}return In(t,e,n)}var KT,Zh,qT,ZT;KT=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Zh=function(){};qT=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,Ir(un.current);var s=null;switch(n){case"input":i=yh(t,i),r=yh(t,r),s=[];break;case"select":i=Se({},i,{value:void 0}),r=Se({},r,{value:void 0}),s=[];break;case"textarea":i=Sh(t,i),r=Sh(t,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=zl)}wh(n,r);var o;n=null;for(c in i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(To.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in r){var l=r[c];if(a=i!=null?i[c]:void 0,r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(To.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&he("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}n&&(s=s||[]).push("style",n);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};ZT=function(t,e,n,r){n!==r&&(e.flags|=4)};function Ns(t,e){if(!ge)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function $e(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function Cb(t,e,n){var r=e.pendingProps;switch(Mp(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $e(e),null;case 1:return lt(e.type)&&Vl(),$e(e),null;case 3:return r=e.stateNode,Qi(),pe(at),pe(qe),zp(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Oa(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ft!==null&&(id(Ft),Ft=null))),Zh(t,e),$e(e),null;case 5:Lp(e);var i=Ir(Oo.current);if(n=e.type,t!==null&&e.stateNode!=null)qT(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(D(166));return $e(e),null}if(t=Ir(un.current),Oa(e)){r=e.stateNode,n=e.type;var s=e.memoizedProps;switch(r[sn]=e,r[Io]=s,t=(e.mode&1)!==0,n){case"dialog":he("cancel",r),he("close",r);break;case"iframe":case"object":case"embed":he("load",r);break;case"video":case"audio":for(i=0;i<Ys.length;i++)he(Ys[i],r);break;case"source":he("error",r);break;case"img":case"image":case"link":he("error",r),he("load",r);break;case"details":he("toggle",r);break;case"input":a_(r,s),he("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},he("invalid",r);break;case"textarea":c_(r,s),he("invalid",r)}wh(n,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&Ma(r.textContent,a,t),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Ma(r.textContent,a,t),i=["children",""+a]):To.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&he("scroll",r)}switch(n){case"input":wa(r),l_(r,s,!0);break;case"textarea":wa(r),u_(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=zl)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Av(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[sn]=e,t[Io]=r,KT(t,e,!1,!1),e.stateNode=t;e:{switch(o=Ah(n,r),n){case"dialog":he("cancel",t),he("close",t),i=r;break;case"iframe":case"object":case"embed":he("load",t),i=r;break;case"video":case"audio":for(i=0;i<Ys.length;i++)he(Ys[i],t);i=r;break;case"source":he("error",t),i=r;break;case"img":case"image":case"link":he("error",t),he("load",t),i=r;break;case"details":he("toggle",t),i=r;break;case"input":a_(t,r),i=yh(t,r),he("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=Se({},r,{value:void 0}),he("invalid",t);break;case"textarea":c_(t,r),i=Sh(t,r),he("invalid",t);break;default:i=r}wh(n,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?Pv(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&bv(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&So(t,l):typeof l=="number"&&So(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(To.hasOwnProperty(s)?l!=null&&s==="onScroll"&&he("scroll",t):l!=null&&_p(t,s,l,o))}switch(n){case"input":wa(t),l_(t,r,!1);break;case"textarea":wa(t),u_(t);break;case"option":r.value!=null&&t.setAttribute("value",""+cr(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?Di(t,!!r.multiple,s,!1):r.defaultValue!=null&&Di(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=zl)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return $e(e),null;case 6:if(t&&e.stateNode!=null)ZT(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(D(166));if(n=Ir(Oo.current),Ir(un.current),Oa(e)){if(r=e.stateNode,n=e.memoizedProps,r[sn]=e,(s=r.nodeValue!==n)&&(t=_t,t!==null))switch(t.tag){case 3:Ma(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Ma(r.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[sn]=e,e.stateNode=r}return $e(e),null;case 13:if(pe(ye),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ge&&pt!==null&&e.mode&1&&!(e.flags&128))pT(),qi(),e.flags|=98560,s=!1;else if(s=Oa(e),r!==null&&r.dehydrated!==null){if(t===null){if(!s)throw Error(D(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(D(317));s[sn]=e}else qi(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;$e(e),s=!1}else Ft!==null&&(id(Ft),Ft=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||ye.current&1?Ie===0&&(Ie=3):Jp())),e.updateQueue!==null&&(e.flags|=4),$e(e),null);case 4:return Qi(),Zh(t,e),t===null&&Co(e.stateNode.containerInfo),$e(e),null;case 10:return Fp(e.type._context),$e(e),null;case 17:return lt(e.type)&&Vl(),$e(e),null;case 19:if(pe(ye),s=e.memoizedState,s===null)return $e(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)Ns(s,!1);else{if(Ie!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Kl(t),o!==null){for(e.flags|=128,Ns(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)s=n,t=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ce(ye,ye.current&1|2),e.child}t=t.sibling}s.tail!==null&&Ae()>Gi&&(e.flags|=128,r=!0,Ns(s,!1),e.lanes=4194304)}else{if(!r)if(t=Kl(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Ns(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!ge)return $e(e),null}else 2*Ae()-s.renderingStartTime>Gi&&n!==1073741824&&(e.flags|=128,r=!0,Ns(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Ae(),e.sibling=null,n=ye.current,ce(ye,r?n&1|2:n&1),e):($e(e),null);case 22:case 23:return Qp(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?ht&1073741824&&($e(e),e.subtreeFlags&6&&(e.flags|=8192)):$e(e),null;case 24:return null;case 25:return null}throw Error(D(156,e.tag))}function xb(t,e){switch(Mp(e),e.tag){case 1:return lt(e.type)&&Vl(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Qi(),pe(at),pe(qe),zp(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Lp(e),null;case 13:if(pe(ye),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(D(340));qi()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return pe(ye),null;case 4:return Qi(),null;case 10:return Fp(e.type._context),null;case 22:case 23:return Qp(),null;case 24:return null;default:return null}}var Fa=!1,Ke=!1,Ib=typeof WeakSet=="function"?WeakSet:Set,V=null;function bi(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){we(t,e,r)}else n.current=null}function Qh(t,e,n){try{n()}catch(r){we(t,e,r)}}var G_=!1;function Mb(t,e){if(Nh=Bl,t=tT(),xp(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,u=0,f=t,h=null;t:for(;;){for(var d;f!==n||i!==0&&f.nodeType!==3||(a=o+i),f!==s||r!==0&&f.nodeType!==3||(l=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(d=f.firstChild)!==null;)h=f,f=d;for(;;){if(f===t)break t;if(h===n&&++c===i&&(a=o),h===s&&++u===r&&(l=o),(d=f.nextSibling)!==null)break;f=h,h=f.parentNode}f=d}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Fh={focusedElem:t,selectionRange:n},Bl=!1,V=e;V!==null;)if(e=V,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,V=t;else for(;V!==null;){e=V;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var T=m.memoizedProps,A=m.memoizedState,g=e.stateNode,p=g.getSnapshotBeforeUpdate(e.elementType===e.type?T:kt(e.type,T),A);g.__reactInternalSnapshotBeforeUpdate=p}break;case 3:var _=e.stateNode.containerInfo;_.nodeType===1?_.textContent="":_.nodeType===9&&_.documentElement&&_.removeChild(_.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(D(163))}}catch(w){we(e,e.return,w)}if(t=e.sibling,t!==null){t.return=e.return,V=t;break}V=e.return}return m=G_,G_=!1,m}function oo(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,s!==void 0&&Qh(e,n,s)}i=i.next}while(i!==r)}}function _u(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Jh(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function QT(t){var e=t.alternate;e!==null&&(t.alternate=null,QT(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[sn],delete e[Io],delete e[Uh],delete e[db],delete e[pb])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function JT(t){return t.tag===5||t.tag===3||t.tag===4}function em(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||JT(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Gh(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=zl));else if(r!==4&&(t=t.child,t!==null))for(Gh(t,e,n),t=t.sibling;t!==null;)Gh(t,e,n),t=t.sibling}function ed(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(ed(t,e,n),t=t.sibling;t!==null;)ed(t,e,n),t=t.sibling}var Le=null,Nt=!1;function Fn(t,e,n){for(n=n.child;n!==null;)GT(t,e,n),n=n.sibling}function GT(t,e,n){if(cn&&typeof cn.onCommitFiberUnmount=="function")try{cn.onCommitFiberUnmount(lu,n)}catch{}switch(n.tag){case 5:Ke||bi(n,e);case 6:var r=Le,i=Nt;Le=null,Fn(t,e,n),Le=r,Nt=i,Le!==null&&(Nt?(t=Le,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Le.removeChild(n.stateNode));break;case 18:Le!==null&&(Nt?(t=Le,n=n.stateNode,t.nodeType===8?gf(t.parentNode,n):t.nodeType===1&&gf(t,n),bo(t)):gf(Le,n.stateNode));break;case 4:r=Le,i=Nt,Le=n.stateNode.containerInfo,Nt=!0,Fn(t,e,n),Le=r,Nt=i;break;case 0:case 11:case 14:case 15:if(!Ke&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Qh(n,e,o),i=i.next}while(i!==r)}Fn(t,e,n);break;case 1:if(!Ke&&(bi(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){we(n,e,a)}Fn(t,e,n);break;case 21:Fn(t,e,n);break;case 22:n.mode&1?(Ke=(r=Ke)||n.memoizedState!==null,Fn(t,e,n),Ke=r):Fn(t,e,n);break;default:Fn(t,e,n)}}function tm(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Ib),e.forEach(function(r){var i=zb.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function Ot(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Le=a.stateNode,Nt=!1;break e;case 3:Le=a.stateNode.containerInfo,Nt=!0;break e;case 4:Le=a.stateNode.containerInfo,Nt=!0;break e}a=a.return}if(Le===null)throw Error(D(160));GT(s,o,i),Le=null,Nt=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){we(i,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)eS(e,t),e=e.sibling}function eS(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ot(e,t),Zt(t),r&4){try{oo(3,t,t.return),_u(3,t)}catch(T){we(t,t.return,T)}try{oo(5,t,t.return)}catch(T){we(t,t.return,T)}}break;case 1:Ot(e,t),Zt(t),r&512&&n!==null&&bi(n,n.return);break;case 5:if(Ot(e,t),Zt(t),r&512&&n!==null&&bi(n,n.return),t.flags&32){var i=t.stateNode;try{So(i,"")}catch(T){we(t,t.return,T)}}if(r&4&&(i=t.stateNode,i!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&Ev(i,s),Ah(a,o);var c=Ah(a,s);for(o=0;o<l.length;o+=2){var u=l[o],f=l[o+1];u==="style"?Pv(i,f):u==="dangerouslySetInnerHTML"?bv(i,f):u==="children"?So(i,f):_p(i,u,f,c)}switch(a){case"input":vh(i,s);break;case"textarea":wv(i,s);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var d=s.value;d!=null?Di(i,!!s.multiple,d,!1):h!==!!s.multiple&&(s.defaultValue!=null?Di(i,!!s.multiple,s.defaultValue,!0):Di(i,!!s.multiple,s.multiple?[]:"",!1))}i[Io]=s}catch(T){we(t,t.return,T)}}break;case 6:if(Ot(e,t),Zt(t),r&4){if(t.stateNode===null)throw Error(D(162));i=t.stateNode,s=t.memoizedProps;try{i.nodeValue=s}catch(T){we(t,t.return,T)}}break;case 3:if(Ot(e,t),Zt(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{bo(e.containerInfo)}catch(T){we(t,t.return,T)}break;case 4:Ot(e,t),Zt(t);break;case 13:Ot(e,t),Zt(t),i=t.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(qp=Ae())),r&4&&tm(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Ke=(c=Ke)||u,Ot(e,t),Ke=c):Ot(e,t),Zt(t),r&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(V=t,u=t.child;u!==null;){for(f=V=u;V!==null;){switch(h=V,d=h.child,h.tag){case 0:case 11:case 14:case 15:oo(4,h,h.return);break;case 1:bi(h,h.return);var m=h.stateNode;if(typeof m.componentWillUnmount=="function"){r=h,n=h.return;try{e=r,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(T){we(r,n,T)}}break;case 5:bi(h,h.return);break;case 22:if(h.memoizedState!==null){rm(f);continue}}d!==null?(d.return=h,V=d):rm(f)}u=u.sibling}e:for(u=null,f=t;;){if(f.tag===5){if(u===null){u=f;try{i=f.stateNode,c?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=Rv("display",o))}catch(T){we(t,t.return,T)}}}else if(f.tag===6){if(u===null)try{f.stateNode.nodeValue=c?"":f.memoizedProps}catch(T){we(t,t.return,T)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;u===f&&(u=null),f=f.return}u===f&&(u=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:Ot(e,t),Zt(t),r&4&&tm(t);break;case 21:break;default:Ot(e,t),Zt(t)}}function Zt(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(JT(n)){var r=n;break e}n=n.return}throw Error(D(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(So(i,""),r.flags&=-33);var s=em(t);ed(t,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=em(t);Gh(t,a,o);break;default:throw Error(D(161))}}catch(l){we(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Ob(t,e,n){V=t,tS(t)}function tS(t,e,n){for(var r=(t.mode&1)!==0;V!==null;){var i=V,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||Fa;if(!o){var a=i.alternate,l=a!==null&&a.memoizedState!==null||Ke;a=Fa;var c=Ke;if(Fa=o,(Ke=l)&&!c)for(V=i;V!==null;)o=V,l=o.child,o.tag===22&&o.memoizedState!==null?im(i):l!==null?(l.return=o,V=l):im(i);for(;s!==null;)V=s,tS(s),s=s.sibling;V=i,Fa=a,Ke=c}nm(t)}else i.subtreeFlags&8772&&s!==null?(s.return=i,V=s):nm(t)}}function nm(t){for(;V!==null;){var e=V;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ke||_u(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Ke)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:kt(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&z_(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}z_(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var f=u.dehydrated;f!==null&&bo(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(D(163))}Ke||e.flags&512&&Jh(e)}catch(h){we(e,e.return,h)}}if(e===t){V=null;break}if(n=e.sibling,n!==null){n.return=e.return,V=n;break}V=e.return}}function rm(t){for(;V!==null;){var e=V;if(e===t){V=null;break}var n=e.sibling;if(n!==null){n.return=e.return,V=n;break}V=e.return}}function im(t){for(;V!==null;){var e=V;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{_u(4,e)}catch(l){we(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){we(e,i,l)}}var s=e.return;try{Jh(e)}catch(l){we(e,s,l)}break;case 5:var o=e.return;try{Jh(e)}catch(l){we(e,o,l)}}}catch(l){we(e,e.return,l)}if(e===t){V=null;break}var a=e.sibling;if(a!==null){a.return=e.return,V=a;break}V=e.return}}var kb=Math.ceil,Ql=On.ReactCurrentDispatcher,Yp=On.ReactCurrentOwner,Rt=On.ReactCurrentBatchConfig,ee=0,De=null,Ce=null,Ve=0,ht=0,Ri=gr(0),Ie=0,Do=null,$r=0,mu=0,Kp=0,ao=null,it=null,qp=0,Gi=1/0,yn=null,Jl=!1,td=null,ir=null,Da=!1,Kn=null,Gl=0,lo=0,nd=null,_l=-1,ml=0;function et(){return ee&6?Ae():_l!==-1?_l:_l=Ae()}function sr(t){return t.mode&1?ee&2&&Ve!==0?Ve&-Ve:_b.transition!==null?(ml===0&&(ml=Lv()),ml):(t=ie,t!==0||(t=window.event,t=t===void 0?16:Xv(t.type)),t):1}function zt(t,e,n,r){if(50<lo)throw lo=0,nd=null,Error(D(185));Go(t,n,r),(!(ee&2)||t!==De)&&(t===De&&(!(ee&2)&&(mu|=n),Ie===4&&Xn(t,Ve)),ct(t,r),n===1&&ee===0&&!(e.mode&1)&&(Gi=Ae()+500,du&&_r()))}function ct(t,e){var n=t.callbackNode;_A(t,e);var r=Dl(t,t===De?Ve:0);if(r===0)n!==null&&d_(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&d_(n),e===1)t.tag===0?gb(sm.bind(null,t)):fT(sm.bind(null,t)),fb(function(){!(ee&6)&&_r()}),n=null;else{switch(zv(r)){case 1:n=Sp;break;case 4:n=Bv;break;case 16:n=Fl;break;case 536870912:n=Uv;break;default:n=Fl}n=cS(n,nS.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function nS(t,e){if(_l=-1,ml=0,ee&6)throw Error(D(327));var n=t.callbackNode;if(Vi()&&t.callbackNode!==n)return null;var r=Dl(t,t===De?Ve:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=ec(t,r);else{e=r;var i=ee;ee|=2;var s=iS();(De!==t||Ve!==e)&&(yn=null,Gi=Ae()+500,Fr(t,e));do try{Db();break}catch(a){rS(t,a)}while(1);Np(),Ql.current=s,ee=i,Ce!==null?e=0:(De=null,Ve=0,e=Ie)}if(e!==0){if(e===2&&(i=xh(t),i!==0&&(r=i,e=rd(t,i))),e===1)throw n=Do,Fr(t,0),Xn(t,r),ct(t,Ae()),n;if(e===6)Xn(t,r);else{if(i=t.current.alternate,!(r&30)&&!Nb(i)&&(e=ec(t,r),e===2&&(s=xh(t),s!==0&&(r=s,e=rd(t,s))),e===1))throw n=Do,Fr(t,0),Xn(t,r),ct(t,Ae()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(D(345));case 2:wr(t,it,yn);break;case 3:if(Xn(t,r),(r&130023424)===r&&(e=qp+500-Ae(),10<e)){if(Dl(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){et(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=Bh(wr.bind(null,t,it,yn),e);break}wr(t,it,yn);break;case 4:if(Xn(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var o=31-Lt(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=Ae()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*kb(r/1960))-r,10<r){t.timeoutHandle=Bh(wr.bind(null,t,it,yn),r);break}wr(t,it,yn);break;case 5:wr(t,it,yn);break;default:throw Error(D(329))}}}return ct(t,Ae()),t.callbackNode===n?nS.bind(null,t):null}function rd(t,e){var n=ao;return t.current.memoizedState.isDehydrated&&(Fr(t,e).flags|=256),t=ec(t,e),t!==2&&(e=it,it=n,e!==null&&id(e)),t}function id(t){it===null?it=t:it.push.apply(it,t)}function Nb(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!jt(s(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Xn(t,e){for(e&=~Kp,e&=~mu,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Lt(e),r=1<<n;t[n]=-1,e&=~r}}function sm(t){if(ee&6)throw Error(D(327));Vi();var e=Dl(t,0);if(!(e&1))return ct(t,Ae()),null;var n=ec(t,e);if(t.tag!==0&&n===2){var r=xh(t);r!==0&&(e=r,n=rd(t,r))}if(n===1)throw n=Do,Fr(t,0),Xn(t,e),ct(t,Ae()),n;if(n===6)throw Error(D(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,wr(t,it,yn),ct(t,Ae()),null}function Zp(t,e){var n=ee;ee|=1;try{return t(e)}finally{ee=n,ee===0&&(Gi=Ae()+500,du&&_r())}}function Xr(t){Kn!==null&&Kn.tag===0&&!(ee&6)&&Vi();var e=ee;ee|=1;var n=Rt.transition,r=ie;try{if(Rt.transition=null,ie=1,t)return t()}finally{ie=r,Rt.transition=n,ee=e,!(ee&6)&&_r()}}function Qp(){ht=Ri.current,pe(Ri)}function Fr(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,ub(n)),Ce!==null)for(n=Ce.return;n!==null;){var r=n;switch(Mp(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Vl();break;case 3:Qi(),pe(at),pe(qe),zp();break;case 5:Lp(r);break;case 4:Qi();break;case 13:pe(ye);break;case 19:pe(ye);break;case 10:Fp(r.type._context);break;case 22:case 23:Qp()}n=n.return}if(De=t,Ce=t=or(t.current,null),Ve=ht=e,Ie=0,Do=null,Kp=mu=$r=0,it=ao=null,xr!==null){for(e=0;e<xr.length;e++)if(n=xr[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,s=n.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}n.pending=r}xr=null}return t}function rS(t,e){do{var n=Ce;try{if(Np(),dl.current=Zl,ql){for(var r=Te.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}ql=!1}if(Hr=0,Ne=xe=Te=null,so=!1,ko=0,Yp.current=null,n===null||n.return===null){Ie=1,Do=e,Ce=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=Ve,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,f=u.tag;if(!(u.mode&1)&&(f===0||f===11||f===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var d=X_(o);if(d!==null){d.flags&=-257,Y_(d,o,a,s,e),d.mode&1&&$_(s,c,e),e=d,l=c;var m=e.updateQueue;if(m===null){var T=new Set;T.add(l),e.updateQueue=T}else m.add(l);break e}else{if(!(e&1)){$_(s,c,e),Jp();break e}l=Error(D(426))}}else if(ge&&a.mode&1){var A=X_(o);if(A!==null){!(A.flags&65536)&&(A.flags|=256),Y_(A,o,a,s,e),Op(Ji(l,a));break e}}s=l=Ji(l,a),Ie!==4&&(Ie=2),ao===null?ao=[s]:ao.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var g=zT(s,l,e);L_(s,g);break e;case 1:a=l;var p=s.type,_=s.stateNode;if(!(s.flags&128)&&(typeof p.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(ir===null||!ir.has(_)))){s.flags|=65536,e&=-e,s.lanes|=e;var w=VT(s,a,e);L_(s,w);break e}}s=s.return}while(s!==null)}oS(n)}catch(R){e=R,Ce===n&&n!==null&&(Ce=n=n.return);continue}break}while(1)}function iS(){var t=Ql.current;return Ql.current=Zl,t===null?Zl:t}function Jp(){(Ie===0||Ie===3||Ie===2)&&(Ie=4),De===null||!($r&268435455)&&!(mu&268435455)||Xn(De,Ve)}function ec(t,e){var n=ee;ee|=2;var r=iS();(De!==t||Ve!==e)&&(yn=null,Fr(t,e));do try{Fb();break}catch(i){rS(t,i)}while(1);if(Np(),ee=n,Ql.current=r,Ce!==null)throw Error(D(261));return De=null,Ve=0,Ie}function Fb(){for(;Ce!==null;)sS(Ce)}function Db(){for(;Ce!==null&&!aA();)sS(Ce)}function sS(t){var e=lS(t.alternate,t,ht);t.memoizedProps=t.pendingProps,e===null?oS(t):Ce=e,Yp.current=null}function oS(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=xb(n,e),n!==null){n.flags&=32767,Ce=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ie=6,Ce=null;return}}else if(n=Cb(n,e,ht),n!==null){Ce=n;return}if(e=e.sibling,e!==null){Ce=e;return}Ce=e=t}while(e!==null);Ie===0&&(Ie=5)}function wr(t,e,n){var r=ie,i=Rt.transition;try{Rt.transition=null,ie=1,Bb(t,e,n,r)}finally{Rt.transition=i,ie=r}return null}function Bb(t,e,n,r){do Vi();while(Kn!==null);if(ee&6)throw Error(D(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(D(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(mA(t,s),t===De&&(Ce=De=null,Ve=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Da||(Da=!0,cS(Fl,function(){return Vi(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=Rt.transition,Rt.transition=null;var o=ie;ie=1;var a=ee;ee|=4,Yp.current=null,Mb(t,n),eS(n,t),rb(Fh),Bl=!!Nh,Fh=Nh=null,t.current=n,Ob(n),lA(),ee=a,ie=o,Rt.transition=s}else t.current=n;if(Da&&(Da=!1,Kn=t,Gl=i),s=t.pendingLanes,s===0&&(ir=null),fA(n.stateNode),ct(t,Ae()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Jl)throw Jl=!1,t=td,td=null,t;return Gl&1&&t.tag!==0&&Vi(),s=t.pendingLanes,s&1?t===nd?lo++:(lo=0,nd=t):lo=0,_r(),null}function Vi(){if(Kn!==null){var t=zv(Gl),e=Rt.transition,n=ie;try{if(Rt.transition=null,ie=16>t?16:t,Kn===null)var r=!1;else{if(t=Kn,Kn=null,Gl=0,ee&6)throw Error(D(331));var i=ee;for(ee|=4,V=t.current;V!==null;){var s=V,o=s.child;if(V.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(V=c;V!==null;){var u=V;switch(u.tag){case 0:case 11:case 15:oo(8,u,s)}var f=u.child;if(f!==null)f.return=u,V=f;else for(;V!==null;){u=V;var h=u.sibling,d=u.return;if(QT(u),u===c){V=null;break}if(h!==null){h.return=d,V=h;break}V=d}}}var m=s.alternate;if(m!==null){var T=m.child;if(T!==null){m.child=null;do{var A=T.sibling;T.sibling=null,T=A}while(T!==null)}}V=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,V=o;else e:for(;V!==null;){if(s=V,s.flags&2048)switch(s.tag){case 0:case 11:case 15:oo(9,s,s.return)}var g=s.sibling;if(g!==null){g.return=s.return,V=g;break e}V=s.return}}var p=t.current;for(V=p;V!==null;){o=V;var _=o.child;if(o.subtreeFlags&2064&&_!==null)_.return=o,V=_;else e:for(o=p;V!==null;){if(a=V,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:_u(9,a)}}catch(R){we(a,a.return,R)}if(a===o){V=null;break e}var w=a.sibling;if(w!==null){w.return=a.return,V=w;break e}V=a.return}}if(ee=i,_r(),cn&&typeof cn.onPostCommitFiberRoot=="function")try{cn.onPostCommitFiberRoot(lu,t)}catch{}r=!0}return r}finally{ie=n,Rt.transition=e}}return!1}function om(t,e,n){e=Ji(n,e),e=zT(t,e,1),t=rr(t,e,1),e=et(),t!==null&&(Go(t,1,e),ct(t,e))}function we(t,e,n){if(t.tag===3)om(t,t,n);else for(;e!==null;){if(e.tag===3){om(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(ir===null||!ir.has(r))){t=Ji(n,t),t=VT(e,t,1),e=rr(e,t,1),t=et(),e!==null&&(Go(e,1,t),ct(e,t));break}}e=e.return}}function Ub(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=et(),t.pingedLanes|=t.suspendedLanes&n,De===t&&(Ve&n)===n&&(Ie===4||Ie===3&&(Ve&130023424)===Ve&&500>Ae()-qp?Fr(t,0):Kp|=n),ct(t,e)}function aS(t,e){e===0&&(t.mode&1?(e=Ra,Ra<<=1,!(Ra&130023424)&&(Ra=4194304)):e=1);var n=et();t=xn(t,e),t!==null&&(Go(t,e,n),ct(t,n))}function Lb(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),aS(t,n)}function zb(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(D(314))}r!==null&&r.delete(e),aS(t,n)}var lS;lS=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||at.current)st=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return st=!1,Pb(t,e,n);st=!!(t.flags&131072)}else st=!1,ge&&e.flags&1048576&&hT(e,Hl,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;gl(t,e),t=e.pendingProps;var i=Ki(e,qe.current);zi(e,n),i=Wp(null,e,r,t,i,n);var s=jp();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,lt(r)?(s=!0,Wl(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Bp(e),i.updater=gu,e.stateNode=i,i._reactInternals=e,Hh(e,r,t,n),e=Yh(null,e,r,!0,s,n)):(e.tag=0,ge&&s&&Ip(e),Ge(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(gl(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=Wb(r),t=kt(r,t),i){case 0:e=Xh(null,e,r,t,n);break e;case 1:e=Z_(null,e,r,t,n);break e;case 11:e=K_(null,e,r,t,n);break e;case 14:e=q_(null,e,r,kt(r.type,t),n);break e}throw Error(D(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:kt(r,i),Xh(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:kt(r,i),Z_(t,e,r,i,n);case 3:e:{if($T(e),t===null)throw Error(D(387));r=e.pendingProps,s=e.memoizedState,i=s.element,yT(t,e),Yl(e,r,null,n);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=Ji(Error(D(423)),e),e=Q_(t,e,r,n,i);break e}else if(r!==i){i=Ji(Error(D(424)),e),e=Q_(t,e,r,n,i);break e}else for(pt=nr(e.stateNode.containerInfo.firstChild),_t=e,ge=!0,Ft=null,n=_T(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(qi(),r===i){e=In(t,e,n);break e}Ge(t,e,r,n)}e=e.child}return e;case 5:return vT(e),t===null&&Vh(e),r=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,o=i.children,Dh(r,i)?o=null:s!==null&&Dh(r,s)&&(e.flags|=32),HT(t,e),Ge(t,e,o,n),e.child;case 6:return t===null&&Vh(e),null;case 13:return XT(t,e,n);case 4:return Up(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Zi(e,null,r,n):Ge(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:kt(r,i),K_(t,e,r,i,n);case 7:return Ge(t,e,e.pendingProps,n),e.child;case 8:return Ge(t,e,e.pendingProps.children,n),e.child;case 12:return Ge(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,ce($l,r._currentValue),r._currentValue=o,s!==null)if(jt(s.value,o)){if(s.children===i.children&&!at.current){e=In(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=Rn(-1,n&-n),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),Wh(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(D(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Wh(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Ge(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,zi(e,n),i=Ct(i),r=r(i),e.flags|=1,Ge(t,e,r,n),e.child;case 14:return r=e.type,i=kt(r,e.pendingProps),i=kt(r.type,i),q_(t,e,r,i,n);case 15:return WT(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:kt(r,i),gl(t,e),e.tag=1,lt(r)?(t=!0,Wl(e)):t=!1,zi(e,n),LT(e,r,i),Hh(e,r,i,n),Yh(null,e,r,!0,t,n);case 19:return YT(t,e,n);case 22:return jT(t,e,n)}throw Error(D(156,e.tag))};function cS(t,e){return Dv(t,e)}function Vb(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function At(t,e,n,r){return new Vb(t,e,n,r)}function Gp(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Wb(t){if(typeof t=="function")return Gp(t)?1:0;if(t!=null){if(t=t.$$typeof,t===yp)return 11;if(t===vp)return 14}return 2}function or(t,e){var n=t.alternate;return n===null?(n=At(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function yl(t,e,n,r,i,s){var o=2;if(r=t,typeof t=="function")Gp(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case _i:return Dr(n.children,i,s,e);case mp:o=8,i|=8;break;case ph:return t=At(12,n,e,i|2),t.elementType=ph,t.lanes=s,t;case gh:return t=At(13,n,e,i),t.elementType=gh,t.lanes=s,t;case _h:return t=At(19,n,e,i),t.elementType=_h,t.lanes=s,t;case vv:return yu(n,i,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case mv:o=10;break e;case yv:o=9;break e;case yp:o=11;break e;case vp:o=14;break e;case Vn:o=16,r=null;break e}throw Error(D(130,t==null?t:typeof t,""))}return e=At(o,n,e,i),e.elementType=t,e.type=r,e.lanes=s,e}function Dr(t,e,n,r){return t=At(7,t,r,e),t.lanes=n,t}function yu(t,e,n,r){return t=At(22,t,r,e),t.elementType=vv,t.lanes=n,t.stateNode={isHidden:!1},t}function wf(t,e,n){return t=At(6,t,null,e),t.lanes=n,t}function Af(t,e,n){return e=At(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function jb(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=rf(0),this.expirationTimes=rf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=rf(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function eg(t,e,n,r,i,s,o,a,l){return t=new jb(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=At(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Bp(s),t}function Hb(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:gi,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function uS(t){if(!t)return ur;t=t._reactInternals;e:{if(Jr(t)!==t||t.tag!==1)throw Error(D(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(lt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(D(171))}if(t.tag===1){var n=t.type;if(lt(n))return uT(t,n,e)}return e}function fS(t,e,n,r,i,s,o,a,l){return t=eg(n,r,!0,t,i,s,o,a,l),t.context=uS(null),n=t.current,r=et(),i=sr(n),s=Rn(r,i),s.callback=e??null,rr(n,s,i),t.current.lanes=i,Go(t,i,r),ct(t,r),t}function vu(t,e,n,r){var i=e.current,s=et(),o=sr(i);return n=uS(n),e.context===null?e.context=n:e.pendingContext=n,e=Rn(s,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=rr(i,e,o),t!==null&&(zt(t,i,o,s),hl(t,i,o)),o}function tc(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function am(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function tg(t,e){am(t,e),(t=t.alternate)&&am(t,e)}function $b(){return null}var hS=typeof reportError=="function"?reportError:function(t){console.error(t)};function ng(t){this._internalRoot=t}Tu.prototype.render=ng.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(D(409));vu(t,e,null,null)};Tu.prototype.unmount=ng.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Xr(function(){vu(null,t,null,null)}),e[Cn]=null}};function Tu(t){this._internalRoot=t}Tu.prototype.unstable_scheduleHydration=function(t){if(t){var e=jv();t={blockedOn:null,target:t,priority:e};for(var n=0;n<$n.length&&e!==0&&e<$n[n].priority;n++);$n.splice(n,0,t),n===0&&$v(t)}};function rg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Su(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function lm(){}function Xb(t,e,n,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var c=tc(o);s.call(c)}}var o=fS(e,r,t,0,null,!1,!1,"",lm);return t._reactRootContainer=o,t[Cn]=o.current,Co(t.nodeType===8?t.parentNode:t),Xr(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var c=tc(l);a.call(c)}}var l=eg(t,0,!1,null,null,!1,!1,"",lm);return t._reactRootContainer=l,t[Cn]=l.current,Co(t.nodeType===8?t.parentNode:t),Xr(function(){vu(e,l,n,r)}),l}function Eu(t,e,n,r,i){var s=n._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var l=tc(o);a.call(l)}}vu(e,o,t,i)}else o=Xb(n,e,t,i,r);return tc(o)}Vv=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Xs(e.pendingLanes);n!==0&&(Ep(e,n|1),ct(e,Ae()),!(ee&6)&&(Gi=Ae()+500,_r()))}break;case 13:Xr(function(){var r=xn(t,1);if(r!==null){var i=et();zt(r,t,1,i)}}),tg(t,1)}};wp=function(t){if(t.tag===13){var e=xn(t,134217728);if(e!==null){var n=et();zt(e,t,134217728,n)}tg(t,134217728)}};Wv=function(t){if(t.tag===13){var e=sr(t),n=xn(t,e);if(n!==null){var r=et();zt(n,t,e,r)}tg(t,e)}};jv=function(){return ie};Hv=function(t,e){var n=ie;try{return ie=t,e()}finally{ie=n}};Rh=function(t,e,n){switch(e){case"input":if(vh(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=hu(r);if(!i)throw Error(D(90));Sv(r),vh(r,i)}}}break;case"textarea":wv(t,n);break;case"select":e=n.value,e!=null&&Di(t,!!n.multiple,e,!1)}};Iv=Zp;Mv=Xr;var Yb={usingClientEntryPoint:!1,Events:[ta,Ti,hu,Cv,xv,Zp]},Fs={findFiberByHostInstance:Cr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Kb={bundleType:Fs.bundleType,version:Fs.version,rendererPackageName:Fs.rendererPackageName,rendererConfig:Fs.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:On.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Nv(t),t===null?null:t.stateNode},findFiberByHostInstance:Fs.findFiberByHostInstance||$b,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ba=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ba.isDisabled&&Ba.supportsFiber)try{lu=Ba.inject(Kb),cn=Ba}catch{}}yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Yb;yt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!rg(e))throw Error(D(200));return Hb(t,e,null,n)};yt.createRoot=function(t,e){if(!rg(t))throw Error(D(299));var n=!1,r="",i=hS;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=eg(t,1,!1,null,null,n,!1,r,i),t[Cn]=e.current,Co(t.nodeType===8?t.parentNode:t),new ng(e)};yt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(D(188)):(t=Object.keys(t).join(","),Error(D(268,t)));return t=Nv(e),t=t===null?null:t.stateNode,t};yt.flushSync=function(t){return Xr(t)};yt.hydrate=function(t,e,n){if(!Su(e))throw Error(D(200));return Eu(null,t,e,!0,n)};yt.hydrateRoot=function(t,e,n){if(!rg(t))throw Error(D(405));var r=n!=null&&n.hydratedSources||null,i=!1,s="",o=hS;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=fS(e,null,t,1,n??null,i,!1,s,o),t[Cn]=e.current,Co(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new Tu(e)};yt.render=function(t,e,n){if(!Su(e))throw Error(D(200));return Eu(null,t,e,!1,n)};yt.unmountComponentAtNode=function(t){if(!Su(t))throw Error(D(40));return t._reactRootContainer?(Xr(function(){Eu(null,null,t,!1,function(){t._reactRootContainer=null,t[Cn]=null})}),!0):!1};yt.unstable_batchedUpdates=Zp;yt.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Su(n))throw Error(D(200));if(t==null||t._reactInternals===void 0)throw Error(D(38));return Eu(t,e,n,!1,r)};yt.version="18.3.1-next-f1338f8080-20240426";function dS(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(dS)}catch(t){console.error(t)}}dS(),dv.exports=yt;var ig=dv.exports,pS,cm=ig;pS=cm.createRoot,cm.hydrateRoot;const qb="modulepreload",Zb=function(t){return"/"+t},um={},Qb=function(e,n,r){if(!n||n.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(n.map(s=>{if(s=Zb(s),s in um)return;um[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let u=i.length-1;u>=0;u--){const f=i[u];if(f.href===s&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":qb,o||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),o)return new Promise((u,f)=>{c.addEventListener("load",u),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})},Jb=W.createContext(null);function Gb(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,r=Array.isArray(t)?t[1]:t?t.y:0,i=Array.isArray(e)?e[0]:e?e.x:0,s=Array.isArray(e)?e[1]:e?e.y:0;return n===i&&r===s}function En(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!En(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(const i of n)if(!e.hasOwnProperty(i)||!En(t[i],e[i]))return!1;return!0}return!1}function eR(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function fm(t,e){if(!t.getProjection)return;const n=t.getProjection(),r=e.getProjection();En(n,r)||e.setProjection(n)}function hm(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function dm(t,e){const n=e.viewState||e;let r=!1;if("longitude"in n&&"latitude"in n){const i=t.center;t.center=new i.constructor(n.longitude,n.latitude),r=r||i!==t.center}if("zoom"in n){const i=t.zoom;t.zoom=n.zoom,r=r||i!==t.zoom}if("bearing"in n){const i=t.bearing;t.bearing=n.bearing,r=r||i!==t.bearing}if("pitch"in n){const i=t.pitch;t.pitch=n.pitch,r=r||i!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(r=!0,t.padding=n.padding),r}const tR=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function pm(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const r of t.layers)e[r.id]=r;const n=t.layers.map(r=>{let i=null;"interactive"in r&&(i=Object.assign({},r),delete i.interactive);const s=e[r.ref];if(s){i=i||Object.assign({},r),delete i.ref;for(const o of tR)o in s&&(i[o]=s[o])}return i||r});return{...t,layers:n}}const gm={version:8,sources:{},layers:[]},_m={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},bf={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},mm={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},nR=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],rR=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class es{constructor(e,n,r){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=i=>{const s=this.props[mm[i.type]];s?s(i):i.type==="error"&&console.error(i.error)},this._onPointerEvent=i=>{(i.type==="mousemove"||i.type==="mouseout")&&this._updateHover(i);const s=this.props[_m[i.type]];s&&(this.props.interactiveLayerIds&&i.type!=="mouseover"&&i.type!=="mouseout"&&(i.features=this._hoveredFeatures||this._queryRenderedFeatures(i.point)),s(i),delete i.features)},this._onCameraEvent=i=>{if(!this._internalUpdate){const s=this.props[bf[i.type]];s&&s(i)}i.type in this._deferredEvents&&(this._deferredEvents[i.type]=!1)},this._MapClass=e,this.props=n,this._initialize(r)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const r=this._updateSettings(e,n);r&&this._createShadowTransform(this._map);const i=this._updateSize(e),s=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(r||i||s&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const r=es.savedMaps.pop();if(!r)return null;const i=r.map,s=i.getContainer();for(n.className=s.className;s.childNodes.length>0;)n.appendChild(s.childNodes[0]);i._container=n;const o=i._resizeObserver;o&&(o.disconnect(),o.observe(n)),r.setProps({...e,styleDiffing:!1}),i.resize();const{initialViewState:a}=e;return a&&(a.bounds?i.fitBounds(a.bounds,{...a.fitBoundsOptions,duration:0}):r._updateViewState(a,!1)),i.isStyleLoaded()?i.fire("load"):i.once("styledata",()=>i.fire("load")),i._update(),r}_initialize(e){const{props:n}=this,{mapStyle:r=gm}=n,i={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||iR()||null,container:e,style:pm(r)},s=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[s.longitude||0,s.latitude||0],zoom:s.zoom||0,pitch:s.pitch||0,bearing:s.bearing||0}),n.gl){const u=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=u,n.gl)}const o=new this._MapClass(i);s.padding&&o.setPadding(s.padding),n.cursor&&(o.getCanvas().style.cursor=n.cursor),this._createShadowTransform(o);const a=o._render;o._render=u=>{this._inRender=!0,a.call(o,u),this._inRender=!1};const l=o._renderTaskQueue.run;o._renderTaskQueue.run=u=>{l.call(o._renderTaskQueue,u),this._onBeforeRepaint()},o.on("render",()=>this._onAfterRepaint());const c=o.fire;o.fire=this._fireEvent.bind(this,c),o.on("resize",()=>{this._renderTransform.resize(o.transform.width,o.transform.height)}),o.on("styledata",()=>{this._updateStyleComponents(this.props,{}),fm(o.transform,this._renderTransform)}),o.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const u in _m)o.on(u,this._onPointerEvent);for(const u in bf)o.on(u,this._onCameraEvent);for(const u in mm)o.on(u,this._onEvent);this._map=o}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),es.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=eR(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const r=this._map;if(n.width!==r.transform.width||n.height!==r.transform.height)return r.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const r=this._map,i=this._renderTransform,{zoom:s,pitch:o,bearing:a}=i,l=r.isMoving();l&&(i.cameraElevationReference="sea");const c=dm(i,{...hm(r.transform),...e});if(l&&(i.cameraElevationReference="ground"),c&&n){const u=this._deferredEvents;u.move=!0,u.zoom||(u.zoom=s!==i.zoom),u.rotate||(u.rotate=a!==i.bearing),u.pitch||(u.pitch=o!==i.pitch)}return l||dm(r.transform,e),c}_updateSettings(e,n){const r=this._map;let i=!1;for(const s of nR)if(s in e&&!En(e[s],n[s])){i=!0;const o=r[`set${s[0].toUpperCase()}${s.slice(1)}`];o==null||o.call(r,e[s])}return i}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:r=gm,styleDiffing:i=!0}=e,s={diff:i};return"localIdeographFontFamily"in e&&(s.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(pm(r),s),!0}return!1}_updateStyleComponents(e,n){const r=this._map;let i=!1;return r.isStyleLoaded()&&("light"in e&&r.setLight&&!En(e.light,n.light)&&(i=!0,r.setLight(e.light)),"fog"in e&&r.setFog&&!En(e.fog,n.fog)&&(i=!0,r.setFog(e.fog)),"terrain"in e&&r.setTerrain&&!En(e.terrain,n.terrain)&&(!e.terrain||r.getSource(e.terrain.source))&&(i=!0,r.setTerrain(e.terrain))),i}_updateHandlers(e,n){var r,i;const s=this._map;let o=!1;for(const a of rR){const l=(r=e[a])!==null&&r!==void 0?r:!0,c=(i=n[a])!==null&&i!==void 0?i:!0;En(l,c)||(o=!0,l?s[a].enable(l):s[a].disable())}return o}_queryRenderedFeatures(e){const n=this._map,r=n.transform,{interactiveLayerIds:i=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:i.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=r}}_updateHover(e){var n;const{props:r}=this;if(r.interactiveLayerIds&&(r.onMouseMove||r.onMouseEnter||r.onMouseLeave)){const s=e.type,o=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,a=this._queryRenderedFeatures(e.point),l=a.length>0;!l&&o&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=a,l&&!o&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=s}else this._hoveredFeatures=null}_fireEvent(e,n,r){const i=this._map,s=i.transform,o=typeof n=="string"?n:n.type;return o==="move"&&this._updateViewState(this.props,!1),o in bf&&(typeof n=="object"&&(n.viewState=hm(s)),this._map.isMoving())?(i.transform=this._renderTransform,e.call(i,n,r),i.transform=s,i):(e.call(i,n,r),i)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const r in this._deferredEvents)this._deferredEvents[r]&&e.fire(r);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{fm(this._renderTransform,n),e.transform=n}}}es.savedMaps=[];function iR(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{}.MapboxAccessToken}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const sR=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function oR(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:r=>{const i=e.transform;e.transform=t.transform;const s=e.project(r);return e.transform=i,s},unproject:r=>{const i=e.transform;e.transform=t.transform;const s=e.unproject(r);return e.transform=i,s},queryTerrainElevation:(r,i)=>{const s=e.transform;e.transform=t.transform;const o=e.queryTerrainElevation(r,i);return e.transform=s,o},queryRenderedFeatures:(r,i)=>{const s=e.transform;e.transform=t.transform;const o=e.queryRenderedFeatures(r,i);return e.transform=s,o}};for(const r of aR(e))!(r in n)&&!sR.includes(r)&&(n[r]=e[r].bind(e));return n}function aR(t){const e=new Set;let n=t;for(;n;){for(const r of Object.getOwnPropertyNames(n))r[0]!=="_"&&typeof t[r]=="function"&&r!=="fire"&&r!=="setEventedParent"&&e.add(r);n=Object.getPrototypeOf(n)}return Array.from(e)}const lR=typeof document<"u"?W.useLayoutEffect:W.useEffect,cR=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function uR(t,e){for(const r of cR)r in e&&(t[r]=e[r]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,r=>{r&&console.error(r)},!0)}const wu=W.createContext(null);function fR(t,e,n){const r=W.useContext(Jb),[i,s]=W.useState(null),o=W.useRef(),{current:a}=W.useRef({mapLib:null,map:null});W.useEffect(()=>{const u=t.mapLib;let f=!0,h;return Promise.resolve(u||n).then(d=>{if(!f)return;if(!d)throw new Error("Invalid mapLib");const m="Map"in d?d:d.default;if(!m.Map)throw new Error("Invalid mapLib");if(uR(m,t),!m.supported||m.supported(t))t.reuseMaps&&(h=es.reuse(t,o.current)),h||(h=new es(m.Map,t,o.current)),a.map=oR(h),a.mapLib=m,s(h),r==null||r.onMapMount(a.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(d=>{const{onError:m}=t;m?m({type:"error",target:null,originalEvent:null,error:d}):console.error(d)}),()=>{f=!1,h&&(r==null||r.onMapUnmount(t.id),t.reuseMaps?h.recycle():h.destroy())}},[]),lR(()=>{i&&i.setProps(t)}),W.useImperativeHandle(e,()=>a.map,[i]);const l=W.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),c={height:"100%"};return W.createElement("div",{id:t.id,ref:o,style:l},i&&W.createElement(wu.Provider,{value:a},W.createElement("div",{"mapboxgl-children":"",style:c},t.children)))}const hR=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Gr(t,e){if(!t||!e)return;const n=t.style;for(const r in e){const i=e[r];Number.isFinite(i)&&!hR.test(r)?n[r]=`${i}px`:n[r]=i}}function dR(t,e){const{map:n,mapLib:r}=W.useContext(wu),i=W.useRef({props:t});i.current.props=t;const s=W.useMemo(()=>{let T=!1;W.Children.forEach(t.children,p=>{p&&(T=!0)});const A={...t,element:T?document.createElement("div"):null},g=new r.Marker(A);return g.setLngLat([t.longitude,t.latitude]),g.getElement().addEventListener("click",p=>{var _,w;(w=(_=i.current.props).onClick)===null||w===void 0||w.call(_,{type:"click",target:g,originalEvent:p})}),g.on("dragstart",p=>{var _,w;const R=p;R.lngLat=s.getLngLat(),(w=(_=i.current.props).onDragStart)===null||w===void 0||w.call(_,R)}),g.on("drag",p=>{var _,w;const R=p;R.lngLat=s.getLngLat(),(w=(_=i.current.props).onDrag)===null||w===void 0||w.call(_,R)}),g.on("dragend",p=>{var _,w;const R=p;R.lngLat=s.getLngLat(),(w=(_=i.current.props).onDragEnd)===null||w===void 0||w.call(_,R)}),g},[]);W.useEffect(()=>(s.addTo(n.getMap()),()=>{s.remove()}),[]);const{longitude:o,latitude:a,offset:l,style:c,draggable:u=!1,popup:f=null,rotation:h=0,rotationAlignment:d="auto",pitchAlignment:m="auto"}=t;return W.useEffect(()=>{Gr(s.getElement(),c)},[c]),W.useImperativeHandle(e,()=>s,[]),(s.getLngLat().lng!==o||s.getLngLat().lat!==a)&&s.setLngLat([o,a]),l&&!Gb(s.getOffset(),l)&&s.setOffset(l),s.isDraggable()!==u&&s.setDraggable(u),s.getRotation()!==h&&s.setRotation(h),s.getRotationAlignment()!==d&&s.setRotationAlignment(d),s.getPitchAlignment()!==m&&s.setPitchAlignment(m),s.getPopup()!==f&&s.setPopup(f),ig.createPortal(t.children,s.getElement())}W.memo(W.forwardRef(dR));function ym(t){return new Set(t?t.trim().split(/\s+/):[])}function pR(t,e){const{map:n,mapLib:r}=W.useContext(wu),i=W.useMemo(()=>document.createElement("div"),[]),s=W.useRef({props:t});s.current.props=t;const o=W.useMemo(()=>{const a={...t},l=new r.Popup(a);return l.setLngLat([t.longitude,t.latitude]),l.once("open",c=>{var u,f;(f=(u=s.current.props).onOpen)===null||f===void 0||f.call(u,c)}),l},[]);if(W.useEffect(()=>{const a=l=>{var c,u;(u=(c=s.current.props).onClose)===null||u===void 0||u.call(c,l)};return o.on("close",a),o.setDOMContent(i).addTo(n.getMap()),()=>{o.off("close",a),o.isOpen()&&o.remove()}},[]),W.useEffect(()=>{Gr(o.getElement(),t.style)},[t.style]),W.useImperativeHandle(e,()=>o,[]),o.isOpen()&&((o.getLngLat().lng!==t.longitude||o.getLngLat().lat!==t.latitude)&&o.setLngLat([t.longitude,t.latitude]),t.offset&&!En(o.options.offset,t.offset)&&o.setOffset(t.offset),(o.options.anchor!==t.anchor||o.options.maxWidth!==t.maxWidth)&&(o.options.anchor=t.anchor,o.setMaxWidth(t.maxWidth)),o.options.className!==t.className)){const a=ym(o.options.className),l=ym(t.className);for(const c of a)l.has(c)||o.removeClassName(c);for(const c of l)a.has(c)||o.addClassName(c);o.options.className=t.className}return ig.createPortal(t.children,i)}const gR=W.memo(W.forwardRef(pR));function vs(t,e,n,r){const i=W.useContext(wu),s=W.useMemo(()=>t(i),[]);return W.useEffect(()=>{const o=r||n||e,a=typeof e=="function"&&typeof n=="function"?e:null,l=typeof n=="function"?n:typeof e=="function"?e:null,{map:c}=i;return c.hasControl(s)||(c.addControl(s,o==null?void 0:o.position),a&&a(i)),()=>{l&&l(i),c.hasControl(s)&&c.removeControl(s)}},[]),s}function _R(t){const e=vs(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return W.useEffect(()=>{Gr(e._container,t.style)},[t.style]),null}W.memo(_R);function mR(t){const e=vs(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return W.useEffect(()=>{Gr(e._controlContainer,t.style)},[t.style]),null}W.memo(mR);function yR(t,e){const n=W.useRef({props:t}),r=vs(({mapLib:i})=>{const s=new i.GeolocateControl(t),o=s._setupUI;return s._setupUI=a=>{s._container.hasChildNodes()||o(a)},s.on("geolocate",a=>{var l,c;(c=(l=n.current.props).onGeolocate)===null||c===void 0||c.call(l,a)}),s.on("error",a=>{var l,c;(c=(l=n.current.props).onError)===null||c===void 0||c.call(l,a)}),s.on("outofmaxbounds",a=>{var l,c;(c=(l=n.current.props).onOutOfMaxBounds)===null||c===void 0||c.call(l,a)}),s.on("trackuserlocationstart",a=>{var l,c;(c=(l=n.current.props).onTrackUserLocationStart)===null||c===void 0||c.call(l,a)}),s.on("trackuserlocationend",a=>{var l,c;(c=(l=n.current.props).onTrackUserLocationEnd)===null||c===void 0||c.call(l,a)}),s},{position:t.position});return n.current.props=t,W.useImperativeHandle(e,()=>r,[]),W.useEffect(()=>{Gr(r._container,t.style)},[t.style]),null}W.memo(W.forwardRef(yR));function vR(t){const e=vs(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return W.useEffect(()=>{Gr(e._container,t.style)},[t.style]),null}const TR=W.memo(vR);function SR(t){const e=vs(({mapLib:s})=>new s.ScaleControl(t),{position:t.position}),n=W.useRef(t),r=n.current;n.current=t;const{style:i}=t;return t.maxWidth!==void 0&&t.maxWidth!==r.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==r.unit&&e.setUnit(t.unit),W.useEffect(()=>{Gr(e._container,i)},[i]),null}W.memo(SR);const ER=Qb(()=>import("./maplibre-gl-69e0549d.js").then(t=>t.m),[]),wR=(()=>W.forwardRef(function(e,n){return fR(e,n,ER)}))(),AR=gR,bR=TR;var ot=function(){return ot=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},ot.apply(this,arguments)};function nc(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}var de="-ms-",co="-moz-",ne="-webkit-",gS="comm",Au="rule",sg="decl",RR="@import",_S="@keyframes",PR="@layer",mS=Math.abs,og=String.fromCharCode,sd=Object.assign;function CR(t,e){return Fe(t,0)^45?(((e<<2^Fe(t,0))<<2^Fe(t,1))<<2^Fe(t,2))<<2^Fe(t,3):0}function yS(t){return t.trim()}function vn(t,e){return(t=e.exec(t))?t[0]:t}function q(t,e,n){return t.replace(e,n)}function vl(t,e,n){return t.indexOf(e,n)}function Fe(t,e){return t.charCodeAt(e)|0}function ts(t,e,n){return t.slice(e,n)}function rn(t){return t.length}function vS(t){return t.length}function Ks(t,e){return e.push(t),t}function xR(t,e){return t.map(e).join("")}function vm(t,e){return t.filter(function(n){return!vn(n,e)})}var bu=1,ns=1,TS=0,It=0,Re=0,Ts="";function Ru(t,e,n,r,i,s,o,a){return{value:t,root:e,parent:n,type:r,props:i,children:s,line:bu,column:ns,length:o,return:"",siblings:a}}function zn(t,e){return sd(Ru("",null,null,"",null,null,0,t.siblings),t,{length:-t.length},e)}function oi(t){for(;t.root;)t=zn(t.root,{children:[t]});Ks(t,t.siblings)}function IR(){return Re}function MR(){return Re=It>0?Fe(Ts,--It):0,ns--,Re===10&&(ns=1,bu--),Re}function Vt(){return Re=It<TS?Fe(Ts,It++):0,ns++,Re===10&&(ns=1,bu++),Re}function Br(){return Fe(Ts,It)}function Tl(){return It}function Pu(t,e){return ts(Ts,t,e)}function od(t){switch(t){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function OR(t){return bu=ns=1,TS=rn(Ts=t),It=0,[]}function kR(t){return Ts="",t}function Rf(t){return yS(Pu(It-1,ad(t===91?t+2:t===40?t+1:t)))}function NR(t){for(;(Re=Br())&&Re<33;)Vt();return od(t)>2||od(Re)>3?"":" "}function FR(t,e){for(;--e&&Vt()&&!(Re<48||Re>102||Re>57&&Re<65||Re>70&&Re<97););return Pu(t,Tl()+(e<6&&Br()==32&&Vt()==32))}function ad(t){for(;Vt();)switch(Re){case t:return It;case 34:case 39:t!==34&&t!==39&&ad(Re);break;case 40:t===41&&ad(t);break;case 92:Vt();break}return It}function DR(t,e){for(;Vt()&&t+Re!==47+10;)if(t+Re===42+42&&Br()===47)break;return"/*"+Pu(e,It-1)+"*"+og(t===47?t:Vt())}function BR(t){for(;!od(Br());)Vt();return Pu(t,It)}function UR(t){return kR(Sl("",null,null,null,[""],t=OR(t),0,[0],t))}function Sl(t,e,n,r,i,s,o,a,l){for(var c=0,u=0,f=o,h=0,d=0,m=0,T=1,A=1,g=1,p=0,_="",w=i,R=s,x=r,M=_;A;)switch(m=p,p=Vt()){case 40:if(m!=108&&Fe(M,f-1)==58){vl(M+=q(Rf(p),"&","&\f"),"&\f",mS(c?a[c-1]:0))!=-1&&(g=-1);break}case 34:case 39:case 91:M+=Rf(p);break;case 9:case 10:case 13:case 32:M+=NR(m);break;case 92:M+=FR(Tl()-1,7);continue;case 47:switch(Br()){case 42:case 47:Ks(LR(DR(Vt(),Tl()),e,n,l),l);break;default:M+="/"}break;case 123*T:a[c++]=rn(M)*g;case 125*T:case 59:case 0:switch(p){case 0:case 125:A=0;case 59+u:g==-1&&(M=q(M,/\f/g,"")),d>0&&rn(M)-f&&Ks(d>32?Sm(M+";",r,n,f-1,l):Sm(q(M," ","")+";",r,n,f-2,l),l);break;case 59:M+=";";default:if(Ks(x=Tm(M,e,n,c,u,i,a,_,w=[],R=[],f,s),s),p===123)if(u===0)Sl(M,e,x,x,w,s,f,a,R);else switch(h===99&&Fe(M,3)===110?100:h){case 100:case 108:case 109:case 115:Sl(t,x,x,r&&Ks(Tm(t,x,x,0,0,i,a,_,i,w=[],f,R),R),i,R,f,a,r?w:R);break;default:Sl(M,x,x,x,[""],R,0,a,R)}}c=u=d=0,T=g=1,_=M="",f=o;break;case 58:f=1+rn(M),d=m;default:if(T<1){if(p==123)--T;else if(p==125&&T++==0&&MR()==125)continue}switch(M+=og(p),p*T){case 38:g=u>0?1:(M+="\f",-1);break;case 44:a[c++]=(rn(M)-1)*g,g=1;break;case 64:Br()===45&&(M+=Rf(Vt())),h=Br(),u=f=rn(_=M+=BR(Tl())),p++;break;case 45:m===45&&rn(M)==2&&(T=0)}}return s}function Tm(t,e,n,r,i,s,o,a,l,c,u,f){for(var h=i-1,d=i===0?s:[""],m=vS(d),T=0,A=0,g=0;T<r;++T)for(var p=0,_=ts(t,h+1,h=mS(A=o[T])),w=t;p<m;++p)(w=yS(A>0?d[p]+" "+_:q(_,/&\f/g,d[p])))&&(l[g++]=w);return Ru(t,e,n,i===0?Au:a,l,c,u,f)}function LR(t,e,n,r){return Ru(t,e,n,gS,og(IR()),ts(t,2,-2),0,r)}function Sm(t,e,n,r,i){return Ru(t,e,n,sg,ts(t,0,r),ts(t,r+1,-1),r,i)}function SS(t,e,n){switch(CR(t,e)){case 5103:return ne+"print-"+t+t;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return ne+t+t;case 4789:return co+t+t;case 5349:case 4246:case 4810:case 6968:case 2756:return ne+t+co+t+de+t+t;case 5936:switch(Fe(t,e+11)){case 114:return ne+t+de+q(t,/[svh]\w+-[tblr]{2}/,"tb")+t;case 108:return ne+t+de+q(t,/[svh]\w+-[tblr]{2}/,"tb-rl")+t;case 45:return ne+t+de+q(t,/[svh]\w+-[tblr]{2}/,"lr")+t}case 6828:case 4268:case 2903:return ne+t+de+t+t;case 6165:return ne+t+de+"flex-"+t+t;case 5187:return ne+t+q(t,/(\w+).+(:[^]+)/,ne+"box-$1$2"+de+"flex-$1$2")+t;case 5443:return ne+t+de+"flex-item-"+q(t,/flex-|-self/g,"")+(vn(t,/flex-|baseline/)?"":de+"grid-row-"+q(t,/flex-|-self/g,""))+t;case 4675:return ne+t+de+"flex-line-pack"+q(t,/align-content|flex-|-self/g,"")+t;case 5548:return ne+t+de+q(t,"shrink","negative")+t;case 5292:return ne+t+de+q(t,"basis","preferred-size")+t;case 6060:return ne+"box-"+q(t,"-grow","")+ne+t+de+q(t,"grow","positive")+t;case 4554:return ne+q(t,/([^-])(transform)/g,"$1"+ne+"$2")+t;case 6187:return q(q(q(t,/(zoom-|grab)/,ne+"$1"),/(image-set)/,ne+"$1"),t,"")+t;case 5495:case 3959:return q(t,/(image-set\([^]*)/,ne+"$1$`$1");case 4968:return q(q(t,/(.+:)(flex-)?(.*)/,ne+"box-pack:$3"+de+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+ne+t+t;case 4200:if(!vn(t,/flex-|baseline/))return de+"grid-column-align"+ts(t,e)+t;break;case 2592:case 3360:return de+q(t,"template-","")+t;case 4384:case 3616:return n&&n.some(function(r,i){return e=i,vn(r.props,/grid-\w+-end/)})?~vl(t+(n=n[e].value),"span",0)?t:de+q(t,"-start","")+t+de+"grid-row-span:"+(~vl(n,"span",0)?vn(n,/\d+/):+vn(n,/\d+/)-+vn(t,/\d+/))+";":de+q(t,"-start","")+t;case 4896:case 4128:return n&&n.some(function(r){return vn(r.props,/grid-\w+-start/)})?t:de+q(q(t,"-end","-span"),"span ","")+t;case 4095:case 3583:case 4068:case 2532:return q(t,/(.+)-inline(.+)/,ne+"$1$2")+t;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(rn(t)-1-e>6)switch(Fe(t,e+1)){case 109:if(Fe(t,e+4)!==45)break;case 102:return q(t,/(.+:)(.+)-([^]+)/,"$1"+ne+"$2-$3$1"+co+(Fe(t,e+3)==108?"$3":"$2-$3"))+t;case 115:return~vl(t,"stretch",0)?SS(q(t,"stretch","fill-available"),e,n)+t:t}break;case 5152:case 5920:return q(t,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(r,i,s,o,a,l,c){return de+i+":"+s+c+(o?de+i+"-span:"+(a?l:+l-+s)+c:"")+t});case 4949:if(Fe(t,e+6)===121)return q(t,":",":"+ne)+t;break;case 6444:switch(Fe(t,Fe(t,14)===45?18:11)){case 120:return q(t,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+ne+(Fe(t,14)===45?"inline-":"")+"box$3$1"+ne+"$2$3$1"+de+"$2box$3")+t;case 100:return q(t,":",":"+de)+t}break;case 5719:case 2647:case 2135:case 3927:case 2391:return q(t,"scroll-","scroll-snap-")+t}return t}function rc(t,e){for(var n="",r=0;r<t.length;r++)n+=e(t[r],r,t,e)||"";return n}function zR(t,e,n,r){switch(t.type){case PR:if(t.children.length)break;case RR:case sg:return t.return=t.return||t.value;case gS:return"";case _S:return t.return=t.value+"{"+rc(t.children,r)+"}";case Au:if(!rn(t.value=t.props.join(",")))return""}return rn(n=rc(t.children,r))?t.return=t.value+"{"+n+"}":""}function VR(t){var e=vS(t);return function(n,r,i,s){for(var o="",a=0;a<e;a++)o+=t[a](n,r,i,s)||"";return o}}function WR(t){return function(e){e.root||(e=e.return)&&t(e)}}function jR(t,e,n,r){if(t.length>-1&&!t.return)switch(t.type){case sg:t.return=SS(t.value,t.length,n);return;case _S:return rc([zn(t,{value:q(t.value,"@","@"+ne)})],r);case Au:if(t.length)return xR(n=t.props,function(i){switch(vn(i,r=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":oi(zn(t,{props:[q(i,/:(read-\w+)/,":"+co+"$1")]})),oi(zn(t,{props:[i]})),sd(t,{props:vm(n,r)});break;case"::placeholder":oi(zn(t,{props:[q(i,/:(plac\w+)/,":"+ne+"input-$1")]})),oi(zn(t,{props:[q(i,/:(plac\w+)/,":"+co+"$1")]})),oi(zn(t,{props:[q(i,/:(plac\w+)/,de+"input-$1")]})),oi(zn(t,{props:[i]})),sd(t,{props:vm(n,r)});break}return""})}}var HR={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},rs=typeof process<"u"&&process.env!==void 0&&({}.REACT_APP_SC_ATTR||{}.SC_ATTR)||"data-styled",ES="active",wS="data-styled-version",Cu="6.1.13",ag=`/*!sc*/
`,ic=typeof window<"u"&&"HTMLElement"in window,$R=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&process.env!==void 0&&{}.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&{}.REACT_APP_SC_DISABLE_SPEEDY!==""?{}.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&{}.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&process.env!==void 0&&{}.SC_DISABLE_SPEEDY!==void 0&&{}.SC_DISABLE_SPEEDY!==""&&{}.SC_DISABLE_SPEEDY!=="false"&&{}.SC_DISABLE_SPEEDY),xu=Object.freeze([]),is=Object.freeze({});function XR(t,e,n){return n===void 0&&(n=is),t.theme!==n.theme&&t.theme||e||n.theme}var AS=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),YR=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,KR=/(^-|-$)/g;function Em(t){return t.replace(YR,"-").replace(KR,"")}var qR=/(a)(d)/gi,Ua=52,wm=function(t){return String.fromCharCode(t+(t>25?39:97))};function ld(t){var e,n="";for(e=Math.abs(t);e>Ua;e=e/Ua|0)n=wm(e%Ua)+n;return(wm(e%Ua)+n).replace(qR,"$1-$2")}var Pf,bS=5381,Pi=function(t,e){for(var n=e.length;n;)t=33*t^e.charCodeAt(--n);return t},RS=function(t){return Pi(bS,t)};function ZR(t){return ld(RS(t)>>>0)}function QR(t){return t.displayName||t.name||"Component"}function Cf(t){return typeof t=="string"&&!0}var PS=typeof Symbol=="function"&&Symbol.for,CS=PS?Symbol.for("react.memo"):60115,JR=PS?Symbol.for("react.forward_ref"):60112,GR={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},eP={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},xS={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},tP=((Pf={})[JR]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Pf[CS]=xS,Pf);function Am(t){return("type"in(e=t)&&e.type.$$typeof)===CS?xS:"$$typeof"in t?tP[t.$$typeof]:GR;var e}var nP=Object.defineProperty,rP=Object.getOwnPropertyNames,bm=Object.getOwnPropertySymbols,iP=Object.getOwnPropertyDescriptor,sP=Object.getPrototypeOf,Rm=Object.prototype;function IS(t,e,n){if(typeof e!="string"){if(Rm){var r=sP(e);r&&r!==Rm&&IS(t,r,n)}var i=rP(e);bm&&(i=i.concat(bm(e)));for(var s=Am(t),o=Am(e),a=0;a<i.length;++a){var l=i[a];if(!(l in eP||n&&n[l]||o&&l in o||s&&l in s)){var c=iP(e,l);try{nP(t,l,c)}catch{}}}}return t}function ss(t){return typeof t=="function"}function lg(t){return typeof t=="object"&&"styledComponentId"in t}function Mr(t,e){return t&&e?"".concat(t," ").concat(e):t||e||""}function Pm(t,e){if(t.length===0)return"";for(var n=t[0],r=1;r<t.length;r++)n+=e?e+t[r]:t[r];return n}function Bo(t){return t!==null&&typeof t=="object"&&t.constructor.name===Object.name&&!("props"in t&&t.$$typeof)}function cd(t,e,n){if(n===void 0&&(n=!1),!n&&!Bo(t)&&!Array.isArray(t))return e;if(Array.isArray(e))for(var r=0;r<e.length;r++)t[r]=cd(t[r],e[r]);else if(Bo(e))for(var r in e)t[r]=cd(t[r],e[r]);return t}function cg(t,e){Object.defineProperty(t,"toString",{value:e})}function ra(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(t," for more information.").concat(e.length>0?" Args: ".concat(e.join(", ")):""))}var oP=function(){function t(e){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=e}return t.prototype.indexOfGroup=function(e){for(var n=0,r=0;r<e;r++)n+=this.groupSizes[r];return n},t.prototype.insertRules=function(e,n){if(e>=this.groupSizes.length){for(var r=this.groupSizes,i=r.length,s=i;e>=s;)if((s<<=1)<0)throw ra(16,"".concat(e));this.groupSizes=new Uint32Array(s),this.groupSizes.set(r),this.length=s;for(var o=i;o<s;o++)this.groupSizes[o]=0}for(var a=this.indexOfGroup(e+1),l=(o=0,n.length);o<l;o++)this.tag.insertRule(a,n[o])&&(this.groupSizes[e]++,a++)},t.prototype.clearGroup=function(e){if(e<this.length){var n=this.groupSizes[e],r=this.indexOfGroup(e),i=r+n;this.groupSizes[e]=0;for(var s=r;s<i;s++)this.tag.deleteRule(r)}},t.prototype.getGroup=function(e){var n="";if(e>=this.length||this.groupSizes[e]===0)return n;for(var r=this.groupSizes[e],i=this.indexOfGroup(e),s=i+r,o=i;o<s;o++)n+="".concat(this.tag.getRule(o)).concat(ag);return n},t}(),El=new Map,sc=new Map,wl=1,La=function(t){if(El.has(t))return El.get(t);for(;sc.has(wl);)wl++;var e=wl++;return El.set(t,e),sc.set(e,t),e},aP=function(t,e){wl=e+1,El.set(t,e),sc.set(e,t)},lP="style[".concat(rs,"][").concat(wS,'="').concat(Cu,'"]'),cP=new RegExp("^".concat(rs,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),uP=function(t,e,n){for(var r,i=n.split(","),s=0,o=i.length;s<o;s++)(r=i[s])&&t.registerName(e,r)},fP=function(t,e){for(var n,r=((n=e.textContent)!==null&&n!==void 0?n:"").split(ag),i=[],s=0,o=r.length;s<o;s++){var a=r[s].trim();if(a){var l=a.match(cP);if(l){var c=0|parseInt(l[1],10),u=l[2];c!==0&&(aP(u,c),uP(t,u,l[3]),t.getTag().insertRules(c,i)),i.length=0}else i.push(a)}}},Cm=function(t){for(var e=document.querySelectorAll(lP),n=0,r=e.length;n<r;n++){var i=e[n];i&&i.getAttribute(rs)!==ES&&(fP(t,i),i.parentNode&&i.parentNode.removeChild(i))}};function hP(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var MS=function(t){var e=document.head,n=t||e,r=document.createElement("style"),i=function(a){var l=Array.from(a.querySelectorAll("style[".concat(rs,"]")));return l[l.length-1]}(n),s=i!==void 0?i.nextSibling:null;r.setAttribute(rs,ES),r.setAttribute(wS,Cu);var o=hP();return o&&r.setAttribute("nonce",o),n.insertBefore(r,s),r},dP=function(){function t(e){this.element=MS(e),this.element.appendChild(document.createTextNode("")),this.sheet=function(n){if(n.sheet)return n.sheet;for(var r=document.styleSheets,i=0,s=r.length;i<s;i++){var o=r[i];if(o.ownerNode===n)return o}throw ra(17)}(this.element),this.length=0}return t.prototype.insertRule=function(e,n){try{return this.sheet.insertRule(n,e),this.length++,!0}catch{return!1}},t.prototype.deleteRule=function(e){this.sheet.deleteRule(e),this.length--},t.prototype.getRule=function(e){var n=this.sheet.cssRules[e];return n&&n.cssText?n.cssText:""},t}(),pP=function(){function t(e){this.element=MS(e),this.nodes=this.element.childNodes,this.length=0}return t.prototype.insertRule=function(e,n){if(e<=this.length&&e>=0){var r=document.createTextNode(n);return this.element.insertBefore(r,this.nodes[e]||null),this.length++,!0}return!1},t.prototype.deleteRule=function(e){this.element.removeChild(this.nodes[e]),this.length--},t.prototype.getRule=function(e){return e<this.length?this.nodes[e].textContent:""},t}(),gP=function(){function t(e){this.rules=[],this.length=0}return t.prototype.insertRule=function(e,n){return e<=this.length&&(this.rules.splice(e,0,n),this.length++,!0)},t.prototype.deleteRule=function(e){this.rules.splice(e,1),this.length--},t.prototype.getRule=function(e){return e<this.length?this.rules[e]:""},t}(),xm=ic,_P={isServer:!ic,useCSSOMInjection:!$R},OS=function(){function t(e,n,r){e===void 0&&(e=is),n===void 0&&(n={});var i=this;this.options=ot(ot({},_P),e),this.gs=n,this.names=new Map(r),this.server=!!e.isServer,!this.server&&ic&&xm&&(xm=!1,Cm(this)),cg(this,function(){return function(s){for(var o=s.getTag(),a=o.length,l="",c=function(f){var h=function(g){return sc.get(g)}(f);if(h===void 0)return"continue";var d=s.names.get(h),m=o.getGroup(f);if(d===void 0||!d.size||m.length===0)return"continue";var T="".concat(rs,".g").concat(f,'[id="').concat(h,'"]'),A="";d!==void 0&&d.forEach(function(g){g.length>0&&(A+="".concat(g,","))}),l+="".concat(m).concat(T,'{content:"').concat(A,'"}').concat(ag)},u=0;u<a;u++)c(u);return l}(i)})}return t.registerId=function(e){return La(e)},t.prototype.rehydrate=function(){!this.server&&ic&&Cm(this)},t.prototype.reconstructWithOptions=function(e,n){return n===void 0&&(n=!0),new t(ot(ot({},this.options),e),this.gs,n&&this.names||void 0)},t.prototype.allocateGSInstance=function(e){return this.gs[e]=(this.gs[e]||0)+1},t.prototype.getTag=function(){return this.tag||(this.tag=(e=function(n){var r=n.useCSSOMInjection,i=n.target;return n.isServer?new gP(i):r?new dP(i):new pP(i)}(this.options),new oP(e)));var e},t.prototype.hasNameForId=function(e,n){return this.names.has(e)&&this.names.get(e).has(n)},t.prototype.registerName=function(e,n){if(La(e),this.names.has(e))this.names.get(e).add(n);else{var r=new Set;r.add(n),this.names.set(e,r)}},t.prototype.insertRules=function(e,n,r){this.registerName(e,n),this.getTag().insertRules(La(e),r)},t.prototype.clearNames=function(e){this.names.has(e)&&this.names.get(e).clear()},t.prototype.clearRules=function(e){this.getTag().clearGroup(La(e)),this.clearNames(e)},t.prototype.clearTag=function(){this.tag=void 0},t}(),mP=/&/g,yP=/^\s*\/\/.*$/gm;function kS(t,e){return t.map(function(n){return n.type==="rule"&&(n.value="".concat(e," ").concat(n.value),n.value=n.value.replaceAll(",",",".concat(e," ")),n.props=n.props.map(function(r){return"".concat(e," ").concat(r)})),Array.isArray(n.children)&&n.type!=="@keyframes"&&(n.children=kS(n.children,e)),n})}function vP(t){var e,n,r,i=t===void 0?is:t,s=i.options,o=s===void 0?is:s,a=i.plugins,l=a===void 0?xu:a,c=function(h,d,m){return m.startsWith(n)&&m.endsWith(n)&&m.replaceAll(n,"").length>0?".".concat(e):h},u=l.slice();u.push(function(h){h.type===Au&&h.value.includes("&")&&(h.props[0]=h.props[0].replace(mP,n).replace(r,c))}),o.prefix&&u.push(jR),u.push(zR);var f=function(h,d,m,T){d===void 0&&(d=""),m===void 0&&(m=""),T===void 0&&(T="&"),e=T,n=d,r=new RegExp("\\".concat(n,"\\b"),"g");var A=h.replace(yP,""),g=UR(m||d?"".concat(m," ").concat(d," { ").concat(A," }"):A);o.namespace&&(g=kS(g,o.namespace));var p=[];return rc(g,VR(u.concat(WR(function(_){return p.push(_)})))),p};return f.hash=l.length?l.reduce(function(h,d){return d.name||ra(15),Pi(h,d.name)},bS).toString():"",f}var TP=new OS,ud=vP(),NS=ze.createContext({shouldForwardProp:void 0,styleSheet:TP,stylis:ud});NS.Consumer;ze.createContext(void 0);function Im(){return W.useContext(NS)}var SP=function(){function t(e,n){var r=this;this.inject=function(i,s){s===void 0&&(s=ud);var o=r.name+s.hash;i.hasNameForId(r.id,o)||i.insertRules(r.id,o,s(r.rules,o,"@keyframes"))},this.name=e,this.id="sc-keyframes-".concat(e),this.rules=n,cg(this,function(){throw ra(12,String(r.name))})}return t.prototype.getName=function(e){return e===void 0&&(e=ud),this.name+e.hash},t}(),EP=function(t){return t>="A"&&t<="Z"};function Mm(t){for(var e="",n=0;n<t.length;n++){var r=t[n];if(n===1&&r==="-"&&t[0]==="-")return t;EP(r)?e+="-"+r.toLowerCase():e+=r}return e.startsWith("ms-")?"-"+e:e}var FS=function(t){return t==null||t===!1||t===""},DS=function(t){var e,n,r=[];for(var i in t){var s=t[i];t.hasOwnProperty(i)&&!FS(s)&&(Array.isArray(s)&&s.isCss||ss(s)?r.push("".concat(Mm(i),":"),s,";"):Bo(s)?r.push.apply(r,nc(nc(["".concat(i," {")],DS(s),!1),["}"],!1)):r.push("".concat(Mm(i),": ").concat((e=i,(n=s)==null||typeof n=="boolean"||n===""?"":typeof n!="number"||n===0||e in HR||e.startsWith("--")?String(n).trim():"".concat(n,"px")),";")))}return r};function Ur(t,e,n,r){if(FS(t))return[];if(lg(t))return[".".concat(t.styledComponentId)];if(ss(t)){if(!ss(s=t)||s.prototype&&s.prototype.isReactComponent||!e)return[t];var i=t(e);return Ur(i,e,n,r)}var s;return t instanceof SP?n?(t.inject(n,r),[t.getName(r)]):[t]:Bo(t)?DS(t):Array.isArray(t)?Array.prototype.concat.apply(xu,t.map(function(o){return Ur(o,e,n,r)})):[t.toString()]}function wP(t){for(var e=0;e<t.length;e+=1){var n=t[e];if(ss(n)&&!lg(n))return!1}return!0}var AP=RS(Cu),bP=function(){function t(e,n,r){this.rules=e,this.staticRulesId="",this.isStatic=(r===void 0||r.isStatic)&&wP(e),this.componentId=n,this.baseHash=Pi(AP,n),this.baseStyle=r,OS.registerId(n)}return t.prototype.generateAndInjectStyles=function(e,n,r){var i=this.baseStyle?this.baseStyle.generateAndInjectStyles(e,n,r):"";if(this.isStatic&&!r.hash)if(this.staticRulesId&&n.hasNameForId(this.componentId,this.staticRulesId))i=Mr(i,this.staticRulesId);else{var s=Pm(Ur(this.rules,e,n,r)),o=ld(Pi(this.baseHash,s)>>>0);if(!n.hasNameForId(this.componentId,o)){var a=r(s,".".concat(o),void 0,this.componentId);n.insertRules(this.componentId,o,a)}i=Mr(i,o),this.staticRulesId=o}else{for(var l=Pi(this.baseHash,r.hash),c="",u=0;u<this.rules.length;u++){var f=this.rules[u];if(typeof f=="string")c+=f;else if(f){var h=Pm(Ur(f,e,n,r));l=Pi(l,h+u),c+=h}}if(c){var d=ld(l>>>0);n.hasNameForId(this.componentId,d)||n.insertRules(this.componentId,d,r(c,".".concat(d),void 0,this.componentId)),i=Mr(i,d)}}return i},t}(),BS=ze.createContext(void 0);BS.Consumer;var xf={};function RP(t,e,n){var r=lg(t),i=t,s=!Cf(t),o=e.attrs,a=o===void 0?xu:o,l=e.componentId,c=l===void 0?function(w,R){var x=typeof w!="string"?"sc":Em(w);xf[x]=(xf[x]||0)+1;var M="".concat(x,"-").concat(ZR(Cu+x+xf[x]));return R?"".concat(R,"-").concat(M):M}(e.displayName,e.parentComponentId):l,u=e.displayName,f=u===void 0?function(w){return Cf(w)?"styled.".concat(w):"Styled(".concat(QR(w),")")}(t):u,h=e.displayName&&e.componentId?"".concat(Em(e.displayName),"-").concat(e.componentId):e.componentId||c,d=r&&i.attrs?i.attrs.concat(a).filter(Boolean):a,m=e.shouldForwardProp;if(r&&i.shouldForwardProp){var T=i.shouldForwardProp;if(e.shouldForwardProp){var A=e.shouldForwardProp;m=function(w,R){return T(w,R)&&A(w,R)}}else m=T}var g=new bP(n,h,r?i.componentStyle:void 0);function p(w,R){return function(x,M,k){var F=x.attrs,U=x.componentStyle,j=x.defaultProps,X=x.foldedComponentIds,$=x.styledComponentId,K=x.target,je=ze.useContext(BS),yr=Im(),$t=x.shouldForwardProp||yr.shouldForwardProp,L=XR(M,je,j)||is,H=function(Xt,Qe,fe){for(var ut,se=ot(ot({},Qe),{className:void 0,theme:fe}),Me=0;Me<Xt.length;Me+=1){var pn=ss(ut=Xt[Me])?ut(se):ut;for(var rt in pn)se[rt]=rt==="className"?Mr(se[rt],pn[rt]):rt==="style"?ot(ot({},se[rt]),pn[rt]):pn[rt]}return Qe.className&&(se.className=Mr(se.className,Qe.className)),se}(F,M,L),Y=H.as||K,re={};for(var G in H)H[G]===void 0||G[0]==="$"||G==="as"||G==="theme"&&H.theme===L||(G==="forwardedAs"?re.as=H.forwardedAs:$t&&!$t(G,Y)||(re[G]=H[G]));var dn=function(Xt,Qe){var fe=Im(),ut=Xt.generateAndInjectStyles(Qe,fe.styleSheet,fe.stylis);return ut}(U,H),Ze=Mr(X,$);return dn&&(Ze+=" "+dn),H.className&&(Ze+=" "+H.className),re[Cf(Y)&&!AS.has(Y)?"class":"className"]=Ze,re.ref=k,W.createElement(Y,re)}(_,w,R)}p.displayName=f;var _=ze.forwardRef(p);return _.attrs=d,_.componentStyle=g,_.displayName=f,_.shouldForwardProp=m,_.foldedComponentIds=r?Mr(i.foldedComponentIds,i.styledComponentId):"",_.styledComponentId=h,_.target=r?i.target:t,Object.defineProperty(_,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(w){this._foldedDefaultProps=r?function(R){for(var x=[],M=1;M<arguments.length;M++)x[M-1]=arguments[M];for(var k=0,F=x;k<F.length;k++)cd(R,F[k],!0);return R}({},i.defaultProps,w):w}}),cg(_,function(){return".".concat(_.styledComponentId)}),s&&IS(_,t,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),_}function Om(t,e){for(var n=[t[0]],r=0,i=e.length;r<i;r+=1)n.push(e[r],t[r+1]);return n}var km=function(t){return Object.assign(t,{isCss:!0})};function PP(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(ss(t)||Bo(t))return km(Ur(Om(xu,nc([t],e,!0))));var r=t;return e.length===0&&r.length===1&&typeof r[0]=="string"?Ur(r):km(Ur(Om(r,e)))}function fd(t,e,n){if(n===void 0&&(n=is),!e)throw ra(1,e);var r=function(i){for(var s=[],o=1;o<arguments.length;o++)s[o-1]=arguments[o];return t(e,n,PP.apply(void 0,nc([i],s,!1)))};return r.attrs=function(i){return fd(t,e,ot(ot({},n),{attrs:Array.prototype.concat(n.attrs,i).filter(Boolean)}))},r.withConfig=function(i){return fd(t,e,ot(ot({},n),i))},r}var US=function(t){return fd(RP,t)},Iu=US;AS.forEach(function(t){Iu[t]=US(t)});const CP=Iu.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
  background-color: #282c34;
  color: white;
  padding: 15px;
  height: 20px;
  font-family: "Gill Sans", sans-serif;
`,xP=Iu.div`
  font-size: 1rem;
  font-weight: bold;
`,IP=Iu.div`
  font-size: 1rem;
  color: #a0a0a0;
`,MP=()=>ze.createElement(CP,null,ze.createElement(xP,null,"Walking every street in Barcelona"),ze.createElement(IP,null,"Completed: 43.89% | Walked: 1534km"));function oc(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const ug=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Nm=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Nm&&parseFloat(Nm[1]);const za=globalThis,ai=globalThis.process||{},OP=globalThis.navigator||{};function LS(t){var r,i;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const e=typeof navigator<"u"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function mr(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||LS()}function kP(t){return!t&&!mr()?"Node":LS(t)?"Electron":(t||OP.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}const zS="4.0.7";function NP(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class FP{constructor(e,n,r="sessionStorage"){this.storage=NP(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function DP(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function BP(t,e=8){const n=Math.max(e-t.length,0);return`${" ".repeat(n)}${t}`}var ac;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(ac||(ac={}));const UP=10;function Fm(t){return typeof t!="string"?t:(t=t.toUpperCase(),ac[t]||ac.WHITE)}function LP(t,e,n){return!mr&&typeof t=="string"&&(e&&(t=`\x1B[${Fm(e)}m${t}\x1B[39m`),n&&(t=`\x1B[${Fm(n)+UP}m${t}\x1B[49m`)),t}function zP(t,e=["constructor"]){const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),i=t;for(const s of r){const o=i[s];typeof o=="function"&&(e.find(a=>s===a)||(i[s]=o.bind(t)))}}function fg(t,e){if(!t)throw new Error(e||"Assertion failed")}function li(){var e,n,r;let t;if(mr()&&za.performance)t=(n=(e=za==null?void 0:za.performance)==null?void 0:e.now)==null?void 0:n.call(e);else if("hrtime"in ai){const i=(r=ai==null?void 0:ai.hrtime)==null?void 0:r.call(ai);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const ci={debug:mr()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},VP={enabled:!0,level:0};function ui(){}const Dm={},Bm={once:!0};class ia{constructor({id:e}={id:""}){this.VERSION=zS,this._startTs=li(),this._deltaTs=li(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new FP(`__probe-${this.id}__`,VP),this.timeStamp(`${this.id} started`),zP(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((li()-this._startTs).toPrecision(10))}getDelta(){return Number((li()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){if(!e)throw new Error(n||"Assertion failed")}warn(e){return this._getLogFunction(0,e,ci.warn,arguments,Bm)}error(e){return this._getLogFunction(0,e,ci.error,arguments)}deprecated(e,n){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(e,n){return this.error(`\`${e}\` has been removed. Use \`${n}\` instead`)}probe(e,n){return this._getLogFunction(e,n,ci.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,ci.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,ci.debug||ci.info,arguments,Bm)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||ui,r&&[r],{tag:jP(n)}):ui}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||ui)}group(e,n,r={collapsed:!1}){const i=Um({logLevel:e,message:n,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,n,r={}){return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||ui)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=VS(e)}_getLogFunction(e,n,r,i,s){if(this._shouldLog(e)){s=Um({logLevel:e,message:n,args:i,opts:s}),r=r||s.method,fg(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=li();const o=s.tag||s.message;if(s.once&&o)if(!Dm[o])Dm[o]=li();else return ui;return n=WP(this.id,s.message,s),r.bind(console,n,...s.args)}return ui}}ia.VERSION=zS;function VS(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return fg(Number.isFinite(e)&&e>=0),e}function Um(t){const{logLevel:e,message:n}=t;t.logLevel=VS(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return fg(i==="string"||i==="object"),Object.assign(t,{args:r},t.opts)}function WP(t,e,n){if(typeof e=="string"){const r=n.time?BP(DP(n.total)):"";e=n.time?`${t}: ${r}  ${e}`:`${t}: ${e}`,e=LP(e,n.color,n.background)}return e}function jP(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}function HP(t,e){return WS(t||{},e)}function WS(t,e,n=0){if(n>3)return e;const r={...t};for(const[i,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?r[i]=WS(r[i]||{},e[i],n+1):r[i]=e[i];return r}const $P="latest";function XP(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.2.2"),globalThis._loadersgl_.version}const YP=XP();function fr(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Lr=typeof process!="object"||String(process)!=="[object process]"||process.browser,KP=typeof window<"u"&&typeof window.orientation<"u",Lm=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Lm&&parseFloat(Lm[1]);class qP{constructor(e,n){v(this,"name");v(this,"workerThread");v(this,"isRunning",!0);v(this,"result");v(this,"_resolve",()=>{});v(this,"_reject",()=>{});this.name=e,this.workerThread=n,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){fr(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){fr(this.isRunning),this.isRunning=!1,this._reject(e)}}class If{terminate(){}}const Mf=new Map;function ZP(t){fr(t.source&&!t.url||!t.source&&t.url);let e=Mf.get(t.source||t.url);return e||(t.url&&(e=QP(t.url),Mf.set(t.url,e)),t.source&&(e=jS(t.source),Mf.set(t.source,e))),fr(e),e}function QP(t){if(!t.startsWith("http"))return t;const e=JP(t);return jS(e)}function jS(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function JP(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function HS(t,e=!0,n){const r=n||new Set;if(t){if(zm(t))r.add(t);else if(zm(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const i in t)HS(t[i],e,r)}}return n===void 0?Array.from(r):[]}function zm(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Of=()=>{};class hd{constructor(e){v(this,"name");v(this,"source");v(this,"url");v(this,"terminated",!1);v(this,"worker");v(this,"onMessage");v(this,"onError");v(this,"_loadableURL","");const{name:n,source:r,url:i}=e;fr(r||i),this.name=n,this.source=r,this.url=i,this.onMessage=Of,this.onError=s=>console.log(s),this.worker=Lr?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Lr||typeof If<"u"&&!Lr}destroy(){this.onMessage=Of,this.onError=Of,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||HS(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,e.message&&(n+=`${e.message} in `),e.lineno&&(n+=`:${e.lineno}:${e.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=ZP({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new If(r,{eval:!1})}else if(this.source)e=new If(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class GP{constructor(e){v(this,"name","unnamed");v(this,"source");v(this,"url");v(this,"maxConcurrency",1);v(this,"maxMobileConcurrency",1);v(this,"onDebug",()=>{});v(this,"reuseWorkers",!0);v(this,"props",{});v(this,"jobQueue",[]);v(this,"idleQueue",[]);v(this,"count",0);v(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return hd.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(i,s,o)=>i.done(o),r=(i,s)=>i.error(s)){const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new qP(n.name,e);e.onMessage=i=>n.onMessage(r,i.type,i.payload),e.onError=i=>n.onError(r,i),n.onStart(r);try{await r.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Lr||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new hd({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return KP?this.maxMobileConcurrency:this.maxConcurrency}}const eC={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Hn=class Hn{constructor(e){v(this,"props");v(this,"workerPools",new Map);this.props={...eC},this.setProps(e),this.workerPools=new Map}static isSupported(){return hd.isSupported()}static getWorkerFarm(e={}){return Hn._workerFarm=Hn._workerFarm||new Hn({}),Hn._workerFarm.setProps(e),Hn._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:i}=e;let s=this.workerPools.get(n);return s||(s=new GP({name:n,source:r,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};v(Hn,"_workerFarm");let lc=Hn;function tC(t,e={}){const n=e[t.id]||{},r=Lr?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let i=n.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(Lr?i=`modules/${t.module}/dist/${r}`:i=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!i){let s=t.version;s==="latest"&&(s=$P);const o=s?`@${s}`:"";i=`https://unpkg.com/@loaders.gl/${t.module}${o}/dist/${r}`}return fr(i),i}function nC(t,e=YP){fr(t,"no worker provided");const n=t.version;return!(!e||!n)}function rC(t,e){return!lc.isSupported()||!Lr&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function iC(t,e,n,r,i){const s=t.id,o=tC(t,n),l=lc.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const c=await l.startJob("process-on-worker",sC.bind(null,i));return c.postMessage("process",{input:e,options:n,context:r}),await(await c.result).result}async function sC(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:s,options:o}=r;try{const a=await t(s,o);e.postMessage("done",{id:i,result:a})}catch(a){const l=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:i,error:l})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function oC(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),i=new Uint8Array(e);for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}function aC(...t){return lC(t)}function lC(t){const e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=e.reduce((s,o)=>s+o.byteLength,0),r=new Uint8Array(n);let i=0;for(const s of e)r.set(s,i),i+=s.byteLength;return r.buffer}async function cC(t){const e=[];for await(const n of t)e.push(n);return aC(...e)}function Vm(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class Wm{constructor(e,n){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Vm(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Vm()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Mu{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,n="count"){return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:r}=e;let i=this.stats[n];return i||(e instanceof Wm?i=e:i=new Wm(n,r),this.stats[n]=i),i}}let uC="";const jm={};function fC(t){for(const e in jm)if(t.startsWith(e)){const n=jm[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${uC}${t}`),t}function hC(t){return t&&typeof t=="object"&&t.isBuffer}function $S(t){if(hC(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function XS(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function dC(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const pC=t=>typeof t=="boolean",uo=t=>typeof t=="function",sa=t=>t!==null&&typeof t=="object",Hm=t=>sa(t)&&t.constructor==={}.constructor,gC=t=>!!t&&typeof t[Symbol.iterator]=="function",_C=t=>t&&typeof t[Symbol.asyncIterator]=="function",ei=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,ti=t=>typeof Blob<"u"&&t instanceof Blob,mC=t=>t&&typeof t=="object"&&t.isBuffer,yC=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||sa(t)&&uo(t.tee)&&uo(t.cancel)&&uo(t.getReader),vC=t=>sa(t)&&uo(t.read)&&uo(t.pipe)&&pC(t.readable),YS=t=>yC(t)||vC(t);class TC extends Error{constructor(n,r){super(n);v(this,"reason");v(this,"url");v(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const SC=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,EC=/^([-\w.]+\/[-\w.+]+)/;function $m(t,e){return t.toLowerCase()===e.toLowerCase()}function wC(t){const e=EC.exec(t);return e?e[1]:t}function Xm(t){const e=SC.exec(t);return e?e[1]:""}const KS=/\?.*/;function AC(t){const e=t.match(KS);return e&&e[0]}function hg(t){return t.replace(KS,"")}function bC(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function Ou(t){return ei(t)?t.url:ti(t)?t.name||"":typeof t=="string"?t:""}function dg(t){if(ei(t)){const e=t,n=e.headers.get("content-type")||"",r=hg(e.url);return wC(n)||Xm(r)}return ti(t)?t.type||"":typeof t=="string"?Xm(t):""}function RC(t){return ei(t)?t.headers["content-length"]||-1:ti(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function qS(t){if(ei(t))return t;const e={},n=RC(t);n>=0&&(e["content-length"]=String(n));const r=Ou(t),i=dg(t);i&&(e["content-type"]=i);const s=await xC(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function PC(t){if(!t.ok)throw await CC(t)}async function CC(t){const e=bC(t.url);let n=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;n=n.length>100?`${n.slice(0,100)}...`:n;const r={reason:t.statusText,url:t.url,response:t};try{const i=t.headers.get("Content-Type");r.reason=i!=null&&i.includes("application/json")?await t.json():t.text()}catch{}return new TC(n,r)}async function xC(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=s=>{var o;return r((o=s==null?void 0:s.target)==null?void 0:o.result)},i.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5);return`data:base64,${IC(n)}`}return null}function IC(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function MC(t){return!OC(t)&&!kC(t)}function OC(t){return t.startsWith("http:")||t.startsWith("https:")}function kC(t){return t.startsWith("data:")}async function Ym(t,e){var n,r;if(typeof t=="string"){const i=fC(t);return MC(i)&&(n=globalThis.loaders)!=null&&n.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(i,e):await fetch(i,e)}return await qS(t)}const Km=new ia({id:"loaders.gl"});class NC{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class FC{constructor(){v(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const ZS={fetch:null,mimeType:void 0,nothrow:!1,log:new FC,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:ug,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},DC={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function QS(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function JS(){const t=QS();return t.globalOptions=t.globalOptions||{...ZS},t.globalOptions}function BC(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],UC(t,n),zC(e,t,r)}function UC(t,e){qm(t,null,ZS,DC,e);for(const n of e){const r=t&&t[n.id]||{},i=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};qm(r,n.id,i,s,e)}}function qm(t,e,n,r,i){const s=e||"Top level",o=e?`${e}.`:"";for(const a in t){const l=!e&&sa(t[a]),c=a==="baseUri"&&!e,u=a==="workerUrl"&&e;if(!(a in n)&&!c&&!u){if(a in r)Km.warn(`${s} loader option '${o}${a}' no longer supported, use '${r[a]}'`)();else if(!l){const f=LC(a,i);Km.warn(`${s} loader option '${o}${a}' not recognized. ${f}`)()}}}}function LC(t,e){const n=t.toLowerCase();let r="";for(const i of e)for(const s in i.options){if(t===s)return`Did you mean '${i.id}.${s}'?`;const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(r=r||`Did you mean '${i.id}.${s}'?`)}return r}function zC(t,e,n){const i={...t.options||{}};return VC(i,n),i.log===null&&(i.log=new NC),Zm(i,JS()),Zm(i,e),i}function Zm(t,e){for(const n in e)if(n in e){const r=e[n];Hm(r)&&Hm(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function VC(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function pg(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function gg(t){oc(t,"null loader"),oc(pg(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const GS=()=>{const t=QS();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function WC(t){const e=GS();t=Array.isArray(t)?t:[t];for(const n of t){const r=gg(n);e.find(i=>r===i)||e.unshift(r)}}function jC(){return GS()}const HC=new ia({id:"loaders.gl"}),$C=/\.([^.]+)$/;async function XC(t,e=[],n,r){if(!eE(t))return null;let i=Qm(t,e,{...n,nothrow:!0},r);if(i)return i;if(ti(t)&&(t=await t.slice(0,10).arrayBuffer(),i=Qm(t,e,n,r)),!i&&!(n!=null&&n.nothrow))throw new Error(tE(t));return i}function Qm(t,e=[],n,r){if(!eE(t))return null;if(e&&!Array.isArray(e))return gg(e);let i=[];e&&(i=i.concat(e)),n!=null&&n.ignoreRegisteredLoaders||i.push(...jC()),KC(i);const s=YC(t,i,n,r);if(!s&&!(n!=null&&n.nothrow))throw new Error(tE(t));return s}function YC(t,e,n,r){const i=Ou(t),s=dg(t),o=hg(i)||(r==null?void 0:r.url);let a=null,l="";return n!=null&&n.mimeType&&(a=kf(e,n==null?void 0:n.mimeType),l=`match forced by supplied MIME type ${n==null?void 0:n.mimeType}`),a=a||qC(e,o),l=l||(a?`matched url ${o}`:""),a=a||kf(e,s),l=l||(a?`matched MIME type ${s}`:""),a=a||QC(e,t),l=l||(a?`matched initial data ${nE(t)}`:""),n!=null&&n.fallbackMimeType&&(a=a||kf(e,n==null?void 0:n.fallbackMimeType),l=l||(a?`matched fallback MIME type ${s}`:"")),l&&HC.log(1,`selectLoader selected ${a==null?void 0:a.name}: ${l}.`),a}function eE(t){return!(t instanceof Response&&t.status===204)}function tE(t){const e=Ou(t),n=dg(t);let r="No valid loader found (";r+=e?`${XS(e)}, `:"no url provided, ",r+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const i=t?nE(t):"";return r+=i?` first bytes: "${i}"`:"first bytes: not available",r+=")",r}function KC(t){for(const e of t)gg(e)}function qC(t,e){const n=e&&$C.exec(e),r=n&&n[1];return r?ZC(t,r):null}function ZC(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function kf(t,e){var n;for(const r of t)if((n=r.mimeTypes)!=null&&n.some(i=>$m(e,i))||$m(e,`application/x.${r.id}`))return r;return null}function QC(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(JC(e,n))return n}else if(ArrayBuffer.isView(e)){if(Jm(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&Jm(e,0,n))return n;return null}function JC(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function Jm(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(i=>GC(t,e,n,i))}function GC(t,e,n,r){if(r instanceof ArrayBuffer)return oC(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":const i=dd(t,e,r.length);return r===i;default:return!1}}function nE(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?dd(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?dd(t,0,e):""}function dd(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let i="";for(let s=0;s<n;s++)i+=String.fromCharCode(r.getUint8(e+s));return i}const e3=256*1024;function*t3(t,e){const n=(e==null?void 0:e.chunkSize)||e3;let r=0;const i=new TextEncoder;for(;r<t.length;){const s=Math.min(t.length-r,n),o=t.slice(r,r+s);r+=s,yield i.encode(o)}}const n3=256*1024;function*r3(t,e={}){const{chunkSize:n=n3}=e;let r=0;for(;r<t.byteLength;){const i=Math.min(t.byteLength-r,n),s=new ArrayBuffer(i),o=new Uint8Array(t,r,i);new Uint8Array(s).set(o),r+=i,yield s}}const i3=1024*1024;async function*s3(t,e){const n=(e==null?void 0:e.chunkSize)||i3;let r=0;for(;r<t.size;){const i=r+n,s=await t.slice(r,i).arrayBuffer();r=i,yield s}}function Gm(t,e){return ug?o3(t,e):a3(t)}async function*o3(t,e){const n=t.getReader();let r;try{for(;;){const i=r||n.read();e!=null&&e._streamReadAhead&&(r=n.read());const{done:s,value:o}=await i;if(s)return;yield $S(o)}}catch{n.releaseLock()}}async function*a3(t,e){for await(const n of t)yield $S(n)}function l3(t,e){if(typeof t=="string")return t3(t,e);if(t instanceof ArrayBuffer)return r3(t,e);if(ti(t))return s3(t,e);if(YS(t))return Gm(t,e);if(ei(t))return Gm(t.body,e);throw new Error("makeIterator")}const rE="Cannot convert supplied data type";function c3(t,e,n){if(e.text&&typeof t=="string")return t;if(mC(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+i)),r}throw new Error(rE)}async function u3(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return c3(t,e);if(ti(t)&&(t=await qS(t)),ei(t)){const i=t;return await PC(i),e.binary?await i.arrayBuffer():await i.text()}if(YS(t)&&(t=l3(t,n)),gC(t)||_C(t))return cC(t);throw new Error(rE)}function iE(t,e){const n=JS(),r=t||n;return typeof r.fetch=="function"?r.fetch:sa(r.fetch)?i=>Ym(i,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:Ym}function f3(t,e,n){if(n)return n;const r={fetch:iE(e,t),...t};if(r.url){const i=hg(r.url);r.baseUrl=i,r.queryString=AC(r.url),r.filename=XS(i),r.baseUrl=dC(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function h3(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:void 0}async function cc(t,e,n,r){e&&!Array.isArray(e)&&!pg(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const i=Ou(t),o=h3(e,r),a=await XC(t,o,n);return a?(n=BC(n,a,o,i),r=f3({url:i,_parse:cc,loaders:o},n,r||null),await d3(a,t,n,r)):null}async function d3(t,e,n,r){if(nC(t),n=HP(t.options,n),ei(e)){const s=e,{ok:o,redirected:a,status:l,statusText:c,type:u,url:f}=s,h=Object.fromEntries(s.headers.entries());r.response={headers:h,ok:o,redirected:a,status:l,statusText:c,type:u,url:f}}e=await u3(e,t,n);const i=t;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,n,r);if(rC(t,n))return await iC(t,e,n,r,cc);if(i.parseText&&typeof e=="string")return await i.parseText(e,n,r);if(i.parse)return await i.parse(e,n,r);throw fr(!i.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function uc(t,e,n,r){let i,s;!Array.isArray(e)&&!pg(e)?(i=[],s=e):(i=e,s=n);const o=iE(s);let a=t;return typeof t=="string"&&(a=await o(t)),ti(t)&&(a=await o(t)),Array.isArray(i)?await cc(a,i,s):await cc(a,i,s)}const p3="4.2.2";var rv;const g3=(rv=globalThis.loaders)==null?void 0:rv.parseImageNode,pd=typeof Image<"u",gd=typeof ImageBitmap<"u",_3=!!g3,_d=ug?!0:_3;function m3(t){switch(t){case"auto":return gd||pd||_d;case"imagebitmap":return gd;case"image":return pd;case"data":return _d;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function y3(){if(gd)return"imagebitmap";if(pd)return"image";if(_d)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function v3(t){const e=S3(t);if(!e)throw new Error("Not an image");return e}function T3(t){switch(v3(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function S3(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const E3=/^data:image\/svg\+xml/,w3=/\.svg((\?|#).*)?$/;function _g(t){return t&&(E3.test(t)||w3.test(t))}function A3(t,e){if(_g(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return sE(t,e)}function sE(t,e){if(_g(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function oE(t,e,n){const r=A3(t,n),i=self.URL||self.webkitURL,s=typeof r!="string"&&i.createObjectURL(r);try{return await b3(s||r,e)}finally{s&&i.revokeObjectURL(s)}}async function b3(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,i)=>{try{n.onload=()=>r(n),n.onerror=s=>{const o=s instanceof Error?s.message:"error";i(new Error(o))}}catch(s){i(s)}})}const R3={};let ey=!0;async function P3(t,e,n){let r;_g(n)?r=await oE(t,e,n):r=sE(t,n);const i=e&&e.imagebitmap;return await C3(r,i)}async function C3(t,e=null){if((x3(e)||!ey)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),ey=!1}return await createImageBitmap(t)}function x3(t){for(const e in t||R3)return!1;return!0}function I3(t){return!N3(t,"ftyp",4)||!(t[8]&96)?null:M3(t)}function M3(t){switch(O3(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function O3(t,e,n){return String.fromCharCode(...t.slice(e,n))}function k3(t){return[...t].map(e=>e.charCodeAt(0))}function N3(t,e,n=0){const r=k3(e);for(let i=0;i<r.length;++i)if(r[i]!==t[i+n])return!1;return!0}const on=!1,fo=!0;function aE(t){const e=oa(t);return D3(e)||L3(e)||B3(e)||U3(e)||F3(e)}function F3(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=I3(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function D3(t){const e=oa(t);return e.byteLength>=24&&e.getUint32(0,on)===2303741511?{mimeType:"image/png",width:e.getUint32(16,on),height:e.getUint32(20,on)}:null}function B3(t){const e=oa(t);return e.byteLength>=10&&e.getUint32(0,on)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,fo),height:e.getUint16(8,fo)}:null}function U3(t){const e=oa(t);return e.byteLength>=14&&e.getUint16(0,on)===16973&&e.getUint32(2,fo)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,fo),height:e.getUint32(22,fo)}:null}function L3(t){const e=oa(t);if(!(e.byteLength>=3&&e.getUint16(0,on)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=z3();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,on);if(i.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,on),width:e.getUint16(s+7,on)};if(!r.has(o))return null;s+=2,s+=e.getUint16(s,on)}return null}function z3(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function oa(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function V3(t,e){var i;const{mimeType:n}=aE(t)||{},r=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return oc(r),await r(t,n)}async function W3(t,e,n){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=n||{},o=j3(i);let a;switch(o){case"imagebitmap":a=await P3(t,e,s);break;case"image":a=await oE(t,e,s);break;case"data":a=await V3(t);break;default:oc(!1)}return i==="data"&&(a=T3(a)),a}function j3(t){switch(t){case"auto":case"data":return y3();default:return m3(t),t}}const H3=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],$3=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],X3={image:{type:"auto",decode:!0}},Y3={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:p3,mimeTypes:$3,extensions:H3,parse:W3,tests:[t=>!!aE(new DataView(t))],options:X3},K3=new ia({id:"deck"}),Q=K3;let md={};function q3(t){md=t}function Ye(t,e,n,r){Q.level>0&&md[t]&&md[t].call(null,e,n,r)}function Z3(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const Q3={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:Z3,parseTextSync:JSON.parse};function J3(){const t="9.0.29",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(Q.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:Q,_registerLoggers:q3},WC([Q3,[Y3,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const G3=J3();function Or(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Nf={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function ex(t){const e={};for(const[n,r]of Object.entries(t))e[n]=nx(r);return e}function tx(t,e,n){const r={};for(const[i,s]of Object.entries(e))t&&i in t&&!s.private?(s.validate&&Or(s.validate(t[i],s),`${n}: invalid ${i}`),r[i]=t[i]):r[i]=s.value;return r}function nx(t){let e=ty(t);if(e!=="object")return{value:t,...Nf[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...Nf[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=ty(t.value),{...t,...Nf[e],type:e}):{type:"object",value:null};throw new Error("props")}function ty(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const rx=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,ix=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`,sx={vertex:rx,fragment:ix},ny=/void\s+main\s*\([^)]*\)\s*\{\n?/,ry=/}\n?[^{}]*$/,Ff=[],Al="__LUMA_INJECT_DECLARATIONS__";function ox(t){const e={vertex:{},fragment:{}};for(const n in t){let r=t[n];const i=ax(n);typeof r=="string"&&(r={order:0,injection:r}),e[i][n]=r}return e}function ax(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function fc(t,e,n,r=!1){const i=e==="vertex";for(const s in n){const o=n[s];o.sort((l,c)=>l.order-c.order),Ff.length=o.length;for(let l=0,c=o.length;l<c;++l)Ff[l]=o[l].injection;const a=`${Ff.join(`
`)}
`;switch(s){case"vs:#decl":i&&(t=t.replace(Al,a));break;case"vs:#main-start":i&&(t=t.replace(ny,l=>l+a));break;case"vs:#main-end":i&&(t=t.replace(ry,l=>a+l));break;case"fs:#decl":i||(t=t.replace(Al,a));break;case"fs:#main-start":i||(t=t.replace(ny,l=>l+a));break;case"fs:#main-end":i||(t=t.replace(ry,l=>a+l));break;default:t=t.replace(s,l=>l+a)}}return t=t.replace(Al,""),r&&(t=t.replace(/\}\s*$/,s=>s+sx[e])),t}let lx=1;class kr{constructor(e){v(this,"name");v(this,"vs");v(this,"fs");v(this,"getModuleUniforms");v(this,"dependencies");v(this,"deprecations");v(this,"defines");v(this,"injections");v(this,"uniforms",{});v(this,"uniformTypes",{});const{name:n,vs:r,fs:i,dependencies:s=[],uniformTypes:o={},uniformPropTypes:a={},getUniforms:l,deprecations:c=[],defines:u={},inject:f={}}=e;Or(typeof n=="string"),this.name=n,this.vs=r,this.fs=i,this.getModuleUniforms=l,this.dependencies=kr.instantiateModules(s),this.deprecations=this._parseDeprecationDefinitions(c),this.defines=u,this.injections=ox(f),this.uniformTypes=o,a&&(this.uniforms=ex(a))}static instantiateModules(e){return e.map(n=>{if(n instanceof kr)return n;Or(typeof n!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(n)}' and use it directly.`),n.name||(console.warn("shader module has no name"),n.name=`shader-module-${lx++}`);const r=new kr(n);return r.dependencies=kr.instantiateModules(n.dependencies||[]),r})}getModuleSource(e){let n;switch(e){case"vertex":n=this.vs||"";break;case"fragment":n=this.fs||"";break;default:Or(!1)}const r=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${r}
${n}

`}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):tx(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(r=>{var i;(i=r.regex)!=null&&i.test(e)&&(r.deprecated?n.deprecated(r.old,r.new)():n.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp(`\\b${n.old}\\(`);break;default:n.regex=new RegExp(`${n.type} ${n.old};`)}}),e}_defaultGetUniforms(e={}){const n={},r=this.uniforms;for(const i in r){const s=r[i];i in e&&!s.private?(s.validate&&Or(s.validate(e[i],s),`${this.name}: invalid ${i}`),n[i]=e[i]):n[i]=s.value}return n}}function iy(t){if(t.source&&t.platformInfo.type==="webgpu")return{...t,vs:void 0,fs:void 0};if(!t.vs)throw new Error("no vertex shader");const e=sy(t.platformInfo,t.vs);let n;return t.fs&&(n=sy(t.platformInfo,t.fs)),{...t,vs:e,fs:n}}function sy(t,e){if(typeof e=="string")return e;switch(t.type){case"webgpu":if(e!=null&&e.wgsl)return e.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(e!=null&&e.glsl)return e.glsl;throw new Error("WebGL does not support WGSL shaders")}}function ku(t){const e=kr.instantiateModules(t);return cx(e)}function cx(t){const e={},n={};return lE({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((r,i)=>n[i]-n[r]).map(r=>e[r])}function lE(t){const{modules:e,level:n,moduleMap:r,moduleDepth:i}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)r[s.name]=s,(i[s.name]===void 0||i[s.name]<n)&&(i[s.name]=n);for(const s of e)s.dependencies&&lE({modules:s.dependencies,level:n+1,moduleMap:r,moduleDepth:i})}function ux(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function fx(t,e){var r;if(Number(((r=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=oy(t,hx),t;case"fragment":return t=oy(t,dx),t;default:throw new Error(e)}}const cE=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],hx=[...cE,[yd("attribute"),"in $1"],[yd("varying"),"out $1"]],dx=[...cE,[yd("varying"),"in $1"]];function oy(t,e){for(const[n,r]of e)t=t.replace(n,r);return t}function yd(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function uE(t,e){let n="";for(const r in t){const i=t[r];if(n+=`void ${i.signature} {
`,i.header&&(n+=`  ${i.header}`),e[r]){const s=e[r];s.sort((o,a)=>o.order-a.order);for(const o of s)n+=`  ${o.injection}
`}i.footer&&(n+=`  ${i.footer}`),n+=`}
`}return n}function fE(t){const e={vertex:{},fragment:{}};for(const n of t){let r,i;typeof n!="string"?(r=n,i=r.hook):(r={},i=n),i=i.trim();const[s,o]=i.split(":"),a=i.replace(/\(.+/,""),l=Object.assign(r,{signature:o});switch(s){case"vs":e.vertex[a]=l;break;case"fs":e.fragment[a]=l;break;default:throw new Error(s)}}return e}function px(t,e){return{name:gx(t,e),language:"glsl",version:_x(t)}}function gx(t,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return r?r[1]:e}function _x(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const hE=`

${Al}
`,mx=`precision highp float;
`;function yx(t){const e=ku(t.modules||[]);return{source:vd(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:mg(e)}}function vx(t){const e=ku(t.modules||[]);return{vs:vd(t.platformInfo,{...t,source:t.vs,stage:"vertex",modules:e}),fs:vd(t.platformInfo,{...t,source:t.fs,stage:"fragment",modules:e}),getUniforms:mg(e)}}function Tx(t){const{vs:e,fs:n}=t,r=ku(t.modules||[]);return{vs:ay(t.platformInfo,{...t,source:e,stage:"vertex",modules:r}),fs:ay(t.platformInfo,{...t,source:n,stage:"fragment",modules:r}),getUniforms:mg(r)}}function vd(t,e){const{source:n,stage:r,modules:i,hookFunctions:s=[],inject:o={},log:a}=e;Or(typeof n=="string","shader source must be a string");const l=n;let c="";const u=fE(s),f={},h={},d={};for(const T in o){const A=typeof o[T]=="string"?{injection:o[T],order:0}:o[T],g=/^(v|f)s:(#)?([\w-]+)$/.exec(T);if(g){const p=g[2],_=g[3];p?_==="decl"?h[T]=[A]:d[T]=[A]:f[T]=[A]}else d[T]=[A]}const m=t.type!=="webgpu"?i:[];for(const T of m){a&&T.checkDeprecations(l,a);const A=T.getModuleSource(r,"wgsl");c+=A;const g=T.injections[r];for(const p in g){const _=/^(v|f)s:#([\w-]+)$/.exec(p);if(_){const R=_[2]==="decl"?h:d;R[p]=R[p]||[],R[p].push(g[p])}else f[p]=f[p]||[],f[p].push(g[p])}}return c+=hE,c=fc(c,r,h),c+=uE(u[r],f),c+=l,c=fc(c,r,d),c}function ay(t,e){const{id:n,source:r,stage:i,language:s="glsl",modules:o,defines:a={},hookFunctions:l=[],inject:c={},prologue:u=!0,log:f}=e;Or(typeof r=="string","shader source must be a string");const h=s==="glsl"?px(r).version:-1,d=t.shaderLanguageVersion,m=h===100?"#version 100":"#version 300 es",A=r.split(`
`).slice(1).join(`
`),g={};o.forEach(M=>{Object.assign(g,M.getDefines())}),Object.assign(g,a);let p="";switch(s){case"wgsl":break;case"glsl":p=u?`${m}

// ----- PROLOGUE -------------------------
${Sx({id:n,source:r,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}
${ux(t)}
${i==="fragment"?mx:""}

// ----- APPLICATION DEFINES -------------------------

${Ex(g)}

`:`${m}
`;break}const _=fE(l),w={},R={},x={};for(const M in c){const k=typeof c[M]=="string"?{injection:c[M],order:0}:c[M],F=/^(v|f)s:(#)?([\w-]+)$/.exec(M);if(F){const U=F[2],j=F[3];U?j==="decl"?R[M]=[k]:x[M]=[k]:w[M]=[k]}else x[M]=[k]}for(const M of o){f&&M.checkDeprecations(A,f);const k=M.getModuleSource(i);p+=k;const F=M.injections[i];for(const U in F){const j=/^(v|f)s:#([\w-]+)$/.exec(U);if(j){const $=j[2]==="decl"?R:x;$[U]=$[U]||[],$[U].push(F[U])}else w[U]=w[U]||[],w[U].push(F[U])}}return p+="// ----- MAIN SHADER SOURCE -------------------------",p+=hE,p=fc(p,i,R),p+=uE(_[i],w),p+=A,p=fc(p,i,x),s==="glsl"&&h!==d&&(p=fx(p,i)),p.trim()}function mg(t){return function(n){const r={};for(const i of t){const s=i.getUniforms(n,r);Object.assign(r,s)}return r}}function Sx(t){const{id:e,source:n,stage:r}=t;return e&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}

`:""}function Ex(t={}){let e="";for(const n in t){const r=t[n];(r||Number.isFinite(r))&&(e+=`#define ${n.toUpperCase()} ${t[n]}
`)}return e}const Rr=class Rr{constructor(){v(this,"_hookFunctions",[]);v(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Rr.defaultShaderAssembler=Rr.defaultShaderAssembler||new Rr,Rr.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(n=>n.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==n)}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e)}assembleShader(e){const n=this._getModuleList(e.modules),r=this._hookFunctions,i=iy(e);return{...yx({platformInfo:e.platformInfo,...i,modules:n,hookFunctions:r}),modules:n}}assembleShaderPair(e){const n=iy(e),r=this._getModuleList(e.modules),i=this._hookFunctions,{platformInfo:s}=e;return{...e.platformInfo.shaderLanguage==="wgsl"?vx({platformInfo:s,...n,modules:r,hookFunctions:i}):Tx({platformInfo:s,...n,modules:r,hookFunctions:i}),modules:r}}_getModuleList(e=[]){const n=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const a=this._defaultModules[s],l=a.name;n[i++]=a,r[l]=!0}for(let s=0,o=e.length;s<o;++s){const a=e[s],l=a.name;r[l]||(n[i++]=a,r[l]=!0)}return n.length=i,kr.instantiateModules(n)}};v(Rr,"defaultShaderAssembler");let hc=Rr;const wx=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,Ax=`#version 300 es
${wx}`;function bx(t){const{input:e,inputChannels:n,output:r}=t||{};if(!e)return Ax;if(!n)throw new Error("inputChannels");const i=Rx(n),s=Px(e,n);return`#version 300 es
in ${i} ${e};
out vec4 ${r};
void main() {
  ${r} = ${s};
}`}function Rx(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function Px(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}const B=new ia({id:"luma.gl"});class Cx{constructor(){v(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Mu({id:e})),this.stats.get(e)}}const yg=new Cx;function xx(){const t="9.0.27",e="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==t)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${t}`);return globalThis.luma||(mr()&&B.log(1,`${t} - ${e}`)(),globalThis.luma=globalThis.luma||{VERSION:t,version:t,log:B,stats:yg}),t}const Ix=xx();function Mx(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)?t:null}function Uo(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number"?t:null:Mx(t)}const Df={};function ni(t="id"){Df[t]=Df[t]||1;const e=Df[t]++;return`${t}-${e}`}function dc(t){let e=!0;for(const n in t){e=!1;break}return e}var hh;let le=(hh=class{constructor(e,n,r){v(this,"id");v(this,"props");v(this,"userData",{});v(this,"_device");v(this,"destroyed",!1);v(this,"allocatedBytes",0);v(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=Ox(n,r);const i=this.props.id!=="undefined"?this.props.id:ni(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get(`${n}s Active`).decrementCount()}trackAllocatedMemory(e,n=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${n} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").subtractCount(this.allocatedBytes),n.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${n}s Created`).incrementCount(),e.get(`${n}s Active`).incrementCount()}},v(hh,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),hh);function Ox(t,e){const n={...e};for(const r in t)t[r]!==void 0&&(n[r]=t[r]);return n}const Ue=class Ue extends le{constructor(n,r){const i={...r};(r.usage||0)&Ue.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?i.indexType="uint32":r.data instanceof Uint16Array&&(i.indexType="uint16"));super(n,i,Ue.defaultProps);v(this,"usage");v(this,"indexType");v(this,"updateTimestamp");v(this,"debugData",new ArrayBuffer(0));this.usage=r.usage||0,this.indexType=i.indexType,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}readSyncWebGL(n,r){throw new Error("not implemented")}_setDebugData(n,r,i){const s=ArrayBuffer.isView(n)?n.buffer:n,o=Math.min(n?n.byteLength:i,Ue.DEBUG_DATA_MAX_LENGTH);n===null?this.debugData=new ArrayBuffer(o):r===0&&i===n.byteLength?this.debugData=s.slice(0,o):this.debugData=s.slice(r,r+o)}};v(Ue,"defaultProps",{...le.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),v(Ue,"MAP_READ",1),v(Ue,"MAP_WRITE",2),v(Ue,"COPY_SRC",4),v(Ue,"COPY_DST",8),v(Ue,"INDEX",16),v(Ue,"VERTEX",32),v(Ue,"UNIFORM",64),v(Ue,"STORAGE",128),v(Ue,"INDIRECT",256),v(Ue,"QUERY_RESOLVE",512),v(Ue,"DEBUG_DATA_MAX_LENGTH",32);let _e=Ue;function dE(t){const e=ly[t],n=kx(e),r=t.includes("norm"),i=!r&&!t.startsWith("float"),s=t.startsWith("s");return{dataType:ly[t],byteLength:n,integer:i,signed:s,normalized:r}}function kx(t){return Nx[t]}const ly={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},Nx={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},Fx=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],Dx=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function Bx(t){return Fx.some(e=>t.startsWith(e))}function pE(t){const e=Dx.exec(t);if(e){const[,n,r,i,s,o]=e;if(n){const a=`${i}${r}`,l=dE(a);return{format:n,components:n.length,srgb:s==="-srgb",unsized:o==="-unsized",webgl:o==="-webgl",...l}}}return Lx(t)}const Ux={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function Lx(t){var n;const e=Ux[t];if(!e)throw new Error(`Unknown format ${t}`);return{format:e.format||"",components:e.components||((n=e.format)==null?void 0:n.length)||1,byteLength:e.bpp||1,srgb:!1,unsized:!1}}class zx{}class Vx{constructor(e=[],n){v(this,"features");v(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=n||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures[e]&&this.features.has(e)}}const mo=class mo{constructor(e){v(this,"id");v(this,"props");v(this,"userData",{});v(this,"statsManager",yg);v(this,"_lumaData",{});v(this,"timestamp",0);this.props={...mo.defaultProps,...e},this.id=this.props.id||ni(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}isTextureFormatCompressed(e){return Bx(e)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||typeof e=="string")&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e={}){throw new Error("not implemented")}readPixelsToArrayWebGL(e,n){throw new Error("not implemented")}readPixelsToBufferWebGL(e,n){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,n){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const n={...e};return(e.usage||0)&_e.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?n.indexType="uint32":e.data instanceof Uint16Array?n.indexType="uint16":B.warn("indices buffer content must be of integer type")()),n}};v(mo,"defaultProps",{id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!B.get("debug"),spector:!!(B.get("spector")||B.get("spectorjs")),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:e=>B.error(e.message)}),v(mo,"VERSION",Ix);let os=mo;function ue(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const Ds=new Map,Fi=class Fi{static registerDevices(e){for(const n of e)ue(n.type&&n.isSupported&&n.create),Ds.set(n.type,n)}static getAvailableDevices(){return Array.from(Ds).map(e=>e.type)}static getSupportedDevices(){return Array.from(Ds).filter(e=>e.isSupported()).map(e=>e.type)}static setDefaultDeviceProps(e){Object.assign(os.defaultProps,e)}static async attachDevice(e){const n=cy(e.devices)||Ds;if(e.handle instanceof WebGL2RenderingContext){const r=n.get("webgl");if(r)return await r.attach(e.handle)}if(e.handle===null){const r=n.get("unknown");if(r)return await r.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(e={}){var s,o;e={...Fi.defaultProps,...e},e.gl&&(e.type="webgl");const n=cy(e.devices)||Ds;let r,i;switch(e.type){case"webgpu":if(r=n.get("webgpu"),r)return await r.create(e);break;case"webgl":if(i=n.get("webgl"),i)return await i.create(e);break;case"unknown":const a=n.get("unknown");if(a)return await a.create(e);break;case"best-available":if(r=n.get("webgpu"),(s=r==null?void 0:r.isSupported)!=null&&s.call(r))return await r.create(e);if(i=n.get("webgl"),(o=i==null?void 0:i.isSupported)!=null&&o.call(i))return await i.create(e);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static enforceWebGL2(e=!0){const n=HTMLCanvasElement.prototype;if(!e&&n.originalGetContext){n.getContext=n.originalGetContext,n.originalGetContext=void 0;return}n.originalGetContext=n.getContext,n.getContext=function(r,i){return r==="webgl"||r==="experimental-webgl"?this.originalGetContext("webgl2",i):this.originalGetContext(r,i)}}};v(Fi,"defaultProps",{...os.defaultProps,type:"best-available",devices:void 0}),v(Fi,"stats",yg),v(Fi,"log",B);let Wi=Fi;function cy(t){if(!t||(t==null?void 0:t.length)===0)return null;const e=new Map;for(const n of t)e.set(n.type,n);return e}const Wx=mr()&&typeof document<"u",Nu=()=>Wx&&document.readyState==="complete",jx={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class vg{constructor(e){v(this,"id");v(this,"props");v(this,"canvas");v(this,"htmlCanvas");v(this,"offscreenCanvas");v(this,"type");v(this,"width",1);v(this,"height",1);v(this,"resizeObserver");v(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...jx,...e},e=this.props,!mr()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=Xx(e.canvas):this.canvas=e.canvas;else{const n=Yx(e),r=$x((e==null?void 0:e.container)||null);r.insertBefore(n,r.firstChild),this.canvas=n,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(n=>{for(const r of n)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}static get isPageLoaded(){return Nu()}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),n=this.canvas;return n.parentElement?[n.clientWidth*e,n.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,n]=this.getPixelSize();return e/n}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:n}=this._canvasSizeInfo;return n?e/n:1}catch{return 1}}cssToDevicePixels(e,n=!0){const r=this.cssToDeviceRatio(),[i,s]=this.getDrawingBufferSize();return Kx(e,r,i,s,n)}setDevicePixelRatio(e,n={}){if(!this.htmlCanvas)return;let r="width"in n?n.width:this.htmlCanvas.clientWidth,i="height"in n?n.height:this.htmlCanvas.clientHeight;(!r||!i)&&(B.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==r||s.clientHeight!==i||s.devicePixelRatio!==e){let o=e;const a=Math.floor(r*o),l=Math.floor(i*o);this.htmlCanvas.width=a,this.htmlCanvas.height=l;const[c,u]=this.getDrawingBufferSize();(c!==a||u!==l)&&(o=Math.min(c/r,u/i),this.htmlCanvas.width=Math.floor(r*o),this.htmlCanvas.height=Math.floor(i*o),B.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var n;((n=this.htmlCanvas)==null?void 0:n.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}v(vg,"pageLoaded",Hx());function Hx(){return Nu()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}function $x(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e&&!Nu())throw new Error(`Accessing '${t}' before page was loaded`);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function Xx(t){const e=document.getElementById(t);if(!e&&!Nu())throw new Error(`Accessing '${t}' before page was loaded`);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function Yx(t){const{width:e,height:n}=t,r=document.createElement("canvas");return r.id="lumagl-auto-created-canvas",r.width=e||1,r.height=n||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(n)?`${n}px`:"100%",r}function Kx(t,e,n,r,i){const s=t,o=uy(s[0],e,n);let a=fy(s[1],e,r,i),l=uy(s[0]+1,e,n);const c=l===n-1?l:l-1;l=fy(s[1]+1,e,r,i);let u;return i?(l=l===0?l:l+1,u=a,a=l):u=l===r-1?l:l-1,{x:o,y:a,width:Math.max(c-o+1,1),height:Math.max(u-a+1,1)}}function uy(t,e,n){return Math.min(Math.round(t*e),n-1)}function fy(t,e,n,r){return r?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const Tn=class Tn extends le{constructor(n,r,i=Tn.defaultProps){super(n,r,i);v(this,"dimension");v(this,"format");v(this,"width");v(this,"height");v(this,"depth");v(this,"updateTimestamp");this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}};v(Tn,"defaultProps",{...le.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0}),v(Tn,"COPY_SRC",1),v(Tn,"COPY_DST",2),v(Tn,"TEXTURE_BINDING",4),v(Tn,"STORAGE_BINDING",8),v(Tn,"RENDER_ATTACHMENT",16);let bt=Tn;const Fc=class Fc extends le{get[Symbol.toStringTag](){return"TextureView"}constructor(e,n){super(e,n,Fc.defaultProps)}};v(Fc,"defaultProps",{...le.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let pc=Fc;function qx(t,e,n){let r="";const i=e.split(/\r?\n/),s=t.slice().sort((o,a)=>o.lineNum-a.lineNum);switch((n==null?void 0:n.showSourceCode)||"no"){case"all":let o=0;for(let a=1;a<=i.length;a++)for(r+=gE(i[a-1],a,n);s.length>o&&s[o].lineNum===a;){const l=s[o++];r+=hy(l,i,l.lineNum,{...n,inlineSource:!1})}return r;case"issues":case"no":for(const a of t)r+=hy(a,i,a.lineNum,{inlineSource:(n==null?void 0:n.showSourceCode)!=="no"});return r}}function hy(t,e,n,r){if(r!=null&&r.inlineSource){const i=Zx(e,n),s=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${i}${s}${t.type.toUpperCase()}: ${t.message}

`}return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function Zx(t,e,n){let r="";for(let i=e-2;i<=e;i++){const s=t[i-1];s!==void 0&&(r+=gE(s,e,n))}return r}function gE(t,e,n){const r=n!=null&&n.html?Jx(t):t;return`${Qx(String(e),4)}: ${r}${n!=null&&n.html?"<br/>":`
`}`}function Qx(t,e){let n="";for(let r=t.length;r<e;++r)n+=" ";return n+t}function Jx(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function _E(t,e){return{name:Gx(t,e),language:"glsl",version:e2(t)}}function Gx(t,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return r?r[1]:e}function e2(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}return e}const Dc=class Dc extends le{constructor(n,r){super(n,{id:t2(r),...r},Dc.defaultProps);v(this,"stage");v(this,"source");v(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(n=this.props.debug){switch(n){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();this.props.debug==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r)}_displayShaderLog(n){var c;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=_E(this.source).name,i=`${this.stage} ${r}`;let s=qx(n,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a);const l=document.getElementsByClassName("luma-compiler-log-error");(c=l[0])!=null&&c.scrollIntoView&&l[0].scrollIntoView(),a.onclick=()=>{const u=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(u)}}};v(Dc,"defaultProps",{...le.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"});let gc=Dc;function t2(t){return _E(t.source).name||t.id||ni(`unnamed ${t.stage}-shader`)}const Bc=class Bc extends le{get[Symbol.toStringTag](){return"Sampler"}constructor(e,n){super(e,n,Bc.defaultProps)}};v(Bc,"defaultProps",{...le.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let _c=Bc;const Uc=class Uc extends le{constructor(n,r={}){super(n,r,Uc.defaultProps);v(this,"width");v(this,"height");v(this,"colorAttachments",[]);v(this,"depthStencilAttachment",null);this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}resize(n){let r=!n;if(n){const[i,s]=Array.isArray(n)?n:[n.width,n.height];r=r||s!==this.height||i!==this.width,this.width=i,this.height=s}r&&(B.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(r=>{if(typeof r=="string"){const i=this.createColorTexture(r);return this.attachResource(i),i.view}return r instanceof bt?r.view:r});const n=this.props.depthStencilAttachment;if(n)if(typeof n=="string"){const r=this.createDepthStencilTexture(n);this.attachResource(r),this.depthStencilAttachment=r.view}else n instanceof bt?this.depthStencilAttachment=n.view:this.depthStencilAttachment=n}createColorTexture(n){return this.device.createTexture({id:"color-attachment",usage:bt.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height})}createDepthStencilTexture(n){return this.device.createTexture({id:"depth-stencil-attachment",usage:bt.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height})}resizeAttachments(n,r){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.device._createTexture({...this.colorAttachments[i].props,width:n,height:r});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.device._createTexture({...this.depthStencilAttachment.props,width:n,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}}};v(Uc,"defaultProps",{...le.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let mc=Uc;const Lc=class Lc extends le{constructor(n,r){super(n,r,Lc.defaultProps);v(this,"shaderLayout");v(this,"bufferLayout");v(this,"linkStatus","pending");v(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(n){throw new Error("Use uniform blocks")}};v(Lc,"defaultProps",{...le.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let as=Lc;const zc=class zc extends le{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,n){super(e,n,zc.defaultProps)}};v(zc,"defaultProps",{...le.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let Td=zc;const Vc=class Vc extends le{constructor(n,r){super(n,r,Vc.defaultProps);v(this,"hash","")}get[Symbol.toStringTag](){return"ComputePipeline"}};v(Vc,"defaultProps",{...le.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let yc=Vc;const Wc=class Wc extends le{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,n){super(e,n,Wc.defaultProps)}};v(Wc,"defaultProps",{...le.defaultProps,measureExecutionTime:void 0});let Sd=Wc;const jc=class jc extends le{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,n){super(e,n,jc.defaultProps)}};v(jc,"defaultProps",{...le.defaultProps});let Ed=jc;function n2(t){const[e,n]=i2[t],r=e==="i32"||e==="u32",i=e!=="u32",s=s2[e]*n,o=r2(e,n);return{dataType:e,components:n,defaultVertexFormat:o,byteLength:s,integer:r,signed:i}}function r2(t,e){let n;switch(t){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?n:`${n}x${e}`}const i2={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},s2={f32:4,f16:2,i32:4,u32:4};function mE(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[n,r]=t.split("x"),i=n,s=r?parseInt(r):1,o=dE(i),a={type:i,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(a.webglOnly=!0),a}function yE(t,e){const n={};for(const r of t.attributes)n[r.name]=a2(t,e,r.name);return n}function o2(t,e,n=16){const r=yE(t,e),i=new Array(n).fill(null);for(const s of Object.values(r))i[s.location]=s;return i}function a2(t,e,n){const r=l2(t,n),i=c2(e,n);if(!r)return null;const s=n2(r.type),o=(i==null?void 0:i.vertexFormat)||s.defaultVertexFormat,a=mE(o);return{attributeName:(i==null?void 0:i.attributeName)||r.name,bufferName:(i==null?void 0:i.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:o,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:s.integer,stepMode:(i==null?void 0:i.stepMode)||r.stepMode,byteOffset:(i==null?void 0:i.byteOffset)||0,byteStride:(i==null?void 0:i.byteStride)||0}}function l2(t,e){const n=t.attributes.find(r=>r.name===e);return n||B.warn(`shader layout attribute "${e}" not present in shader`),n||null}function c2(t,e){u2(t);let n=f2(t,e);return n||(n=h2(t,e),n)?n:(B.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function u2(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&B.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function f2(t,e){for(const n of t)if(n.format&&n.name===e)return{attributeName:n.name,bufferName:e,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}function h2(t,e){var n;for(const r of t){let i=r.byteStride;if(typeof r.byteStride!="number")for(const o of r.attributes||[]){const a=mE(o.format);i+=a.byteLength}const s=(n=r.attributes)==null?void 0:n.find(o=>o.attribute===e);if(s)return{attributeName:s.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:i}}return null}function d2(t,e){const n={...t,attributes:t.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const i=n.attributes.find(s=>s.name===r.name);i?(i.type=r.type||i.type,i.stepMode=r.stepMode||i.stepMode):B.warn(`shader layout attribute ${r.name} not present in shader`)}return n}const Hc=class Hc extends le{constructor(n,r){super(n,r,Hc.defaultProps);v(this,"maxVertexAttributes");v(this,"attributeInfos");v(this,"indexBuffer",null);v(this,"attributes");this.maxVertexAttributes=n.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=o2(r.renderPipeline.shaderLayout,r.renderPipeline.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(n,r){throw new Error("constant attributes not supported")}};v(Hc,"defaultProps",{...le.defaultProps,renderPipeline:null});let wd=Hc;const $c=class $c extends le{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,n){super(e,n,$c.defaultProps)}};v($c,"defaultProps",{...le.defaultProps,layout:void 0,buffers:{}});let Ad=$c;const Xc=class Xc extends le{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,n){super(e,n,Xc.defaultProps)}};v(Xc,"defaultProps",{...le.defaultProps,type:void 0,count:void 0});let bd=Xc;const p2={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function g2(t){const e=p2[t];return ue(t),e}function _2(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let Va;function vE(t){return(!Va||Va.byteLength<t)&&(Va=new ArrayBuffer(t)),Va}function m2(t,e){const n=vE(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function y2(t){const{target:e,source:n,start:r=0,count:i=1}=t,s=n.length,o=i*s;let a=0;for(let l=r;a<s;a++)e[l++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+o-a),a=o);return t.target}const dy=1024;class v2{constructor(e){v(this,"layout",{});v(this,"byteLength");let n=0;for(const[i,s]of Object.entries(e)){const o=g2(s),{type:a,components:l}=o;n=_2(n,l);const c=n;n+=l,this.layout[i]={type:a,size:l,offset:c}}n+=(4-n%4)%4;const r=n*4;this.byteLength=Math.max(r,dy)}getData(e){const n=Math.max(this.byteLength,dy),r=vE(n),i={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[s,o]of Object.entries(e)){const a=this.layout[s];if(!a){B.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:l,size:c,offset:u}=a,f=i[l];if(c===1){if(typeof o!="number"&&typeof o!="boolean"){B.warn(`Supplied value for single component uniform ${s} is not a number: ${o}`)();continue}f[u]=Number(o)}else{const h=Uo(o);if(!h){B.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${o}`)();continue}f.set(h,u)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function T2(t,e,n=16){if(t!==e)return!1;const r=Uo(t);if(!r)return!1;const i=Uo(e);if(i&&r.length===i.length){for(let s=0;s<r.length;++s)if(i[s]!==r[s])return!1}return!0}function S2(t){const e=Uo(t);return e?e.slice():t}class E2{constructor(e){v(this,"name");v(this,"uniforms",{});v(this,"modifiedUniforms",{});v(this,"modified",!0);v(this,"bindingLayout",{});v(this,"needsRedraw","initialized");var n;if(this.name=e==null?void 0:e.name,e!=null&&e.name&&(e!=null&&e.shaderLayout)){const r=(n=e==null?void 0:e.shaderLayout.bindings)==null?void 0:n.find(s=>s.type==="uniform"&&s.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const i=r;for(const s of i.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[n,r]of Object.entries(e))this._setUniform(n,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${n}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,n){T2(this.uniforms[e],n)||(this.uniforms[e]=S2(n),this.modifiedUniforms[e]=!0,this.modified=!0)}}class w2{constructor(e){v(this,"uniformBlocks",new Map);v(this,"uniformBufferLayouts",new Map);v(this,"uniformBuffers",new Map);for(const[n,r]of Object.entries(e)){const i=n,s=new v2(r.uniformTypes||{});this.uniformBufferLayouts.set(i,s);const o=new E2({name:n});o.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(i,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[n,r]of Object.entries(e))this.uniformBlocks.get(n).setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const n=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(n)}createUniformBuffer(e,n,r){r&&this.setUniforms(r);const i=this.getUniformBufferByteLength(n),s=e.createBuffer({usage:_e.UNIFORM|_e.COPY_DST,byteLength:i}),o=this.getUniformBufferData(n);return s.write(o),s}getManagedUniformBuffer(e,n){if(!this.uniformBuffers.get(n)){const r=this.getUniformBufferByteLength(n),i=e.createBuffer({usage:_e.UNIFORM|_e.COPY_DST,byteLength:r});this.uniformBuffers.set(n,i)}return this.uniformBuffers.get(n)}updateUniformBuffers(){let e=!1;for(const n of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(n);e||(e=r)}return e&&B.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const n=this.uniformBlocks.get(e),r=this.uniformBuffers.get(e);let i=!1;if(r&&n.needsRedraw){i||(i=n.needsRedraw);const s=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(s);const a=this.uniformBlocks.get(e).getAllUniforms();B.log(4,`Writing to uniform buffer ${String(e)}`,s,a)()}return i}}function TE(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function SE(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function A2(t,e,n){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let i=TE(t);if(i==="uint8"&&n&&r===1)return"unorm8-webgl";if(i==="uint8"&&n&&r===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}if(i==="uint16"||i==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}return r===1?i:`${i}x${r}`}function b2(t){return Uo(t)!==null||typeof t=="number"||typeof t=="boolean"}function Tg(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const r=t[n];b2(r)?e.uniforms[n]=r:e.bindings[n]=r}),e}function R2(t,e,n){const{removedProps:r={},deprecatedProps:i={},replacedProps:s={}}=n;for(const a in r)if(a in e){const c=r[a]?`${t}.${r[a]}`:"N/A";B.removed(`${t}.${a}`,c)()}for(const a in i)if(a in e){const l=i[a];B.deprecated(`${t}.${a}`,`${t}.${l}`)()}let o=null;for(const[a,l]of Object.entries(s))a in e&&(B.deprecated(`${t}.${a}`,`${t}.${l}`)(),o=o||Object.assign({},e),o[l]=e[a],delete o[a]);return o||e}let P2="";async function C2(t,e){return await new Promise((n,r)=>{try{const i=new Image;i.onload=()=>n(i),i.onerror=()=>r(new Error(`Could not load image ${t}.`)),i.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",i.src=t.startsWith("http")?t:P2+t}catch(i){r(i)}})}async function EE(t,e){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",t),e&&(r.id=e),new Promise((i,s)=>{r.onload=i,r.onerror=o=>s(new Error(`Unable to load script '${t}': ${o}`)),n.appendChild(r)})}function Rd(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!Rd(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!Rd(t[s],e[s],n-1))return!1;return!0}return!1}function x2(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function I2(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}class M2{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}let kn=class{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,n){if(e){n(vc.instance);for(const r of e)r instanceof Array?this.searchBlock(r,n):r.search(n);n(Tc.instance)}}};class vc extends kn{}vc.instance=new vc;class Tc extends kn{}Tc.instance=new Tc;class me extends kn{constructor(){super()}}class Pd extends me{constructor(e,n,r,i,s,o){super(),this.calls=new Set,this.name=e,this.args=n,this.returnType=r,this.body=i,this.startLine=s,this.endLine=o}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}}class O2 extends me{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class k2 extends me{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class N2 extends me{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class F2 extends me{constructor(e,n,r,i){super(),this.init=e,this.condition=n,this.increment=r,this.body=i}get astNodeType(){return"for"}search(e){var n,r,i;(n=this.init)===null||n===void 0||n.search(e),(r=this.condition)===null||r===void 0||r.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class br extends me{constructor(e,n,r,i,s){super(),this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"var"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class wE extends me{constructor(e,n,r){super(),this.name=e,this.type=n,this.value=r}get astNodeType(){return"override"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class Cd extends me{constructor(e,n,r,i,s){super(),this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"let"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class py extends me{constructor(e,n,r,i,s){super(),this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}var ls;(function(t){t.increment="++",t.decrement="--"})(ls||(ls={}));(function(t){function e(n){const r=n;if(r=="parse")throw new Error("Invalid value for IncrementOperator");return t[r]}t.parse=e})(ls||(ls={}));class D2 extends me{constructor(e,n){super(),this.operator=e,this.variable=n}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}var Lo;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(Lo||(Lo={}));(function(t){function e(n){const r=n;if(r=="parse")throw new Error("Invalid value for AssignOperator");return r}t.parse=e})(Lo||(Lo={}));class B2 extends me{constructor(e,n,r){super(),this.operator=e,this.variable=n,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class AE extends me{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"call"}search(e){for(const n of this.args)n.search(e);e(this)}}class U2 extends me{constructor(e,n){super(),this.body=e,this.continuing=n}get astNodeType(){return"loop"}}class L2 extends me{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"body"}}class z2 extends me{constructor(e,n,r,i){super(),this.condition=e,this.body=n,this.elseif=r,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class V2 extends me{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class W2 extends me{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class j2 extends me{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class H2 extends me{constructor(e,n){super(),this.severity=e,this.rule=n}get astNodeType(){return"diagnostic"}}class bE extends me{constructor(e,n){super(),this.name=e,this.type=n}get astNodeType(){return"alias"}}class $2 extends me{constructor(){super()}get astNodeType(){return"discard"}}class X2 extends me{constructor(){super()}get astNodeType(){return"break"}}class Y2 extends me{constructor(){super()}get astNodeType(){return"continue"}}class ri extends me{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class Ar extends ri{constructor(e,n,r,i){super(e),this.members=n,this.startLine=r,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let n=0;n<this.members.length;n++)if(this.members[n].name==e)return n;return-1}}class RE extends ri{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"template"}}class K2 extends ri{constructor(e,n,r,i){super(e),this.storage=n,this.type=r,this.access=i}get astNodeType(){return"pointer"}}class PE extends ri{constructor(e,n,r,i){super(e),this.attributes=n,this.format=r,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class qs extends ri{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"sampler"}}class Ht extends kn{constructor(){super()}}class gy extends Ht{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class Ci extends Ht{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"createExpr"}search(e){e(this);for(const n of this.args)n.search(e)}}class CE extends Ht{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(const n of this.args)n.search(e);e(this)}}class xd extends Ht{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}evaluate(e){const n=e.constants.get(this.name);if(!n)throw new Error("Cannot evaluate node");return n.evaluate(e)}}class _y extends Ht{constructor(e,n){super(),this.name=e,this.initializer=n}get astNodeType(){return"constExpr"}evaluate(e){var n,r;if(this.initializer instanceof Ci){const i=(n=this.postfix)===null||n===void 0?void 0:n.evaluateString(e),s=(r=this.initializer.type)===null||r===void 0?void 0:r.name,o=e.structs.get(s),a=o==null?void 0:o.getMemberIndex(i);if(a!=-1)return this.initializer.args[a].evaluate(e);console.log(a)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}}class my extends Ht{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class q2 extends Ht{constructor(e,n){super(),this.type=e,this.value=n}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Z2 extends Ht{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"typecastExpr"}evaluate(e){return this.args[0].evaluate(e)}search(e){this.searchBlock(this.args,e)}}class yy extends Ht{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}}class Q2 extends Ht{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class xE extends Ht{constructor(){super()}}class J2 extends xE{constructor(e,n){super(),this.operator=e,this.right=n}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}}class Qt extends xE{constructor(e,n,r){super(),this.operator=e,this.left=n,this.right=r}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}}class IE extends kn{constructor(){super()}}class G2 extends IE{constructor(e,n){super(),this.selector=e,this.body=n}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class eI extends IE{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class tI extends kn{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"argument"}}class nI extends kn{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class rI extends kn{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"member"}}let iI=class extends kn{constructor(e,n){super(),this.name=e,this.value=n}get astNodeType(){return"attribute"}};var I,P;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(P||(P={}));class C{constructor(e,n,r){this.name=e,this.type=n,this.rule=r}toString(){return this.name}}class E{}I=E;E.none=new C("",P.reserved,"");E.eof=new C("EOF",P.token,"");E.reserved={asm:new C("asm",P.reserved,"asm"),bf16:new C("bf16",P.reserved,"bf16"),do:new C("do",P.reserved,"do"),enum:new C("enum",P.reserved,"enum"),f16:new C("f16",P.reserved,"f16"),f64:new C("f64",P.reserved,"f64"),handle:new C("handle",P.reserved,"handle"),i8:new C("i8",P.reserved,"i8"),i16:new C("i16",P.reserved,"i16"),i64:new C("i64",P.reserved,"i64"),mat:new C("mat",P.reserved,"mat"),premerge:new C("premerge",P.reserved,"premerge"),regardless:new C("regardless",P.reserved,"regardless"),typedef:new C("typedef",P.reserved,"typedef"),u8:new C("u8",P.reserved,"u8"),u16:new C("u16",P.reserved,"u16"),u64:new C("u64",P.reserved,"u64"),unless:new C("unless",P.reserved,"unless"),using:new C("using",P.reserved,"using"),vec:new C("vec",P.reserved,"vec"),void:new C("void",P.reserved,"void")};E.keywords={array:new C("array",P.keyword,"array"),atomic:new C("atomic",P.keyword,"atomic"),bool:new C("bool",P.keyword,"bool"),f32:new C("f32",P.keyword,"f32"),i32:new C("i32",P.keyword,"i32"),mat2x2:new C("mat2x2",P.keyword,"mat2x2"),mat2x3:new C("mat2x3",P.keyword,"mat2x3"),mat2x4:new C("mat2x4",P.keyword,"mat2x4"),mat3x2:new C("mat3x2",P.keyword,"mat3x2"),mat3x3:new C("mat3x3",P.keyword,"mat3x3"),mat3x4:new C("mat3x4",P.keyword,"mat3x4"),mat4x2:new C("mat4x2",P.keyword,"mat4x2"),mat4x3:new C("mat4x3",P.keyword,"mat4x3"),mat4x4:new C("mat4x4",P.keyword,"mat4x4"),ptr:new C("ptr",P.keyword,"ptr"),sampler:new C("sampler",P.keyword,"sampler"),sampler_comparison:new C("sampler_comparison",P.keyword,"sampler_comparison"),struct:new C("struct",P.keyword,"struct"),texture_1d:new C("texture_1d",P.keyword,"texture_1d"),texture_2d:new C("texture_2d",P.keyword,"texture_2d"),texture_2d_array:new C("texture_2d_array",P.keyword,"texture_2d_array"),texture_3d:new C("texture_3d",P.keyword,"texture_3d"),texture_cube:new C("texture_cube",P.keyword,"texture_cube"),texture_cube_array:new C("texture_cube_array",P.keyword,"texture_cube_array"),texture_multisampled_2d:new C("texture_multisampled_2d",P.keyword,"texture_multisampled_2d"),texture_storage_1d:new C("texture_storage_1d",P.keyword,"texture_storage_1d"),texture_storage_2d:new C("texture_storage_2d",P.keyword,"texture_storage_2d"),texture_storage_2d_array:new C("texture_storage_2d_array",P.keyword,"texture_storage_2d_array"),texture_storage_3d:new C("texture_storage_3d",P.keyword,"texture_storage_3d"),texture_depth_2d:new C("texture_depth_2d",P.keyword,"texture_depth_2d"),texture_depth_2d_array:new C("texture_depth_2d_array",P.keyword,"texture_depth_2d_array"),texture_depth_cube:new C("texture_depth_cube",P.keyword,"texture_depth_cube"),texture_depth_cube_array:new C("texture_depth_cube_array",P.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new C("texture_depth_multisampled_2d",P.keyword,"texture_depth_multisampled_2d"),texture_external:new C("texture_external",P.keyword,"texture_external"),u32:new C("u32",P.keyword,"u32"),vec2:new C("vec2",P.keyword,"vec2"),vec3:new C("vec3",P.keyword,"vec3"),vec4:new C("vec4",P.keyword,"vec4"),bitcast:new C("bitcast",P.keyword,"bitcast"),block:new C("block",P.keyword,"block"),break:new C("break",P.keyword,"break"),case:new C("case",P.keyword,"case"),continue:new C("continue",P.keyword,"continue"),continuing:new C("continuing",P.keyword,"continuing"),default:new C("default",P.keyword,"default"),diagnostic:new C("diagnostic",P.keyword,"diagnostic"),discard:new C("discard",P.keyword,"discard"),else:new C("else",P.keyword,"else"),enable:new C("enable",P.keyword,"enable"),fallthrough:new C("fallthrough",P.keyword,"fallthrough"),false:new C("false",P.keyword,"false"),fn:new C("fn",P.keyword,"fn"),for:new C("for",P.keyword,"for"),function:new C("function",P.keyword,"function"),if:new C("if",P.keyword,"if"),let:new C("let",P.keyword,"let"),const:new C("const",P.keyword,"const"),loop:new C("loop",P.keyword,"loop"),while:new C("while",P.keyword,"while"),private:new C("private",P.keyword,"private"),read:new C("read",P.keyword,"read"),read_write:new C("read_write",P.keyword,"read_write"),return:new C("return",P.keyword,"return"),requires:new C("requires",P.keyword,"requires"),storage:new C("storage",P.keyword,"storage"),switch:new C("switch",P.keyword,"switch"),true:new C("true",P.keyword,"true"),alias:new C("alias",P.keyword,"alias"),type:new C("type",P.keyword,"type"),uniform:new C("uniform",P.keyword,"uniform"),var:new C("var",P.keyword,"var"),override:new C("override",P.keyword,"override"),workgroup:new C("workgroup",P.keyword,"workgroup"),write:new C("write",P.keyword,"write"),r8unorm:new C("r8unorm",P.keyword,"r8unorm"),r8snorm:new C("r8snorm",P.keyword,"r8snorm"),r8uint:new C("r8uint",P.keyword,"r8uint"),r8sint:new C("r8sint",P.keyword,"r8sint"),r16uint:new C("r16uint",P.keyword,"r16uint"),r16sint:new C("r16sint",P.keyword,"r16sint"),r16float:new C("r16float",P.keyword,"r16float"),rg8unorm:new C("rg8unorm",P.keyword,"rg8unorm"),rg8snorm:new C("rg8snorm",P.keyword,"rg8snorm"),rg8uint:new C("rg8uint",P.keyword,"rg8uint"),rg8sint:new C("rg8sint",P.keyword,"rg8sint"),r32uint:new C("r32uint",P.keyword,"r32uint"),r32sint:new C("r32sint",P.keyword,"r32sint"),r32float:new C("r32float",P.keyword,"r32float"),rg16uint:new C("rg16uint",P.keyword,"rg16uint"),rg16sint:new C("rg16sint",P.keyword,"rg16sint"),rg16float:new C("rg16float",P.keyword,"rg16float"),rgba8unorm:new C("rgba8unorm",P.keyword,"rgba8unorm"),rgba8unorm_srgb:new C("rgba8unorm_srgb",P.keyword,"rgba8unorm_srgb"),rgba8snorm:new C("rgba8snorm",P.keyword,"rgba8snorm"),rgba8uint:new C("rgba8uint",P.keyword,"rgba8uint"),rgba8sint:new C("rgba8sint",P.keyword,"rgba8sint"),bgra8unorm:new C("bgra8unorm",P.keyword,"bgra8unorm"),bgra8unorm_srgb:new C("bgra8unorm_srgb",P.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new C("rgb10a2unorm",P.keyword,"rgb10a2unorm"),rg11b10float:new C("rg11b10float",P.keyword,"rg11b10float"),rg32uint:new C("rg32uint",P.keyword,"rg32uint"),rg32sint:new C("rg32sint",P.keyword,"rg32sint"),rg32float:new C("rg32float",P.keyword,"rg32float"),rgba16uint:new C("rgba16uint",P.keyword,"rgba16uint"),rgba16sint:new C("rgba16sint",P.keyword,"rgba16sint"),rgba16float:new C("rgba16float",P.keyword,"rgba16float"),rgba32uint:new C("rgba32uint",P.keyword,"rgba32uint"),rgba32sint:new C("rgba32sint",P.keyword,"rgba32sint"),rgba32float:new C("rgba32float",P.keyword,"rgba32float"),static_assert:new C("static_assert",P.keyword,"static_assert")};E.tokens={decimal_float_literal:new C("decimal_float_literal",P.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new C("hex_float_literal",P.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new C("int_literal",P.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new C("uint_literal",P.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new C("ident",P.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new C("and",P.token,"&"),and_and:new C("and_and",P.token,"&&"),arrow:new C("arrow ",P.token,"->"),attr:new C("attr",P.token,"@"),forward_slash:new C("forward_slash",P.token,"/"),bang:new C("bang",P.token,"!"),bracket_left:new C("bracket_left",P.token,"["),bracket_right:new C("bracket_right",P.token,"]"),brace_left:new C("brace_left",P.token,"{"),brace_right:new C("brace_right",P.token,"}"),colon:new C("colon",P.token,":"),comma:new C("comma",P.token,","),equal:new C("equal",P.token,"="),equal_equal:new C("equal_equal",P.token,"=="),not_equal:new C("not_equal",P.token,"!="),greater_than:new C("greater_than",P.token,">"),greater_than_equal:new C("greater_than_equal",P.token,">="),shift_right:new C("shift_right",P.token,">>"),less_than:new C("less_than",P.token,"<"),less_than_equal:new C("less_than_equal",P.token,"<="),shift_left:new C("shift_left",P.token,"<<"),modulo:new C("modulo",P.token,"%"),minus:new C("minus",P.token,"-"),minus_minus:new C("minus_minus",P.token,"--"),period:new C("period",P.token,"."),plus:new C("plus",P.token,"+"),plus_plus:new C("plus_plus",P.token,"++"),or:new C("or",P.token,"|"),or_or:new C("or_or",P.token,"||"),paren_left:new C("paren_left",P.token,"("),paren_right:new C("paren_right",P.token,")"),semicolon:new C("semicolon",P.token,";"),star:new C("star",P.token,"*"),tilde:new C("tilde",P.token,"~"),underscore:new C("underscore",P.token,"_"),xor:new C("xor",P.token,"^"),plus_equal:new C("plus_equal",P.token,"+="),minus_equal:new C("minus_equal",P.token,"-="),times_equal:new C("times_equal",P.token,"*="),division_equal:new C("division_equal",P.token,"/="),modulo_equal:new C("modulo_equal",P.token,"%="),and_equal:new C("and_equal",P.token,"&="),or_equal:new C("or_equal",P.token,"|="),xor_equal:new C("xor_equal",P.token,"^="),shift_right_equal:new C("shift_right_equal",P.token,">>="),shift_left_equal:new C("shift_left_equal",P.token,"<<=")};E.simpleTokens={"@":I.tokens.attr,"{":I.tokens.brace_left,"}":I.tokens.brace_right,":":I.tokens.colon,",":I.tokens.comma,"(":I.tokens.paren_left,")":I.tokens.paren_right,";":I.tokens.semicolon};E.literalTokens={"&":I.tokens.and,"&&":I.tokens.and_and,"->":I.tokens.arrow,"/":I.tokens.forward_slash,"!":I.tokens.bang,"[":I.tokens.bracket_left,"]":I.tokens.bracket_right,"=":I.tokens.equal,"==":I.tokens.equal_equal,"!=":I.tokens.not_equal,">":I.tokens.greater_than,">=":I.tokens.greater_than_equal,">>":I.tokens.shift_right,"<":I.tokens.less_than,"<=":I.tokens.less_than_equal,"<<":I.tokens.shift_left,"%":I.tokens.modulo,"-":I.tokens.minus,"--":I.tokens.minus_minus,".":I.tokens.period,"+":I.tokens.plus,"++":I.tokens.plus_plus,"|":I.tokens.or,"||":I.tokens.or_or,"*":I.tokens.star,"~":I.tokens.tilde,_:I.tokens.underscore,"^":I.tokens.xor,"+=":I.tokens.plus_equal,"-=":I.tokens.minus_equal,"*=":I.tokens.times_equal,"/=":I.tokens.division_equal,"%=":I.tokens.modulo_equal,"&=":I.tokens.and_equal,"|=":I.tokens.or_equal,"^=":I.tokens.xor_equal,">>=":I.tokens.shift_right_equal,"<<=":I.tokens.shift_left_equal};E.regexTokens={decimal_float_literal:I.tokens.decimal_float_literal,hex_float_literal:I.tokens.hex_float_literal,int_literal:I.tokens.int_literal,uint_literal:I.tokens.uint_literal,ident:I.tokens.ident};E.storage_class=[I.keywords.function,I.keywords.private,I.keywords.workgroup,I.keywords.uniform,I.keywords.storage];E.access_mode=[I.keywords.read,I.keywords.write,I.keywords.read_write];E.sampler_type=[I.keywords.sampler,I.keywords.sampler_comparison];E.sampled_texture_type=[I.keywords.texture_1d,I.keywords.texture_2d,I.keywords.texture_2d_array,I.keywords.texture_3d,I.keywords.texture_cube,I.keywords.texture_cube_array];E.multisampled_texture_type=[I.keywords.texture_multisampled_2d];E.storage_texture_type=[I.keywords.texture_storage_1d,I.keywords.texture_storage_2d,I.keywords.texture_storage_2d_array,I.keywords.texture_storage_3d];E.depth_texture_type=[I.keywords.texture_depth_2d,I.keywords.texture_depth_2d_array,I.keywords.texture_depth_cube,I.keywords.texture_depth_cube_array,I.keywords.texture_depth_multisampled_2d];E.texture_external_type=[I.keywords.texture_external];E.any_texture_type=[...I.sampled_texture_type,...I.multisampled_texture_type,...I.storage_texture_type,...I.depth_texture_type,...I.texture_external_type];E.texel_format=[I.keywords.r8unorm,I.keywords.r8snorm,I.keywords.r8uint,I.keywords.r8sint,I.keywords.r16uint,I.keywords.r16sint,I.keywords.r16float,I.keywords.rg8unorm,I.keywords.rg8snorm,I.keywords.rg8uint,I.keywords.rg8sint,I.keywords.r32uint,I.keywords.r32sint,I.keywords.r32float,I.keywords.rg16uint,I.keywords.rg16sint,I.keywords.rg16float,I.keywords.rgba8unorm,I.keywords.rgba8unorm_srgb,I.keywords.rgba8snorm,I.keywords.rgba8uint,I.keywords.rgba8sint,I.keywords.bgra8unorm,I.keywords.bgra8unorm_srgb,I.keywords.rgb10a2unorm,I.keywords.rg11b10float,I.keywords.rg32uint,I.keywords.rg32sint,I.keywords.rg32float,I.keywords.rgba16uint,I.keywords.rgba16sint,I.keywords.rgba16float,I.keywords.rgba32uint,I.keywords.rgba32sint,I.keywords.rgba32float];E.const_literal=[I.tokens.int_literal,I.tokens.uint_literal,I.tokens.decimal_float_literal,I.tokens.hex_float_literal,I.keywords.true,I.keywords.false];E.literal_or_ident=[I.tokens.ident,I.tokens.int_literal,I.tokens.uint_literal,I.tokens.decimal_float_literal,I.tokens.hex_float_literal];E.element_count_expression=[I.tokens.int_literal,I.tokens.uint_literal,I.tokens.ident];E.template_types=[I.keywords.vec2,I.keywords.vec3,I.keywords.vec4,I.keywords.mat2x2,I.keywords.mat2x3,I.keywords.mat2x4,I.keywords.mat3x2,I.keywords.mat3x3,I.keywords.mat3x4,I.keywords.mat4x2,I.keywords.mat4x3,I.keywords.mat4x4,I.keywords.atomic,I.keywords.bitcast,...I.any_texture_type];E.attribute_name=[I.tokens.ident,I.keywords.block,I.keywords.diagnostic];E.assignment_operators=[I.tokens.equal,I.tokens.plus_equal,I.tokens.minus_equal,I.tokens.times_equal,I.tokens.division_equal,I.tokens.modulo_equal,I.tokens.and_equal,I.tokens.or_equal,I.tokens.xor_equal,I.tokens.shift_right_equal,I.tokens.shift_left_equal];E.increment_operators=[I.tokens.plus_plus,I.tokens.minus_minus];class vy{constructor(e,n,r){this.type=e,this.lexeme=n,this.line=r}toString(){return this.lexeme}isTemplateType(){return E.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==E.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class sI{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new vy(E.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const n=E.simpleTokens[e];if(n)return this._addToken(n),!0;let r=E.none;const i=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)e+=this._advance(),o=this._peekAhead()}if(i){const o=E.keywords[e];if(o)return this._addToken(o),!0}if(i||s)return this._addToken(E.tokens.ident),!0;for(;;){let o=this._findType(e);const a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(E.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(E.tokens.minus_minus),!0;const l=this._tokens.length-1;if((E.literal_or_ident.indexOf(this._tokens[l].type)!=-1||this._tokens[l].type==E.tokens.paren_right)&&a!=">")return this._addToken(o),!0}if(e==">"&&(a==">"||a=="=")){let l=!1,c=this._tokens.length-1;for(let u=0;u<5&&c>=0&&E.assignment_operators.indexOf(this._tokens[c].type)===-1;++u,--c)if(this._tokens[c].type===E.tokens.less_than){c>0&&this._tokens[c-1].isArrayOrTemplateType()&&(l=!0);break}if(l)return this._addToken(o),!0}if(o===E.none){let l=e,c=0;const u=2;for(let f=0;f<u;++f)if(l+=this._peekAhead(f),o=this._findType(l),o!==E.none){c=f;break}if(o===E.none)return r===E.none?!1:(this._current--,this._addToken(r),!0);e=l,this._current+=c+1}if(r=o,this._isAtEnd())break;e+=this._advance()}return r===E.none?!1:(this._addToken(r),!0)}_findType(e){for(const r in E.regexTokens){const i=E.regexTokens[r];if(this._match(e,i.rule))return i}const n=E.literalTokens[e];return n||E.none}_match(e,n){const r=n.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let n=this._source[this._current];return e=e||0,e++,this._current+=e,n}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const n=this._source.substring(this._start,this._current);this._tokens.push(new vy(e,n,this._line))}}class oI{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new M2,this._deferArrayCountEval=[]}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const n=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;n.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const i=r.arrayType,s=r.countNode;if(s instanceof xd){const a=s.name,l=this._context.constants.get(a);if(l)try{const c=l.evaluate(this._context);i.count=c}catch{}}}this._deferArrayCountEval.length=0}return n}_initialize(e){if(e)if(typeof e=="string"){const n=new sI(e);this._tokens=n.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,n){return{token:e,message:n,toString:function(){return`${n}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==E.eof}_match(e){if(e instanceof C)return this._check(e)?(this._advance(),!0):!1;for(let n=0,r=e.length;n<r;++n){const i=e[n];if(this._check(i))return this._advance(),!0}return!1}_consume(e,n){if(this._check(e))return this._advance();throw this._error(this._peek(),n)}_check(e){if(this._isAtEnd())return!1;const n=this._peek();if(e instanceof Array){const r=n.type;return e.indexOf(r)!=-1}return n.type==e}_advance(){var e,n;return this._currentLine=(n=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&n!==void 0?n:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(E.tokens.semicolon)&&!this._isAtEnd(););if(this._match(E.keywords.alias)){const n=this._type_alias();return this._consume(E.tokens.semicolon,"Expected ';'"),n}if(this._match(E.keywords.diagnostic)){const n=this._diagnostic();return this._consume(E.tokens.semicolon,"Expected ';'"),n}if(this._match(E.keywords.requires)){const n=this._requires_directive();return this._consume(E.tokens.semicolon,"Expected ';'"),n}if(this._match(E.keywords.enable)){const n=this._enable_directive();return this._consume(E.tokens.semicolon,"Expected ';'"),n}const e=this._attribute();if(this._check(E.keywords.var)){const n=this._global_variable_decl();return n!=null&&(n.attributes=e),this._consume(E.tokens.semicolon,"Expected ';'."),n}if(this._check(E.keywords.override)){const n=this._override_variable_decl();return n!=null&&(n.attributes=e),this._consume(E.tokens.semicolon,"Expected ';'."),n}if(this._check(E.keywords.let)){const n=this._global_let_decl();return n!=null&&(n.attributes=e),this._consume(E.tokens.semicolon,"Expected ';'."),n}if(this._check(E.keywords.const)){const n=this._global_const_decl();return n!=null&&(n.attributes=e),this._consume(E.tokens.semicolon,"Expected ';'."),n}if(this._check(E.keywords.struct)){const n=this._struct_decl();return n!=null&&(n.attributes=e),n}if(this._check(E.keywords.fn)){const n=this._function_decl();return n!=null&&(n.attributes=e),n}return null}_function_decl(){if(!this._match(E.keywords.fn))return null;const e=this._currentLine,n=this._consume(E.tokens.ident,"Expected function name.").toString();this._consume(E.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(E.tokens.paren_right))do{if(this._check(E.tokens.paren_right))break;const a=this._attribute(),l=this._consume(E.tokens.ident,"Expected argument name.").toString();this._consume(E.tokens.colon,"Expected ':' for argument type.");const c=this._attribute(),u=this._type_decl();u!=null&&(u.attributes=c,r.push(new tI(l,u,a)))}while(this._match(E.tokens.comma));this._consume(E.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(E.tokens.arrow)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}const s=this._compound_statement(),o=this._currentLine;return new Pd(n,r,i,s,e,o)}_compound_statement(){const e=[];for(this._consume(E.tokens.brace_left,"Expected '{' for block.");!this._check(E.tokens.brace_right);){const n=this._statement();n!==null&&e.push(n)}return this._consume(E.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(E.tokens.semicolon)&&!this._isAtEnd(););if(this._check(E.tokens.attr)&&this._attribute(),this._check(E.keywords.if))return this._if_statement();if(this._check(E.keywords.switch))return this._switch_statement();if(this._check(E.keywords.loop))return this._loop_statement();if(this._check(E.keywords.for))return this._for_statement();if(this._check(E.keywords.while))return this._while_statement();if(this._check(E.keywords.continuing))return this._continuing_statement();if(this._check(E.keywords.static_assert))return this._static_assert_statement();if(this._check(E.tokens.brace_left))return this._compound_statement();let e=null;return this._check(E.keywords.return)?e=this._return_statement():this._check([E.keywords.var,E.keywords.let,E.keywords.const])?e=this._variable_statement():this._match(E.keywords.discard)?e=new $2:this._match(E.keywords.break)?e=new X2:this._match(E.keywords.continue)?e=new Y2:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(E.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(E.keywords.static_assert))return null;const e=this._optional_paren_expression();return new O2(e)}_while_statement(){if(!this._match(E.keywords.while))return null;const e=this._optional_paren_expression();this._check(E.tokens.attr)&&this._attribute();const n=this._compound_statement();return new k2(e,n)}_continuing_statement(){if(!this._match(E.keywords.continuing))return null;const e=this._compound_statement();return new N2(e)}_for_statement(){if(!this._match(E.keywords.for))return null;this._consume(E.tokens.paren_left,"Expected '('.");const e=this._check(E.tokens.semicolon)?null:this._for_init();this._consume(E.tokens.semicolon,"Expected ';'.");const n=this._check(E.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(E.tokens.semicolon,"Expected ';'.");const r=this._check(E.tokens.paren_right)?null:this._for_increment();this._consume(E.tokens.paren_right,"Expected ')'."),this._check(E.tokens.attr)&&this._attribute();const i=this._compound_statement();return new F2(e,n,r,i)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(E.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let n=null;return this._match(E.tokens.equal)&&(n=this._short_circuit_or_expression()),new br(e.name,e.type,e.storage,e.access,n)}if(this._match(E.keywords.let)){const e=this._consume(E.tokens.ident,"Expected name for let.").toString();let n=null;if(this._match(E.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}this._consume(E.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return new Cd(e,n,null,null,r)}if(this._match(E.keywords.const)){const e=this._consume(E.tokens.ident,"Expected name for const.").toString();let n=null;if(this._match(E.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}this._consume(E.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return new py(e,n,null,null,r)}return null}_increment_decrement_statement(){const e=this._current,n=this._unary_expression();if(n==null)return null;if(!this._check(E.increment_operators))return this._current=e,null;const r=this._consume(E.increment_operators,"Expected increment operator");return new D2(r.type===E.tokens.plus_plus?ls.increment:ls.decrement,n)}_assignment_statement(){let e=null;if(this._check(E.tokens.brace_right))return null;let n=this._match(E.tokens.underscore);if(n||(e=this._unary_expression()),!n&&e==null)return null;const r=this._consume(E.assignment_operators,"Expected assignment operator."),i=this._short_circuit_or_expression();return new B2(Lo.parse(r.lexeme),e,i)}_func_call_statement(){if(!this._check(E.tokens.ident))return null;const e=this._current,n=this._consume(E.tokens.ident,"Expected function name."),r=this._argument_expression_list();return r===null?(this._current=e,null):new AE(n.lexeme,r)}_loop_statement(){if(!this._match(E.keywords.loop))return null;this._check(E.tokens.attr)&&this._attribute(),this._consume(E.tokens.brace_left,"Expected '{' for loop.");const e=[];let n=this._statement();for(;n!==null;){if(Array.isArray(n))for(let i of n)e.push(i);else e.push(n);n=this._statement()}let r=null;return this._match(E.keywords.continuing)&&(r=this._compound_statement()),this._consume(E.tokens.brace_right,"Expected '}' for loop."),new U2(e,r)}_switch_statement(){if(!this._match(E.keywords.switch))return null;const e=this._optional_paren_expression();this._check(E.tokens.attr)&&this._attribute(),this._consume(E.tokens.brace_left,"Expected '{' for switch.");const n=this._switch_body();if(n==null||n.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(E.tokens.brace_right,"Expected '}' for switch."),new L2(e,n)}_switch_body(){const e=[];if(this._match(E.keywords.case)){const n=this._case_selectors();this._match(E.tokens.colon),this._check(E.tokens.attr)&&this._attribute(),this._consume(E.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(E.tokens.brace_right,"Exected '}' for switch case."),e.push(new G2(n,r))}if(this._match(E.keywords.default)){this._match(E.tokens.colon),this._check(E.tokens.attr)&&this._attribute(),this._consume(E.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(E.tokens.brace_right,"Exected '}' for switch default."),e.push(new eI(n))}if(this._check([E.keywords.default,E.keywords.case])){const n=this._switch_body();e.push(n[0])}return e}_case_selectors(){const e=[this._shift_expression()];for(;this._match(E.tokens.comma);)e.push(this._shift_expression());return e}_case_body(){if(this._match(E.keywords.fallthrough))return this._consume(E.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const n=this._case_body();return n.length==0?e:[...e,n[0]]}_if_statement(){if(!this._match(E.keywords.if))return null;const e=this._optional_paren_expression();this._check(E.tokens.attr)&&this._attribute();const n=this._compound_statement();let r=[];this._match_elseif()&&(this._check(E.tokens.attr)&&this._attribute(),r=this._elseif_statement(r));let i=null;return this._match(E.keywords.else)&&(this._check(E.tokens.attr)&&this._attribute(),i=this._compound_statement()),new z2(e,n,r,i)}_match_elseif(){return this._tokens[this._current].type===E.keywords.else&&this._tokens[this._current+1].type===E.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const n=this._optional_paren_expression(),r=this._compound_statement();return e.push(new nI(n,r)),this._match_elseif()&&(this._check(E.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(E.keywords.return))return null;const e=this._short_circuit_or_expression();return new V2(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(E.tokens.or_or);)e=new Qt(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(E.tokens.and_and);)e=new Qt(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(E.tokens.or);)e=new Qt(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(E.tokens.xor);)e=new Qt(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(E.tokens.and);)e=new Qt(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([E.tokens.equal_equal,E.tokens.not_equal])?new Qt(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([E.tokens.less_than,E.tokens.greater_than,E.tokens.less_than_equal,E.tokens.greater_than_equal]);)e=new Qt(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([E.tokens.shift_left,E.tokens.shift_right]);)e=new Qt(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([E.tokens.plus,E.tokens.minus]);)e=new Qt(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([E.tokens.star,E.tokens.forward_slash,E.tokens.modulo]);)e=new Qt(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([E.tokens.minus,E.tokens.bang,E.tokens.tilde,E.tokens.star,E.tokens.and])?new J2(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),n=this._postfix_expression();return n&&(e.postfix=n),e}_postfix_expression(){if(this._match(E.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(E.tokens.bracket_right,"Expected ']'.");const n=new Q2(e),r=this._postfix_expression();return r&&(n.postfix=r),n}if(this._match(E.tokens.period)){const e=this._consume(E.tokens.ident,"Expected member name."),n=this._postfix_expression(),r=new gy(e.lexeme);return n&&(r.postfix=n),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(E.tokens.ident)){const r=this._previous().toString();if(this._check(E.tokens.paren_left)){const i=this._argument_expression_list(),s=this._getStruct(r);return s!=null?new Ci(s,i):new CE(r,i)}if(this._context.constants.has(r)){const i=this._context.constants.get(r);return new _y(r,i.value)}return new xd(r)}if(this._match(E.const_literal))return new my(parseFloat(this._previous().toString()));if(this._check(E.tokens.paren_left))return this._paren_expression();if(this._match(E.keywords.bitcast)){this._consume(E.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(E.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return new q2(r,i)}const e=this._type_decl(),n=this._argument_expression_list();return new Z2(e,n)}_argument_expression_list(){if(!this._match(E.tokens.paren_left))return null;const e=[];do{if(this._check(E.tokens.paren_right))break;const n=this._short_circuit_or_expression();e.push(n)}while(this._match(E.tokens.comma));return this._consume(E.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(E.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(E.tokens.paren_right),new yy([e])}_paren_expression(){this._consume(E.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(E.tokens.paren_right,"Expected ')'."),new yy([e])}_struct_decl(){if(!this._match(E.keywords.struct))return null;const e=this._currentLine,n=this._consume(E.tokens.ident,"Expected name for struct.").toString();this._consume(E.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(E.tokens.brace_right);){const o=this._attribute(),a=this._consume(E.tokens.ident,"Expected variable name.").toString();this._consume(E.tokens.colon,"Expected ':' for struct member type.");const l=this._attribute(),c=this._type_decl();c!=null&&(c.attributes=l),this._check(E.tokens.brace_right)?this._match(E.tokens.comma):this._consume(E.tokens.comma,"Expected ',' for struct member."),r.push(new rI(a,c,o))}this._consume(E.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,s=new Ar(n,r,e,i);return this._context.structs.set(n,s),s}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(E.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(E.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(E.keywords.const))return null;const e=this._consume(E.tokens.ident,"Expected variable name");let n=null;if(this._match(E.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}let r=null;if(this._match(E.tokens.equal)){const s=this._short_circuit_or_expression();if(s instanceof Ci)r=s;else if(s instanceof _y&&s.initializer instanceof Ci)r=s.initializer;else try{const o=s.evaluate(this._context);r=new my(o)}catch{r=s}}const i=new py(e.toString(),n,"","",r);return this._context.constants.set(i.name,i),i}_global_let_decl(){if(!this._match(E.keywords.let))return null;const e=this._consume(E.tokens.ident,"Expected variable name");let n=null;if(this._match(E.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}let r=null;return this._match(E.tokens.equal)&&(r=this._const_expression()),new Cd(e.toString(),n,"","",r)}_const_expression(){if(this._match(E.const_literal))return new gy(this._previous().toString());const e=this._type_decl();this._consume(E.tokens.paren_left,"Expected '('.");let n=[];for(;!this._check(E.tokens.paren_right)&&(n.push(this._const_expression()),!!this._check(E.tokens.comma));)this._advance();return this._consume(E.tokens.paren_right,"Expected ')'."),new Ci(e,n)}_variable_decl(){if(!this._match(E.keywords.var))return null;let e="",n="";this._match(E.tokens.less_than)&&(e=this._consume(E.storage_class,"Expected storage_class.").toString(),this._match(E.tokens.comma)&&(n=this._consume(E.access_mode,"Expected access_mode.").toString()),this._consume(E.tokens.greater_than,"Expected '>'."));const r=this._consume(E.tokens.ident,"Expected variable name");let i=null;if(this._match(E.tokens.colon)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}return new br(r.toString(),i,e,n,null)}_override_decl(){if(!this._match(E.keywords.override))return null;const e=this._consume(E.tokens.ident,"Expected variable name");let n=null;if(this._match(E.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}return new wE(e.toString(),n,null)}_diagnostic(){this._consume(E.tokens.paren_left,"Expected '('");const e=this._consume(E.tokens.ident,"Expected severity control name.");this._consume(E.tokens.comma,"Expected ','");const n=this._consume(E.tokens.ident,"Expected diagnostic rule name.");return this._consume(E.tokens.paren_right,"Expected ')'"),new H2(e.toString(),n.toString())}_enable_directive(){const e=this._consume(E.tokens.ident,"identity expected.");return new W2(e.toString())}_requires_directive(){const e=[this._consume(E.tokens.ident,"identity expected.").toString()];for(;this._match(E.tokens.comma);){const n=this._consume(E.tokens.ident,"identity expected.");e.push(n.toString())}return new j2(e)}_type_alias(){const e=this._consume(E.tokens.ident,"identity expected.");this._consume(E.tokens.equal,"Expected '=' for type alias.");let n=this._type_decl();if(n===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);const r=new bE(e.toString(),n);return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([E.tokens.ident,...E.texel_format,E.keywords.bool,E.keywords.f32,E.keywords.i32,E.keywords.u32])){const r=this._advance(),i=r.toString();return this._context.structs.has(i)?this._context.structs.get(i):this._context.aliases.has(i)?this._context.aliases.get(i).type:new ri(r.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(E.template_types)){let r=this._advance().toString(),i=null,s=null;return this._match(E.tokens.less_than)&&(i=this._type_decl(),s=null,this._match(E.tokens.comma)&&(s=this._consume(E.access_mode,"Expected access_mode for pointer").toString()),this._consume(E.tokens.greater_than,"Expected '>' for type.")),new RE(r,i,s)}if(this._match(E.keywords.ptr)){let r=this._previous().toString();this._consume(E.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(E.storage_class,"Expected storage_class for pointer");this._consume(E.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let o=null;return this._match(E.tokens.comma)&&(o=this._consume(E.access_mode,"Expected access_mode for pointer").toString()),this._consume(E.tokens.greater_than,"Expected '>' for pointer."),new K2(r,i.toString(),s,o)}const n=this._attribute();if(this._match(E.keywords.array)){let r=null,i=-1;const s=this._previous();let o=null;if(this._match(E.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let l="";if(this._match(E.tokens.comma)){o=this._shift_expression();try{l=o.evaluate(this._context).toString(),o=null}catch{l="1"}}this._consume(E.tokens.greater_than,"Expected '>' for array."),i=l?parseInt(l):0}const a=new PE(s.toString(),n,r,i);return o&&this._deferArrayCountEval.push({arrayType:a,countNode:o}),a}return null}_texture_sampler_types(){if(this._match(E.sampler_type))return new qs(this._previous().toString(),null,null);if(this._match(E.depth_texture_type))return new qs(this._previous().toString(),null,null);if(this._match(E.sampled_texture_type)||this._match(E.multisampled_texture_type)){const e=this._previous();this._consume(E.tokens.less_than,"Expected '<' for sampler type.");const n=this._type_decl();return this._consume(E.tokens.greater_than,"Expected '>' for sampler type."),new qs(e.toString(),n,null)}if(this._match(E.storage_texture_type)){const e=this._previous();this._consume(E.tokens.less_than,"Expected '<' for sampler type.");const n=this._consume(E.texel_format,"Invalid texel format.").toString();this._consume(E.tokens.comma,"Expected ',' after texel format.");const r=this._consume(E.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(E.tokens.greater_than,"Expected '>' for sampler type."),new qs(e.toString(),n,r)}return null}_attribute(){let e=[];for(;this._match(E.tokens.attr);){const n=this._consume(E.attribute_name,"Expected attribute name"),r=new iI(n.toString(),null);if(this._match(E.tokens.paren_left)){if(r.value=this._consume(E.literal_or_ident,"Expected attribute value").toString(),this._check(E.tokens.comma)){this._advance();do{const i=this._consume(E.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(i)}while(this._match(E.tokens.comma))}this._consume(E.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class ji{constructor(e,n){this.name=e,this.attributes=n,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class Ty{constructor(e,n,r){this.name=e,this.type=n,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Wa extends ji{constructor(e,n){super(e,n),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Bf extends ji{constructor(e,n){super(e,n),this.count=0,this.stride=0}get isArray(){return!0}}class Sy extends ji{constructor(e,n,r,i){super(e,r),this.format=n,this.access=i}get isTemplate(){return!0}}var jn;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(jn||(jn={}));class ja{constructor(e,n,r,i,s,o,a){this.name=e,this.type=n,this.group=r,this.binding=i,this.attributes=s,this.resourceType=o,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class aI{constructor(e,n){this.name=e,this.type=n}}class Ha{constructor(e,n){this.align=e,this.size=n}}class lI{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i,this.interpolation=null}}class Ey{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i}}class cI{constructor(e,n=null){this.stage=null,this.inputs=[],this.outputs=[],this.resources=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=n}}class uI{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class fI{constructor(e,n,r,i){this.name=e,this.type=n,this.attributes=r,this.id=i}}class hI{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class bn{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new uI,this.functions=[],this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const r=new oI().parse(e);for(const i of r)i instanceof Pd&&this._functions.set(i.name,new hI(i));for(const i of r)if(i instanceof Ar){const s=this._getTypeInfo(i,null);s instanceof Wa&&this.structs.push(s)}for(const i of r){if(i instanceof bE){this.aliases.push(this._getAliasInfo(i));continue}if(i instanceof wE){const s=i,o=this._getAttributeNum(s.attributes,"id",0),a=s.type!=null?this._getTypeInfo(s.type,s.attributes):null;this.overrides.push(new fI(s.name,a,s.attributes,o));continue}if(this._isUniformVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=new ja(s.name,l,o,a,s.attributes,jn.Uniform,s.access);this.uniforms.push(c);continue}if(this._isStorageVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=this._isStorageTexture(l),u=new ja(s.name,l,o,a,s.attributes,c?jn.StorageTexture:jn.Storage,s.access);this.storage.push(u);continue}if(this._isTextureVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=this._isStorageTexture(l),u=new ja(s.name,l,o,a,s.attributes,c?jn.StorageTexture:jn.Texture,s.access);c?this.storage.push(u):this.textures.push(u);continue}if(this._isSamplerVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=new ja(s.name,l,o,a,s.attributes,jn.Sampler,s.access);this.samplers.push(c);continue}if(i instanceof Pd){const s=this._getAttribute(i,"vertex"),o=this._getAttribute(i,"fragment"),a=this._getAttribute(i,"compute"),l=s||o||a,c=new cI(i.name,l==null?void 0:l.name);c.startLine=i.startLine,c.endLine=i.endLine,this.functions.push(c),this._functions.get(i.name).info=c,l&&(this._functions.get(i.name).inUse=!0,c.inUse=!0,c.resources=this._findResources(i,!!l),c.inputs=this._getInputs(i.args),c.outputs=this._getOutputs(i.returnType),this.entry[l.name].push(c));continue}}for(const i of this._functions.values())i.info&&(i.info.inUse=i.inUse,this._addCalls(i.node,i.info.calls));for(const i of this.uniforms)this._markStructsInUse(i.type);for(const i of this.storage)this._markStructsInUse(i.type)}_markStructsInUse(e){if(e.isStruct){e.inUse=!0;for(const n of e.members)this._markStructsInUse(n.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)this._markStructsInUse(e.format);else{const n=this._getAlias(e.name);n&&this._markStructsInUse(n)}}_addCalls(e,n){var r;for(const i of e.calls){const s=(r=this._functions.get(i.name))===null||r===void 0?void 0:r.info;s&&n.add(s)}}findResource(e,n){for(const r of this.uniforms)if(r.group==e&&r.binding==n)return r;for(const r of this.storage)if(r.group==e&&r.binding==n)return r;for(const r of this.textures)if(r.group==e&&r.binding==n)return r;for(const r of this.samplers)if(r.group==e&&r.binding==n)return r;return null}_findResource(e){for(const n of this.uniforms)if(n.name==e)return n;for(const n of this.storage)if(n.name==e)return n;for(const n of this.textures)if(n.name==e)return n;for(const n of this.samplers)if(n.name==e)return n;return null}_markStructsFromAST(e){const n=this._getTypeInfo(e,null);this._markStructsInUse(n)}_findResources(e,n){const r=[],i=this,s=[];return e.search(o=>{if(o instanceof vc)s.push({});else if(o instanceof Tc)s.pop();else if(o instanceof br){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type),s.length>0&&(s[s.length-1][a.name]=a)}else if(o instanceof Ci){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type)}else if(o instanceof Cd){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type),s.length>0&&(s[s.length-1][a.name]=a)}else if(o instanceof xd){const a=o;if(s.length>0&&s[s.length-1][a.name])return;const l=i._findResource(a.name);l&&r.push(l)}else if(o instanceof CE){const a=o,l=i._functions.get(a.name);l&&(n&&(l.inUse=!0),e.calls.add(l.node),l.resources===null&&(l.resources=i._findResources(l.node,n)),r.push(...l.resources))}else if(o instanceof AE){const a=o,l=i._functions.get(a.name);l&&(n&&(l.inUse=!0),e.calls.add(l.node),l.resources===null&&(l.resources=i._findResources(l.node,n)),r.push(...l.resources))}}),[...new Map(r.map(o=>[o.name,o])).values()]}getBindGroups(){const e=[];function n(r,i){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),i>=e[r].length&&(e[r].length=i+1)}for(const r of this.uniforms){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}for(const r of this.storage){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}for(const r of this.textures){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}for(const r of this.samplers){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}return e}_getOutputs(e,n=void 0){if(n===void 0&&(n=[]),e instanceof Ar)this._getStructOutputs(e,n);else{const r=this._getOutputInfo(e);r!==null&&n.push(r)}return n}_getStructOutputs(e,n){for(const r of e.members)if(r.type instanceof Ar)this._getStructOutputs(r.type,n);else{const i=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(i!==null){const s=this._getTypeInfo(r.type,r.type.attributes),o=this._parseInt(i.value),a=new Ey(r.name,s,i.name,o);n.push(a)}}}_getOutputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getTypeInfo(e,e.attributes),i=this._parseInt(n.value);return new Ey("",r,n.name,i)}return null}_getInputs(e,n=void 0){n===void 0&&(n=[]);for(const r of e)if(r.type instanceof Ar)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}return n}_getStructInputs(e,n){for(const r of e.members)if(r.type instanceof Ar)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}}_getInputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getAttribute(e,"interpolation"),i=this._getTypeInfo(e.type,e.attributes),s=this._parseInt(n.value),o=new lI(e.name,i,n.name,s);return r!==null&&(o.interpolation=this._parseString(r.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const n=parseInt(e);return isNaN(n)?e:n}_getAlias(e){for(const n of this.aliases)if(n.name==e)return n.type;return null}_getAliasInfo(e){return new aI(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,n){if(this._types.has(e))return this._types.get(e);if(e instanceof PE){const i=e,s=this._getTypeInfo(i.format,i.attributes),o=new Bf(i.name,n);return o.format=s,o.count=i.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Ar){const i=e,s=new Wa(i.name,n);s.startLine=i.startLine,s.endLine=i.endLine;for(const o of i.members){const a=this._getTypeInfo(o.type,o.attributes);s.members.push(new Ty(o.name,a,o.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof qs){const i=e,s=i.format instanceof ri,o=i.format?s?this._getTypeInfo(i.format,null):new ji(i.format,null):null,a=new Sy(i.name,o,n,i.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof RE){const i=e,s=i.format?this._getTypeInfo(i.format,null):null,o=new Sy(i.name,s,n,i.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const r=new ji(e.name,n);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var n,r;const i=this._getTypeSize(e);if(e.size=(n=i==null?void 0:i.size)!==null&&n!==void 0?n:0,e instanceof Bf){const s=this._getTypeSize(e.format);e.stride=(r=s==null?void 0:s.size)!==null&&r!==void 0?r:0,this._updateTypeInfo(e.format)}e instanceof Wa&&this._updateStructInfo(e)}_updateStructInfo(e){var n;let r=0,i=0,s=0,o=0;for(let a=0,l=e.members.length;a<l;++a){const c=e.members[a],u=this._getTypeSize(c);if(!u)continue;(n=this._getAlias(c.type.name))!==null&&n!==void 0||c.type;const f=u.align,h=u.size;r=this._roundUp(f,r+i),i=h,s=r,o=Math.max(o,f),c.offset=r,c.size=h,this._updateTypeInfo(c.type)}e.size=this._roundUp(o,s+i),e.align=o}_getTypeSize(e){var n,r;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Ty&&(e=e.type),e instanceof ji){const o=this._getAlias(e.name);o!==null&&(e=o)}{const o=bn._typeInfo[e.name];if(o!==void 0){const a=((n=e.format)===null||n===void 0?void 0:n.name)==="f16"?2:1;return new Ha(Math.max(s,o.align/a),Math.max(i,o.size/a))}}{const o=bn._typeInfo[e.name.substring(0,e.name.length-1)];if(o){const a=e.name[e.name.length-1]==="h"?2:1;return new Ha(Math.max(s,o.align/a),Math.max(i,o.size/a))}}if(e instanceof Bf){let o=e,a=8,l=8;const c=this._getTypeSize(o.format);c!==null&&(l=c.size,a=c.align);const u=o.count,f=this._getAttributeNum((r=e==null?void 0:e.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(a,l));return l=u*f,i&&(l=i),new Ha(Math.max(s,a),Math.max(i,l))}if(e instanceof Wa){let o=0,a=0,l=0,c=0,u=0;for(const f of e.members){const h=this._getTypeSize(f.type);h!==null&&(o=Math.max(h.align,o),l=this._roundUp(h.align,l+c),c=h.size,u=l)}return a=this._roundUp(o,u+c),new Ha(Math.max(s,o),Math.max(i,a))}return null}_isUniformVar(e){return e instanceof br&&e.storage=="uniform"}_isStorageVar(e){return e instanceof br&&e.storage=="storage"}_isTextureVar(e){return e instanceof br&&e.type!==null&&bn._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof br&&e.type!==null&&bn._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,n){const r=e;if(!r||!r.attributes)return null;const i=r.attributes;for(let s of i)if(s.name==n)return s;return null}_getAttributeNum(e,n,r){if(e===null)return r;for(let i of e)if(i.name==n){let s=i!==null&&i.value!==null?i.value:r;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):r}return r}_roundUp(e,n){return Math.ceil(n/e)*e}}bn._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};bn._textureTypes=E.any_texture_type.map(t=>t.name);bn._samplerTypes=E.sampler_type.map(t=>t.name);function dI(t){var s;const e={attributes:[],bindings:[]};let n;try{n=pI(t)}catch(o){return B.error(o.message)(),e}for(const o of n.uniforms){const a=[];for(const l of((s=o.type)==null?void 0:s.members)||[])a.push({name:l.name,type:wy(l.type)});e.bindings.push({type:"uniform",name:o.name,location:o.binding,group:o.group,members:a})}const r=n.entry.vertex[0],i=(r==null?void 0:r.inputs.length)||0;for(let o=0;o<i;o++){const a=r.inputs[o];if(a.locationType==="location"){const l=wy(a.type);e.attributes.push({name:a.name,location:Number(a.location),type:l})}}return e}function wy(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function pI(t){try{return new bn(t)}catch(e){if(e instanceof Error)throw e;let n="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(n+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(n+=e.token.line||""),new Error(n,{cause:e})}}const gI=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,_I={name:"fp32",vs:gI},mI=[0,1,1,1],yI=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,vI=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,Ay={name:"picking",vs:yI,fs:vI,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:mI},getUniforms:TI};function TI(t={},e){const n={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const r=t.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=r}if(t.highlightColor){const r=Array.from(t.highlightColor,i=>i/255);Number.isFinite(r[3])||(r[3]=1),n.highlightColor=r}return t.isActive!==void 0&&(n.isActive=!!t.isActive,n.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(n.useFloatColors=!!t.useFloatColors),n}function ME(t,e=[],n=0){const r=Math.fround(t),i=t-r;return e[n]=r,e[n+1]=i,e}function SI(t){return t-Math.fround(t)}function EI(t){const e=new Float32Array(32);for(let n=0;n<4;++n)for(let r=0;r<4;++r){const i=n*4+r;ME(t[r*4+n],e,i*2)}return e}const wI=`uniform float ONE;
vec2 split(float a) {
const float SPLIT = 4097.0;
float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float a_hi = t * ONE - (t - a);
float a_lo = a * ONE - a_hi;
#else
float a_hi = t - (t - a);
float a_lo = a - a_hi;
#endif
return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
vec2 b = split(a.x);
b.y += a.y;
return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float sum = (a + b) * ONE;
float err = b - (sum - a) * ONE;
#else
float sum = a + b;
float err = b - (sum - a);
#endif
return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
float v = s - a;
float err = (a - (s - v)) + (b - v);
#endif
return vec2(s, err);
}
vec2 twoSub(float a, float b) {
float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
float v = s - a;
float err = (a - (s - v)) - (b + v);
#endif
return vec2(s, err);
}
vec2 twoSqr(float a) {
float prod = a * a;
vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
return vec2(prod, err);
}
vec2 twoProd(float a, float b) {
float prod = a * b;
vec2 a_fp64 = split(a);
vec2 b_fp64 = split(b);
float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
return vec2(prod, err);
}
vec2 sum_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSum(a.x, b.x);
t = twoSum(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 sub_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSub(a.x, b.x);
t = twoSub(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 mul_fp64(vec2 a, vec2 b) {
vec2 prod = twoProd(a.x, b.x);
prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
return prod;
}
vec2 div_fp64(vec2 a, vec2 b) {
float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
vec2 yn = a * xn;
#endif
float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
vec2 prod = twoProd(xn, diff);
return sum_fp64(yn, prod);
}
vec2 sqrt_fp64(vec2 a) {
if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
float x = 1.0 / sqrt(a.x);
float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
vec2 yn_sqr = twoSqr(yn) * ONE;
#else
vec2 yn_sqr = twoSqr(yn);
#endif
float diff = sub_fp64(a, yn_sqr).x;
vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
return sum_fp64(split(yn), prod);
#else
return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,AI={ONE:1};function bI(){return AI}const RI={name:"fp64-arithmetic",vs:wI,getUniforms:bI,fp64ify:ME,fp64LowPart:SI,fp64ifyMatrix4:EI},PI={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...PI}};const gt=globalThis.mathgl.config;function CI(t,{precision:e=gt.precision}={}){return t=xI(t),`${parseFloat(t.toPrecision(e))}`}function cs(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function qn(t,e,n){return MI(t,r=>Math.max(e,Math.min(n,r)))}function Sc(t,e,n){return cs(t)?t.map((r,i)=>Sc(r,e[i],n)):n*e+(1-n)*t}function zo(t,e,n){const r=gt.EPSILON;n&&(gt.EPSILON=n);try{if(t===e)return!0;if(cs(t)&&cs(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!zo(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=gt.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{gt.EPSILON=r}}function xI(t){return Math.round(t/gt.EPSILON)*gt.EPSILON}function II(t){return t.clone?t.clone():new Array(t.length)}function MI(t,e,n){if(cs(t)){const r=t;n=n||II(r);for(let i=0;i<n.length&&i<r.length;++i){const s=typeof t=="number"?t:t[i];n[i]=e(s,i,n)}return n}return e(t)}class OE extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:cs(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(gt)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+CI(this[r],e);return`${e.printTypes?this.constructor.name:""}[${n}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!zo(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],o=typeof n=="number"?n:n[i];this[i]=s+r*(o-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(gt.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function OI(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function dt(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function Uf(t,e,n=""){if(gt.debug&&!OI(t,e))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return t}function by(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class kI extends OE{get x(){return this[0]}set x(e){this[0]=dt(e)}get y(){return this[1]}set y(e){this[1]=dt(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];n+=i*i}return dt(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return dt(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return by(e>=0&&e<this.ELEMENTS,"index is out of range"),dt(this[e])}setComponent(e,n){return by(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}const bl=1e-6;let us=typeof Float32Array<"u"?Float32Array:Array;function NI(){const t=new us(2);return us!=Float32Array&&(t[0]=0,t[1]=0),t}function Ry(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function FI(t,e){return t[0]=-e[0],t[1]=-e[1],t}function kE(t,e,n,r){const i=e[0],s=e[1];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t}function DI(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}(function(){const t=NI();return function(e,n,r,i,s,o){let a,l;for(n||(n=2),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function BI(t,e,n){const r=e[0],i=e[1],s=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/s,t[1]=(n[1]*r+n[5]*i)/s,t}function NE(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s||1;return t[0]=(n[0]*r+n[4]*i+n[8]*s)/o,t[1]=(n[1]*r+n[5]*i+n[9]*s)/o,t[2]=(n[2]*r+n[6]*i+n[10]*s)/o,t}function UI(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t}function LI(){const t=new us(3);return us!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function zI(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function VI(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function WI(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function jI(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],l=n[2];return t[0]=i*l-s*a,t[1]=s*o-r*l,t[2]=r*a-i*o,t}function FE(t,e,n){const r=e[0],i=e[1],s=e[2];let o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,t}function HI(t,e,n){const r=e[0],i=e[1],s=e[2];return t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8],t}function $I(t,e,n){const r=n[0],i=n[1],s=n[2],o=n[3],a=e[0],l=e[1],c=e[2];let u=i*c-s*l,f=s*a-r*c,h=r*l-i*a,d=i*h-s*f,m=s*u-r*h,T=r*f-i*u;const A=o*2;return u*=A,f*=A,h*=A,d*=2,m*=2,T*=2,t[0]=a+u+d,t[1]=l+f+m,t[2]=c+h+T,t}function XI(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function YI(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function KI(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function qI(t,e){const n=t[0],r=t[1],i=t[2],s=e[0],o=e[1],a=e[2],l=Math.sqrt((n*n+r*r+i*i)*(s*s+o*o+a*a)),c=l&&WI(t,e)/l;return Math.acos(Math.min(Math.max(c,-1),1))}const ZI=zI;(function(){const t=LI();return function(e,n,r,i,s,o){let a,l;for(n||(n=3),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const Lf=[0,0,0];let $a;class fn extends kI{static get ZERO(){return $a||($a=new fn(0,0,0),Object.freeze($a)),$a}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&cs(e)?this.copy(e):(gt.debug&&(dt(e),dt(n),dt(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return gt.debug&&(dt(e.x),dt(e.y),dt(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=dt(e)}angle(e){return qI(this,e)}cross(e){return jI(this,this,e),this.check()}rotateX({radians:e,origin:n=Lf}){return XI(this,this,n,e),this.check()}rotateY({radians:e,origin:n=Lf}){return YI(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=Lf}){return KI(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return FE(this,this,e),this.check()}transformAsVector(e){return NE(this,this,e),this.check()}transformByMatrix3(e){return HI(this,this,e),this.check()}transformByMatrix2(e){return UI(this,this,e),this.check()}transformByQuaternion(e){return $I(this,this,e),this.check()}}class QI extends OE{toString(){let e="[";if(gt.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+n]}`}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=` ${this[n]}`}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=dt(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)n[i]=this[r+i];return n}setColumn(e,n){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=n[i];return this}}function JI(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function GI(t,e){if(t===e){const n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Id(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],f=e[9],h=e[10],d=e[11],m=e[12],T=e[13],A=e[14],g=e[15],p=n*a-r*o,_=n*l-i*o,w=n*c-s*o,R=r*l-i*a,x=r*c-s*a,M=i*c-s*l,k=u*T-f*m,F=u*A-h*m,U=u*g-d*m,j=f*A-h*T,X=f*g-d*T,$=h*g-d*A;let K=p*$-_*X+w*j+R*U-x*F+M*k;return K?(K=1/K,t[0]=(a*$-l*X+c*j)*K,t[1]=(i*X-r*$-s*j)*K,t[2]=(T*M-A*x+g*R)*K,t[3]=(h*x-f*M-d*R)*K,t[4]=(l*U-o*$-c*F)*K,t[5]=(n*$-i*U+s*F)*K,t[6]=(A*w-m*M-g*_)*K,t[7]=(u*M-h*w+d*_)*K,t[8]=(o*X-a*U+c*k)*K,t[9]=(r*U-n*X-s*k)*K,t[10]=(m*x-T*w+g*p)*K,t[11]=(f*w-u*x-d*p)*K,t[12]=(a*F-o*j-l*k)*K,t[13]=(n*j-r*F+i*k)*K,t[14]=(T*_-m*R-A*p)*K,t[15]=(u*R-f*_+h*p)*K,t):null}function eM(t){const e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],f=t[10],h=t[11],d=t[12],m=t[13],T=t[14],A=t[15],g=e*o-n*s,p=e*a-r*s,_=n*a-r*o,w=c*m-u*d,R=c*T-f*d,x=u*T-f*m,M=e*x-n*R+r*w,k=s*x-o*R+a*w,F=c*_-u*p+f*g,U=d*_-m*p+T*g;return l*M-i*k+A*F-h*U}function zr(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],f=e[8],h=e[9],d=e[10],m=e[11],T=e[12],A=e[13],g=e[14],p=e[15];let _=n[0],w=n[1],R=n[2],x=n[3];return t[0]=_*r+w*a+R*f+x*T,t[1]=_*i+w*l+R*h+x*A,t[2]=_*s+w*c+R*d+x*g,t[3]=_*o+w*u+R*m+x*p,_=n[4],w=n[5],R=n[6],x=n[7],t[4]=_*r+w*a+R*f+x*T,t[5]=_*i+w*l+R*h+x*A,t[6]=_*s+w*c+R*d+x*g,t[7]=_*o+w*u+R*m+x*p,_=n[8],w=n[9],R=n[10],x=n[11],t[8]=_*r+w*a+R*f+x*T,t[9]=_*i+w*l+R*h+x*A,t[10]=_*s+w*c+R*d+x*g,t[11]=_*o+w*u+R*m+x*p,_=n[12],w=n[13],R=n[14],x=n[15],t[12]=_*r+w*a+R*f+x*T,t[13]=_*i+w*l+R*h+x*A,t[14]=_*s+w*c+R*d+x*g,t[15]=_*o+w*u+R*m+x*p,t}function Ec(t,e,n){const r=n[0],i=n[1],s=n[2];let o,a,l,c,u,f,h,d,m,T,A,g;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*s+e[12],t[13]=e[1]*r+e[5]*i+e[9]*s+e[13],t[14]=e[2]*r+e[6]*i+e[10]*s+e[14],t[15]=e[3]*r+e[7]*i+e[11]*s+e[15]):(o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],f=e[5],h=e[6],d=e[7],m=e[8],T=e[9],A=e[10],g=e[11],t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=f,t[6]=h,t[7]=d,t[8]=m,t[9]=T,t[10]=A,t[11]=g,t[12]=o*r+u*i+m*s+e[12],t[13]=a*r+f*i+T*s+e[13],t[14]=l*r+h*i+A*s+e[14],t[15]=c*r+d*i+g*s+e[15]),t}function Sg(t,e,n){const r=n[0],i=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function tM(t,e,n,r){let i=r[0],s=r[1],o=r[2],a=Math.sqrt(i*i+s*s+o*o),l,c,u,f,h,d,m,T,A,g,p,_,w,R,x,M,k,F,U,j,X,$,K,je;return a<bl?null:(a=1/a,i*=a,s*=a,o*=a,c=Math.sin(n),l=Math.cos(n),u=1-l,f=e[0],h=e[1],d=e[2],m=e[3],T=e[4],A=e[5],g=e[6],p=e[7],_=e[8],w=e[9],R=e[10],x=e[11],M=i*i*u+l,k=s*i*u+o*c,F=o*i*u-s*c,U=i*s*u-o*c,j=s*s*u+l,X=o*s*u+i*c,$=i*o*u+s*c,K=s*o*u-i*c,je=o*o*u+l,t[0]=f*M+T*k+_*F,t[1]=h*M+A*k+w*F,t[2]=d*M+g*k+R*F,t[3]=m*M+p*k+x*F,t[4]=f*U+T*j+_*X,t[5]=h*U+A*j+w*X,t[6]=d*U+g*j+R*X,t[7]=m*U+p*j+x*X,t[8]=f*$+T*K+_*je,t[9]=h*$+A*K+w*je,t[10]=d*$+g*K+R*je,t[11]=m*$+p*K+x*je,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function DE(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],f=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+c*r,t[5]=o*i+u*r,t[6]=a*i+f*r,t[7]=l*i+h*r,t[8]=c*i-s*r,t[9]=u*i-o*r,t[10]=f*i-a*r,t[11]=h*i-l*r,t}function nM(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],f=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-c*r,t[1]=o*i-u*r,t[2]=a*i-f*r,t[3]=l*i-h*r,t[8]=s*r+c*i,t[9]=o*r+u*i,t[10]=a*r+f*i,t[11]=l*r+h*i,t}function BE(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],f=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+c*r,t[1]=o*i+u*r,t[2]=a*i+f*r,t[3]=l*i+h*r,t[4]=c*i-s*r,t[5]=u*i-o*r,t[6]=f*i-a*r,t[7]=h*i-l*r,t}function rM(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,l=i+i,c=n*o,u=r*o,f=r*a,h=i*o,d=i*a,m=i*l,T=s*o,A=s*a,g=s*l;return t[0]=1-f-m,t[1]=u+g,t[2]=h-A,t[3]=0,t[4]=u-g,t[5]=1-c-m,t[6]=d+T,t[7]=0,t[8]=h+A,t[9]=d-T,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function iM(t,e,n,r,i,s,o){const a=1/(n-e),l=1/(i-r),c=1/(s-o);return t[0]=s*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*l,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(i+r)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function sM(t,e,n,r,i){const s=1/Math.tan(e/2);if(t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0){const o=1/(r-i);t[10]=(i+r)*o,t[14]=2*i*r*o}else t[10]=-1,t[14]=-2*r;return t}const oM=sM;function aM(t,e,n,r,i,s,o){const a=1/(e-n),l=1/(r-i),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*l,t[14]=(o+s)*c,t[15]=1,t}const lM=aM;function cM(t,e,n,r){let i,s,o,a,l,c,u,f,h,d;const m=e[0],T=e[1],A=e[2],g=r[0],p=r[1],_=r[2],w=n[0],R=n[1],x=n[2];return Math.abs(m-w)<bl&&Math.abs(T-R)<bl&&Math.abs(A-x)<bl?JI(t):(f=m-w,h=T-R,d=A-x,i=1/Math.sqrt(f*f+h*h+d*d),f*=i,h*=i,d*=i,s=p*d-_*h,o=_*f-g*d,a=g*h-p*f,i=Math.sqrt(s*s+o*o+a*a),i?(i=1/i,s*=i,o*=i,a*=i):(s=0,o=0,a=0),l=h*a-d*o,c=d*s-f*a,u=f*o-h*s,i=Math.sqrt(l*l+c*c+u*u),i?(i=1/i,l*=i,c*=i,u*=i):(l=0,c=0,u=0),t[0]=s,t[1]=l,t[2]=f,t[3]=0,t[4]=o,t[5]=c,t[6]=h,t[7]=0,t[8]=a,t[9]=u,t[10]=d,t[11]=0,t[12]=-(s*m+o*T+a*A),t[13]=-(l*m+c*T+u*A),t[14]=-(f*m+h*T+d*A),t[15]=1,t)}function uM(){const t=new us(4);return us!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function fM(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function aa(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}(function(){const t=uM();return function(e,n,r,i,s,o){let a,l;for(n||(n=4),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var Md;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(Md||(Md={}));const hM=45*Math.PI/180,dM=1,zf=.1,Vf=500,pM=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class hn extends QI{static get IDENTITY(){return _M()}static get ZERO(){return gM()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Md}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,r,i,s,o,a,l,c,u,f,h,d,m,T,A){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=a,this[7]=l,this[8]=c,this[9]=u,this[10]=f,this[11]=h,this[12]=d,this[13]=m,this[14]=T,this[15]=A,this.check()}setRowMajor(e,n,r,i,s,o,a,l,c,u,f,h,d,m,T,A){return this[0]=e,this[1]=s,this[2]=c,this[3]=d,this[4]=n,this[5]=o,this[6]=u,this[7]=m,this[8]=r,this[9]=a,this[10]=f,this[11]=T,this[12]=i,this[13]=l,this[14]=h,this[15]=A,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(pM)}fromObject(e){return this.check()}fromQuaternion(e){return rM(this,e),this.check()}frustum(e){const{left:n,right:r,bottom:i,top:s,near:o=zf,far:a=Vf}=e;return a===1/0?mM(this,n,r,i,s,o):iM(this,n,r,i,s,o,a),this.check()}lookAt(e){const{eye:n,center:r=[0,0,0],up:i=[0,1,0]}=e;return cM(this,n,r,i),this.check()}ortho(e){const{left:n,right:r,bottom:i,top:s,near:o=zf,far:a=Vf}=e;return lM(this,n,r,i,s,o,a),this.check()}orthographic(e){const{fovy:n=hM,aspect:r=dM,focalDistance:i=1,near:s=zf,far:o=Vf}=e;Py(n);const a=n/2,l=i*Math.tan(a),c=l*r;return this.ortho({left:-c,right:c,bottom:-l,top:l,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:r=1,near:i=.1,far:s=500}=e;return Py(n),oM(this,n,r,i,s),this.check()}determinant(){return eM(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return GI(this,this),this.check()}invert(){return Id(this,this),this.check()}multiplyLeft(e){return zr(this,e,this),this.check()}multiplyRight(e){return zr(this,this,e),this.check()}rotateX(e){return DE(this,this,e),this.check()}rotateY(e){return nM(this,this,e),this.check()}rotateZ(e){return BE(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return tM(this,this,e,n),this.check()}scale(e){return Sg(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Ec(this,this,e),this.check()}transform(e,n){return e.length===4?(n=aa(n||[-0,-0,-0,-0],e,this),Uf(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:r}=e;let i;switch(r){case 2:i=DI(n||[-0,-0],e,this);break;case 3:i=FE(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Uf(i,e.length),i}transformAsVector(e,n){let r;switch(e.length){case 2:r=BI(n||[-0,-0],e,this);break;case 3:r=NE(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Uf(r,e.length),r}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,r){return this.identity().translate([e,n,r])}}let Xa,Ya;function gM(){return Xa||(Xa=new hn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Xa)),Xa}function _M(){return Ya||(Ya=new hn,Object.freeze(Ya)),Ya}function Py(t){if(t>Math.PI*2)throw Error("expected radians")}function mM(t,e,n,r,i,s){const o=2*s/(n-e),a=2*s/(i-r),l=(n+e)/(n-e),c=(i+r)/(i-r),u=-1,f=-1,h=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=l,t[9]=c,t[10]=u,t[11]=f,t[12]=0,t[13]=0,t[14]=h,t[15]=0,t}const Cy=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;
uniform bool lighting_uEnabled;
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
#endif
`,yM={lightSources:{}};function Wf(t={}){const{color:e=[0,0,0],intensity:n=1}=t;return e.map(r=>r*n/255)}function vM({ambientLight:t,pointLights:e=[],directionalLights:n=[]}){const r={};return t?r["lighting_uAmbientLight.color"]=Wf(t):r["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((i,s)=>{r[`lighting_uPointLight[${s}].color`]=Wf(i),r[`lighting_uPointLight[${s}].position`]=i.position,r[`lighting_uPointLight[${s}].attenuation`]=i.attenuation||[1,0,0]}),r.lighting_uPointLightCount=e.length,n.forEach((i,s)=>{r[`lighting_uDirectionalLight[${s}].color`]=Wf(i),r[`lighting_uDirectionalLight[${s}].direction`]=i.direction}),r.lighting_uDirectionalLightCount=n.length,r}function UE(t=yM){var e,n;if("lightSources"in t){const{ambientLight:r,pointLights:i,directionalLights:s}=t.lightSources||{};return r||i&&i.length>0||s&&s.length>0?Object.assign({},vM({ambientLight:r,pointLights:i,directionalLights:s}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const r={pointLights:[],directionalLights:[]};for(const i of t.lights||[])switch(i.type){case"ambient":r.ambientLight=i;break;case"directional":(e=r.directionalLights)==null||e.push(i);break;case"point":(n=r.pointLights)==null||n.push(i);break}return UE({lightSources:r})}return{}}const TM={name:"lights",vs:Cy,fs:Cy,getUniforms:UE,defines:{MAX_LIGHTS:3}},SM=`uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, lighting_uShininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = vec3(0, 0, 0);
vec3 surfaceColor = vec3(0, 0, 0);
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
`,EM={};function wM(t){const{ambient:e=.35,diffuse:n=.6,shininess:r=32,specularColor:i=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:r,lighting_uSpecularColor:i.map(s=>s/255)}}function AM(t=EM){if(!("material"in t))return{};const{material:e}=t;return e?wM(e):{lighting_uEnabled:!1}}const bM={name:"gouraud-lighting",dependencies:[TM],vs:SM,defines:{LIGHTING_VERTEX:1},getUniforms:AM},LE="#define SMOOTH_EDGE_RADIUS 0.5",RM=`
${LE}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,PM=`
${LE}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,CM={name:"geometry",vs:RM,fs:PM},te={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(te,"IDENTITY",{get:()=>(Q.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const an={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Yr={common:0,meters:1,pixels:2},Od={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},xM=Object.keys(te).map(t=>`const int COORDINATE_SYSTEM_${t} = ${te[t]};`).join(""),IM=Object.keys(an).map(t=>`const int PROJECTION_MODE_${t} = ${an[t]};`).join(""),MM=Object.keys(Yr).map(t=>`const int UNIT_${t.toUpperCase()} = ${Yr[t]};`).join(""),OM=`${xM}
${IM}
${MM}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function kM(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function la(t){let e={},n;return r=>{for(const i in r)if(!kM(r[i],e[i])){n=t(r),e=r;break}return n}}const xy=[0,0,0,0],NM=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],zE=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],FM=[0,0,0],VE=[0,0,0],DM=la(LM);function WE(t,e,n=VE){n.length<3&&(n=[n[0],n[1],0]);let r=n,i,s=!0;switch(e===te.LNGLAT_OFFSETS||e===te.METER_OFFSETS?i=n:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case an.WEB_MERCATOR:(e===te.LNGLAT||e===te.CARTESIAN)&&(i=[0,0,0],s=!1);break;case an.WEB_MERCATOR_AUTO_OFFSET:e===te.LNGLAT?r=i:e===te.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case an.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case an.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}function BM(t,e,n){const{viewMatrixUncentered:r,projectionMatrix:i}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,a=xy,l=xy,c=t.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:f,offsetMode:h}=WE(t,e,n);return h&&(l=t.projectPosition(u||f),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=aa([],l,o),s=r||s,o=zr([],i,s),o=zr([],o,NM)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:f,geospatialOrigin:u}}function UM({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:r=te.DEFAULT,coordinateOrigin:i=VE,autoWrapLongitude:s=!1}){r===te.DEFAULT&&(r=t.isGeospatial?te.LNGLAT:te.CARTESIAN);const o=DM({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return o.project_uWrapLongitude=s,o.project_uModelMatrix=n||zE,o}function LM({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=BM(t,n,r),u=t.getDistanceScales(),f=[t.width*e,t.height*e],h=aa([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,d={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:o.slice(0,3),project_uCenter:i,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:f,project_uDevicePixelRatio:e,project_uFocalDistance:h,project_uCommonUnitsPerMeter:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:FM,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:zE,project_uCameraPosition:a};if(c){const m=t.getDistanceScales(c);switch(n){case te.METER_OFFSETS:d.project_uCommonUnitsPerWorldUnit=m.unitsPerMeter,d.project_uCommonUnitsPerWorldUnit2=m.unitsPerMeter2;break;case te.LNGLAT:case te.LNGLAT_OFFSETS:t._pseudoMeters||(d.project_uCommonUnitsPerMeter=m.unitsPerMeter),d.project_uCommonUnitsPerWorldUnit=m.unitsPerDegree,d.project_uCommonUnitsPerWorldUnit2=m.unitsPerDegree2;break;case te.CARTESIAN:d.project_uCommonUnitsPerWorldUnit=[1,1,m.unitsPerMeter[2]],d.project_uCommonUnitsPerWorldUnit2=[0,0,m.unitsPerMeter2[2]];break}}return d}const zM={};function VM(t=zM){return"viewport"in t?UM(t):{}}const Eg={name:"project",dependencies:[_I,CM],vs:OM,getUniforms:VM},WM=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,ca={name:"project32",dependencies:[Eg],vs:WM};function jM(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Hi(t,e){const n=aa([],e,t);return fM(n,n,1/n[3]),n}function Iy(t,e){const n=t%e;return n<0?e+n:n}function kd(t,e,n){return t<e?e:t>n?n:t}function HM(t){return Math.log(t)*Math.LOG2E}const wg=Math.log2||HM;function Mn(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Dt=Math.PI,jE=Dt/4,Pt=Dt/180,Nd=180/Dt,fs=512,wc=4003e4,Ka=85.051129,$M=1.5;function XM(t){return wg(t)}function Vo(t){const[e,n]=t;Mn(Number.isFinite(e)),Mn(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=e*Pt,i=n*Pt,s=fs*(r+Dt)/(2*Dt),o=fs*(Dt+Math.log(Math.tan(jE+i*.5)))/(2*Dt);return[s,o]}function hs(t){const[e,n]=t,r=e/fs*(2*Dt)-Dt,i=2*(Math.atan(Math.exp(n/fs*(2*Dt)-Dt))-jE);return[r*Nd,i*Nd]}function YM(t){const{latitude:e}=t;Mn(Number.isFinite(e));const n=Math.cos(e*Pt);return XM(wc*n)-9}function Rl(t){const e=Math.cos(t*Pt);return fs/wc/e}function Fd(t){const{latitude:e,longitude:n,highPrecision:r=!1}=t;Mn(Number.isFinite(e)&&Number.isFinite(n));const i=fs,s=Math.cos(e*Pt),o=i/360,a=o/s,l=i/wc/s,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[o,a,l],degreesPerUnit:[1/o,1/a,1/l]};if(r){const u=Pt*Math.tan(e*Pt)/s,f=o*u/2,h=i/wc*u,d=h/a*l;c.unitsPerDegree2=[0,f,h],c.unitsPerMeter2=[d,0,d]}return c}function HE(t,e){const[n,r,i]=t,[s,o,a]=e,{unitsPerMeter:l,unitsPerMeter2:c}=Fd({longitude:n,latitude:r,highPrecision:!0}),u=Vo(t);u[0]+=s*(l[0]+c[0]*o),u[1]+=o*(l[1]+c[1]*o);const f=hs(u),h=(i||0)+(a||0);return Number.isFinite(i)||Number.isFinite(a)?[f[0],f[1],h]:f}function KM(t){const{height:e,pitch:n,bearing:r,altitude:i,scale:s,center:o}=t,a=jM();Ec(a,a,[0,0,-i]),DE(a,a,-n*Pt),BE(a,a,r*Pt);const l=s/e;return Sg(a,a,[l,l,l]),o&&Ec(a,a,VI([],o)),a}function qM(t){const{width:e,height:n,altitude:r,pitch:i=0,offset:s,center:o,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=t;let{fovy:u=Ac($M)}=t;r!==void 0&&(u=Ac(r));const f=u*Pt,h=i*Pt,d=$E(u);let m=d;o&&(m+=o[2]*a/Math.cos(h)/n);const T=f*(.5+(s?s[1]:0)/n),A=Math.sin(T)*m/Math.sin(kd(Math.PI/2-h-T,.01,Math.PI-.01)),g=Math.sin(h)*A+m,p=m*10,_=Math.min(g*c,p);return{fov:f,aspect:e/n,focalDistance:d,near:l,far:_}}function Ac(t){return 2*Math.atan(.5/t)*Nd}function $E(t){return .5/Math.tan(.5*t*Pt)}function XE(t,e){const[n,r,i=0]=t;return Mn(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(i)),Hi(e,[n,r,i,1])}function Ag(t,e,n=0){const[r,i,s]=t;if(Mn(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return Hi(e,[r,i,s,1]);const o=Hi(e,[r,i,0,1]),a=Hi(e,[r,i,1,1]),l=o[2],c=a[2],u=l===c?0:((n||0)-l)/(c-l);return kE([],o,a,u)}function ZM(t){const{width:e,height:n,bounds:r,minExtent:i=0,maxZoom:s=24,offset:o=[0,0]}=t,[[a,l],[c,u]]=r,f=QM(t.padding),h=Vo([a,kd(u,-Ka,Ka)]),d=Vo([c,kd(l,-Ka,Ka)]),m=[Math.max(Math.abs(d[0]-h[0]),i),Math.max(Math.abs(d[1]-h[1]),i)],T=[e-f.left-f.right-Math.abs(o[0])*2,n-f.top-f.bottom-Math.abs(o[1])*2];Mn(T[0]>0&&T[1]>0);const A=T[0]/m[0],g=T[1]/m[1],p=(f.right-f.left)/2/A,_=(f.top-f.bottom)/2/g,w=[(d[0]+h[0])/2+p,(d[1]+h[1])/2+_],R=hs(w),x=Math.min(s,wg(Math.abs(Math.min(A,g))));return Mn(Number.isFinite(x)),{longitude:R[0],latitude:R[1],zoom:x}}function QM(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Mn(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const My=Math.PI/180;function JM(t,e=0){const{width:n,height:r,unproject:i}=t,s={targetZ:e},o=i([0,r],s),a=i([n,r],s);let l,c;const u=t.fovy?.5*t.fovy*My:Math.atan(.5/t.altitude),f=(90-t.pitch)*My;return u>f-.01?(l=Oy(t,0,e),c=Oy(t,n,e)):(l=i([0,0],s),c=i([n,0],s)),[o,a,c,l]}function Oy(t,e,n){const{pixelUnprojectionMatrix:r}=t,i=Hi(r,[e,0,1,1]),s=Hi(r,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),l=kE([],i,s,a),c=hs(l);return c.push(n),c}const ky=512;function GM(t){const{width:e,height:n,pitch:r=0}=t;let{longitude:i,latitude:s,zoom:o,bearing:a=0}=t;(i<-180||i>180)&&(i=Iy(i+180,360)-180),(a<-180||a>180)&&(a=Iy(a+180,360)-180);const l=wg(n/ky);if(o<=l)o=l,s=0;else{const c=n/2/Math.pow(2,o),u=hs([0,c])[1];if(s<u)s=u;else{const f=hs([0,ky-c])[1];s>f&&(s=f)}}return{width:e,height:n,longitude:i,latitude:s,zoom:o,pitch:r,bearing:a}}const eO=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,tO=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,nO=la(aO),rO=la(lO),iO=[0,0,0,1],sO=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function oO(t,e){const[n,r,i]=t,s=Ag([n,r,i],e);return Number.isFinite(i)?s:[s[0],s[1],0]}function aO({viewport:t,center:e}){return new hn(t.viewProjectionMatrix).invert().transform(e)}function lO({viewport:t,shadowMatrices:e}){const n=[],r=t.pixelUnprojectionMatrix,i=t.isGeospatial?void 0:1,s=[[0,0,i],[t.width,0,i],[0,t.height,i],[t.width,t.height,i],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>oO(o,r));for(const o of e){const a=o.clone().translate(new fn(t.center).negate()),l=s.map(u=>a.transform(u)),c=new hn().ortho({left:Math.min(...l.map(u=>u[0])),right:Math.max(...l.map(u=>u[0])),bottom:Math.min(...l.map(u=>u[1])),top:Math.max(...l.map(u=>u[1])),near:Math.min(...l.map(u=>-u[2])),far:Math.max(...l.map(u=>-u[2]))});n.push(c.multiplyRight(o))}return n}function cO(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const r={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||iO,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},i=nO({viewport:t.viewport,center:e.project_uCenter}),s=[],o=rO({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const l=o[a],c=l.clone().translate(new fn(t.viewport.center).negate());e.project_uCoordinateSystem===te.LNGLAT&&e.project_uProjectionMode===an.WEB_MERCATOR?(o[a]=c,s[a]=i):(o[a]=l.clone().multiplyRight(sO),s[a]=c.transform(i))}for(let a=0;a<o.length;a++)r[`shadow_uViewProjectionMatrices[${a}]`]=o[a],r[`shadow_uProjectCenters[${a}]`]=s[a];for(let a=0;a<2;a++)r[`shadow_uShadowMap${a}`]=t.shadowMaps&&t.shadowMaps[a]||t.dummyShadowMap;return r}const Ny={name:"shadow",dependencies:[Eg],vs:eO,fs:tO,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?cO(t,e):{}},ua={...Ay,defaultUniforms:{...Ay.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},uO=[Eg],fO=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function hO(){const t=hc.getDefaultShaderAssembler();for(const e of uO)t.addDefaultModule(e);for(const e of fO)t.addShaderHook(e);return t}const dO=[255,255,255],pO=1;let gO=0;class _O{constructor(e={}){this.type="ambient";const{color:n=dO}=e,{intensity:r=pO}=e;this.id=e.id||`ambient-${gO++}`,this.color=n,this.intensity=r}}const mO=[255,255,255],yO=1,vO=[0,0,-1];let TO=0;class Fy{constructor(e={}){this.type="directional";const{color:n=mO}=e,{intensity:r=yO}=e,{direction:i=vO}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${TO++}`,this.color=n,this.intensity=r,this.type="directional",this.direction=new fn(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class SO{constructor(e,n={id:"pass"}){const{id:r}=n;this.id=r,this.device=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class bg extends SO{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[n,r]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,s=e.clearColor??(i?[0,0,0,0]:!1),o=i?1:!1,a=i?0:!1,l=e.colorMask??15,c={viewport:[0,0,n,r]};e.colorMask&&(c.colorMask=l),e.scissorRect&&(c.scissorRect=e.scissorRect);const u=this.device.beginRenderPass({framebuffer:e.target,parameters:c,clearColor:s,clearDepth:o,clearStencil:a});try{return this._drawLayers(u,e)}finally{u.end()}}_drawLayers(e,n){const{target:r,moduleParameters:i,viewports:s,views:o,onViewportActive:a,clearStack:l=!0}=n;n.pass=n.pass||"unknown",l&&(this._lastRenderIndex=-1);const c=[];for(const u of s){const f=o&&o[u.id];a==null||a(u);const h=this._getDrawLayerParams(u,n),d=u.subViewports||[u];for(const m of d){const T=this._drawLayersInViewport(e,{target:r,moduleParameters:i,viewport:m,view:f,pass:n.pass,layers:n.layers},h);c.push(T)}}return c}_getDrawLayerParams(e,{layers:n,pass:r,isPicking:i=!1,layerFilter:s,cullRect:o,effects:a,moduleParameters:l},c=!1){var m;const u=[],f=YE(this._lastRenderIndex+1),h={layer:n[0],viewport:e,isPicking:i,renderPass:r,cullRect:o},d={};for(let T=0;T<n.length;T++){const A=n[T],g=this._shouldDrawLayer(A,h,s,d),p={shouldDrawLayer:g};g&&!c&&(p.layerRenderIndex=f(A,g),p.moduleParameters=this._getModuleParameters(A,a,r,l),p.layerParameters={...(m=A.context.deck)==null?void 0:m.props.parameters,...this.getLayerParameters(A,T,e)}),u[T]=p}return u}_drawLayersInViewport(e,{layers:n,moduleParameters:r,pass:i,target:s,viewport:o,view:a},l){const c=EO(this.device,{moduleParameters:r,target:s,viewport:o});if(a&&a.props.clear){const f=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:c},()=>this.device.clearWebGL(f))}const u={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:c});for(let f=0;f<n.length;f++){const h=n[f],{shouldDrawLayer:d,layerRenderIndex:m,moduleParameters:T,layerParameters:A}=l[f];if(d&&h.props.pickable&&u.pickableCount++,h.isComposite)u.compositeCount++;else if(d){u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,m),T.viewport=o,h.context.renderPass=e;try{h._drawLayer({renderPass:e,moduleParameters:T,uniforms:{layerIndex:m},parameters:A})}catch(g){h.raiseError(g,`drawing ${h} to ${i}`)}}}return u}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,r){return e.props.parameters}_shouldDrawLayer(e,n,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(r){const a=n.layer.id;if(a in i||(i[a]=r(n)),!i[a])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,r,i){var a,l;const s=this.device.canvasContext.cssToDeviceRatio(),o=Object.assign(Object.create(((a=e.internalState)==null?void 0:a.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:s});if(n)for(const c of n)Object.assign(o,(l=c.getModuleParameters)==null?void 0:l.call(c,e));return Object.assign(o,this.getModuleParameters(e,n),i)}}function YE(t=0,e={}){const n={},r=(i,s)=>{const o=i.props._offset,a=i.id,l=i.parent&&i.parent.id;let c;if(l&&!(l in e)&&r(i.parent,!1),l in n){const u=n[l]=n[l]||YE(e[l],e);c=u(i,s),n[a]=u}else Number.isFinite(o)?(c=o+(e[l]||0),n[a]=null):c=t;return s&&c>=t&&(t=c+1),e[a]=c,c};return r}function EO(t,{moduleParameters:e,target:n,viewport:r}){const i=e&&e.devicePixelRatio||t.canvasContext.cssToDeviceRatio(),[,s]=t.canvasContext.getDrawingBufferSize(),o=n?n.height:s,a=r;return[a.x*i,o-(a.y+a.height)*i,a.width*i,a.height*i]}class wO extends bg{constructor(e,n){super(e,n),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){const n=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],s=i.width*r,o=i.height*r,a=[1,1,1,1];(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,clearColor:a,target:n,pass:"shadow"})}getLayerParameters(e,n,r){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const AO={color:[255,255,255],intensity:1},Dy=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],bO=[0,0,0,200/255];class KE{constructor(e={}){this.id="lighting-effect",this.shadowColor=bO,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:n,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(n),r._addDefaultShaderModule(Ny),this.dummyShadowMap=n.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const r=e[n];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s,moduleParameters:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},n}cleanup(e){for(const n of this.shadowPasses)n.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(Ny))}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const r=new hn().lookAt({eye:new fn(n.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const r=new wO(e);this.shadowPasses[n]=r,this.shadowMaps[n]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:r}=this;!e&&n.length===0&&r.length===0&&(this.ambientLight=new _O(AO),this.directionalLights.push(new Fy(Dy[0]),new Fy(Dy[1])))}}class RO{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:r=1,type:i,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:l}){const c=i||e&&e.constructor||Float32Array,u=n*r+s;if(ArrayBuffer.isView(e)){if(u<=e.length)return e;if(u*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new c(e.buffer,0,u)}let f=1/0;l&&(f=l*r+s);const h=this._allocate(c,u,a,f);return e&&o?h.set(e):a||h.fill(0,0,4),this._release(e),h}release(e){this._release(e)}_allocate(e,n,r,i){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>i&&(s=i);const o=this._pool,a=e.BYTES_PER_ELEMENT*s,l=o.findIndex(c=>c.byteLength>=a);if(l>=0){const c=new e(o.splice(l,1)[0],0,s);return r&&c.fill(0),c}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:r}=e,{byteLength:i}=r,s=n.findIndex(o=>o.byteLength>=i);s<0?n.push(r):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,r),n.length>this.opts.poolSize&&n.shift()}}const ds=new RO;function Zs(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function PO(t){return[t[12],t[13],t[14]]}function CO(t){return{left:fi(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:fi(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:fi(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:fi(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:fi(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:fi(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const By=new fn;function fi(t,e,n,r){By.set(t,e,n);const i=By.len();return{distance:r/i,normal:new fn(-t/i,-e/i,-n/i)}}function xO(t){return t-Math.fround(t)}let Bs;function jf(t,e){const{size:n=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:t.length,s=(i-r)/n;Bs=ds.allocate(Bs,s,{type:Float32Array,size:n*2});let o=r,a=0;for(;o<i;){for(let l=0;l<n;l++){const c=t[o++];Bs[a+l]=c,Bs[a+l+n]=xO(c)}a+=n*2}return Bs.subarray(0,s*n*2)}function IO(t){let e=null,n=!1;for(const r of t)r&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const MO=Math.PI/180,OO=Zs(),Uy=[0,0,0],kO={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function NO({width:t,height:e,orthographic:n,fovyRadians:r,focalDistance:i,padding:s,near:o,far:a}){const l=t/e,c=n?new hn().orthographic({fovy:r,aspect:l,focalDistance:i,near:o,far:a}):new hn().perspective({fovy:r,aspect:l,near:o,far:a});if(s){const{left:u=0,right:f=0,top:h=0,bottom:d=0}=s,m=qn((u+t-f)/2,0,t)-t/2,T=qn((h+e-d)/2,0,e)-e/2;c[8]-=m*2/t,c[9]+=T*2/e}return c}const Yc=class Yc{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||kO,this.focalDistance=e.focalDistance||1,this.position=e.position||Uy,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?an.WEB_MERCATOR:an.WEB_MERCATOR_AUTO_OFFSET:an.IDENTITY}equals(e){return e instanceof Yc?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&zo(e.projectionMatrix,this.projectionMatrix)&&zo(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const r=this.projectPosition(e),i=XE(r,this.pixelProjectionMatrix),[s,o]=i,a=n?o:this.height-o;return e.length===2?[s,a]:[s,a,i[2]]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[i,s,o]=e,a=n?s:this.height-s,l=r&&r*this.distanceScales.unitsPerMeter[2],c=Ag([i,a,o],this.pixelUnprojectionMatrix,l),[u,f,h]=this.unprojectPosition(c);return Number.isFinite(o)?[u,f,h]:Number.isFinite(r)?[u,f,r]:[u,f]}projectPosition(e){const[n,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,r,i]}unprojectPosition(e){const[n,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,r,i]}projectFlat(e){if(this.isGeospatial){const n=Vo(e);return n[1]=qn(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?hs(e):e}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,0],n),i=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(r[0],i[0],s[0],o[0]),Math.min(r[1],i[1],s[1],o[1]),Math.max(r[0],i[0],s[0],o[0]),Math.max(r[1],i[1],s[1],o[1])]}getDistanceScales(e){return e?Fd({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,CO(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=YM({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Fd({latitude:r,longitude:n}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:o}=e;let a=Uy;if(s&&(a=o?new hn(o).transformAsVector(s,[]):s),this.isGeospatial){const l=this.projectPosition([n,r,0]);this.center=new fn(a).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:n=OO,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:s,fovy:o=75,near:a=.1,far:l=1e3,padding:c=null,focalDistance:u=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new hn().multiplyRight(n).translate(new fn(this.center).negate()),this.projectionMatrix=r||NO({width:this.width,height:this.height,orthographic:i,fovyRadians:s||o*MO,focalDistance:u,padding:c,near:a,far:l});const f=Zs();zr(f,f,this.projectionMatrix),zr(f,f,this.viewMatrix),this.viewProjectionMatrix=f,this.viewMatrixInverse=Id([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=PO(this.viewMatrixInverse);const h=Zs(),d=Zs();Sg(h,h,[this.width/2,-this.height/2,1]),Ec(h,h,[1,-1,0]),zr(d,h,this.viewProjectionMatrix),this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=Id(Zs(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Q.warn("Pixel project matrix not invertible")()}};Yc.displayName="Viewport";let bc=Yc;const yo=class yo extends bc{constructor(e={}){const{latitude:n=0,longitude:r=0,zoom:i=0,pitch:s=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:l=1.01,nearZ:c,farZ:u,orthographic:f=!1,projectionMatrix:h,repeat:d=!1,worldOffset:m=0,position:T,padding:A,legacyMeterSizes:g=!1}=e;let{width:p,height:_,altitude:w=1.5}=e;const R=Math.pow(2,i);p=p||1,_=_||1;let x,M=null;if(h)w=h[5]/2,x=Ac(w);else{e.fovy?(x=e.fovy,w=$E(x)):x=Ac(w);let F;if(A){const{top:U=0,bottom:j=0}=A;F=[0,qn((U+_-j)/2,0,_)-_/2]}M=qM({width:p,height:_,scale:R,center:T&&[0,0,T[2]*Rl(n)],offset:F,pitch:s,fovy:x,nearZMultiplier:a,farZMultiplier:l}),Number.isFinite(c)&&(M.near=c),Number.isFinite(u)&&(M.far=u)}let k=KM({height:_,pitch:s,bearing:o,scale:R,altitude:w});m&&(k=new hn().translate([512*m,0,0]).multiplyLeft(k)),super({...e,width:p,height:_,viewMatrix:k,longitude:r,latitude:n,zoom:i,...M,fovy:x,focalDistance:w}),this.latitude=n,this.longitude=r,this.zoom=i,this.pitch=s,this.bearing=o,this.altitude=w,this.fovy=x,this.orthographic=f,this._subViewports=d?[]:null,this._pseudoMeters=g,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=n;i<=r;i++){const s=i?new yo({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,r]=this.projectFlat(e),i=(e[2]||0)*Rl(e[1]);return[n,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,r]=this.unprojectFlat(e),i=(e[2]||0)/Rl(r);return[n,r,i]}addMetersToLngLat(e,n){return HE(e,n)}panByPosition(e,n){const r=Ag(n,this.pixelUnprojectionMatrix),i=this.projectFlat(e),s=Ry([],i,FI([],r)),o=Ry([],this.center,s),[a,l]=this.unprojectFlat(o);return{longitude:a,latitude:l}}getBounds(e={}){const n=JM(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:r,height:i}=this,{longitude:s,latitude:o,zoom:a}=ZM({width:r,height:i,bounds:e,...n});return new yo({width:r,height:i,longitude:s,latitude:o,zoom:a})}};yo.displayName="WebMercatorViewport";let Wo=yo;const Ly=[0,0,0];function Hf(t,e,n=!1){const r=e.projectPosition(t);if(n&&e instanceof Wo){const[i,s,o=0]=t,a=e.getDistanceScales([i,s]);r[2]=o*a.unitsPerMeter[2]}return r}function FO(t){const{viewport:e,modelMatrix:n,coordinateOrigin:r}=t;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return i===te.DEFAULT&&(i=e.isGeospatial?te.LNGLAT:te.CARTESIAN),s===void 0&&(s=i),o===void 0&&(o=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function qE(t,{viewport:e,modelMatrix:n,coordinateSystem:r,coordinateOrigin:i,offsetMode:s}){let[o,a,l=0]=t;switch(n&&([o,a,l]=aa([],[o,a,l,1],n)),r){case te.LNGLAT:return Hf([o,a,l],e,s);case te.LNGLAT_OFFSETS:return Hf([o+i[0],a+i[1],l+(i[2]||0)],e,s);case te.METER_OFFSETS:return Hf(HE(i,[o,a,l]),e,s);case te.CARTESIAN:default:return e.isGeospatial?[o+i[0],a+i[1],l+i[2]]:e.projectPosition([o,a,l])}}function DO(t,e){const{viewport:n,coordinateSystem:r,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=FO(e),{autoOffset:l=!0}=e,{geospatialOrigin:c=Ly,shaderCoordinateOrigin:u=Ly,offsetMode:f=!1}=l?WE(n,r,i):{},h=qE(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:f});if(f){const d=n.projectPosition(c||u);ZI(h,h,d)}return h}let BO=1,UO=1;class ZE{constructor(){v(this,"time",0);v(this,"channels",new Map);v(this,"animations",new Map);v(this,"playing",!1);v(this,"lastEngineTime",-1)}addChannel(e){const{delay:n=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=e,o=BO++,a={time:0,delay:n,duration:r,rate:i,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[n,r]of this.animations)r.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const i of n)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:s,channel:o}=i;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const r=UO++;return this.animations.set(r,{animation:e,channel:n}),e.setTime(this.getTime(n)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const r=n-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}let LO=0;const zO={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:Wi.stats.get(`animation-loop-${LO++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class VO{constructor(e){v(this,"device",null);v(this,"canvas",null);v(this,"props");v(this,"animationProps",null);v(this,"timeline",null);v(this,"stats");v(this,"cpuTime");v(this,"gpuTime");v(this,"frameRate");v(this,"display");v(this,"needsRedraw","initialized");v(this,"_initialized",!1);v(this,"_running",!1);v(this,"_animationFrameId",null);v(this,"_nextFramePromise",null);v(this,"_resolveNextFrame",null);v(this,"_cpuStartTime",0);if(this.props={...zO,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:n=!0}=this.props;this.stats=e.stats||new Mu({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:n}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const n=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(n),n}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=x2(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(I2(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e,n;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:(n=(e=this.device)==null?void 0:e.canvasContext)==null?void 0:n.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:n,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(n);const r=this.props.onAddHTML(n);r&&(n.innerHTML=r)}}_getSizeAndAspect(){var s,o,a,l;if(!this.device)return{width:1,height:1,aspect:1};const[e,n]=((o=(s=this.device)==null?void 0:s.canvasContext)==null?void 0:o.getPixelSize())||[1,1];let r=1;const i=(l=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:l.canvas;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&n>0&&(r=e/n),{width:e,height:n,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,n;this.props.autoResizeDrawingBuffer&&((n=(e=this.device)==null?void 0:e.canvasContext)==null||n.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}class zy{constructor(e){v(this,"id");v(this,"userData",{});v(this,"topology");v(this,"bufferLayout",[]);v(this,"vertexCount");v(this,"indices");v(this,"attributes");this.id=e.id||ni("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&ue(this.indices.usage===_e.INDEX)}destroy(){var e;(e=this.indices)==null||e.destroy();for(const n of Object.values(this.attributes))n.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function WO(t,e){if(e instanceof zy)return e;const n=jO(t,e),{attributes:r,bufferLayout:i}=HO(t,e);return new zy({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:n,attributes:r})}function jO(t,e){if(!e.indices)return;const n=e.indices.value;return t.createBuffer({usage:_e.INDEX,data:n})}function HO(t,e){const n=[],r={};for(const[s,o]of Object.entries(e.attributes)){let a=s;switch(s){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}r[a]=t.createBuffer({data:o.value,id:`${s}-buffer`});const{value:l,size:c,normalized:u}=o;n.push({name:a,format:A2(l,c,u)})}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:n,vertexCount:i}}class $O{constructor(e){v(this,"modules");v(this,"moduleUniforms");v(this,"moduleBindings");v(this,"moduleUniformsChanged");const n=ku(Object.values(e).filter(r=>r.dependencies));for(const r of n)e[r.name]=r;B.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[r,i]of Object.entries(e)){const s=r;this.moduleUniforms[s]=i.defaultUniforms||{},this.moduleBindings[s]={}}}destroy(){}setProps(e){var n;for(const r of Object.keys(e)){const i=r,s=e[i],o=this.modules[i];if(!o){B.warn(`Module ${r} not found`)();continue}const a=this.moduleUniforms[i],l=this.moduleBindings[i],c=((n=o.getUniforms)==null?void 0:n.call(o,s,a))||s,{uniforms:u,bindings:f}=Tg(c);this.moduleUniforms[i]={...a,...u},this.moduleBindings[i]={...l,...f}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const n of Object.values(this.moduleBindings))Object.assign(e,n);return e}getDebugTable(){var n;const e={};for(const[r,i]of Object.entries(this.moduleUniforms))for(const[s,o]of Object.entries(i))e[`${r}.${s}`]={type:(n=this.modules[r].uniformTypes)==null?void 0:n[s],value:String(o)};return e}}const Kc=class Kc{constructor(e){v(this,"device");v(this,"_hashCounter",0);v(this,"_hashes",{});v(this,"_renderPipelineCache",{});v(this,"_computePipelineCache",{});this.device=e}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Kc(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const n={...as.defaultProps,...e},r=this._hashRenderPipeline(n);if(!this._renderPipelineCache[r]){const i=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._renderPipelineCache[r]={pipeline:i,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const n={...yc.defaultProps,...e},r=this._hashComputePipeline(n);if(!this._computePipelineCache[r]){const i=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._computePipelineCache[r]={pipeline:i,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const n=e.hash,r=e instanceof yc?this._computePipelineCache:this._renderPipelineCache;r[n].useCount--,r[n].useCount===0&&(r[n].pipeline.destroy(),delete r[n])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const n=this._getHash(e.vs.source),r=e.fs?this._getHash(e.fs.source):0,i="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${n}/${r}V${i}BL${s}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${n}/${r}V${i}T${e.topology}P${o}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};v(Kc,"defaultProps",{...as.defaultProps});let Dd=Kc;const qc=class qc{constructor(e){v(this,"device");v(this,"_cache",{});this.device=e}static getDefaultShaderFactory(e){var n;return(n=e._lumaData).defaultShaderFactory||(n.defaultShaderFactory=new qc(e)),e._lumaData.defaultShaderFactory}createShader(e){const n=this._hashShader(e);let r=this._cache[n];if(!r){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[n]=r={shader:i,useCount:0}}return r.useCount++,r.shader}release(e){const n=this._hashShader(e),r=this._cache[n];r&&(r.useCount--,r.useCount===0&&(delete this._cache[n],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};v(qc,"defaultProps",{...gc.defaultProps});let Bd=qc;function XO(t,e){var i;const n={},r="Values";if(t.attributes.length===0&&!((i=t.varyings)!=null&&i.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const s of t.attributes)if(s){const o=`${s.location} ${s.name}: ${s.type}`;n[`in ${o}`]={[r]:s.stepMode||"vertex"}}for(const s of t.varyings||[]){const o=`${s.location} ${s.name}`;n[`out ${o}`]={[r]:JSON.stringify(s.accessor)}}return n}let ke=null,$f=null;function YO(t,{id:e,minimap:n,opaque:r,top:i="0",left:s="0",rgbaScale:o=1}){ke||(ke=document.createElement("canvas"),ke.id=e,ke.title=e,ke.style.zIndex="100",ke.style.position="absolute",ke.style.top=i,ke.style.left=s,ke.style.border="blue 1px solid",ke.style.transform="scaleY(-1)",document.body.appendChild(ke),$f=ke.getContext("2d")),(ke.width!==t.width||ke.height!==t.height)&&(ke.width=t.width/2,ke.height=t.height/2,ke.style.width="400px",ke.style.height="400px");const a=t.device.readPixelsToArrayWebGL(t),l=$f.createImageData(t.width,t.height),c=0;for(let u=0;u<a.length;u+=4)l.data[c+u+0]=a[u+0]*o,l.data[c+u+1]=a[u+1]*o,l.data[c+u+2]=a[u+2]*o,l.data[c+u+3]=r?255:a[u+3]*o;$f.putImageData(l,0,0)}const hi=2,KO=1e4,Zc=class Zc{constructor(e,n){v(this,"device");v(this,"id");v(this,"source");v(this,"vs");v(this,"fs");v(this,"pipelineFactory");v(this,"shaderFactory");v(this,"userData",{});v(this,"parameters");v(this,"topology");v(this,"bufferLayout");v(this,"isInstanced");v(this,"instanceCount",0);v(this,"vertexCount");v(this,"indexBuffer",null);v(this,"bufferAttributes",{});v(this,"constantAttributes",{});v(this,"bindings",{});v(this,"uniforms",{});v(this,"vertexArray");v(this,"transformFeedback",null);v(this,"pipeline");v(this,"shaderInputs");v(this,"_uniformStore");v(this,"_attributeInfos",{});v(this,"_gpuGeometry",null);v(this,"_getModuleUniforms");v(this,"props");v(this,"_pipelineNeedsUpdate","newly created");v(this,"_needsRedraw","initializing");v(this,"_destroyed",!1);v(this,"_lastDrawTimestamp",-1);v(this,"_lastLogTime",0);v(this,"_logOpen",!1);v(this,"_drawCount",0);var a,l,c,u;this.props={...Zc.defaultProps,...n},n=this.props,this.id=n.id||ni("model"),this.device=e,Object.assign(this.userData,n.userData);const r=Object.fromEntries(((a=this.props.modules)==null?void 0:a.map(f=>[f.name,f]))||[]);this.setShaderInputs(n.shaderInputs||new $O(r));const i=qO(e),s=(((l=this.props.modules)==null?void 0:l.length)>0?this.props.modules:(c=this.shaderInputs)==null?void 0:c.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(u=this.props).shaderLayout||(u.shaderLayout=dI(this.props.source));const{source:f,getUniforms:h}=this.props.shaderAssembler.assembleShader({platformInfo:i,...this.props,modules:s});this.source=f,this._getModuleUniforms=h}else{const{vs:f,fs:h,getUniforms:d}=this.props.shaderAssembler.assembleShaderPair({platformInfo:i,...this.props,modules:s});this.vs=f,this.fs=h,this._getModuleUniforms=d}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||Dd.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||Bd.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in n&&(this.isInstanced=n.isInstanced),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.vertexCount&&this.setVertexCount(n.vertexCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.uniforms&&this.setUniforms(n.uniforms),n.moduleSettings&&this.updateModuleSettings(n.moduleSettings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){this.predraw();let n;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),dc(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:r}=this.vertexArray,i=r?r.byteLength/(r.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:i,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var r;(r=this._gpuGeometry)==null||r.destroy();const n=e&&WO(this.device,e);n&&(this.setTopology(n.topology||"triangle-list"),this.bufferLayout=Vy(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)),this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?Vy(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Rd(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new w2(this.shaderInputs.modules);for(const n of Object.keys(this.shaderInputs.modules)){const r=this._uniformStore.getManagedUniformBuffer(this.device,n);this.bindings[`${n}Uniforms`]=r}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindings()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,n){e.indices&&B.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[r,i]of Object.entries(e)){const s=this.bufferLayout.find(l=>Wy(l).includes(r));if(!s){B.warn(`Model(${this.id}): Missing layout for buffer "${r}".`)();continue}const o=Wy(s);let a=!1;for(const l of o){const c=this._attributeInfos[l];c&&(this.vertexArray.setBuffer(c.location,i),a=!0)}!a&&!((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)&&B.warn(`Model(${this.id}): Ignoring buffer "${i.id}" for unknown attribute "${r}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,n){for(const[r,i]of Object.entries(e)){const s=this._attributeInfos[r];s?this.vertexArray.setConstantWebGL(s.location,i):((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)||B.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){dc(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){const{bindings:n,uniforms:r}=Tg(this._getModuleUniforms(e));Object.assign(this.bindings,n),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let e=0;for(const n of Object.values(this.bindings))n instanceof pc?e=Math.max(e,n.texture.updateTimestamp):n instanceof _e||n instanceof bt?e=Math.max(e,n.updateTimestamp):n instanceof _c||(e=Math.max(e,n.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const n={...e.attributes};for(const[r]of Object.entries(n))!this.pipeline.shaderLayout.attributes.find(i=>i.name===r)&&r!=="positions"&&delete n[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(n,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,n=null;this.pipeline&&(B.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,n=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let i=null;this.source?i=r:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:r,fs:i}),this._attributeInfos=yE(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),n&&this.shaderFactory.release(n)}return this.pipeline}_logDrawCallStart(){const e=B.level>3?0:KO;B.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,B.group(hi,`>>> DRAWING MODEL ${this.id}`,{collapsed:B.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=XO(this.pipeline.shaderLayout,this.id);B.table(hi,e)();const n=this.shaderInputs.getDebugTable();for(const[i,s]of Object.entries(this.uniforms))n[i]={value:s};B.table(hi,n)();const r=this._getAttributeDebugTable();B.table(hi,this._attributeInfos)(),B.table(hi,r)(),B.groupEnd(hi)(),this._logOpen=!1}}_logFramebuffer(e){const n=B.get("framebuffer");if(this._drawCount++,!n||this._drawCount++>3&&this._drawCount%60)return;const r=e.props.framebuffer;r&&YO(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[n,r]of Object.entries(this._attributeInfos))e[r.location]={name:n,type:r.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[r.location],r.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:n}=this.vertexArray,r=n.indexType==="uint32"?new Uint32Array(n.debugData):new Uint16Array(n.debugData);e.indices={name:"indices",type:n.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,n){const r=SE(n);return(e instanceof _e?new r(e.debugData):e).toString()}};v(Zc,"defaultProps",{...as.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:hc.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Wt=Zc;function Vy(t,e){const n=[...t];for(const r of e){const i=n.findIndex(s=>s.name===r.name);i<0?n.push(r):n[i]=r}return n}function qO(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function Wy(t){var e;return t.attributes?(e=t.attributes)==null?void 0:e.map(n=>n.attribute):[t.name]}class jo{constructor(e,n=Wt.defaultProps){v(this,"device");v(this,"model");v(this,"transformFeedback");ue(jo.isSupported(e),"BufferTransform not yet implemented on WebGPU"),this.device=e,this.model=new Wt(this.device,{id:n.id||"buffer-transform-model",fs:n.fs||bx(),topology:n.topology||"point-list",...n}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:n.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var n;return((n=e==null?void 0:e.info)==null?void 0:n.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){const n=this.device.beginRenderPass(e);this.model.draw(n),n.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const n=this.getBuffer(e);if(n instanceof _e)return n.readAsync();const{buffer:r,byteOffset:i=0,byteLength:s=r.byteLength}=n;return r.readAsync(i,s)}}class ps{constructor(e){v(this,"id");v(this,"topology");v(this,"vertexCount");v(this,"indices");v(this,"attributes");v(this,"userData",{});const{attributes:n={},indices:r=null,vertexCount:i=null}=e;this.id=e.id||ni("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[s,o]of Object.entries(n)){const a=ArrayBuffer.isView(o)?{value:o}:o;ue(ArrayBuffer.isView(a.value),`${this._print(s)}: must be typed array or object with value as typed array`),(s==="POSITION"||s==="positions")&&!a.size&&(a.size=3),s==="indices"?(ue(!this.indices),this.indices=a):this.attributes[s]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,n){return this}_calculateVertexCount(e,n){if(n)return n.value.length;let r=1/0;for(const i of Object.values(e)){const{value:s,size:o,constant:a}=i;!a&&s&&o>=1&&(r=Math.min(r,s.length/o))}return ue(Number.isFinite(r)),r}}const ZO={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class QE extends bg{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:l,width:c,height:u},cullRect:f,effects:h,pass:d="picking",pickZ:m,moduleParameters:T}){this.pickZ=m;const A=this._resetColorEncoder(m),g=[a,l,c,u],p=super.render({target:o,layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,cullRect:f,effects:h==null?void 0:h.filter(w=>w.useInPicking),pass:d,isPicking:!0,moduleParameters:T,clearColor:[0,0,0,0],colorMask:15,scissorRect:g});return this._colorEncoderState=null,{decodePickingColor:A&&JO.bind(null,A),stats:p}}shouldDrawLayer(e){const{pickable:n,operation:r}=e.props;return n&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,n,r){const i={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:s,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?i.blend=!1:s&&o.includes("draw")&&(Object.assign(i,ZO),i.blend=!0,i.blendColor=QO(this._colorEncoderState,e,r)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function QO(t,e,n){const{byLayer:r,byAlpha:i}=t;let s,o=r.get(e);return o?(o.viewports.push(n),s=o.a):(s=r.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},r.set(e,o),i[s]=o):(Q.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function JO(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const pi={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Rc=Symbol.for("component"),ar=Symbol.for("propTypes"),Xf=Symbol.for("deprecatedProps"),$i=Symbol.for("asyncPropDefaults"),Kr=Symbol.for("asyncPropOriginal"),Zn=Symbol.for("asyncPropResolved");function gs(t,e=()=>!0){return Array.isArray(t)?JE(t,e,[]):e(t)?[t]:[]}function JE(t,e,n){let r=-1;for(;++r<t.length;){const i=t[r];Array.isArray(i)?JE(i,e,n):e(i)&&n.push(i)}return n}function GO({target:t,source:e,start:n=0,count:r=1}){const i=e.length,s=r*i;let o=0;for(let a=n;o<i;o++)t[a++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class ek{constructor(e,n,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=uc(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class tk{constructor(e){var n;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(n=e.device)==null?void 0:n.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:r=!1,persistent:i=!0}){let s=this._resources[e];s?s.setData(n,r):(s=new ek(e,n,this._context),this._resources[e]=s),s.persistent=i}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const r in n){const i=n[r],s=this._resources[i.resourceId];s&&s.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:r,requestId:i="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=s[e];if(this._track(r,i,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,r,i){const s=this._consumers,o=s[e]=s[e]||{};let a=o[n];const l=a&&a.resourceId&&this._resources[a.resourceId];l&&(l.unsubscribe(a),this.prune()),r&&(a?(a.onChange=i,a.resourceId=r.id):a={onChange:i,resourceId:r.id},o[n]=a,r.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const nk="layerManager.setLayers",rk="layerManager.activateViewport";class ik{constructor(e,n){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{Ye(rk,this,a),a&&(this.context.viewport=a)};const{deck:r,stats:i,viewport:s,timeline:o}=n||{};this.layers=[],this.resourceManager=new tk({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:hO(),defaultShaderModules:[],renderPass:void 0,stats:i||new Mu({id:"deck.gl"}),viewport:s||new bc({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new ZE,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);n=n||i}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(r=>n.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){Ye(nk,this,n,e),this._lastRenderedLayers=e;const r=gs(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:n}=this.context;n.find(r=>r.name===e.name)||(n.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:n}=this.context,r=n.findIndex(i=>i.name===e.name);r>=0&&(n.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,n,r){r.raiseError(n,`${e} of ${r}`)}_updateLayers(e,n){const r={};for(const o of e)r[o.id]?Q.warn(`Multiple old layers with same id ${o.id}`)():r[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(n,r,i),this._finalizeOldLayers(r);let s=!1;for(const o of i)if(o.hasUniformTransition()){s=`Uniform transition in ${o}`;break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,n,r){for(const i of e){i.context=this.context;const s=n[i.id];s===null&&Q.warn(`Multiple new layers with same id ${i.id}`)(),n[i.id]=null;let o=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),o=i.isComposite?i.getSubLayers():null}catch(a){this._handleError("matching",a,i)}o&&this._updateSublayersRecursively(o,n,r)}}_finalizeOldLayers(e){for(const n in e){const r=e[n];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=pi.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=pi.MATCHED,n!==e&&(e.lifecycle=pi.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=pi.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=pi.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function Bt(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!Bt(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!Bt(t[s],e[s],n-1))return!1;return!0}return!1}class sk{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,r=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,n){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let s=r.length-1;s>=0;--s){const o=r[s];if(o.containsPixel(i)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=gs(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Bt(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Q.warn("missing `viewState` or `initialViewState`")()}_createController(e,n){const r=n.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))==null?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,r,i){const s=e.controller;if(s&&r){const o={...n,...s,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==s.type)&&(i=this._createController(e,o)),i&&i.setProps(o),i}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const s=e[i],o=this.getViewState(s),a=s.makeViewport({viewState:o,width:this.width,height:this.height});let l=n[s.id];const c=!!s.controller;c&&!l&&(r=!0),(r||!c)&&l&&(l.finalize(),l=null),this.controllers[s.id]=this._updateController(s,o,a,l),a&&this._viewports.unshift(a)}for(const i in n){const s=n[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((r,i)=>!e[i].equals(n[i]))}}const ok=/([0-9]+\.?[0-9]*)(%|px)/;function Dn(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=ok.exec(t);if(e&&e.length>=3){const n=e[2]==="%",r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error(`Could not parse position string ${t}`)}}function Bn(t,e){return t.relative?Math.round(t.position*e):t.position}class ak{constructor(e){const{id:n,x:r=0,y:i=0,width:s="100%",height:o="100%",padding:a=null}=e;this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Dn(r),this._y=Dn(i),this._width=Dn(s),this._height=Dn(o),this._padding=a&&{left:Dn(a.left||0),right:Dn(a.right||0),top:Dn(a.top||0),bottom:Dn(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.ViewportType===e.ViewportType&&Bt(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:r}){r=this.filterViewState(r);const i=this.getDimensions({width:e,height:n});return!i.height||!i.width?null:new this.ViewportType({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const r in this.props.viewState)r!=="id"&&(n[r]=this.props.viewState[r]);return n}return e}getDimensions({width:e,height:n}){const r={x:Bn(this._x,e),y:Bn(this._y,n),width:Bn(this._width,e),height:Bn(this._height,n)};return this._padding&&(r.padding={left:Bn(this._padding.left,e),top:Bn(this._padding.top,n),right:Bn(this._padding.right,e),bottom:Bn(this._padding.bottom,n)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Fu{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var n,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(n=this.settings).onStart)==null||r.call(n,this)}end(){var e,n;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(n=(e=this.settings).onEnd)==null||n.call(e,this))}cancel(){var e,n;this._inProgress&&((n=(e=this.settings).onInterrupt)==null||n.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:i}=this;this._handle=r.addChannel({delay:r.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(n=(e=this.settings).onUpdate)==null||n.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const jy=()=>{},Ud={BREAK:1,SNAP_TO_END:2,IGNORE:3},lk=t=>t,ck=Ud.BREAK;class uk{constructor(e){this._onTransitionUpdate=n=>{const{time:r,settings:{interpolator:i,startProps:s,endProps:o,duration:a,easing:l}}=n,c=l(r/a),u=i.interpolateProps(s,o,c);this.propsInTransition=this.getControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Fu(e.timeline),this.onViewStateChange=e.onViewStateChange||jy,this.onStateChange=e.onStateChange||jy}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;i={...r,...s===Ud.SNAP_TO_END?o:this.propsInTransition||r}}this._triggerTransition(i,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:r}=e;return(n>0||n==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===Ud.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const r=this.getControllerState(e),i=this.getControllerState(n).shortestPathFrom(r),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const a=s.initializeProps(e,i);this.propsInTransition={};const l={duration:o,easing:n.transitionEasing||lk,interpolator:s,interruption:n.transitionInterruption||ck,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}function Pe(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class fk{constructor(e){const{compare:n,extract:r,required:i}=e;this._propsToCompare=n,this._propsToExtract=r||n,this._requiredProps=i}arePropsEqual(e,n){for(const r of this._propsToCompare)if(!(r in e)||!(r in n)||!zo(e[r],n[r]))return!1;return!0}initializeProps(e,n){const r={},i={};for(const s of this._propsToExtract)(s in e||s in n)&&(r[s]=e[s],i[s]=n[s]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const r=e[n];Pe(Number.isFinite(r)||Array.isArray(r),`${n} is required for transition`)})}}const hk=["longitude","latitude","zoom","bearing","pitch"],dk=["longitude","latitude","zoom"];class GE extends fk{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:hk,required:dk},super(r.transitionProps),this.opts=r}initializeProps(e,n){const r=super.initializeProps(e,n),{makeViewport:i,around:s}=this.opts;if(i&&s){const o=i(e),a=i(n),l=o.unproject(s);r.start.around=s,Object.assign(r.end,{around:a.project(l),aroundPosition:l,width:n.width,height:n.height})}return r}interpolateProps(e,n,r){const i={};for(const s of this._propsToExtract)i[s]=Sc(e[s]||0,n[s]||0,r);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...i});Object.assign(i,s.panByPosition(n.aroundPosition,Sc(e.around,n.around,r)))}return i}}const Un={transitionDuration:0},pk=300,qa=t=>1-(1-t)*(1-t),di={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Sr={};class gk{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new uk({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const n in this._events)this._events[n]&&((e=this.eventManager)==null||e.off(n,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:r}=this.props,{offsetCenter:i}=e;return[i.x-n,i.y-r]}isPointInBounds(e,n){const{width:r,height:i}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?pk:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:l=!1,keyboard:c=!0}=e,u=!!this.onViewStateChange;this.toggleEvents(di.WHEEL,u&&r),this.toggleEvents(di.PAN,u),this.toggleEvents(di.PINCH,u&&(a||l)),this.toggleEvents(di.TRIPLE_PAN,u&&l),this.toggleEvents(di.DOUBLE_TAP,u&&o),this.toggleEvents(di.KEYBOARD,u&&c),this.scrollZoom=r,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=l,this.keyboard=c}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(r=>{this._events[r]!==n&&(this._events[r]=n,n?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,n=null,r={}){const i={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:n});return this._panMove=r,this.updateViewport(i,Un,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),r=this.controllerState.pan({pos:n});return this.updateViewport(r,Un,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:qa},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),r=this.controllerState.rotate({pos:n});return this.updateViewport(r,Un,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:qa},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*r)));s<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.rotateStart({pos:n});return this.updateViewport(r,Un,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const r=this.controllerState.rotate({pos:n});return this.updateViewport(r,Un,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:qa},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return Sr._startPinchRotation=e.rotation,Sr._lastPinchEvent=e,this.updateViewport(r,Un,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);n=n.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;n=n.rotate({deltaAngleX:Sr._startPinchRotation-r})}return this.updateViewport(n,Un,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Sr._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:r}=Sr;if(this.touchZoom&&n&&r&&e.scale!==r.scale){const i=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),l=Math.pow(2,o+a*n/2);s=s.zoom({pos:i,scale:l}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:n,transitionEasing:qa},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Sr._startPinchRotation=null,Sr._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:n,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let l;const c={};switch(e.srcEvent.code){case"Minus":l=n?a.zoomOut(r).zoomOut(r):a.zoomOut(r),c.isZooming=!0;break;case"Equal":l=n?a.zoomIn(r).zoomIn(r):a.zoomIn(r),c.isZooming=!0;break;case"ArrowLeft":n?(l=a.rotateLeft(s),c.isRotating=!0):(l=a.moveLeft(i),c.isPanning=!0);break;case"ArrowRight":n?(l=a.rotateRight(s),c.isRotating=!0):(l=a.moveRight(i),c.isPanning=!0);break;case"ArrowUp":n?(l=a.rotateUp(o),c.isRotating=!0):(l=a.moveUp(i),c.isPanning=!0);break;case"ArrowDown":n?(l=a.rotateDown(o),c.isRotating=!0):(l=a.moveDown(i),c.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),c),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?Un:e?{...n,transitionInterpolator:new GE({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class _k{constructor(e,n){this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Hy=5,mk=1.2;class yk extends _k{constructor(e){const{width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a=0,pitch:l=0,altitude:c=1.5,position:u=[0,0,0],maxZoom:f=20,minZoom:h=0,maxPitch:d=60,minPitch:m=0,startPanLngLat:T,startZoomLngLat:A,startRotatePos:g,startBearing:p,startPitch:_,startZoom:w,normalize:R=!0}=e;Pe(Number.isFinite(s)),Pe(Number.isFinite(i)),Pe(Number.isFinite(o)),super({width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a,pitch:l,altitude:c,maxZoom:f,minZoom:h,maxPitch:d,minPitch:m,normalize:R,position:u},{startPanLngLat:T,startZoomLngLat:A,startRotatePos:g,startBearing:p,startPitch:_,startZoom:w}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:s,startPitch:o}=this.getState();if(!i||s===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,i,o,s):a={bearing:s+n,pitch:o+r},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomLngLat:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let l=i+Math.log2(r);l=qn(l,a,o);const c=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...c.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:s}=r;return Math.abs(i-n.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(s-n.longitude)>180&&(r.longitude=s<0?s+360:s-360),r}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i}=e;e.zoom=qn(i,r,n);const{maxPitch:s,minPitch:o,pitch:a}=e;e.pitch=qn(a,o,s);const{normalize:l=!0}=e;return l&&Object.assign(e,GM(e)),e}_zoomFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.zoom({pos:[n/2,r/2],scale:e})}_panFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.pan({startPos:[n/2,r/2],pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,r,i){const s=e[0]-n[0],o=e[1]-n[1],a=e[1],l=n[1],{width:c,height:u}=this.getViewportProps(),f=s/c;let h=0;o>0?Math.abs(u-l)>Hy&&(h=o/(l-u)*mk):o<0&&l>Hy&&(h=1-a/l),h=qn(h,-1,1);const{minPitch:d,maxPitch:m}=this.getViewportProps(),T=i+180*f;let A=r;return h>0?A=r+h*(m-r):h<0&&(A=r-h*(d-r)),{pitch:A,bearing:T}}}class vk extends gk{constructor(){super(...arguments),this.ControllerState=yk,this.transition={transitionDuration:300,transitionInterpolator:new GE({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}const Ng=class Ng extends ak{constructor(e={}){super(e)}get ViewportType(){return Wo}get ControllerType(){return vk}};Ng.displayName="MapView";let Pc=Ng;const Tk=new KE;function Sk(t,e){const n=t.order??1/0,r=e.order??1/0;return n-r}class Ek{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(r=>r.id===e.id)){const r=n.findIndex(i=>Sk(i,e)>0);r<0?n.push(e):n.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Bt(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const i of this.effects)n[i.id]=i;const r=[];for(const i of e){const s=n[i.id];let o=i;s&&s!==i?s.setProps?(s.setProps(i.props),o=s):s.cleanup(this._context):s||i.setup(this._context),r.push(o),delete n[i.id]}for(const i in n)n[i].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof KE)||this._resolvedEffects.push(Tk),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class wk extends bg{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const Ak="deckRenderer.renderLayers";class bk{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new wk(e),this.pickLayersPass=new QE(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const s=n.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,Ye(Ak,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const r of e)n.preRenderStats[r.id]=r.preRender(n),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,n=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[i]}))});for(const r of e)r.resize(n)}_postRender(e,n){const{renderBuffers:r}=this,i={...n,inputBuffer:r[0],swapBuffer:r[1]};for(const s of e)if(s.postRender){i.target=s.id===this.lastPostProcessEffect?n.target:void 0;const o=s.postRender(i);i.inputBuffer=o,i.swapBuffer=o===r[0]?r[1]:r[0]}}}const Rk={pickedColor:null,pickedObjectIndex:-1};function Pk({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:r,deviceRadius:i,deviceRect:s}){const{x:o,y:a,width:l,height:c}=s;let u=i*i,f=-1,h=0;for(let d=0;d<c;d++){const m=d+a-r,T=m*m;if(T>u)h+=4*l;else for(let A=0;A<l;A++){if(t[h+3]-1>=0){const p=A+o-n,_=p*p+T;_<=u&&(u=_,f=h)}h+=4}}if(f>=0){const d=t.slice(f,f+4),m=e(d);if(m){const T=Math.floor(f/4/l),A=f/4-T*l;return{...m,pickedColor:d,pickedX:o+A,pickedY:a+T}}Q.error("Picked non-existent layer. Is picking buffer corrupt?")()}return Rk}function Ck({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const s=t.slice(r,r+4),o=s.join(",");if(!n.has(o)){const a=e(s);a?n.set(o,{...a,color:s}):Q.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function ew({pickInfo:t,viewports:e,pixelRatio:n,x:r,y:i,z:s}){let o=e[0];e.length>1&&(o=Ik((t==null?void 0:t.pickedViewports)||e,{x:r,y:i}));let a;if(o){const l=[r-o.x,i-o.y];s!==void 0&&(l[2]=s),a=o.unproject(l)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function xk(t){const{pickInfo:e,lastPickedInfo:n,mode:r,layers:i}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,l=o?[o]:[];if(r==="hover"){const f=n.index,h=n.layerId,d=o?o.props.id:null;if(d!==h||a!==f){if(d!==h){const m=i.find(T=>T.props.id===h);m&&l.unshift(m)}n.layerId=d,n.index=a,n.info=null}}const c=ew(t),u=new Map;return u.set(null,c),l.forEach(f=>{let h={...c};f===o&&(h.color=s,h.index=a,h.picked=!0),h=tw({layer:f,info:h,mode:r});const d=h.layer;f===o&&r==="hover"&&(n.info=h),u.set(d.id,h),r==="hover"&&d.updateAutoHighlight(h)}),u}function tw({layer:t,info:e,mode:n}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:r}),t=t.parent}return e}function Ik(t,e){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.containsPixel(e))return r}return t[0]}class Mk{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new QE(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:r,viewports:i},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,l=o?r.find(h=>h.id===o):null,c=a&&i.find(h=>h.id===a)||i[0],u=c&&c.unproject([e-c.x,n-c.y]);return{...s,...{x:e,y:n,viewport:c,coordinate:u,layer:l}}}_resizeBuffer(){var n,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const i=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=i}const{canvas:e}=this.device.getCanvasContext();(n=this.pickingFBO)==null||n.resize({width:e.width,height:e.height}),(r=this.depthFBO)==null||r.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:r,x:i,y:s,radius:o=0,depth:a=1,mode:l="query",unproject3D:c,onViewportActive:u,effects:f}){const h=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(e);if(!d||r.length===0)return{result:[],emptyInfo:ew({viewports:r,x:i,y:s,pixelRatio:h})};this._resizeBuffer();const m=this.device.canvasContext.cssToDevicePixels([i,s],!0),T=[m.x+Math.floor(m.width/2),m.y+Math.floor(m.height/2)],A=Math.round(o*h),{width:g,height:p}=this.pickingFBO,_=this._getPickingRect({deviceX:T[0],deviceY:T[1],deviceRadius:A,deviceWidth:g,deviceHeight:p}),w={x:i-o,y:s-o,width:o*2+1,height:o*2+1};let R;const x=[],M=new Set;for(let k=0;k<a;k++){let F;if(_){const j=this._drawAndSample({layers:d,views:n,viewports:r,onViewportActive:u,deviceRect:_,cullRect:w,effects:f,pass:`picking:${l}`});F=Pk({...j,deviceX:T[0],deviceY:T[1],deviceRadius:A,deviceRect:_})}else F={pickedColor:null,pickedObjectIndex:-1};let U;if(F.pickedLayer&&c&&this.depthFBO){const{pickedColors:j}=this._drawAndSample({layers:[F.pickedLayer],views:n,viewports:r,onViewportActive:u,deviceRect:{x:F.pickedX,y:F.pickedY,width:1,height:1},cullRect:w,effects:f,pass:`picking:${l}:z`},!0);j[3]&&(U=j[0])}F.pickedLayer&&k+1<a&&(M.add(F.pickedLayer),F.pickedLayer.disablePickingIndex(F.pickedObjectIndex)),R=xk({pickInfo:F,lastPickedInfo:this.lastPickedInfo,mode:l,layers:d,viewports:r,x:i,y:s,z:U,pixelRatio:h});for(const j of R.values())j.layer&&x.push(j);if(!F.pickedColor)break}for(const k of M)k.restorePickingColors();return{result:x,emptyInfo:R.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:r,x:i,y:s,width:o=1,height:a=1,mode:l="query",maxObjects:c=null,onViewportActive:u,effects:f}){const h=this._getPickable(e);if(!h||r.length===0)return[];this._resizeBuffer();const d=this.device.canvasContext.cssToDeviceRatio(),m=this.device.canvasContext.cssToDevicePixels([i,s],!0),T=m.x,A=m.y+m.height,g=this.device.canvasContext.cssToDevicePixels([i+o,s+a],!0),p=g.x+g.width,_=g.y,w={x:T,y:_,width:p-T,height:A-_},R=this._drawAndSample({layers:h,views:n,viewports:r,onViewportActive:u,deviceRect:w,cullRect:{x:i,y:s,width:o,height:a},effects:f,pass:`picking:${l}`}),x=Ck(R),M=new Map,k=[],F=Number.isFinite(c);for(let U=0;U<x.length&&!(F&&k.length>=c);U++){const j=x[U];let X={color:j.pickedColor,layer:null,index:j.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:d};X=tw({layer:j.pickedLayer,info:X,mode:l});const $=X.layer.id;M.has($)||M.set($,new Set);const K=M.get($),je=X.object??X.index;K.has(je)||(K.add(je),k.push(X))}return k}_drawAndSample({layers:e,views:n,viewports:r,onViewportActive:i,deviceRect:s,cullRect:o,effects:a,pass:l},c=!1){const u=c?this.depthFBO:this.pickingFBO,f={layers:e,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:i,pickingFBO:u,deviceRect:s,cullRect:o,effects:a,pass:l,pickZ:c,preRenderStats:{}};for(const p of a)p.useInPicking&&(f.preRenderStats[p.id]=p.preRender(f));const{decodePickingColor:h}=this.pickLayersPass.render(f),{x:d,y:m,width:T,height:A}=s,g=new(c?Float32Array:Uint8Array)(T*A*4);return this.device.readPixelsToArrayWebGL(u,{sourceX:d,sourceY:m,sourceWidth:T,sourceHeight:A,target:g}),{pickedColors:g,decodePickingColor:h}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:r,deviceWidth:i,deviceHeight:s}){const o=Math.max(0,e-r),a=Math.max(0,n-r),l=Math.min(i,e+r+1)-o,c=Math.min(s,n+r+1)-a;return l<=0||c<=0?null:{x:o,y:a,width:l,height:c}}}const Ok={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},kk="top-left",$y="__root";class Nk{constructor({deck:e,parentElement:n}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=n}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Bt(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(n=>n.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const n={};for(const r of this.resolvedWidgets)n[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)n[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const i=n[r.id];i?i.viewId!==r.viewId||i.placement!==r.placement?(this._remove(i),this._add(r)):r!==i&&(i.setProps(r.props),r=i):this._add(r),n[r.id]=null,this.resolvedWidgets.push(r)}for(const r in n){const i=n[r];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:n=null,placement:r=kk}=e,i=e.onAdd({deck:this.deck,viewId:n});i&&this._getContainer(n,r).append(i),e._element=i}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,n){var o;const r=e||$y;let i=this.containers[r];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",(o=this.parentElement)==null||o.append(i),this.containers[r]=i);let s=i.querySelector(`.${n}`);return s||(s=document.createElement("div"),s.className=n,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,Ok[n]),i.append(s)),s}_updateContainers(){const e=this.deck.width,n=this.deck.height;for(const r in this.containers){const i=this.lastViewports[r]||null,s=r===$y||i,o=this.containers[r];s?(o.style.display="block",o.style.left=`${i?i.x:0}px`,o.style.top=`${i?i.y:0}px`,o.style.width=`${i?i.width:e}px`,o.style.height=`${i?i.height:n}px`):o.style.display="none"}}onRedraw({viewports:e,layers:n}){var s,o;const r=e.reduce((a,l)=>(a[l.id]=l,a),{}),{lastViewports:i}=this;for(const a of this.getWidgets()){const{viewId:l}=a;if(l){const c=r[l];c&&(a.onViewportChange&&!c.equals(i[l])&&a.onViewportChange(c),(s=a.onRedraw)==null||s.call(a,{viewports:[c],layers:n}))}else{if(a.onViewportChange)for(const c of e)c.equals(i[c.id])||a.onViewportChange(c);(o=a.onRedraw)==null||o.call(a,{viewports:e,layers:n})}}this.lastViewports=r,this._updateContainers()}onHover(e,n){var r,i;for(const s of this.getWidgets()){const{viewId:o}=s;(!o||o===((r=e.viewport)==null?void 0:r.id))&&((i=s.onHover)==null||i.call(s,e,n))}}onEvent(e,n){var i,s;const r=Od[n.type];if(r)for(const o of this.getWidgets()){const{viewId:a}=o;(!a||a===((i=e.viewport)==null?void 0:i.id))&&((s=o[r.handler])==null||s.call(o,e,n))}}}const Fk={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class Dk{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const n=document.createElement("div");return n.className="deck-tooltip",Object.assign(n.style,Fk),this.deck=e,this.element=n,n}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var n;this.isVisible&&e.id===((n=this.lastViewport)==null?void 0:n.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:n}=this,r=n&&n.props.getTooltip;if(!r)return;const i=r(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,n,r){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${n}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}var xi;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(xi||(xi={}));const Rg={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},be=(t,e,n)=>e?t.enable(n):t.disable(n),Xy=(t,e,n)=>t.hint(n,e),ft=(t,e,n)=>t.pixelStorei(n,e),Yy=(t,e,n)=>{const r=n===36006?36009:36008;return t.bindFramebuffer(r,e)},Us=(t,e,n)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];t.bindBuffer(i,e)};function Yf(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const Bk={3042:be,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:be,2885:(t,e)=>t.cullFace(e),2929:be,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:be,35723:Xy,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var n;return(n=t.bindTransformFeedback)==null?void 0:n.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:Yy,36010:Yy,34964:Us,36662:Us,36663:Us,35053:Us,35055:Us,2886:(t,e)=>t.frontFace(e),33170:Xy,2849:(t,e)=>t.lineWidth(e),32823:be,32824:"polygonOffset",10752:"polygonOffset",35977:be,32926:be,32928:be,32938:"sampleCoverage",32939:"sampleCoverage",3089:be,3088:(t,e)=>t.scissor(...e),2960:be,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:be,10754:be,12288:be,12289:be,12290:be,12291:be,12292:be,12293:be,12294:be,12295:be,3333:ft,3317:ft,37440:ft,37441:ft,37443:ft,3330:ft,3332:ft,3331:ft,3314:ft,32878:ft,3316:ft,3315:ft,32877:ft,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const n=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...n)},blendFunc:(t,e)=>{const n=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...n)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Yf(e)?e:[e,e];const[n,r]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=Yf(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilFuncSeparate(1028,n,r,i),t.stencilFuncSeparate(1029,s,o,a)},stencilOp:(t,e)=>{e=Yf(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilOpSeparate(1028,n,r,i),t.stencilOpSeparate(1029,s,o,a)},viewport:(t,e)=>t.viewport(...e)};function Ee(t,e,n){return e[t]!==void 0?e[t]:n[t]}const Uk={blendEquation:(t,e,n)=>t.blendEquationSeparate(Ee(32777,e,n),Ee(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(Ee(32969,e,n),Ee(32968,e,n),Ee(32971,e,n),Ee(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(Ee(32824,e,n),Ee(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(Ee(32938,e,n),Ee(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,Ee(2962,e,n),Ee(2967,e,n),Ee(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,Ee(34816,e,n),Ee(36003,e,n),Ee(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,Ee(2964,e,n),Ee(2965,e,n),Ee(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,Ee(34817,e,n),Ee(34818,e,n),Ee(34819,e,n))},Ky={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,n)=>t({36007:n}),bindTransformFeedback:(t,e,n)=>t({36389:n}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},bindBuffer:(t,e,n)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?t({[r]:n}):{valueChanged:!0}},blendColor:(t,e,n,r,i)=>t({32773:new Float32Array([e,n,r,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,r,i)=>t({32969:e,32968:n,32971:r,32970:i}),clearColor:(t,e,n,r,i)=>t({3106:new Float32Array([e,n,r,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,r,i)=>t({3107:[e,n,r,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,r,i)=>t({3088:new Int32Array([e,n,r,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,r)=>t({2962:e,2967:n,2963:r,34816:e,36003:n,36004:r}),stencilFuncSeparate:(t,e,n,r,i)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(t,e,n,r)=>t({2964:e,2965:n,2966:r,34817:e,34818:n,34819:r}),stencilOpSeparate:(t,e,n,r,i)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(t,e,n,r,i)=>t({2978:[e,n,r,i]})},Jt=(t,e)=>t.isEnabled(e),qy={3042:Jt,2884:Jt,2929:Jt,3024:Jt,32823:Jt,32926:Jt,32928:Jt,3089:Jt,2960:Jt,35977:Jt},Lk=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Ss(t,e){if(Vk(e))return;const n={};for(const i in e){const s=Number(i),o=Bk[i];o&&(typeof o=="string"?n[o]=!0:o(t,e[i],s))}const r=t.state&&t.state.cache;if(r)for(const i in n){const s=Uk[i];s(t,e,r)}}function nw(t,e=Rg){if(typeof e=="number"){const i=e,s=qy[i];return s?s(t,i):t.getParameter(i)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const i of n){const s=qy[i];r[i]=s?s(t,Number(i)):t.getParameter(Number(i))}return r}function zk(t){Ss(t,Rg)}function Vk(t){for(const e in t)return!1;return!0}function Wk(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&r&&t.length===e.length){for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}return!1}class jk{constructor(e,{copyState:n=!1,log:r=()=>{}}={}){v(this,"gl");v(this,"program",null);v(this,"stateStack",[]);v(this,"enable",!0);v(this,"cache");v(this,"log");this.gl=e,this.cache=n?nw(e):Object.assign({},Rg),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){ue(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Ss(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,r;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){ue(s!==void 0);const o=e[s],a=this.cache[s];Wk(o,a)||(n=!0,r=a,i&&!(s in i)&&(i[s]=a),this.cache[s]=o)}return{valueChanged:n,oldValue:r}}}function qr(t){return t.state}function rw(t,e){const{enable:n=!0,copyState:r}=e;if(ue(r!==void 0),!t.state){t.state=new jk(t,{copyState:r}),$k(t);for(const s in Ky){const o=Ky[s];Hk(t,s,o)}Zy(t,"getParameter"),Zy(t,"isEnabled")}const i=qr(t);return i.enable=n,t}function Du(t){let e=qr(t);e||(rw(t,{copyState:!1}),e=qr(t)),e.push()}function Ho(t){const e=qr(t);ue(e),e.pop()}function Zy(t,e){const n=t[e].bind(t);t[e]=function(i){if(i===void 0||Lk.has(i))return n(i);const s=qr(t);return i in s.cache||(s.cache[i]=n(i)),s.enable?s.cache[i]:n(i)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function Hk(t,e,n){if(!t[e])return;const r=t[e].bind(t);t[e]=function(...s){const o=qr(t),{valueChanged:a,oldValue:l}=n(o._updateCache,...s);return a&&r(...s),l},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function $k(t){const e=t.useProgram.bind(t);t.useProgram=function(r){const i=qr(t);i.program!==r&&(e(r),i.program=r)}}const Xk={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function Yk(t,e){e={...Xk,...e};let n=null;const r=s=>n=s.statusMessage||n;t.addEventListener("webglcontextcreationerror",r,!1);let i=null;if(i||(i=t.getContext("webgl2",e)),t.removeEventListener("webglcontextcreationerror",r,!1),!i)throw new Error(`Failed to create WebGL context: ${n||"Unknown error"}`);if(e.onContextLost){const{onContextLost:s}=e;t.addEventListener("webglcontextlost",o=>s(o),!1)}if(e.onContextRestored){const{onContextRestored:s}=e;t.addEventListener("webglcontextrestored",o=>s(o),!1)}return i}function hr(t,e,n){return n[e]===void 0&&(n[e]=t.getExtension(e)||null),n[e]}function Kk(t,e){const n=t.getParameter(7936),r=t.getParameter(7937);hr(t,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,s=t.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),o=t.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),a=s||n,l=o||r,c=t.getParameter(7938),u=iw(a,l),f=qk(a,l),h=Zk(a,l);return{type:"webgl",gpu:u,gpuType:h,gpuBackend:f,vendor:a,renderer:l,version:c,shadingLanguage:"glsl",shadingLanguageVersion:300}}function iw(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function qk(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function Zk(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(iw(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function sw(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const Xe="texture-compression-bc",oe="texture-compression-astc",Gt="texture-compression-etc2",Qk="texture-compression-etc1-webgl",Za="texture-compression-pvrtc-webgl",Kf="texture-compression-atc-webgl",Ls="float32-renderable-webgl",qf="float16-renderable-webgl",Jk="rgb9e5ufloat_renderable-webgl",Zf="snorm8-renderable-webgl",zs="norm16-renderable-webgl",Qf="snorm16-renderable-webgl",Qa="float32-filterable",Qy="float16-filterable-webgl",Qs="WEBGL_compressed_texture_s3tc",Js="WEBGL_compressed_texture_s3tc_srgb",Ii="EXT_texture_compression_rgtc",Mi="EXT_texture_compression_bptc",Gk="WEBGL_compressed_texture_etc",eN="WEBGL_compressed_texture_astc",tN="WEBGL_compressed_texture_etc1",nN="WEBGL_compressed_texture_pvrtc",rN="WEBGL_compressed_texture_atc",Jy="EXT_texture_norm16",Gy="EXT_render_snorm",iN="EXT_color_buffer_float",Pg={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[Gy],"norm16-renderable-webgl":[Jy],"snorm16-renderable-webgl":[Jy,Gy],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Qs,Js,Ii,Mi],"texture-compression-bc5-webgl":[Ii],"texture-compression-bc7-webgl":[Mi],"texture-compression-etc2":[Gk],"texture-compression-astc":[eN],"texture-compression-etc1-webgl":[tN],"texture-compression-pvrtc-webgl":[nN],"texture-compression-atc-webgl":[rN]};function sN(t){return t in Pg}function oN(t,e,n){return(Pg[e]||[]).every(i=>hr(t,i,n))}const Bu={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:Zf},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:Zf},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:qf,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:zs,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:Qf},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:Zf},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:qf,filter:Qy,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:zs},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:Qf},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:Ls,filter:Qa},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:Jk},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:Ls,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:zs},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:zs},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:Ls,filter:Qa,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:qf,filter:Qy},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:zs,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:Qf},"rgb32float-webgl":{gl:34837,render:Ls,filter:Qa,gl2ext:iN,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:Ls,filter:Qa,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Qs,f:Xe},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Js,f:Xe},"bc1-rgba-unorm":{gl:33777,x:Qs,f:Xe},"bc1-rgba-unorm-srgb":{gl:35916,x:Js,f:Xe},"bc2-rgba-unorm":{gl:33778,x:Qs,f:Xe},"bc2-rgba-unorm-srgb":{gl:35918,x:Js,f:Xe},"bc3-rgba-unorm":{gl:33779,x:Qs,f:Xe},"bc3-rgba-unorm-srgb":{gl:35919,x:Js,f:Xe},"bc4-r-unorm":{gl:36283,x:Ii,f:Xe},"bc4-r-snorm":{gl:36284,x:Ii,f:Xe},"bc5-rg-unorm":{gl:36285,x:Ii,f:Xe},"bc5-rg-snorm":{gl:36286,x:Ii,f:Xe},"bc6h-rgb-ufloat":{gl:36495,x:Mi,f:Xe},"bc6h-rgb-float":{gl:36494,x:Mi,f:Xe},"bc7-rgba-unorm":{gl:36492,x:Mi,f:Xe},"bc7-rgba-unorm-srgb":{gl:36493,x:Mi,f:Xe},"etc2-rgb8unorm":{gl:37492,f:Gt},"etc2-rgb8unorm-srgb":{gl:37494,f:Gt},"etc2-rgb8a1unorm":{gl:37496,f:Gt},"etc2-rgb8a1unorm-srgb":{gl:37497,f:Gt},"etc2-rgba8unorm":{gl:37493,f:Gt},"etc2-rgba8unorm-srgb":{gl:37495,f:Gt},"eac-r11unorm":{gl:37488,f:Gt},"eac-r11snorm":{gl:37489,f:Gt},"eac-rg11unorm":{gl:37490,f:Gt},"eac-rg11snorm":{gl:37491,f:Gt},"astc-4x4-unorm":{gl:37808,f:oe},"astc-4x4-unorm-srgb":{gl:37840,f:oe},"astc-5x4-unorm":{gl:37809,f:oe},"astc-5x4-unorm-srgb":{gl:37841,f:oe},"astc-5x5-unorm":{gl:37810,f:oe},"astc-5x5-unorm-srgb":{gl:37842,f:oe},"astc-6x5-unorm":{gl:37811,f:oe},"astc-6x5-unorm-srgb":{gl:37843,f:oe},"astc-6x6-unorm":{gl:37812,f:oe},"astc-6x6-unorm-srgb":{gl:37844,f:oe},"astc-8x5-unorm":{gl:37813,f:oe},"astc-8x5-unorm-srgb":{gl:37845,f:oe},"astc-8x6-unorm":{gl:37814,f:oe},"astc-8x6-unorm-srgb":{gl:37846,f:oe},"astc-8x8-unorm":{gl:37815,f:oe},"astc-8x8-unorm-srgb":{gl:37847,f:oe},"astc-10x5-unorm":{gl:37819,f:oe},"astc-10x5-unorm-srgb":{gl:37851,f:oe},"astc-10x6-unorm":{gl:37817,f:oe},"astc-10x6-unorm-srgb":{gl:37849,f:oe},"astc-10x8-unorm":{gl:37818,f:oe},"astc-10x8-unorm-srgb":{gl:37850,f:oe},"astc-10x10-unorm":{gl:37819,f:oe},"astc-10x10-unorm-srgb":{gl:37851,f:oe},"astc-12x10-unorm":{gl:37820,f:oe},"astc-12x10-unorm-srgb":{gl:37852,f:oe},"astc-12x12-unorm":{gl:37821,f:oe},"astc-12x12-unorm-srgb":{gl:37853,f:oe},"pvrtc-rgb4unorm-webgl":{gl:35840,f:Za},"pvrtc-rgba4unorm-webgl":{gl:35842,f:Za},"pvrtc-rbg2unorm-webgl":{gl:35841,f:Za},"pvrtc-rgba2unorm-webgl":{gl:35843,f:Za},"etc1-rbg-unorm-webgl":{gl:36196,f:Qk},"atc-rgb-unorm-webgl":{gl:35986,f:Kf},"atc-rgba-unorm-webgl":{gl:35986,f:Kf},"atc-rgbai-unorm-webgl":{gl:34798,f:Kf}},aN={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},lN={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function Cg(t,e,n){const r=Bu[e];if(!r||r.gl===void 0)return!1;const i=r.x||r.gl2ext;return i?!!hr(t,i,n):!0}function ow(t){const e=Bu[t],n=e==null?void 0:e.gl;if(n===void 0)throw new Error(`Unsupported texture format ${t}`);return n}function cN(t,e,n){if(!Cg(t,e,n)||e.startsWith("depth")||e.startsWith("stencil"))return!1;try{if(pE(e).signed)return!1}catch{return!1}return e.endsWith("32float")?!!hr(t,"OES_texture_float_linear, extensions",n):e.endsWith("16float")?!!hr(t,"OES_texture_half_float_linear, extensions",n):!0}function uN(t,e,n){return!(!Cg(t,e,n)||typeof e=="number")}function Cc(t){var i;const e=Bu[t],n=ow(t),r=pE(t);return{format:n,dataFormat:(e==null?void 0:e.dataFormat)||hN(r.format,r.integer,r.normalized,n),type:r.dataType?sw(r.dataType):((i=e==null?void 0:e.types)==null?void 0:i[0])||5121,compressed:r.compressed}}function fN(t){const e=Bu[t];if(!(e!=null&&e.attachment))throw new Error(`${t} is not a depth stencil format`);return e.attachment}function e0(t){const e=Cc(t),n=aN[e.dataFormat]||4,r=lN[e.type]||1;return n*r}function hN(t,e,n,r){if(r===6408||r===6407)return r;switch(t){case"r":return e&&!n?36244:6403;case"rg":return e&&!n?33320:33319;case"rgb":return e&&!n?36248:6407;case"rgba":return e&&!n?36249:6408;default:return 6408}}const t0={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class dN extends Vx{constructor(n,r,i){super([],i);v(this,"gl");v(this,"extensions");v(this,"testedFeatures",new Set);this.gl=n,this.extensions=r,hr(n,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const n=this.getFeatures();for(const r of n)this.has(r)&&(yield r);return[]}has(n){return this.disabledFeatures[n]?!1:(this.testedFeatures.has(n)||(this.testedFeatures.add(n),sN(n)&&oN(this.gl,n,this.extensions)&&this.features.add(n),this.getWebGLFeature(n)&&this.features.add(n)),this.features.has(n))}initializeFeatures(){const n=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of n)this.has(r)}getFeatures(){return[...Object.keys(t0),...Object.keys(Pg)]}getWebGLFeature(n){const r=t0[n];return typeof r=="string"?!!hr(this.gl,r,this.extensions):!!r}}class pN extends zx{constructor(n){super();v(this,"gl");v(this,"limits",{});this.gl=n}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(n){return this.limits[n]===void 0&&(this.limits[n]=this.gl.getParameter(n)),this.limits[n]}}function Qn(t,e,n){if(gN(e))return n(t);const{nocatch:r=!0}=e;Du(t),Ss(t,e);let i;if(r)i=n(t),Ho(t);else try{i=n(t)}finally{Ho(t)}return i}function gN(t){for(const e in t)return!1;return!0}function _N(t,e,n,r){if(dc(e))return r(t);const i=t;Du(i.gl);try{return mN(t,e),Ss(i.gl,n),r(t)}finally{Ho(i.gl)}}function mN(t,e){const n=t,{gl:r}=n;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(Vr("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const s=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=Vr("provokingVertex",e.provokingVertex,{first:36429,last:36430});s==null||s.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=Vr("polygonMode",e.polygonMode,{fill:6914,line:6913});s==null||s.polygonModeWEBGL(1028,o),s==null||s.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&r.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(vN("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(Ld("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;r.stencilMaskSeparate(1028,i),r.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&B.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,s=Ld("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,s,0,i),r.stencilFuncSeparate(1029,s,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=Jf("stencilPassOperation",e.stencilPassOperation),s=Jf("stencilFailOperation",e.stencilFailOperation),o=Jf("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,s,o,i),r.stencilOpSeparate(1029,s,o,i)}if(e.blendColorOperation||e.blendAlphaOperation){r.enable(3042);const i=n0("blendColorOperation",e.blendColorOperation||"add"),s=n0("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(i,s);const o=Ja("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=Ja("blendColorDstFactor",e.blendColorDstFactor||"zero"),l=Ja("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),c=Ja("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(o,a,l,c)}}function Ld(t,e){return Vr(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Jf(t,e){return Vr(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function n0(t,e){return Vr(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Ja(t,e){return Vr(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function yN(t,e){return`Illegal parameter ${e} for ${t}`}function Vr(t,e,n){if(!(e in n))throw new Error(yN(t,e));return n[e]}function vN(t,e){return e}function aw(t){const e={};return t.addressModeU&&(e[10242]=Gf(t.addressModeU)),t.addressModeV&&(e[10243]=Gf(t.addressModeV)),t.addressModeW&&(e[32882]=Gf(t.addressModeW)),t.magFilter&&(e[10240]=lw(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=TN(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=Ld("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function Gf(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function lw(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function TN(t,e){if(!e)return lw(t);switch(t){case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class lr extends _e{constructor(n,r={}){super(n,r);v(this,"device");v(this,"gl");v(this,"handle");v(this,"glTarget");v(this,"glUsage");v(this,"glIndexType",5123);v(this,"byteLength");v(this,"bytesUsed");this.device=n,this.gl=this.device.gl;const i=typeof r=="object"?r.handle:void 0;this.handle=i||this.gl.createBuffer(),n.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=SN(this.props.usage),this.glUsage=EN(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(n,r=0,i=n.byteLength+r){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,r,n),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(n,r,i),this.trackAllocatedMemory(i)}_initWithByteLength(n){ue(n>=0);let r=n;n===0&&(r=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(null,0,n),this.trackAllocatedMemory(n),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(n,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,n),this.gl.bindBuffer(36663,null),this._setDebugData(n,r,n.byteLength)}async readAsync(n=0,r){return this.readSyncWebGL(n,r)}readSyncWebGL(n=0,r){r=r??this.byteLength-n;const i=new Uint8Array(r),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,i,s,r),this.gl.bindBuffer(36662,null),this._setDebugData(i,n,r),i}}function SN(t){return t&_e.INDEX?34963:t&_e.VERTEX?34962:t&_e.UNIFORM?35345:34962}function EN(t){return t&_e.INDEX||t&_e.VERTEX?35044:t&_e.UNIFORM?35048:35044}class zd extends _c{constructor(n,r){super(n,r);v(this,"device");v(this,"handle");v(this,"parameters");this.device=n,this.parameters=aw(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(n){for(const[r,i]of Object.entries(n)){const s=Number(r);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}class Oi extends pc{constructor(n,r){super(n,{...bt.defaultProps,...r});v(this,"device");v(this,"gl");v(this,"handle");v(this,"texture");this.device=n,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const wN={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},vo=class vo extends bt{constructor(n,r){var i;super(n,{...wN,format:"rgba8unorm",...r});v(this,"MAX_ATTRIBUTES");v(this,"device");v(this,"gl");v(this,"handle");v(this,"sampler");v(this,"view");v(this,"glFormat");v(this,"type");v(this,"dataFormat");v(this,"mipmaps");v(this,"target");v(this,"textureUnit");v(this,"loaded",!1);v(this,"_video");this.device=n,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=AN(this.props),this.loaded=!1,typeof((i=this.props)==null?void 0:i.data)=="string"&&Object.assign(this.props,{data:C2(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(n){return new Oi(this.device,{...n,texture:this})}initialize(n={}){if(this.props.dimension==="cube")return this.initializeCube(n);let r=n.data;if(r instanceof Promise)return r.then(g=>this.initialize(Object.assign({},n,{pixels:g,data:g}))),this;const i=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement;if(i&&r.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,r.addEventListener("loadeddata",()=>this.initialize(n)),this;const{parameters:s={}}=n,{pixels:o=null,pixelStore:a={},textureUnit:l=void 0,mipmaps:c=!0}=n;r||(r=o);let{width:u,height:f,dataFormat:h,type:d,compressed:m=!1}=n;const{depth:T=0}=n,A=ow(n.format);return{width:u,height:f,compressed:m,dataFormat:h,type:d}=this._deduceParameters({format:n.format,type:d,dataFormat:h,compressed:m,data:r,width:u,height:f}),this.width=u,this.height=f,this.glFormat=A,this.type=d,this.dataFormat=h,this.textureUnit=l,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=c,this.setImageData({data:r,width:u,height:f,depth:T,format:n.format,type:d,dataFormat:h,parameters:a,compressed:m}),this.setSampler(n.sampler),this._setSamplerParameters(s),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),c&&this.device.isTextureFormatFilterable(n.format)&&this.generateMipmap(),i&&(this._video={video:r,parameters:s,lastTime:r.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?r.currentTime:-1}),this}initializeCube(n){const{mipmaps:r=!0,parameters:i={}}=n;return this.setCubeMapImageData(n).then(()=>{this.loaded=!0,r&&this.generateMipmap(n),this.setSampler(n.sampler),this._setSamplerParameters(i)}),this}setSampler(n={}){let r;n instanceof zd?(this.sampler=n,r=n.props):(this.sampler=new zd(this.device,n),r=n);const i=aw(r);return this._setSamplerParameters(i),this}resize(n){const{height:r,width:i,mipmaps:s=!1}=n;return i!==this.width||r!==this.height?this.initialize({width:i,height:r,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:s}):this}update(){if(this._video){const{video:n,parameters:r,lastTime:i}=this._video;if(i===n.currentTime||n.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:n,parameters:r}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=n.currentTime}}generateMipmap(n={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Qn(this.gl,n,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(n){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(n);this.trackDeallocatedMemory("Texture");const{target:r=this.target,pixels:i=null,level:s=0,glFormat:o=this.glFormat,offset:a=0,parameters:l={}}=n;let{data:c=null,type:u=this.type,width:f=this.width,height:h=this.height,dataFormat:d=this.dataFormat,compressed:m=!1}=n;c||(c=i),{type:u,dataFormat:d,compressed:m,width:f,height:h}=this._deduceParameters({format:this.props.format,type:u,dataFormat:d,compressed:m,data:c,width:f,height:h});const{gl:T}=this;T.bindTexture(this.target,this.handle);let A=null;if({data:c,dataType:A}=this._getDataType({data:c,compressed:m}),Qn(this.gl,l,()=>{switch(A){case"null":T.texImage2D(r,s,o,f,h,0,d,u,c);break;case"typed-array":T.texImage2D(r,s,o,f,h,0,d,u,c,a);break;case"buffer":this.device.gl.bindBuffer(35052,c.handle||c),this.device.gl.texImage2D(r,s,o,f,h,0,d,u,a),this.device.gl.bindBuffer(35052,null);break;case"browser-object":T.texImage2D(r,s,o,f,h,0,d,u,c);break;case"compressed":for(const[g,p]of c.entries())T.compressedTexImage2D(r,g,p.format,p.width,p.height,0,p.data);break;default:ue(!1,"Unknown image data type")}}),c&&c.byteLength)this.trackAllocatedMemory(c.byteLength,"Texture");else{const g=e0(this.props.format);this.trackAllocatedMemory(this.width*this.height*g,"Texture")}return this.loaded=!0,this}setSubImageData({target:n=this.target,pixels:r=null,data:i=null,x:s=0,y:o=0,width:a=this.width,height:l=this.height,level:c=0,glFormat:u=this.glFormat,type:f=this.type,dataFormat:h=this.dataFormat,compressed:d=!1,offset:m=0,parameters:T={}}){if({type:f,dataFormat:h,compressed:d,width:a,height:l}=this._deduceParameters({format:this.props.format,type:f,dataFormat:h,compressed:d,data:i,width:a,height:l}),ue(this.depth===1,"texSubImage not supported for 3D textures"),i||(i=r),i&&i.data){const A=i;i=A.data,a=A.shape[0],l=A.shape[1]}i instanceof lr&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),Qn(this.gl,T,()=>{d?this.gl.compressedTexSubImage2D(n,c,s,o,a,l,u,i):i===null?this.gl.texSubImage2D(n,c,s,o,a,l,h,f,null):ArrayBuffer.isView(i)?this.gl.texSubImage2D(n,c,s,o,a,l,h,f,i,m):typeof WebGLBuffer<"u"&&i instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,i),this.device.gl.texSubImage2D(n,c,s,o,a,l,h,f,m),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(n,c,s,o,a,l,h,f,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(n={}){return B.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(n=this.textureUnit){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.target,this.handle),n}unbind(n=this.textureUnit){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.target,null),n}_getDataType({data:n,compressed:r=!1}){return r?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof lr?{data:n.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&n instanceof WebGLBuffer?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(n){const{format:r,data:i}=n;let{width:s,height:o,dataFormat:a,type:l,compressed:c}=n;const u=Cc(r);return a=a||u.dataFormat,l=l||u.type,c=c||u.compressed,{width:s,height:o}=this._deduceImageSize(i,s,o),{dataFormat:a,type:l,compressed:c,width:s,height:o,format:r,data:i}}_deduceImageSize(n,r,i){let s;return typeof ImageData<"u"&&n instanceof ImageData?s={width:n.width,height:n.height}:typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement?s={width:n.naturalWidth,height:n.naturalHeight}:typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement?s={width:n.width,height:n.height}:typeof ImageBitmap<"u"&&n instanceof ImageBitmap?s={width:n.width,height:n.height}:typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement?s={width:n.videoWidth,height:n.videoHeight}:n?s={width:r,height:i}:s={width:r>=0?r:1,height:i>=0?i:1},ue(s,"Could not deduced texture size"),ue(r===void 0||s.width===r,"Deduced texture width does not match supplied width"),ue(i===void 0||s.height===i,"Deduced texture height does not match supplied height"),s}async setCubeMapImageData(n){const{gl:r}=this,{width:i,height:s,pixels:o,data:a,format:l=6408,type:c=5121}=n,u=o||a,f=await Promise.all(vo.FACES.map(h=>{const d=u[h];return Promise.all(Array.isArray(d)?d:[d])}));this.bind(),vo.FACES.forEach((h,d)=>{f[d].length>1&&this.props.mipmaps!==!1&&B.warn(`${this.id} has mipmap and multiple LODs.`)(),f[d].forEach((m,T)=>{i&&s?r.texImage2D(h,T,l,i,s,0,l,c,m):r.texImage2D(h,T,l,l,c,m)})}),this.unbind()}setImageDataForFace(n){const{face:r,width:i,height:s,pixels:o,data:a,format:l=6408,type:c=5121}=n,{gl:u}=this,f=o||a;return this.bind(),f instanceof Promise?f.then(h=>this.setImageDataForFace(Object.assign({},n,{face:r,data:h,pixels:h}))):this.width||this.height?u.texImage2D(r,0,l,i,s,0,l,c,f):u.texImage2D(r,0,l,l,c,f),this}setImageData3D(n){const{level:r=0,dataFormat:i,format:s,type:o,width:a,height:l,depth:c=1,offset:u=0,data:f,parameters:h={}}=n;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const d=Cc(s);if(Qn(this.gl,h,()=>{ArrayBuffer.isView(f)&&this.gl.texImage3D(this.target,r,d.format,a,l,c,0,d.dataFormat,d.type,f),f instanceof lr&&(this.gl.bindBuffer(35052,f.handle),this.gl.texImage3D(this.target,r,i,a,l,c,0,s,o,u))}),f&&f.byteLength)this.trackAllocatedMemory(f.byteLength,"Texture");else{const m=e0(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*m,"Texture")}return this.loaded=!0,this}_setSamplerParameters(n){if(!dc(n)){bN(n),this.gl.bindTexture(this.target,this.handle);for(const[r,i]of Object.entries(n)){const s=Number(r),o=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.target,s,o);break;default:this.gl.texParameteri(this.target,s,o);break}}this.gl.bindTexture(this.target,null)}}};v(vo,"FACES",[34069,34070,34071,34072,34073,34074]);let ln=vo;function AN(t){switch(t.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(t.dimension)}}function bN(t){B.log(1,"texture sampler parameters",t)()}class ho extends mc{constructor(n,r){super(n,r);v(this,"device");v(this,"gl");v(this,"handle");const i=r.handle===null;if(this.device=n,this.gl=n.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),!i){n.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const s=this.gl.bindFramebuffer(36160,this.handle);for(let o=0;o<this.colorAttachments.length;++o){const a=this.colorAttachments[o],l=36064+o;a&&this._attachOne(l,a)}if(this.depthStencilAttachment&&this._attachOne(fN(this.depthStencilAttachment.props.format),this.depthStencilAttachment),r.check!==!1){const o=this.gl.checkFramebufferStatus(36160);if(o!==36053)throw new Error(`Framebuffer ${PN(o)}`)}this.gl.bindFramebuffer(36160,s)}}get texture(){return this.colorAttachments[0]}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(n){return new ln(this.device,{id:`${this.id}-depth-stencil`,format:n,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(n,r){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight);for(const i of this.colorAttachments)i.texture.resize({width:n,height:r});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:n,height:r}),this}_attachOne(n,r){if(Array.isArray(r)){const[i,s=0,o=0]=r;return this._attachTexture(n,i,s,o),i}if(r instanceof ln)return this._attachTexture(n,r,0,0),r;if(r instanceof Oi){const i=r;return this._attachTexture(n,i.texture,i.props.baseMipLevel,i.props.baseArrayLayer),r.texture}throw new Error("attach")}_attachTexture(n,r,i,s){const{gl:o}=this.device;switch(o.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:o.framebufferTextureLayer(36160,n,r.target,s,i);break;case 34067:const a=RN(i);o.framebufferTexture2D(36160,n,a,r.handle,s);break;case 3553:o.framebufferTexture2D(36160,n,3553,r.handle,s);break;default:ue(!1,"Illegal texture type")}o.bindTexture(r.target,null)}}function RN(t){return t<34069?t+34069:t}function PN(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class CN extends vg{constructor(n,r){super(r);v(this,"device");v(this,"presentationSize");v(this,"_framebuffer",null);this.device=n,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new ho(this.device,{handle:null}),this._framebuffer}update(){const n=this.getPixelSize();(n[0]!==this.presentationSize[0]||n[1]!==this.presentationSize[1])&&(this.presentationSize=n,this.resize())}resize(n){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(n==null?void 0:n.useDevicePixels);this.setDevicePixelRatio(r,n);return}}commit(){}}const xN={spector:B.get("spector")||B.get("spectorjs")},IN="https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",MN=1;let ae=null,r0=!1;async function ON(t){if(!globalThis.SPECTOR)try{await EE(IN)}catch(e){B.warn(String(e))}}function kN(t){if(t={...xN,...t},!(t!=null&&t.spector)||(!ae&&globalThis.SPECTOR&&(B.probe(MN,"SPECTOR found and initialized")(),ae=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=ae)),!ae))return null;if(r0||(r0=!0,ae.spyCanvases(),ae==null||ae.onCaptureStarted.add(e=>B.info("Spector capture started:",e)()),ae==null||ae.onCapture.add(e=>{B.info("Spector capture complete:",e)(),ae==null||ae.getResultUI(),ae==null||ae.resultView.display(),ae==null||ae.resultView.addCapture(e)})),t!=null&&t.canvas){if(typeof t.spector=="string"&&t.spector!==t.canvas.id)return ae;ae==null||ae.startCapture(t==null?void 0:t.canvas,500),new Promise(e=>setTimeout(e,2e3)).then(e=>{B.info("Spector capture stopped after 2 seconds")(),ae==null||ae.stopCapture()})}return ae}const NN="https://unpkg.com/webgl-debug@2.0.1/index.js";function cw(t){return t.luma=t.luma||{},t.luma}async function FN(){mr()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await EE(NN))}function DN(t,e={}){return t?e.debug?UN(t,e):BN(t):null}function BN(t){const e=cw(t);return e.realContext?e.realContext:t}function UN(t,e){if(!globalThis.WebGLDebugUtils)return B.warn("webgl-debug not loaded")(),t;const n=cw(t);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...xi,...t});const r=globalThis.WebGLDebugUtils.makeDebugContext(t,LN.bind(null,e),zN.bind(null,e));for(const o in xi)!(o in r)&&typeof xi[o]=="number"&&(r[o]=xi[o]);class i{}Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.setPrototypeOf(i,r);const s=Object.create(i);return n.realContext=t,n.debugContext=s,s.debug=!0,s}function eh(t,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${t}(${n})`}function LN(t,e,n,r){r=Array.from(r).map(a=>a===void 0?"undefined":a);const i=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,r),o=`${i} in gl.${n}(${s})`;B.error(o)();debugger;if(t.throwOnError)throw new Error(o)}function zN(t,e,n){let r="";if(B.level>=1&&(r=eh(e,n),B.log(1,r)()),t.break&&t.break.length>0&&(r=r||eh(e,n),t.break.every(s=>r.indexOf(s)!==-1)))debugger;for(const i of n)if(i===void 0){if(r=r||eh(e,n),t.throwOnError)throw new Error(`Undefined argument: ${r}`);B.error(`Undefined argument: ${r}`)();debugger}}function VN(t){const e=t.split(/\r?\n/),n=[];for(const r of e){if(r.length<=1)continue;const i=r.split(":");if(i.length===2){const[f,h]=i;n.push({message:h.trim(),type:i0(f),lineNum:0,linePos:0});continue}const[s,o,a,...l]=i;let c=parseInt(a,10);isNaN(c)&&(c=0);let u=parseInt(o,10);isNaN(u)&&(u=0),n.push({message:l.join(":").trim(),type:i0(s),lineNum:c,linePos:u})}return n}function i0(t){const e=["warning","error","info"],n=t.toLowerCase();return e.includes(n)?n:"info"}class WN extends gc{constructor(n,r){super(n,r);v(this,"device");v(this,"handle");switch(this.device=n,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const n=this.device.gl.getShaderInfoLog(this.handle);return VN(n)}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return r==null?void 0:r.getTranslatedShaderSource(this.handle)}async _compile(n){n=(s=>s.startsWith("#version ")?s:`#version 100
${s}`)(n);const{gl:i}=this.device;if(i.shaderSource(this.handle,n),i.compileShader(this.handle),B.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}B.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),B.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await n(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const jN=256,HN=1024,$N=16384,th=6144,XN=[1,2,4,8];class YN extends Td{constructor(n,r){super(n,r);v(this,"device");v(this,"glParameters");this.device=n,Du(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){Ho(this.device.gl)}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}setParameters(n={}){const r={...this.glParameters};this.props.framebuffer&&(r.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,n.viewport&&(n.viewport.length>=6?(r.viewport=n.viewport.slice(0,4),r.depthRange=[n.viewport[4],n.viewport[5]]):r.viewport=n.viewport),n.scissorRect&&(r.scissorTest=!0,r.scissor=n.scissorRect),n.blendConstant&&(r.blendColor=n.blendConstant),n.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),n[2967]=n.stencilReference),n.colorMask&&(r.colorMask=XN.map(i=>!!(i&n.colorMask))),this.glParameters=r,Ss(this.device.gl,r)}beginOcclusionQuery(n){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const n=this.props.occlusionQuerySet;n==null||n.endOcclusionQuery()}clear(){const n={...this.glParameters};let r=0;this.props.clearColor!==!1&&(r|=$N,n.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=jN,n.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=HN,n.clearStencil=this.props.clearStencil),r!==0&&Qn(this.device.gl,n,()=>{this.device.gl.clear(r)})}clearColorBuffer(n=0,r=[0,0,0,0]){Qn(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int32Array:this.device.gl.clearBufferiv(th,n,r);break;case Uint32Array:this.device.gl.clearBufferuiv(th,n,r);break;case Float32Array:default:this.device.gl.clearBufferfv(th,n,r);break}})}}const KN="Failed to deduce GL constant from typed array";function qN(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(KN)}}function Vd(t,e){const{clamped:n=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const ZN={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},QN={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class po{constructor(...e){v(this,"offset");v(this,"stride");v(this,"type");v(this,"size");v(this,"divisor");v(this,"normalized");v(this,"integer");v(this,"buffer");v(this,"index");e.forEach(n=>this._assign(n)),Object.freeze(this)}static getBytesPerElement(e){return Vd(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return ue(e.size),Vd(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new po(ZN,...e)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return po.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return po.getBytesPerVertex(this)}_assign(e={}){return e=R2("Accessor",e,QN),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalize!==void 0&&(this.normalized=e.normalize),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function JN(t){return GN.includes(t)}const GN=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],uw={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function fw(t){const e=uw[t];if(!e)throw new Error("uniform");const[n,r,,i]=e;return{format:i,components:r,glType:n}}function eF(t){const e=uw[t];if(!e)throw new Error("attribute");const[,n,,r,i]=e;return{attributeType:r,vertexFormat:i,components:n}}function tF(t,e){const n={attributes:[],bindings:[]};n.attributes=nF(t,e);const r=sF(t,e);for(const a of r){const l=a.uniforms.map(c=>({name:c.name,format:c.format,byteOffset:c.byteOffset,byteStride:c.byteStride,arrayLength:c.arrayLength}));n.bindings.push({type:"uniform",name:a.name,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:l})}const i=iF(t,e);let s=0;for(const a of i)if(JN(a.type)){const{viewDimension:l,sampleType:c}=aF(a.type);n.bindings.push({type:"texture",name:a.name,location:s,viewDimension:l,sampleType:c}),a.textureUnit=s,s+=1}i.length&&(n.uniforms=i);const o=rF(t,e);return o!=null&&o.length&&(n.varyings=o),n}function nF(t,e){const n=[],r=t.getProgramParameter(e,35721);for(let i=0;i<r;i++){const s=t.getActiveAttrib(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:a}=s,l=t.getAttribLocation(e,o);if(l>=0){const{attributeType:c}=eF(a),u=/instance/i.test(o)?"instance":"vertex";n.push({name:o,location:l,stepMode:u,type:c})}}return n.sort((i,s)=>i.location-s.location),n}function rF(t,e){const n=[],r=t.getProgramParameter(e,35971);for(let i=0;i<r;i++){const s=t.getTransformFeedbackVarying(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:a,size:l}=s,{glType:c,components:u}=fw(a),f=new po({type:c,size:l*u}),h={location:i,name:o,accessor:f};n.push(h)}return n.sort((i,s)=>i.location-s.location),n}function iF(t,e){const n=[],r=t.getProgramParameter(e,35718);for(let i=0;i<r;i++){const s=t.getActiveUniform(e,i);if(!s)throw new Error("activeInfo");const{name:o,size:a,type:l}=s,{name:c,isArray:u}=lF(o);let f=t.getUniformLocation(e,c);const h={location:f,name:c,size:a,type:l,isArray:u};if(n.push(h),h.size>1)for(let d=0;d<h.size;d++){const m=`${c}[${d}]`;f=t.getUniformLocation(e,m);const T={...h,name:m,location:f};n.push(T)}}return n}function sF(t,e){const n=(s,o)=>t.getActiveUniformBlockParameter(e,s,o),r=[],i=t.getProgramParameter(e,35382);for(let s=0;s<i;s++){const o={name:t.getActiveUniformBlockName(e,s)||"",location:n(s,35391),byteLength:n(s,35392),vertex:n(s,35396),fragment:n(s,35398),uniformCount:n(s,35394),uniforms:[]},a=n(s,35395)||[],l=t.getActiveUniforms(e,a,35383),c=t.getActiveUniforms(e,a,35384),u=t.getActiveUniforms(e,a,35387),f=t.getActiveUniforms(e,a,35388);for(let h=0;h<o.uniformCount;++h){const d=t.getActiveUniform(e,a[h]);if(!d)throw new Error("activeInfo");o.uniforms.push({name:d.name,format:fw(l[h]).format,type:l[h],arrayLength:c[h],byteOffset:u[h],byteStride:f[h]})}r.push(o)}return r.sort((s,o)=>s.location-o.location),r}const oF={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function aF(t){const e=oF[t];if(!e)throw new Error("sampler");const[n,r]=e;return{viewDimension:n,sampleType:r}}function lF(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const n=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!n||n.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:n[1],length:n[2]?1:0,isArray:!!n[2]}}function cF(t,e,n,r){const i=t;let s=r;s===!0&&(s=1),s===!1&&(s=0);const o=typeof s=="number"?[s]:s;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,r);case 5126:return t.uniform1fv(e,o);case 35664:return t.uniform2fv(e,o);case 35665:return t.uniform3fv(e,o);case 35666:return t.uniform4fv(e,o);case 5124:return t.uniform1iv(e,o);case 35667:return t.uniform2iv(e,o);case 35668:return t.uniform3iv(e,o);case 35669:return t.uniform4iv(e,o);case 35670:return t.uniform1iv(e,o);case 35671:return t.uniform2iv(e,o);case 35672:return t.uniform3iv(e,o);case 35673:return t.uniform4iv(e,o);case 5125:return i.uniform1uiv(e,o,1);case 36294:return i.uniform2uiv(e,o,2);case 36295:return i.uniform3uiv(e,o,3);case 36296:return i.uniform4uiv(e,o,4);case 35674:return t.uniformMatrix2fv(e,!1,o);case 35675:return t.uniformMatrix3fv(e,!1,o);case 35676:return t.uniformMatrix4fv(e,!1,o);case 35685:return i.uniformMatrix2x3fv(e,!1,o);case 35686:return i.uniformMatrix2x4fv(e,!1,o);case 35687:return i.uniformMatrix3x2fv(e,!1,o);case 35688:return i.uniformMatrix3x4fv(e,!1,o);case 35689:return i.uniformMatrix4x2fv(e,!1,o);case 35690:return i.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function uF(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(t)}}function fF(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(t)}}const s0=4;class hF extends as{constructor(n,r){super(n,r);v(this,"device");v(this,"handle");v(this,"vs");v(this,"fs");v(this,"introspectedLayout");v(this,"uniforms",{});v(this,"bindings",{});v(this,"varyings",null);v(this,"_uniformCount",0);v(this,"_uniformSetters",{});this.device=n,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:i,bufferMode:s=35981}=r;switch(i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),B.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=tF(this.device.gl,this.handle),B.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=d2(this.introspectedLayout,r.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":B.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(n,r){for(const[i,s]of Object.entries(n)){const o=this.shaderLayout.bindings.find(a=>a.name===i)||this.shaderLayout.bindings.find(a=>a.name===`${i}Uniforms`);if(!o){const a=this.shaderLayout.bindings.map(l=>`"${l.name}"`).join(", ");r!=null&&r.disableWarnings||B.warn(`Unknown binding "${i}" in render pipeline "${this.id}", expected one of ${a}`)();continue}switch(s||B.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(s instanceof lr)&&!(s.buffer instanceof lr))throw new Error("buffer value");break;case"texture":if(!(s instanceof Oi||s instanceof ln||s instanceof ho))throw new Error("texture value");break;case"sampler":B.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(o.type)}this.bindings[i]=s}}draw(n){var A;const{renderPass:r,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:o,vertexCount:a,instanceCount:l,isInstanced:c=!1,firstVertex:u=0,transformFeedback:f}=n,h=uF(s),d=!!o.indexBuffer,m=(A=o.indexBuffer)==null?void 0:A.glIndexType;if(this.linkStatus!=="success")return B.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||a===0)return B.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(a===0)return B.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),f&&f.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const T=r;return _N(this.device,i,T.glParameters,()=>{d&&c?this.device.gl.drawElementsInstanced(h,a||0,m,u,l||0):d?this.device.gl.drawElements(h,a||0,m,u):c?this.device.gl.drawArraysInstanced(h,u,a||0,l||0):this.device.gl.drawArrays(h,u,a||0),f&&f.end()}),o.unbindAfterRender(r),!0}setUniformsWebGL(n){const{bindings:r}=Tg(n);Object.keys(r).forEach(i=>{B.warn(`Unsupported value "${JSON.stringify(r[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,n)}async _linkShaders(){const{gl:n}=this.device;if(n.attachShader(this.handle,this.vs.handle),n.attachShader(this.handle,this.fs.handle),B.time(s0,`linkProgram for ${this.id}`)(),n.linkProgram(this.handle),B.timeEnd(s0,`linkProgram for ${this.id}`)(),B.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}B.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),B.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}_reportLinkStatus(n){var r;switch(n){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):((r=this.fs)==null?void 0:r.compilationStatus)==="error"?(this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${n}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:n}=this.device;return n.getProgramParameter(this.handle,35714)?(n.validateProgram(this.handle),n.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await n(10)}}_areTexturesRenderable(){let n=!0;for(const[,r]of Object.entries(this.bindings))r instanceof ln&&(r.update(),n=n&&r.loaded);return n}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:n}=this.device;n.useProgram(this.handle);let r=0,i=0;for(const s of this.shaderLayout.bindings){const o=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:a}=s,l=n.getUniformBlockIndex(this.handle,a);if(l===4294967295)throw new Error(`Invalid uniform block name ${a}`);n.uniformBlockBinding(this.handle,i,l),o instanceof lr?n.bindBufferBase(35345,i,o.handle):n.bindBufferRange(35345,i,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),i+=1;break;case"texture":if(!(o instanceof Oi||o instanceof ln||o instanceof ho))throw new Error("texture");let c;if(o instanceof Oi)c=o.texture;else if(o instanceof ln)c=o;else if(o instanceof ho&&o.colorAttachments[0]instanceof Oi)B.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),c=o.colorAttachments[0].texture;else throw new Error("No texture");n.activeTexture(33984+r),n.bindTexture(c.target,c.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const n of this.shaderLayout.uniforms||[]){const{name:r,location:i,type:s,textureUnit:o}=n,a=this.uniforms[r]??o;a!==void 0&&cF(this.device.gl,i,s,a)}}}class dF extends Ed{constructor(n){super(n,{});v(this,"device");v(this,"commands",[]);this.device=n}submitCommands(n=this.commands){for(const r of n)switch(r.name){case"copy-buffer-to-buffer":pF(this.device,r.options);break;case"copy-buffer-to-texture":gF(this.device,r.options);break;case"copy-texture-to-buffer":_F(this.device,r.options);break;case"copy-texture-to-texture":mF(this.device,r.options);break}}}function pF(t,e){const n=e.source,r=e.destination;t.gl.bindBuffer(36662,n.handle),t.gl.bindBuffer(36663,r.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function gF(t,e){throw new Error("Not implemented")}function _F(t,e){const{source:n,mipLevel:r=0,aspect:i="all",width:s=e.source.width,height:o=e.source.height,depthOrArrayLayers:a=0,origin:l=[0,0],destination:c,byteOffset:u=0,bytesPerRow:f,rowsPerImage:h}=e;if(i!=="all")throw new Error("not supported");if(r!==0||a!==0||f||h)throw new Error("not implemented");const{framebuffer:d,destroyFramebuffer:m}=hw(n);let T;try{const A=c,g=s||d.width,p=o||d.height,_=Cc(d.texture.props.format),w=_.dataFormat,R=_.type;t.gl.bindBuffer(35051,A.handle),T=t.gl.bindFramebuffer(36160,d.handle),t.gl.readPixels(l[0],l[1],g,p,w,R,u)}finally{t.gl.bindBuffer(35051,null),T!==void 0&&t.gl.bindFramebuffer(36160,T),m&&d.destroy()}}function mF(t,e){const{source:n,destinationMipLevel:r=0,origin:i=[0,0],destinationOrigin:s=[0,0],destination:o}=e;let{width:a=e.destination.width,height:l=e.destination.height}=e;const{framebuffer:c,destroyFramebuffer:u}=hw(n),[f,h]=i,[d,m,T]=s,A=t.gl.bindFramebuffer(36160,c.handle);let g=null,p;if(o instanceof ln)g=o,a=Number.isFinite(a)?a:g.width,l=Number.isFinite(l)?l:g.height,g.bind(0),p=g.target;else throw new Error("invalid destination");switch(p){case 3553:case 34067:t.gl.copyTexSubImage2D(p,r,d,m,f,h,a,l);break;case 35866:case 32879:t.gl.copyTexSubImage3D(p,r,d,m,T,f,h,a,l);break}g&&g.unbind(),t.gl.bindFramebuffer(36160,A),u&&c.destroy()}function hw(t){if(t instanceof bt){const{width:e,height:n,id:r}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:n,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class yF extends Sd{constructor(n,r){super(n,r);v(this,"device");v(this,"commandBuffer");this.device=n,this.commandBuffer=new dF(n)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(n){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:n})}copyBufferToTexture(n){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:n})}copyTextureToBuffer(n){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:n})}copyTextureToTexture(n){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:n})}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}resolveQuerySet(n,r,i){}}class xg extends wd{constructor(n,r){super(n,r);v(this,"device");v(this,"handle");v(this,"buffer",null);v(this,"bufferValue",null);this.device=n,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(n){return kP()==="Chrome"}destroy(){var n;super.destroy(),this.buffer&&((n=this.buffer)==null||n.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(n){const r=n;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(n,r){const i=r;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:o,stride:a,offset:l,normalized:c,integer:u,divisor:f}=this._getAccessor(n);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),u?this.device.gl.vertexAttribIPointer(n,s,o,a,l):this.device.gl.vertexAttribPointer(n,s,o,c,a,l),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(n),this.device.gl.vertexAttribDivisor(n,f||0),this.attributes[n]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(n,r){this._enable(n,!1),this.attributes[n]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let n=0;n<this.maxVertexAttributes;++n){const r=this.attributes[n];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(n,r)}}_getAccessor(n){const r=this.attributeInfos[n];if(!r)throw new Error(`Unknown attribute location ${n}`);const i=sw(r.bufferDataType);return{size:r.bufferComponents,type:i,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(n,r=!0){const s=xg.isConstantAttributeZeroSupported(this.device)||n!==0;(r||s)&&(n=Number(n),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(n):this.device.gl.disableVertexAttribArray(n),this.device.gl.bindVertexArray(null))}getConstantBuffer(n,r){const i=vF(r),s=i.byteLength*n,o=i.length*n;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),a=a||!TF(i,this.bufferValue),a){const l=m2(r.constructor,o);y2({target:l,source:i,start:0,count:o}),this.buffer.write(l),this.bufferValue=r}return this.buffer}}function vF(t){return Array.isArray(t)?new Float32Array(t):t}function TF(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}class SF extends Ad{constructor(n,r){super(n,r);v(this,"device");v(this,"gl");v(this,"handle");v(this,"layout");v(this,"buffers",{});v(this,"unusedBuffers",{});v(this,"bindOnUse",!0);v(this,"_bound",!1);this.device=n,this.gl=n.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(n="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(fF(n))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(n){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in n)this.setBuffer(r,n[r])})}setBuffer(n,r){const i=this._getVaryingIndex(n),{buffer:s,byteLength:o,byteOffset:a}=this._getBufferRange(r);if(i<0){this.unusedBuffers[n]=s,B.warn(`${this.id} unusedBuffers varying buffer ${n}`)();return}this.buffers[i]={buffer:s,byteLength:o,byteOffset:a},this.bindOnUse||this._bindBuffer(i,s,a,o)}getBuffer(n){if(o0(n))return this.buffers[n]||null;const r=this._getVaryingIndex(n);return r>=0?this.buffers[r]:null}bind(n=this.handle){if(typeof n!="function")return this.gl.bindTransformFeedback(36386,n),this;let r;return this._bound?r=n():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=n(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(n){if(n instanceof lr)return{buffer:n,byteOffset:0,byteLength:n.byteLength};const{buffer:r,byteOffset:i=0,byteLength:s=n.buffer.byteLength}=n;return{buffer:r,byteOffset:i,byteLength:s}}_getVaryingIndex(n){if(o0(n))return Number(n);for(const r of this.layout.varyings)if(n===r.name)return r.location;return-1}_bindBuffers(){for(const n in this.buffers){const{buffer:r,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[n]);this._bindBuffer(Number(n),r,s,i)}}_unbindBuffers(){for(const n in this.buffers)this.gl.bindBufferBase(35982,Number(n),null)}_bindBuffer(n,r,i=0,s){const o=r&&r.handle;!o||s===void 0?this.gl.bindBufferBase(35982,n,o):this.gl.bindBufferRange(35982,n,o,i,s)}}function o0(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class EF extends bd{constructor(n,r){super(n,r);v(this,"device");v(this,"handle");v(this,"target",null);v(this,"_queryPending",!1);v(this,"_pollingPromise",null);if(this.device=n,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(n){return this._begin(n!=null&&n.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(n){this._queryPending||(this.target=n,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const n=this.device.gl.getQueryParameter(this.handle,34919);return n&&(this._queryPending=!1),n}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(n=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((i,s)=>{const o=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):r++>n?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}function dw(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return ue(!1),0}}function wF(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return ue(!1),0}}function AF(t,e){var A,g;const{sourceX:n=0,sourceY:r=0,sourceFormat:i=6408,sourceAttachment:s=36064}=e||{};let{target:o=null,sourceWidth:a,sourceHeight:l,sourceType:c}=e||{};const{framebuffer:u,deleteFramebuffer:f}=pw(t);ue(u);const{gl:h,handle:d}=u;a=a||u.width,l=l||u.height;const m=s-36064;c=c||((g=(A=u.colorAttachments[m])==null?void 0:A.texture)==null?void 0:g.type)||5121,o=PF(o,c,i,a,l),c=c||qN(o);const T=h.bindFramebuffer(36160,d);return h.readPixels(n,r,a,l,i,c,o),h.bindFramebuffer(36160,T||null),f&&u.destroy(),o}function bF(t,e){const{target:n,sourceX:r=0,sourceY:i=0,sourceFormat:s=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:a,sourceHeight:l,sourceType:c}=e||{};const{framebuffer:u,deleteFramebuffer:f}=pw(t);ue(u),a=a||u.width,l=l||u.height;const h=u;c=c||5121;let d=n;if(!d){const T=dw(s),A=wF(c),g=o+a*l*T*A;d=h.device.createBuffer({byteLength:g})}const m=t.device.createCommandEncoder();return m.copyTextureToBuffer({source:t,width:a,height:l,origin:[r,i],destination:d,byteOffset:o}),m.destroy(),f&&u.destroy(),d}function pw(t){return t instanceof mc?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:RF(t),deleteFramebuffer:!0}}function RF(t,e){const{device:n,width:r,height:i,id:s}=t;return n.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:r,height:i,colorAttachments:[t]})}function PF(t,e,n,r,i){if(t)return t;e=e||5121;const s=Vd(e,{clamped:!1}),o=dw(n);return new s(r*i*o)}const CF=256,xF=1024,IF=16384,MF="clear: bad arguments";function OF(t,e){const{framebuffer:n=null,color:r=null,depth:i=null,stencil:s=null}=e||{},o={};n&&(o.framebuffer=n);let a=0;r&&(a|=IF,r!==!0&&(o.clearColor=r)),i&&(a|=CF,i!==!0&&(o.clearDepth=i)),s&&(a|=xF,i!==!0&&(o.clearStencil=i)),ue(a!==0,MF);const l=t.gl;Qn(l,o,()=>{l.clear(a)})}const Vs=1,Pr=class Pr extends os{constructor(n){var l,c;super({...n,id:n.id||ni("webgl-device")});v(this,"type","webgl");v(this,"handle");v(this,"features");v(this,"limits");v(this,"info");v(this,"canvasContext");v(this,"lost");v(this,"_resolveContextLost");v(this,"renderPass",null);v(this,"gl");v(this,"debug",!1);v(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});v(this,"_extensions",{});v(this,"_polyfilled",!1);v(this,"spectorJS");v(this,"_constants");const r=(l=n.gl)==null?void 0:l.device;if(r)throw new Error(`WebGL context already attached to device ${r.id}`);const i=((c=n.gl)==null?void 0:c.canvas)||n.canvas;this.canvasContext=new CN(this,{...n,canvas:i}),this.lost=new Promise(u=>{this._resolveContextLost=u});let s=n.gl||null;if(s||(s=Yk(this.canvasContext.canvas,{...n,onContextLost:u=>{var f;return(f=this._resolveContextLost)==null?void 0:f.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}})),!s)throw new Error("WebGL context creation failed");this.handle=s,this.gl=s,this.gl.device=this,this.gl._version=2,n.spector&&(this.spectorJS=kN({...this.props,canvas:this.handle.canvas})),this.info=Kk(this.gl,this._extensions),this.limits=new pN(this.gl),this.features=new dN(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();const{enable:o=!0,copyState:a=!1}=n;rw(this.gl,{enable:o,copyState:a,log:(...u)=>B.log(1,...u)()}),n.debug&&(this.gl=DN(this.gl,{...n,throwOnError:!0}),this.debug=!0,B.level=Math.max(B.level,1),B.warn("WebGL debug mode activated. Performance reduced.")())}static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(n){if(n instanceof Pr)return n;if((n==null?void 0:n.device)instanceof os)return n.device;if(!kF(n))throw new Error("Invalid WebGL2RenderingContext");return new Pr({gl:n})}static async create(n={}){var a;B.groupCollapsed(Vs,"WebGLDevice created")();const r=[];n.debug&&r.push(FN()),n.spector&&r.push(ON()),typeof n.canvas=="string"&&r.push(vg.pageLoaded);const i=await Promise.allSettled(r);for(const l of i)l.status==="rejected"&&B.error(`Failed to initialize debug libraries ${l.reason}`)();if(B.probe(Vs+1,"DOM is loaded")(),(a=n.gl)!=null&&a.device)return B.warn("reattaching existing device")(),Pr.attach(n.gl);const s=new Pr(n),o=`Created ${s.type}${s.debug?" debug":""} context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return B.probe(Vs,o)(),B.table(Vs,s.info)(),B.groupEnd(Vs)(),s}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(n){return Cg(this.gl,n,this._extensions)}isTextureFormatFilterable(n){return cN(this.gl,n,this._extensions)}isTextureFormatRenderable(n){return uN(this.gl,n,this._extensions)}createCanvasContext(n){throw new Error("WebGL only supports a single canvas")}createBuffer(n){const r=this._getBufferProps(n);return new lr(this,r)}_createTexture(n){return new ln(this,n)}createExternalTexture(n){throw new Error("createExternalTexture() not implemented")}createSampler(n){return new zd(this,n)}createShader(n){return new WN(this,n)}createFramebuffer(n){return new ho(this,n)}createVertexArray(n){return new xg(this,n)}createTransformFeedback(n){return new SF(this,n)}createQuerySet(n){return new EF(this,n)}createRenderPipeline(n){return new hF(this,n)}beginRenderPass(n){return new YN(this,n)}createComputePipeline(n){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(n){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(n){return new yF(this,n)}submit(){var n;(n=this.renderPass)==null||n.end(),this.renderPass=null}readPixelsToArrayWebGL(n,r){return AF(n,r)}readPixelsToBufferWebGL(n,r){return bF(n,r)}setParametersWebGL(n){Ss(this.gl,n)}getParametersWebGL(n){return nw(this.gl,n)}withParametersWebGL(n,r){return Qn(this.gl,n,r)}clearWebGL(n){OF(this,n)}resetWebGL(){B.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),zk(this.gl)}loseDevice(){var s;let n=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(n=!0,i.loseContext()),(s=this._resolveContextLost)==null||s.call(this,{reason:"destroyed",message:"Application triggered context loss"}),n}pushState(){Du(this.gl)}popState(){Ho(this.gl)}setSpectorMetadata(n,r){n.__SPECTOR_Metadata=r}getGLKey(n,r){r=r||this.gl2||this.gl;const i=Number(n);for(const s in r)if(r[s]===i)return`GL.${s}`;return String(n)}setConstantAttributeWebGL(n,r){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[n];switch(s&&BF(s,r)&&B.info(1,`setConstantAttributeWebGL(${n}) could have been skipped, value unchanged`)(),this._constants[n]=r,r.constructor){case Float32Array:NF(this,n,r);break;case Int32Array:FF(this,n,r);break;case Uint32Array:DF(this,n,r);break;default:ue(!1)}}getExtension(n){return hr(this.gl,n,this._extensions),this._extensions}};v(Pr,"type","webgl");let go=Pr;function kF(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function NF(t,e,n){switch(n.length){case 1:t.gl.vertexAttrib1fv(e,n);break;case 2:t.gl.vertexAttrib2fv(e,n);break;case 3:t.gl.vertexAttrib3fv(e,n);break;case 4:t.gl.vertexAttrib4fv(e,n);break;default:ue(!1)}}function FF(t,e,n){t.gl.vertexAttribI4iv(e,n)}function DF(t,e,n){t.gl.vertexAttribI4uiv(e,n)}function BF(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}var gw={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,r,i){var s=["","webkit","Moz","MS","ms","o"],o=n.createElement("div"),a="function",l=Math.round,c=Math.abs,u=Date.now;function f(y,S,b){return setTimeout(_(y,b),S)}function h(y,S,b){return Array.isArray(y)?(d(y,b[S],b),!0):!1}function d(y,S,b){var O;if(y)if(y.forEach)y.forEach(S,b);else if(y.length!==i)for(O=0;O<y.length;)S.call(b,y[O],O,y),O++;else for(O in y)y.hasOwnProperty(O)&&S.call(b,y[O],O,y)}function m(y,S,b){var O="DEPRECATED METHOD: "+S+`
`+b+` AT 
`;return function(){var N=new Error("get-stack-trace"),z=N&&N.stack?N.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Z=e.console&&(e.console.warn||e.console.log);return Z&&Z.call(e.console,O,z),y.apply(this,arguments)}}var T;typeof Object.assign!="function"?T=function(S){if(S===i||S===null)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(S),O=1;O<arguments.length;O++){var N=arguments[O];if(N!==i&&N!==null)for(var z in N)N.hasOwnProperty(z)&&(b[z]=N[z])}return b}:T=Object.assign;var A=m(function(S,b,O){for(var N=Object.keys(b),z=0;z<N.length;)(!O||O&&S[N[z]]===i)&&(S[N[z]]=b[N[z]]),z++;return S},"extend","Use `assign`."),g=m(function(S,b){return A(S,b,!0)},"merge","Use `assign`.");function p(y,S,b){var O=S.prototype,N;N=y.prototype=Object.create(O),N.constructor=y,N._super=O,b&&T(N,b)}function _(y,S){return function(){return y.apply(S,arguments)}}function w(y,S){return typeof y==a?y.apply(S&&S[0]||i,S):y}function R(y,S){return y===i?S:y}function x(y,S,b){d(U(S),function(O){y.addEventListener(O,b,!1)})}function M(y,S,b){d(U(S),function(O){y.removeEventListener(O,b,!1)})}function k(y,S){for(;y;){if(y==S)return!0;y=y.parentNode}return!1}function F(y,S){return y.indexOf(S)>-1}function U(y){return y.trim().split(/\s+/g)}function j(y,S,b){if(y.indexOf&&!b)return y.indexOf(S);for(var O=0;O<y.length;){if(b&&y[O][b]==S||!b&&y[O]===S)return O;O++}return-1}function X(y){return Array.prototype.slice.call(y,0)}function $(y,S,b){for(var O=[],N=[],z=0;z<y.length;){var Z=S?y[z][S]:y[z];j(N,Z)<0&&O.push(y[z]),N[z]=Z,z++}return b&&(S?O=O.sort(function(Be,Je){return Be[S]>Je[S]}):O=O.sort()),O}function K(y,S){for(var b,O,N=S[0].toUpperCase()+S.slice(1),z=0;z<s.length;){if(b=s[z],O=b?b+N:S,O in y)return O;z++}return i}var je=1;function yr(){return je++}function $t(y){var S=y.ownerDocument||y;return S.defaultView||S.parentWindow||e}var L=/mobile|tablet|ip(ad|hone|od)|android/i,H="ontouchstart"in e,Y=K(e,"PointerEvent")!==i,re=H&&L.test(navigator.userAgent),G="touch",dn="pen",Ze="mouse",Xt="kinect",Qe=25,fe=1,ut=2,se=4,Me=8,pn=1,rt=2,Es=4,ws=8,As=16,Yt=rt|Es,vr=ws|As,Dg=Yt|vr,Bg=["x","y"],ha=["clientX","clientY"];function Tt(y,S){var b=this;this.manager=y,this.callback=S,this.element=y.element,this.target=y.options.inputTarget,this.domHandler=function(O){w(y.options.enable,[y])&&b.handler(O)},this.init()}Tt.prototype={handler:function(){},init:function(){this.evEl&&x(this.element,this.evEl,this.domHandler),this.evTarget&&x(this.target,this.evTarget,this.domHandler),this.evWin&&x($t(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&M(this.element,this.evEl,this.domHandler),this.evTarget&&M(this.target,this.evTarget,this.domHandler),this.evWin&&M($t(this.element),this.evWin,this.domHandler)}};function e1(y){var S,b=y.options.inputClass;return b?S=b:Y?S=ju:re?S=ga:H?S=Hu:S=pa,new S(y,t1)}function t1(y,S,b){var O=b.pointers.length,N=b.changedPointers.length,z=S&fe&&O-N===0,Z=S&(se|Me)&&O-N===0;b.isFirst=!!z,b.isFinal=!!Z,z&&(y.session={}),b.eventType=S,n1(y,b),y.emit("hammer.input",b),y.recognize(b),y.session.prevInput=b}function n1(y,S){var b=y.session,O=S.pointers,N=O.length;b.firstInput||(b.firstInput=Ug(S)),N>1&&!b.firstMultiple?b.firstMultiple=Ug(S):N===1&&(b.firstMultiple=!1);var z=b.firstInput,Z=b.firstMultiple,Oe=Z?Z.center:z.center,Be=S.center=Lg(O);S.timeStamp=u(),S.deltaTime=S.timeStamp-z.timeStamp,S.angle=Wu(Oe,Be),S.distance=da(Oe,Be),r1(b,S),S.offsetDirection=Vg(S.deltaX,S.deltaY);var Je=zg(S.deltaTime,S.deltaX,S.deltaY);S.overallVelocityX=Je.x,S.overallVelocityY=Je.y,S.overallVelocity=c(Je.x)>c(Je.y)?Je.x:Je.y,S.scale=Z?o1(Z.pointers,O):1,S.rotation=Z?s1(Z.pointers,O):0,S.maxPointers=b.prevInput?S.pointers.length>b.prevInput.maxPointers?S.pointers.length:b.prevInput.maxPointers:S.pointers.length,i1(b,S);var qt=y.element;k(S.srcEvent.target,qt)&&(qt=S.srcEvent.target),S.target=qt}function r1(y,S){var b=S.center,O=y.offsetDelta||{},N=y.prevDelta||{},z=y.prevInput||{};(S.eventType===fe||z.eventType===se)&&(N=y.prevDelta={x:z.deltaX||0,y:z.deltaY||0},O=y.offsetDelta={x:b.x,y:b.y}),S.deltaX=N.x+(b.x-O.x),S.deltaY=N.y+(b.y-O.y)}function i1(y,S){var b=y.lastInterval||S,O=S.timeStamp-b.timeStamp,N,z,Z,Oe;if(S.eventType!=Me&&(O>Qe||b.velocity===i)){var Be=S.deltaX-b.deltaX,Je=S.deltaY-b.deltaY,qt=zg(O,Be,Je);z=qt.x,Z=qt.y,N=c(qt.x)>c(qt.y)?qt.x:qt.y,Oe=Vg(Be,Je),y.lastInterval=S}else N=b.velocity,z=b.velocityX,Z=b.velocityY,Oe=b.direction;S.velocity=N,S.velocityX=z,S.velocityY=Z,S.direction=Oe}function Ug(y){for(var S=[],b=0;b<y.pointers.length;)S[b]={clientX:l(y.pointers[b].clientX),clientY:l(y.pointers[b].clientY)},b++;return{timeStamp:u(),pointers:S,center:Lg(S),deltaX:y.deltaX,deltaY:y.deltaY}}function Lg(y){var S=y.length;if(S===1)return{x:l(y[0].clientX),y:l(y[0].clientY)};for(var b=0,O=0,N=0;N<S;)b+=y[N].clientX,O+=y[N].clientY,N++;return{x:l(b/S),y:l(O/S)}}function zg(y,S,b){return{x:S/y||0,y:b/y||0}}function Vg(y,S){return y===S?pn:c(y)>=c(S)?y<0?rt:Es:S<0?ws:As}function da(y,S,b){b||(b=Bg);var O=S[b[0]]-y[b[0]],N=S[b[1]]-y[b[1]];return Math.sqrt(O*O+N*N)}function Wu(y,S,b){b||(b=Bg);var O=S[b[0]]-y[b[0]],N=S[b[1]]-y[b[1]];return Math.atan2(N,O)*180/Math.PI}function s1(y,S){return Wu(S[1],S[0],ha)+Wu(y[1],y[0],ha)}function o1(y,S){return da(S[0],S[1],ha)/da(y[0],y[1],ha)}var a1={mousedown:fe,mousemove:ut,mouseup:se},l1="mousedown",c1="mousemove mouseup";function pa(){this.evEl=l1,this.evWin=c1,this.pressed=!1,Tt.apply(this,arguments)}p(pa,Tt,{handler:function(S){var b=a1[S.type];b&fe&&S.button===0&&(this.pressed=!0),b&ut&&S.which!==1&&(b=se),this.pressed&&(b&se&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[S],changedPointers:[S],pointerType:Ze,srcEvent:S}))}});var u1={pointerdown:fe,pointermove:ut,pointerup:se,pointercancel:Me,pointerout:Me},f1={2:G,3:dn,4:Ze,5:Xt},Wg="pointerdown",jg="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Wg="MSPointerDown",jg="MSPointerMove MSPointerUp MSPointerCancel");function ju(){this.evEl=Wg,this.evWin=jg,Tt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}p(ju,Tt,{handler:function(S){var b=this.store,O=!1,N=S.type.toLowerCase().replace("ms",""),z=u1[N],Z=f1[S.pointerType]||S.pointerType,Oe=Z==G,Be=j(b,S.pointerId,"pointerId");z&fe&&(S.button===0||Oe)?Be<0&&(b.push(S),Be=b.length-1):z&(se|Me)&&(O=!0),!(Be<0)&&(b[Be]=S,this.callback(this.manager,z,{pointers:b,changedPointers:[S],pointerType:Z,srcEvent:S}),O&&b.splice(Be,1))}});var h1={touchstart:fe,touchmove:ut,touchend:se,touchcancel:Me},d1="touchstart",p1="touchstart touchmove touchend touchcancel";function Hg(){this.evTarget=d1,this.evWin=p1,this.started=!1,Tt.apply(this,arguments)}p(Hg,Tt,{handler:function(S){var b=h1[S.type];if(b===fe&&(this.started=!0),!!this.started){var O=g1.call(this,S,b);b&(se|Me)&&O[0].length-O[1].length===0&&(this.started=!1),this.callback(this.manager,b,{pointers:O[0],changedPointers:O[1],pointerType:G,srcEvent:S})}}});function g1(y,S){var b=X(y.touches),O=X(y.changedTouches);return S&(se|Me)&&(b=$(b.concat(O),"identifier",!0)),[b,O]}var _1={touchstart:fe,touchmove:ut,touchend:se,touchcancel:Me},m1="touchstart touchmove touchend touchcancel";function ga(){this.evTarget=m1,this.targetIds={},Tt.apply(this,arguments)}p(ga,Tt,{handler:function(S){var b=_1[S.type],O=y1.call(this,S,b);O&&this.callback(this.manager,b,{pointers:O[0],changedPointers:O[1],pointerType:G,srcEvent:S})}});function y1(y,S){var b=X(y.touches),O=this.targetIds;if(S&(fe|ut)&&b.length===1)return O[b[0].identifier]=!0,[b,b];var N,z,Z=X(y.changedTouches),Oe=[],Be=this.target;if(z=b.filter(function(Je){return k(Je.target,Be)}),S===fe)for(N=0;N<z.length;)O[z[N].identifier]=!0,N++;for(N=0;N<Z.length;)O[Z[N].identifier]&&Oe.push(Z[N]),S&(se|Me)&&delete O[Z[N].identifier],N++;if(Oe.length)return[$(z.concat(Oe),"identifier",!0),Oe]}var v1=2500,$g=25;function Hu(){Tt.apply(this,arguments);var y=_(this.handler,this);this.touch=new ga(this.manager,y),this.mouse=new pa(this.manager,y),this.primaryTouch=null,this.lastTouches=[]}p(Hu,Tt,{handler:function(S,b,O){var N=O.pointerType==G,z=O.pointerType==Ze;if(!(z&&O.sourceCapabilities&&O.sourceCapabilities.firesTouchEvents)){if(N)T1.call(this,b,O);else if(z&&S1.call(this,O))return;this.callback(S,b,O)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function T1(y,S){y&fe?(this.primaryTouch=S.changedPointers[0].identifier,Xg.call(this,S)):y&(se|Me)&&Xg.call(this,S)}function Xg(y){var S=y.changedPointers[0];if(S.identifier===this.primaryTouch){var b={x:S.clientX,y:S.clientY};this.lastTouches.push(b);var O=this.lastTouches,N=function(){var z=O.indexOf(b);z>-1&&O.splice(z,1)};setTimeout(N,v1)}}function S1(y){for(var S=y.srcEvent.clientX,b=y.srcEvent.clientY,O=0;O<this.lastTouches.length;O++){var N=this.lastTouches[O],z=Math.abs(S-N.x),Z=Math.abs(b-N.y);if(z<=$g&&Z<=$g)return!0}return!1}var Yg=K(o.style,"touchAction"),Kg=Yg!==i,qg="compute",Zg="auto",$u="manipulation",Tr="none",bs="pan-x",Rs="pan-y",_a=w1();function Xu(y,S){this.manager=y,this.set(S)}Xu.prototype={set:function(y){y==qg&&(y=this.compute()),Kg&&this.manager.element.style&&_a[y]&&(this.manager.element.style[Yg]=y),this.actions=y.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var y=[];return d(this.manager.recognizers,function(S){w(S.options.enable,[S])&&(y=y.concat(S.getTouchAction()))}),E1(y.join(" "))},preventDefaults:function(y){var S=y.srcEvent,b=y.offsetDirection;if(this.manager.session.prevented){S.preventDefault();return}var O=this.actions,N=F(O,Tr)&&!_a[Tr],z=F(O,Rs)&&!_a[Rs],Z=F(O,bs)&&!_a[bs];if(N){var Oe=y.pointers.length===1,Be=y.distance<2,Je=y.deltaTime<250;if(Oe&&Be&&Je)return}if(!(Z&&z)&&(N||z&&b&Yt||Z&&b&vr))return this.preventSrc(S)},preventSrc:function(y){this.manager.session.prevented=!0,y.preventDefault()}};function E1(y){if(F(y,Tr))return Tr;var S=F(y,bs),b=F(y,Rs);return S&&b?Tr:S||b?S?bs:Rs:F(y,$u)?$u:Zg}function w1(){if(!Kg)return!1;var y={},S=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(b){y[b]=S?e.CSS.supports("touch-action",b):!0}),y}var ma=1,St=2,ii=4,Nn=8,gn=Nn,Ps=16,Kt=32;function _n(y){this.options=T({},this.defaults,y||{}),this.id=yr(),this.manager=null,this.options.enable=R(this.options.enable,!0),this.state=ma,this.simultaneous={},this.requireFail=[]}_n.prototype={defaults:{},set:function(y){return T(this.options,y),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(y){if(h(y,"recognizeWith",this))return this;var S=this.simultaneous;return y=ya(y,this),S[y.id]||(S[y.id]=y,y.recognizeWith(this)),this},dropRecognizeWith:function(y){return h(y,"dropRecognizeWith",this)?this:(y=ya(y,this),delete this.simultaneous[y.id],this)},requireFailure:function(y){if(h(y,"requireFailure",this))return this;var S=this.requireFail;return y=ya(y,this),j(S,y)===-1&&(S.push(y),y.requireFailure(this)),this},dropRequireFailure:function(y){if(h(y,"dropRequireFailure",this))return this;y=ya(y,this);var S=j(this.requireFail,y);return S>-1&&this.requireFail.splice(S,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(y){return!!this.simultaneous[y.id]},emit:function(y){var S=this,b=this.state;function O(N){S.manager.emit(N,y)}b<Nn&&O(S.options.event+Qg(b)),O(S.options.event),y.additionalEvent&&O(y.additionalEvent),b>=Nn&&O(S.options.event+Qg(b))},tryEmit:function(y){if(this.canEmit())return this.emit(y);this.state=Kt},canEmit:function(){for(var y=0;y<this.requireFail.length;){if(!(this.requireFail[y].state&(Kt|ma)))return!1;y++}return!0},recognize:function(y){var S=T({},y);if(!w(this.options.enable,[this,S])){this.reset(),this.state=Kt;return}this.state&(gn|Ps|Kt)&&(this.state=ma),this.state=this.process(S),this.state&(St|ii|Nn|Ps)&&this.tryEmit(S)},process:function(y){},getTouchAction:function(){},reset:function(){}};function Qg(y){return y&Ps?"cancel":y&Nn?"end":y&ii?"move":y&St?"start":""}function Jg(y){return y==As?"down":y==ws?"up":y==rt?"left":y==Es?"right":""}function ya(y,S){var b=S.manager;return b?b.get(y):y}function Mt(){_n.apply(this,arguments)}p(Mt,_n,{defaults:{pointers:1},attrTest:function(y){var S=this.options.pointers;return S===0||y.pointers.length===S},process:function(y){var S=this.state,b=y.eventType,O=S&(St|ii),N=this.attrTest(y);return O&&(b&Me||!N)?S|Ps:O||N?b&se?S|Nn:S&St?S|ii:St:Kt}});function va(){Mt.apply(this,arguments),this.pX=null,this.pY=null}p(va,Mt,{defaults:{event:"pan",threshold:10,pointers:1,direction:Dg},getTouchAction:function(){var y=this.options.direction,S=[];return y&Yt&&S.push(Rs),y&vr&&S.push(bs),S},directionTest:function(y){var S=this.options,b=!0,O=y.distance,N=y.direction,z=y.deltaX,Z=y.deltaY;return N&S.direction||(S.direction&Yt?(N=z===0?pn:z<0?rt:Es,b=z!=this.pX,O=Math.abs(y.deltaX)):(N=Z===0?pn:Z<0?ws:As,b=Z!=this.pY,O=Math.abs(y.deltaY))),y.direction=N,b&&O>S.threshold&&N&S.direction},attrTest:function(y){return Mt.prototype.attrTest.call(this,y)&&(this.state&St||!(this.state&St)&&this.directionTest(y))},emit:function(y){this.pX=y.deltaX,this.pY=y.deltaY;var S=Jg(y.direction);S&&(y.additionalEvent=this.options.event+S),this._super.emit.call(this,y)}});function Yu(){Mt.apply(this,arguments)}p(Yu,Mt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Tr]},attrTest:function(y){return this._super.attrTest.call(this,y)&&(Math.abs(y.scale-1)>this.options.threshold||this.state&St)},emit:function(y){if(y.scale!==1){var S=y.scale<1?"in":"out";y.additionalEvent=this.options.event+S}this._super.emit.call(this,y)}});function Ku(){_n.apply(this,arguments),this._timer=null,this._input=null}p(Ku,_n,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Zg]},process:function(y){var S=this.options,b=y.pointers.length===S.pointers,O=y.distance<S.threshold,N=y.deltaTime>S.time;if(this._input=y,!O||!b||y.eventType&(se|Me)&&!N)this.reset();else if(y.eventType&fe)this.reset(),this._timer=f(function(){this.state=gn,this.tryEmit()},S.time,this);else if(y.eventType&se)return gn;return Kt},reset:function(){clearTimeout(this._timer)},emit:function(y){this.state===gn&&(y&&y.eventType&se?this.manager.emit(this.options.event+"up",y):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}});function qu(){Mt.apply(this,arguments)}p(qu,Mt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Tr]},attrTest:function(y){return this._super.attrTest.call(this,y)&&(Math.abs(y.rotation)>this.options.threshold||this.state&St)}});function Zu(){Mt.apply(this,arguments)}p(Zu,Mt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Yt|vr,pointers:1},getTouchAction:function(){return va.prototype.getTouchAction.call(this)},attrTest:function(y){var S=this.options.direction,b;return S&(Yt|vr)?b=y.overallVelocity:S&Yt?b=y.overallVelocityX:S&vr&&(b=y.overallVelocityY),this._super.attrTest.call(this,y)&&S&y.offsetDirection&&y.distance>this.options.threshold&&y.maxPointers==this.options.pointers&&c(b)>this.options.velocity&&y.eventType&se},emit:function(y){var S=Jg(y.offsetDirection);S&&this.manager.emit(this.options.event+S,y),this.manager.emit(this.options.event,y)}});function Ta(){_n.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}p(Ta,_n,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[$u]},process:function(y){var S=this.options,b=y.pointers.length===S.pointers,O=y.distance<S.threshold,N=y.deltaTime<S.time;if(this.reset(),y.eventType&fe&&this.count===0)return this.failTimeout();if(O&&N&&b){if(y.eventType!=se)return this.failTimeout();var z=this.pTime?y.timeStamp-this.pTime<S.interval:!0,Z=!this.pCenter||da(this.pCenter,y.center)<S.posThreshold;this.pTime=y.timeStamp,this.pCenter=y.center,!Z||!z?this.count=1:this.count+=1,this._input=y;var Oe=this.count%S.taps;if(Oe===0)return this.hasRequireFailures()?(this._timer=f(function(){this.state=gn,this.tryEmit()},S.interval,this),St):gn}return Kt},failTimeout:function(){return this._timer=f(function(){this.state=Kt},this.options.interval,this),Kt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==gn&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function mn(y,S){return S=S||{},S.recognizers=R(S.recognizers,mn.defaults.preset),new Qu(y,S)}mn.VERSION="2.0.7",mn.defaults={domEvents:!1,touchAction:qg,enable:!0,inputTarget:null,inputClass:null,preset:[[qu,{enable:!1}],[Yu,{enable:!1},["rotate"]],[Zu,{direction:Yt}],[va,{direction:Yt},["swipe"]],[Ta],[Ta,{event:"doubletap",taps:2},["tap"]],[Ku]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var A1=1,Gg=2;function Qu(y,S){this.options=T({},mn.defaults,S||{}),this.options.inputTarget=this.options.inputTarget||y,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=y,this.input=e1(this),this.touchAction=new Xu(this,this.options.touchAction),e_(this,!0),d(this.options.recognizers,function(b){var O=this.add(new b[0](b[1]));b[2]&&O.recognizeWith(b[2]),b[3]&&O.requireFailure(b[3])},this)}Qu.prototype={set:function(y){return T(this.options,y),y.touchAction&&this.touchAction.update(),y.inputTarget&&(this.input.destroy(),this.input.target=y.inputTarget,this.input.init()),this},stop:function(y){this.session.stopped=y?Gg:A1},recognize:function(y){var S=this.session;if(!S.stopped){this.touchAction.preventDefaults(y);var b,O=this.recognizers,N=S.curRecognizer;(!N||N&&N.state&gn)&&(N=S.curRecognizer=null);for(var z=0;z<O.length;)b=O[z],S.stopped!==Gg&&(!N||b==N||b.canRecognizeWith(N))?b.recognize(y):b.reset(),!N&&b.state&(St|ii|Nn)&&(N=S.curRecognizer=b),z++}},get:function(y){if(y instanceof _n)return y;for(var S=this.recognizers,b=0;b<S.length;b++)if(S[b].options.event==y)return S[b];return null},add:function(y){if(h(y,"add",this))return this;var S=this.get(y.options.event);return S&&this.remove(S),this.recognizers.push(y),y.manager=this,this.touchAction.update(),y},remove:function(y){if(h(y,"remove",this))return this;if(y=this.get(y),y){var S=this.recognizers,b=j(S,y);b!==-1&&(S.splice(b,1),this.touchAction.update())}return this},on:function(y,S){if(y!==i&&S!==i){var b=this.handlers;return d(U(y),function(O){b[O]=b[O]||[],b[O].push(S)}),this}},off:function(y,S){if(y!==i){var b=this.handlers;return d(U(y),function(O){S?b[O]&&b[O].splice(j(b[O],S),1):delete b[O]}),this}},emit:function(y,S){this.options.domEvents&&b1(y,S);var b=this.handlers[y]&&this.handlers[y].slice();if(!(!b||!b.length)){S.type=y,S.preventDefault=function(){S.srcEvent.preventDefault()};for(var O=0;O<b.length;)b[O](S),O++}},destroy:function(){this.element&&e_(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function e_(y,S){var b=y.element;if(b.style){var O;d(y.options.cssProps,function(N,z){O=K(b.style,z),S?(y.oldCssProps[O]=b.style[O],b.style[O]=N):b.style[O]=y.oldCssProps[O]||""}),S||(y.oldCssProps={})}}function b1(y,S){var b=n.createEvent("Event");b.initEvent(y,!0,!0),b.gesture=S,S.target.dispatchEvent(b)}T(mn,{INPUT_START:fe,INPUT_MOVE:ut,INPUT_END:se,INPUT_CANCEL:Me,STATE_POSSIBLE:ma,STATE_BEGAN:St,STATE_CHANGED:ii,STATE_ENDED:Nn,STATE_RECOGNIZED:gn,STATE_CANCELLED:Ps,STATE_FAILED:Kt,DIRECTION_NONE:pn,DIRECTION_LEFT:rt,DIRECTION_RIGHT:Es,DIRECTION_UP:ws,DIRECTION_DOWN:As,DIRECTION_HORIZONTAL:Yt,DIRECTION_VERTICAL:vr,DIRECTION_ALL:Dg,Manager:Qu,Input:Tt,TouchAction:Xu,TouchInput:ga,MouseInput:pa,PointerEventInput:ju,TouchMouseInput:Hu,SingleTouchInput:Hg,Recognizer:_n,AttrRecognizer:Mt,Tap:Ta,Pan:va,Swipe:Zu,Pinch:Yu,Rotate:qu,Press:Ku,on:x,off:M,each:d,merge:g,extend:A,assign:T,inherit:p,bindFn:_,prefixed:K});var R1=typeof e<"u"?e:typeof self<"u"?self:{};R1.Hammer=mn,typeof i=="function"&&i.amd?i(function(){return mn}):t.exports?t.exports=mn:e[r]=mn})(window,document,"Hammer")})(gw);var fa=gw.exports;const UF=cp(fa),en=x1({__proto__:null,default:UF},[fa]),_w=1,mw=2,Wd=4,LF={mousedown:_w,mousemove:mw,mouseup:Wd};function zF(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function VF(t){const e=t.prototype.handler;t.prototype.handler=function(r){const i=this.store;r.button>0&&r.type==="pointerdown"&&(zF(i,s=>s.pointerId===r.pointerId)||i.push(r)),e.call(this,r)}}function WF(t){t.prototype.handler=function(n){let r=LF[n.type];r&_w&&n.button>=0&&(this.pressed=!0),r&mw&&n.buttons===0&&(r=Wd),this.pressed&&(r&Wd&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}VF(fa.PointerEventInput);WF(fa.MouseInput);const jF=fa.Manager;class Uu{constructor(e,n,r){this.element=e,this.callback=n,this.options={enable:!0,...r}}}const HF=en?[[en.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[en.Rotate,{enable:!1}],[en.Pinch,{enable:!1}],[en.Swipe,{enable:!1}],[en.Pan,{threshold:0,enable:!1}],[en.Press,{enable:!1}],[en.Tap,{event:"doubletap",taps:2,enable:!1}],[en.Tap,{event:"anytap",enable:!1}],[en.Tap,{enable:!1}]]:null,a0={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},$F={doubletap:["tap"]},XF={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Ig={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},YF={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},l0={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},KF=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",ki=typeof window<"u"?window:global;let jd=!1;try{const t={get passive(){return jd=!0,!0}};ki.addEventListener("test",null,t),ki.removeEventListener("test",null)}catch{jd=!1}const qF=KF.indexOf("firefox")!==-1,{WHEEL_EVENTS:ZF}=Ig,c0="wheel",u0=4.000244140625,QF=40,JF=.25;class GF extends Uu{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;ki.WheelEvent&&(qF&&i.deltaMode===ki.WheelEvent.DOM_DELTA_PIXEL&&(s/=ki.devicePixelRatio),i.deltaMode===ki.WheelEvent.DOM_DELTA_LINE&&(s*=QF)),s!==0&&s%u0===0&&(s=Math.floor(s/u0)),i.shiftKey&&s&&(s=s*JF),this.callback({type:c0,center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},this.events=(this.options.events||[]).concat(ZF),this.events.forEach(i=>e.addEventListener(i,this.handleEvent,jd?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===c0&&(this.options.enable=n)}}const{MOUSE_EVENTS:eD}=Ig,f0="pointermove",h0="pointerover",d0="pointerout",p0="pointerenter",g0="pointerleave";class tD extends Uu{constructor(e,n,r){super(e,n,r),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(eD),this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===f0&&(this.enableMoveEvent=n),e===h0&&(this.enableOverEvent=n),e===d0&&(this.enableOutEvent=n),e===p0&&(this.enableEnterEvent=n),e===g0&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(h0,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(d0,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(p0,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(g0,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit(f0,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:nD}=Ig,_0="keydown",m0="keyup";class rD extends Uu{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:_0,srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:m0,srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(nD),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===_0&&(this.enableDownEvent=n),e===m0&&(this.enableUpEvent=n)}}const y0="contextmenu";class iD extends Uu{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:y0,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===y0&&(this.options.enable=n)}}const v0=1,Hd=2,T0=4,sD={pointerdown:v0,pointermove:Hd,pointerup:T0,mousedown:v0,mousemove:Hd,mouseup:T0},oD=0,aD=1,lD=2,cD=1,uD=2,fD=4;function hD(t){const e=sD[t.srcEvent.type];if(!e)return null;const{buttons:n,button:r}=t.srcEvent;let i=!1,s=!1,o=!1;return e===Hd?(i=!!(n&cD),s=!!(n&fD),o=!!(n&uD)):(i=r===oD,s=r===aD,o=r===lD),{leftButton:i,middleButton:s,rightButton:o}}function dD(t,e){const n=t.center;if(!n)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,s=r.height/e.offsetHeight||1,o={x:(n.x-r.left-e.clientLeft)/i,y:(n.y-r.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const nh={srcElement:"root",priority:0};class pD{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const r=this._normalizeEvent(n);let i=n.srcEvent.target;for(;i&&i!==r.rootElement;){if(this._emit(r,i),r.handled)return;i=i.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,r,i=!1,s=!1){const{handlers:o,handlersByElement:a}=this;let l=nh;typeof r=="string"||r&&r.addEventListener?l={...nh,srcElement:r}:r&&(l={...nh,...r});let c=a.get(l.srcElement);c||(c=[],a.set(l.srcElement,c));const u={type:e,handler:n,srcElement:l.srcElement,priority:l.priority};i&&(u.once=!0),s&&(u.passive=!0),o.push(u),this._active=this._active||!u.passive;let f=c.length-1;for(;f>=0&&!(c[f].priority>=u.priority);)f--;c.splice(f+1,0,u)}remove(e,n){const{handlers:r,handlersByElement:i}=this;for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.type===e&&o.handler===n){r.splice(s,1);const a=i.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&i.delete(o.srcElement)}}this._active=r.some(s=>!s.passive)}_emit(e,n){const r=this.handlersByElement.get(n);if(r){let i=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,i=!0},a=[];for(let l=0;l<r.length;l++){const{type:c,handler:u,once:f}=r[l];if(u({...e,type:c,stopPropagation:s,stopImmediatePropagation:o}),f&&a.push(r[l]),i)break}for(let l=0;l<a.length;l++){const{type:c,handler:u}=a[l];this.remove(c,u)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...hD(e),...dD(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const gD={events:null,recognizers:null,recognizerOptions:{},Manager:jF,touchAction:"none",tabIndex:0};class _D{constructor(e=null,n){this._onBasicInput=i=>{const{srcEvent:s}=i,o=XF[s.type];o&&this.manager.emit(o,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={...gD,...n},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,r=n.Manager;this.manager=new r(e,{touchAction:n.touchAction,recognizers:n.recognizers||HF}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(a0).forEach(i=>{const s=this.manager.get(i);s&&a0[i].forEach(o=>{s.recognizeWith(o)})});for(const i in n.recognizerOptions){const s=this.manager.get(i);if(s){const o=n.recognizerOptions[i];delete o.enable,s.set(o)}}this.wheelInput=new GF(e,this._onOtherEvent,{enable:!1}),this.moveInput=new tD(e,this._onOtherEvent,{enable:!1}),this.keyInput=new rD(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new iD(e,this._onOtherEvent,{enable:!1});for(const[i,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(i,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,r){this._addEventHandler(e,n,r,!1)}once(e,n,r){this._addEventHandler(e,n,r,!0)}watch(e,n,r){this._addEventHandler(e,n,r,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:r}=this;if(!r)return;const i=r.get(e);if(i&&i.options.enable!==n){i.set({enable:n});const s=$F[e];s&&!this.options.recognizers&&s.forEach(o=>{const a=r.get(o);n?(a.requireFailure(e),i.dropRequireFailure(o)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,r,i,s){if(typeof e!="string"){r=n;for(const u in e)this._addEventHandler(u,e[u],r,i,s);return}const{manager:o,events:a}=this,l=l0[e]||e;let c=a.get(l);c||(c=new pD(this),a.set(l,c),c.recognizerName=YF[l]||l,o&&o.on(l,c.handleEvent)),c.add(e,n,r,i,s),c.isEmpty()||this._toggleRecognizer(c.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:r}=this,i=l0[e]||e,s=r.get(i);if(s&&(s.remove(e,n),s.isEmpty())){const{recognizerName:o}=s;let a=!1;for(const l of r.values())if(l.recognizerName===o&&!l.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}}function Ln(){}const mD=({isDragging:t})=>t?"grabbing":"grab",S0={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Ln,onWebGLInitialized:Ln,onResize:Ln,onViewStateChange:Ln,onInteractionStateChange:Ln,onBeforeRender:Ln,onAfterRender:Ln,onLoad:Ln,onError:t=>Q.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:mD,getTooltip:null,debug:!1,drawPickingColors:!1},Qc=class Qc{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Mu({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:i}=this;if(r.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(r.leftButton||r.rightButton)return;{const s=r.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=r},this._onEvent=r=>{const i=Od[r.type],s=r.offsetCenter;if(!i||!s||!this.layerManager)return;const o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:o,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:l}=a,c=l&&(l[i.handler]||l.props[i.handler]),u=this.props[i.handler];let f=!1;c&&(f=c.call(l,a,r)),f||(u==null||u(a,r),this.widgetManager.onEvent(a,r))},this._onPointerDown=r=>{const i=r.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...S0,...e},e=this.props,e.viewState&&e.initialViewState&&Q.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&Q.error("WebGL1 context not supported.")(),this.device=go.attach(e.gl));let n=this.device;n||(Wi.registerDevices([go]),n=Wi.createDevice({...e.deviceProps,canvas:this._createCanvas(e)})),this.animationLoop=this._createAnimationLoop(n,e),this.setProps(e),e._typedArrayManagerProps&&ds.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,r,i,s,o,a,l,c,u;(e=this.animationLoop)==null||e.stop(),(n=this.animationLoop)==null||n.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(i=this.viewManager)==null||i.finalize(),this.viewManager=null,(s=this.effectManager)==null||s.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(a=this.deckPicker)==null||a.finalize(),this.deckPicker=null,(l=this.eventManager)==null||l.destroy(),this.eventManager=null,(c=this.widgetManager)==null||c.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((u=this.canvas.parentElement)==null||u.removeChild(this.canvas),this.canvas=null)}setProps(e){var r;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Q.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Q.removed("onLayerClick","onClick")(),e.initialViewState&&!Bt(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(r=this.animationLoop)==null||r.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n),this.widgetManager.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||r||i||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Pe(this.viewManager),this.viewManager.views}getViewports(e){return Pe(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var n;(n=this.layerManager)==null||n.removeDefaultShaderModule(e)}_pick(e,n,r){Pe(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Pe(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){var i;if(!this.canvas)return;const{width:n,height:r}=e;if(n||n===0){const s=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=s}if(r||r===0){const s=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((i=e.style)==null?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var i,s;const{canvas:e}=this;if(!e)return;const n=e.clientWidth??e.width,r=e.clientHeight??e.height;(n!==this.width||r!==this.height)&&(this.width=n,this.height=r,(i=this.viewManager)==null||i.setProps({width:n,height:r}),(s=this.layerManager)==null||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:r}))}_createAnimationLoop(e,n){const{gl:r,onError:i,useDevicePixels:s}=n;return new VO({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,n=Array.isArray(e)?e:e?[e]:[new Pc({id:"default-view"})];return n.length&&this.props.controller&&(n[0].props.controller=this.props.controller),n}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var n,r,i;const{_pickRequest:e}=this;if(e.event){const{result:s,emptyInfo:o}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=s.length>0;let a=o,l=!1;for(const c of s)a=c,l=((n=c.layer)==null?void 0:n.onHover(c,e.event))||l;l||((i=(r=this.props).onHover)==null||i.call(r,a,e.event),this.widgetManager.onHover(a,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var i,s;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(i=this.device.canvasContext)==null?void 0:i.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof go&&this.props.onWebGLInitialized(this.device.gl);const n=new ZE;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new _D(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in Od)this.eventManager.on(o,this._onEvent);this.viewManager=new sk({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new ik(this.device,{deck:this,stats:this.stats,viewport:r,timeline:n}),this.effectManager=new Ek({deck:this,device:this.device}),this.deckRenderer=new bk(this.device),this.deckPicker=new Mk(this.device),this.widgetManager=new Nk({deck:this,parentElement:(s=this.canvas)==null?void 0:s.parentElement}),this.widgetManager.addDefault(new Dk),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){var o;const{device:r,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:i});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n};(o=this.deckRenderer)==null||o.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:r,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Q.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const r=Wi.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}};Qc.defaultProps=S0,Qc.VERSION=G3;let $o=Qc;function yD(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return SE(t)}}const vD=TE;function Ga(t,e){return{attribute:t,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function Nr(t){return t.stride||t.size*t.bytesPerElement}function TD(t,e){return t.type===e.type&&t.size===e.size&&Nr(t)===Nr(e)&&(t.offset||0)===(e.offset||0)}function $d(t,e){e.offset&&Q.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=Nr(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,i=e.elementOffset||0,s=r*n+i*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function SD(t,e){const n=$d(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class ED{constructor(e,n,r){this._buffer=null,this.device=e,this.id=n.id||"",this.size=n.size||1;const i=n.logicalType||n.type,s=i==="float64";let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;s?a="float32":!i&&n.isIndexed?a="uint32":a=i||"float32";let l=yD(i||a);this.doublePrecision=s,s&&n.fp64===!1&&(l=Float32Array),this.value=null,this.settings={...n,defaultType:l,defaultValue:o,logicalType:i,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Nr(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),ds.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,n=null){const r={};if(this.state.constant){const i=this.value;if(n){const s=$d(this.getAccessor(),n),o=s.offset/i.BYTES_PER_ELEMENT,a=s.size||this.size;r[e]=i.subarray(o,o+a)}else r[e]=i}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,n=null){const r=this.getAccessor(),i=[],s={name:this.id,byteStride:Nr(r),attributes:i};if(this.doublePrecision){const o=SD(r,n||{});i.push(Ga(e,{...r,...o.high}),Ga(`${e}64Low`,{...r,...o.low}))}else if(n){const o=$d(r,n);i.push(Ga(e,{...r,...o}))}else i.push(Ga(e,r));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:r,size:i}=this,s=r*i;if(n&&s&&n.length>=s){const o=new Array(i).fill(1/0),a=new Array(i).fill(-1/0);for(let l=0;l<s;)for(let c=0;c<i;c++){const u=n[l++];u<o[c]&&(o[c]=u),u>a[c]&&(a[c]=u)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof _e?r={buffer:e}:r=e;const i={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)i.type="float32";else{const o=vD(r.value);i.type=i.normalized?o.replace("int","norm"):o}i.bytesPerElement=r.value.BYTES_PER_ELEMENT,i.stride=Nr(i)}if(n.bounds=null,r.constant){let s=r.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(r.buffer){const s=r.buffer;n.externalBuffer=s,n.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let s=r.value;n.externalBuffer=null,n.constant=!1,this.value=s;let{buffer:o}=this;const a=Nr(i),l=(i.vertexOffset||0)*a;if(this.doublePrecision&&s instanceof Float64Array&&(s=jf(s,i)),this.settings.isIndexed){const u=this.settings.defaultType;s.constructor!==u&&(s=new u(s))}const c=s.byteLength+l+a*2;(!o||o.byteLength<c)&&(o=this._createBuffer(c)),o.write(s,l)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&n instanceof Float64Array?jf(n,{size:this.size,startIndex:r,endIndex:i}):n.subarray(r,i),r*n.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,n=!1){const{state:r}=this,i=r.allocatedValue,s=ds.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{byteOffset:o}=this;let{buffer:a}=this;return(!a||a.byteLength<s.byteLength+o)&&(a=this._createBuffer(s.byteLength+o),n&&i&&a.write(i instanceof Float64Array?jf(i,this):i,o)),r.allocatedValue=s,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=n.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${n.constructor.name}`);!(n instanceof r)&&this.settings.normalized&&!("normalized"in e)&&Q.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(n=>(n+128)/255*2-1);case"snorm16":return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(n=>n/255);case"unorm16":return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,r){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return n[r]=e,n;if(!e){let o=s;for(;--o>=0;)n[r+o]=i[o];return n}switch(s){case 4:n[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:n[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:n[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:n[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let o=s;for(;--o>=0;)n[r+o]=Number.isFinite(e[o])?e[o]:i[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==n[i])return!1;return!0}_createBuffer(e){var i;this._buffer&&this._buffer.destroy();const{isIndexed:n,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(i=this._buffer)==null?void 0:i.props,id:this.id,usage:n?_e.INDEX:_e.VERTEX,indexType:n?r:void 0,byteLength:e}),this._buffer}}const E0=[],w0=[];function Lu(t,e=0,n=1/0){let r=E0;const i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(w0.length=t.length,r=w0):r=E0,(e>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,n),i.index=e-1),{iterable:r,objectInfo:i}}function yw(t){return t&&t[Symbol.asyncIterator]}function vw(t,e){const{size:n,stride:r,offset:i,startIndices:s,nested:o}=e,a=t.BYTES_PER_ELEMENT,l=r?r/a:n,c=i?i/a:0,u=Math.floor((t.length-c)/l);return(f,{index:h,target:d})=>{if(!s){const g=h*l+c;for(let p=0;p<n;p++)d[p]=t[g+p];return d}const m=s[h],T=s[h+1]||u;let A;if(o){A=new Array(T-m);for(let g=m;g<T;g++){const p=g*l+c;d=new Array(n);for(let _=0;_<n;_++)d[_]=t[p+_];A[g-m]=d}}else if(l===n)A=t.subarray(m*n+c,T*n+c);else{A=new t.constructor((T-m)*n);let g=0;for(let p=m;p<T;p++){const _=p*l+c;for(let w=0;w<n;w++)A[g++]=t[_+w]}}return A}}const wD=[],Pl=[[0,1/0]];function AD(t,e){if(t===Pl||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],r=t.length;let i=0;for(let s=0;s<r;s++){const o=t[s];o[1]<e[0]?(n.push(o),i=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(i,0,e),n}const bD={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function Tw(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...bD[n],...e,...t,type:n}}class Sw extends ED{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Pl}),this.constant=!1,this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var n;(n=this.state).layoutChanged||(n.layoutChanged=!TD(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,r=this.settings.transition,i=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return Tw(i,r)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:r=0,endRow:i=1/0}=n;this.state.updateRanges=AD(this.state.updateRanges,[r,i])}else this.state.updateRanges=Pl}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=wD}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,n.updateRanges!==Pl),!0):!1}updateBuffer({numInstances:e,data:n,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this;let l=!0;if(o){for(const[c,u]of s)o.call(i,this,{data:n,startRow:c,endRow:u,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[c,u]of s){const f=Number.isFinite(c)?this.getVertexOffset(c):0,h=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:f,endOffset:h})}this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;Pe(ArrayBuffer.isView(o.value),`invalid ${i.accessor}`);const a=!!o.size&&o.size!==this.size;return r.binaryAccessor=vw(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,n=super.getValue();if(!e)return n;for(const r in e)Object.assign(n,super.getValue(r,e[r]));return n}getBufferLayout(e){this.state.layoutChanged=!1;const n=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=i??"vertex",!n)return r;for(const s in n){const o=super._getBufferLayout(s,n[s]);r.attributes.push(...o.attributes)}return r}_autoUpdater(e,{data:n,startRow:r,endRow:i,props:s,numInstances:o}){if(e.constant)return;const{settings:a,state:l,value:c,size:u,startIndices:f}=e,{accessor:h,transform:d}=a,m=l.binaryAccessor||(typeof h=="function"?h:s[h]);Pe(typeof m=="function",`accessor "${h}" is not a function`);let T=e.getVertexOffset(r);const{iterable:A,objectInfo:g}=Lu(n,r,i);for(const p of A){g.index++;let _=m(p,g);if(d&&(_=d.call(this,_)),f){const w=(g.index<f.length-1?f[g.index+1]:o)-f[g.index];if(_&&Array.isArray(_[0])){let R=T;for(const x of _)e._normalizeValue(x,c,R),R+=u}else _&&_.length>u?c.set(_,T):(e._normalizeValue(_,g.target,0),GO({target:c,source:g.target,start:T,count:w}));T+=w*u}else e._normalizeValue(_,c,T),T+=u}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let r=!0;switch(n){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function rh(t){const{source:e,target:n,start:r=0,size:i,getData:s}=t,o=t.end||n.length,a=e.length,l=o-r;if(a>l){n.set(e.subarray(0,l),r);return}if(n.set(e,r),!s)return;let c=a;for(;c<l;){const u=s(c,e);for(let f=0;f<i;f++)n[r+c]=u[f]||0,c++}}function RD({source:t,target:e,size:n,getData:r,sourceStartIndices:i,targetStartIndices:s}){if(!i||!s)return rh({source:t,target:e,size:n,getData:r}),e;let o=0,a=0;const l=r&&((u,f)=>r(u+a,f)),c=Math.min(i.length,s.length);for(let u=1;u<c;u++){const f=i[u]*n,h=s[u]*n;rh({source:t.subarray(o,f),target:e,start:a,end:h,size:n,getData:l}),o=f,a=h}return a<e.length&&rh({source:[],target:e,start:a,size:n,getData:l}),e}function PD(t){const{device:e,settings:n,value:r}=t,i=new Sw(e,n);return i.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),i}function Ew(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function ww(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function Aw(t){t.push(t.shift())}function CD(t,e){const{doublePrecision:n,settings:r,value:i,size:s}=t,o=n&&i instanceof Float64Array?2:1;let a=0;const{shaderAttributes:l}=t.settings;if(l)for(const c of Object.values(l))a=Math.max(a,c.vertexOffset??0);return(r.noAlloc?i.length:(e+a)*s)*o}function bw({device:t,source:e,target:n}){return(!n||n.byteLength<e.byteLength)&&(n==null||n.destroy(),n=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),n}function Rw({device:t,buffer:e,attribute:n,fromLength:r,toLength:i,fromStartIndices:s,getData:o=a=>a}){const a=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*a,c=n.byteOffset,u=n.settings.bytesPerElement<4?c/n.settings.bytesPerElement*4:c,f=n.startIndices,h=s&&f,d=n.isConstant;if(!h&&e&&r>=i)return e;const m=n.value instanceof Float64Array?Float32Array:n.value.constructor,T=d?n.value:new m(n.getBuffer().readSyncWebGL(c,i*m.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!d){const _=o;o=(w,R)=>n.normalizeConstant(_(w,R))}const A=d?(_,w)=>o(T,w):(_,w)=>o(T.subarray(_+c,_+c+l),w),g=e?new Float32Array(e.readSyncWebGL(u,r*4).buffer):new Float32Array(0),p=new Float32Array(i);return RD({source:g,target:p,sourceStartIndices:s,targetStartIndices:f,size:l,getData:A}),(!e||e.byteLength<p.byteLength+u)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:p.byteLength+u,usage:35050})),e.write(p,u),e}class Pw{constructor({device:e,attribute:n,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Fu(r),this.attribute=n,this.attributeInTransition=PD(n),this.currentStartIndices=n.startIndices}get inProgress(){return this.transition.inProgress}start(e,n,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=CD(this.attribute,n),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class xD extends Pw{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="interpolation",this.transform=OD(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;if(super.start(e,n,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:o}=this;Aw(s),s[0]=Rw({device:this.device,buffer:s[0],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),s[1]=bw({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:a}=this,l=a.model;let c=Math.floor(this.currentLength/o.size);Cw(o)&&(c/=2),l.setVertexCount(c),o.isConstant?(l.setAttributes({aFrom:s[0]}),l.setConstantAttributes({aTo:o.value})):l.setAttributes({aFrom:s[0],aTo:o.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:n}=this.settings,{time:r}=this.transition;let i=r/e;n&&(i=n(i));const{model:s}=this.transform;s.setUniforms({time:i}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const ID=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`,MD=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function Cw(t){return t.doublePrecision&&t.value instanceof Float64Array}function OD(t,e){const n=e.size,r=Ew(n),i=ww(n),s=e.getBufferLayout();return Cw(e)?new jo(t,{vs:MD,bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*n}]}],modules:[RI],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new jo(t,{vs:ID,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:s.attributes[0].format}],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class kD extends Pw{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="spring",this.texture=BD(e),this.framebuffer=UD(e,this.texture),this.transform=DD(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;super.start(e,n);const{buffers:s,attribute:o}=this;for(let l=0;l<2;l++)s[l]=Rw({device:this.device,buffer:s[l],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});s[2]=bw({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?a.setConstantAttributes({aTo:o.value}):a.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:n,framebuffer:r,transition:i}=this,s=this.settings;n.model.setAttributes({aPrev:e[0],aCur:e[1]}),n.transformFeedback.setBuffers({vNext:e[2]}),n.model.setUniforms({stiffness:s.stiffness,damping:s.damping}),n.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),Aw(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const ND=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,FD=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function DD(t,e){const n=Ew(e.size),r=ww(e.size);return new jo(t,{vs:ND,fs:FD,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function BD(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function UD(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const LD={interpolation:xD,spring:kD};class zD{constructor(e,{id:n,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=n,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:r}){this.numInstances=r||1;for(const i in e){const s=e[i],o=s.getTransitionSetting(n);o&&this._updateAttribute(i,s,o)}for(const i in this.transitions){const s=e[i];(!s||!s.getTransitionSetting(n))&&this._removeTransition(i)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const r=this.transitions[n];r.inProgress&&(e[n]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,n,r){const i=this.transitions[e];let s=!i||i.type!==r.type;if(s){i&&this._removeTransition(e);const o=LD[r.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,device:this.device}):(Q.error(`unsupported transition type '${r.type}'`)(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const A0="attributeManager.invalidate",VD="attributeManager.updateStart",WD="attributeManager.updateEnd",jD="attribute.updateStart",HD="attribute.allocate",$D="attribute.updateEnd";class XD{constructor(e,{id:n="attribute-manager",stats:r,timeline:i}={}){this.mergeBoundsMemoized=la(IO),this.id=n,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new zD(e,{id:`${n}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const r=this._invalidateTrigger(e,n);Ye(A0,this,e,r)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);Ye(A0,this,"all")}update({data:e,numInstances:n,startIndices:r=null,transitions:i,props:s={},buffers:o={},context:a={}}){let l=!1;Ye(VD,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const c in this.attributes){const u=this.attributes[c],f=u.settings.accessor;u.startIndices=r,u.numInstances=n,s[c]&&Q.removed(`props.${c}`,`data.attributes.${c}`)(),u.setExternalBuffer(o[c])||u.setBinaryValue(typeof f=="string"?o[f]:void 0,e.startIndices)||typeof f=="string"&&!o[f]&&u.setConstantValue(s[f])||u.needsUpdate()&&(l=!0,this._updateAttribute({attribute:u,numInstances:n,data:e,props:s,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}l&&Ye(WD,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const n=e.map(r=>{var i;return(i=this.attributes[r])==null?void 0:i.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!r.hasAttribute(s)&&(i[s]=o)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(n=>n.getBufferLayout(e))}_add(e,n){for(const r in e){const i=e[r],s={...i,id:r,size:i.isIndexed&&1||i.size||1,...n};this.attributes[r]=new Sw(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:r,updateTriggers:i}=this,s=i[e];return s&&s.forEach(o=>{const a=r[o];a&&a.setNeedsUpdate(a.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:r}=e;if(Ye(jD,n),n.constant){n.setConstantValue(n.value);return}n.allocate(r)&&Ye(HD,n,r),n.updateBuffer(e)&&(this.needsRedraw=!0,Ye($D,n,r))}}class YD extends Fu{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:r,duration:i,easing:s}}=this,o=s(e/i);this._value=Sc(n,r,o)}}const b0=1e-5;function R0(t,e,n,r,i){const s=e-t,a=(n-e)*i,l=-s*r;return a+l+s+e}function KD(t,e,n,r,i){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=R0(t[o],e[o],n[o],r,i);return s}return R0(t,e,n,r,i)}function P0(t,e){if(Array.isArray(t)){let n=0;for(let r=0;r<t.length;r++){const i=t[r]-e[r];n+=i*i}return Math.sqrt(n)}return Math.abs(t-e)}class qD extends Fu{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:r,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let a=KD(s,o,n,r,i);const l=P0(a,n),c=P0(a,o);l<b0&&c<b0&&(a=n,this.end()),this._prevValue=o,this._currValue=a}}const ZD={interpolation:YD,spring:qD};class QD{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,r,i){const{transitions:s}=this;if(s.has(e)){const l=s.get(e),{value:c=l.settings.fromValue}=l;n=c,this.remove(e)}if(i=Tw(i),!i)return;const o=ZD[i.type];if(!o){Q.error(`unsupported transition type '${i.type}'`)();return}const a=new o(this.timeline);a.start({...i,fromValue:n,toValue:r}),s.set(e,a)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,r]of this.transitions)r.update(),e[n]=r.value,r.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function JD(t){const e=t[ar];for(const n in e){const r=e[n],{validate:i}=r;if(i&&!i(t[n],r))throw new Error(`Invalid prop ${n}: ${t[n]}`)}}function GD(t,e){const n=xw({newProps:t,oldProps:e,propTypes:t[ar],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=t4(t,e);let i=!1;return r||(i=n4(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:i,extensionsChanged:r4(t,e),transitionsChanged:e4(t,e)}}function e4(t,e){if(!t.transitions)return!1;const n={},r=t[ar];let i=!1;for(const s in t.transitions){const o=r[s],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&Xd(t[s],e[s],o)&&(n[s]=!0,i=!0)}return i?n:!1}function xw({newProps:t,oldProps:e,ignoreProps:n={},propTypes:r={},triggerName:i="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return`${i}.${s} added`;const o=Xd(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return`${i}.${s} dropped`;if(!Object.hasOwnProperty.call(t,s)){const o=Xd(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}}return!1}function Xd(t,e,n){let r=n&&n.equal;return r&&!r(t,e,n)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function t4(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:i}=t;return r?r(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&i&&(n=i(t.data,e.data)||n),n}function n4(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&C0(t,e,"all"))return{all:!0};const n={};let r=!1;for(const i in t.updateTriggers)i!=="all"&&C0(t,e,i)&&(n[i]=!0,r=!0);return r?n:!1}function r4(t,e){if(e===null)return!0;const n=e.extensions,{extensions:r}=t;if(r===n)return!1;if(!n||!r||r.length!==n.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(n[i]))return!0;return!1}function C0(t,e,n){let r=t.updateTriggers[n];r=r??{};let i=e.updateTriggers[n];return i=i??{},xw({oldProps:i,newProps:r,triggerName:n})}const i4="count(): argument not an object",s4="count(): argument not a container";function o4(t){if(!l4(t))throw new Error(i4);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(a4(t))return Object.keys(t).length;throw new Error(s4)}function a4(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function l4(t){return t!==null&&typeof t=="object"}function x0(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=n.modules.findIndex(i=>i.name==="project32");r>=0&&n.modules.splice(r,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const r={...t.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];n.inject=r}return n}const c4={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Yd={};function u4(t,e,n,r){if(n instanceof bt)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let i=null;n.compressed&&(i={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const s=e.createTexture({...n,sampler:{...c4,...i,...r}});return Yd[s.id]=t,s}function f4(t,e){!e||!(e instanceof bt)||Yd[e.id]===t&&(e.delete(),delete Yd[e.id])}const h4={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||Kd(t)&&(t.length===3||t.length===4)},equal(t,e,n){return Bt(t,e,1)}},accessor:{validate(t,e){const n=xc(t);return n==="function"||n===xc(e.value)},equal(t,e,n){return typeof e=="function"?!0:Bt(t,e,1)}},array:{validate(t,e){return e.optional&&!t||Kd(t)},equal(t,e,n){const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?Bt(t,e,i):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?Bt(t,e,i):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{if(!t)return t;const{dataTransform:r}=n.props;return r?r(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,n)=>{const r=n.context;return!r||!r.device?null:u4(n.id,r.device,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{f4(n.id,t)}}};function d4(t){const e={},n={},r={};for(const[i,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)r[i]=Array.isArray(o)?o:[o];else{const a=p4(i,s);e[i]=a,n[i]=a.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}function p4(t,e){switch(xc(e)){case"object":return Ws(t,e);case"array":return Ws(t,{type:"array",value:e,compare:!1});case"boolean":return Ws(t,{type:"boolean",value:e});case"number":return Ws(t,{type:"number",value:e});case"function":return Ws(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Ws(t,e){return"type"in e?{name:t,...h4[e.type],...e}:"value"in e?{name:t,type:xc(e.value),...e}:{name:t,type:"object",value:e}}function Kd(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function xc(t){return Kd(t)?"array":t===null?"null":typeof t}function g4(t,e){let n;for(let s=e.length-1;s>=0;s--){const o=e[s];"extensions"in o&&(n=o.extensions)}const r=qd(t.constructor,n),i=Object.create(r);i[Rc]=t,i[Kr]={},i[Zn]={};for(let s=0;s<e.length;++s){const o=e[s];for(const a in o)i[a]=o[a]}return Object.freeze(i),i}const _4="_mergedDefaultProps";function qd(t,e){let n=_4;if(e)for(const i of e){const s=i.constructor;s&&(n+=`:${s.extensionName||s.name}`)}const r=Iw(t,n);return r||(t[n]=m4(t,e||[]))}function m4(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),i=qd(r),s=Iw(t,"defaultProps")||{},o=d4(s),a=Object.assign(Object.create(null),i,o.defaultProps),l=Object.assign(Object.create(null),i==null?void 0:i[ar],o.propTypes),c=Object.assign(Object.create(null),i==null?void 0:i[Xf],o.deprecatedProps);for(const u of e){const f=qd(u.constructor);f&&(Object.assign(a,f),Object.assign(l,f[ar]),Object.assign(c,f[Xf]))}return y4(a,t),T4(a,l),v4(a,c),a[ar]=l,a[Xf]=c,e.length===0&&!Mg(t,"_propTypes")&&(t._propTypes=l),a}function y4(t,e){const n=E4(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function v4(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(r){const i=`${this.id}: ${n}`;for(const s of e[n])Mg(this,s)||(this[s]=r);Q.deprecated(i,e[n].join("/"))()}})}function T4(t,e){const n={},r={};for(const i in e){const s=e[i],{name:o,value:a}=s;s.async&&(n[o]=a,r[o]=S4(o))}t[$i]=n,t[Kr]={},Object.defineProperties(t,r)}function S4(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||yw(e)?this[Kr][t]=e:this[Zn][t]=e},get(){if(this[Zn]){if(t in this[Zn])return this[Zn][t]||this[$i][t];if(t in this[Kr]){const e=this[Rc]&&this[Rc].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[$i][t]}}return this[$i][t]}}}function Mg(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Iw(t,e){return Mg(t,e)&&t[e]}function E4(t){const e=t.componentName;return e||Q.warn(`${t.name}.componentName not specified`)(),e||t.name}let w4=0;const Jc=class Jc{constructor(...e){this.props=g4(this,e),this.id=this.props.id,this.count=w4++}clone(e){const{props:n}=this,r={};for(const i in n[$i])i in n[Zn]?r[i]=n[Zn][i]:i in n[Kr]&&(r[i]=n[Kr][i]);return new this.constructor({...n,...r,...e})}};Jc.componentName="Component",Jc.defaultProps={};let Zd=Jc;const A4=Object.freeze({});class b4{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||A4}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[Rc]||this.component;const n=e[Zn]||{},r=e[Kr]||e,i=e[$i]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in r){const o=r[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(yw(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const r=this.asyncProps[e];return n===r.resolvedValue||n===r.lastValue?!1:(r.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(n=this._postProcessValue(r,n),r.resolvedValue=n,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,n,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=n,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;n.then(s=>{this.component&&(s=this._postProcessValue(r,s),this._setAsyncPropValue(e,s,i),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let s=[],o=0;for await(const a of n){if(!this.component)return;const{dataTransform:l}=this.component.props;l?s=l(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,n){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(n,r,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const i=this.component&&this.component.props[ar];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class R4 extends b4{constructor({attributeManager:e,layer:n}){super(n),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const r=this.layer,i=r==null?void 0:r.props.fetch;return i?i(n,{propName:e,layer:r}):super._fetch(e,n)}_onResolve(e,n){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:r})}}_onError(e,n){const r=this.layer;r&&r.raiseError(n,`loading ${e} of ${this.layer}`)}}const P4="layer.changeFlag",C4="layer.initialize",x4="layer.update",I4="layer.finalize",M4="layer.matched",I0=2**24-1,O4=Object.freeze([]),k4=la(({oldViewport:t,viewport:e})=>t.equals(e));let tn=new Uint8ClampedArray(0);const N4={data:{type:"data",value:O4,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:r,loadOptions:i,signal:s})=>{const{resourceManager:o}=n.context;i=i||n.getLoadOptions(),r=r||n.props.loaders,s&&(i={...i,fetch:{...i==null?void 0:i.fetch,signal:s}});let a=o.contains(t);return!a&&!i&&(o.add({resourceId:t,data:uc(t,r),persistent:!1}),a=!0),a?o.subscribe({resourceId:t,onChange:l=>{var c;return(c=n.internalState)==null?void 0:c.reloadAsyncProp(e,l)},consumerId:n.id,requestId:e}):uc(t,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:te.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},Gc=class Gc extends Zd{constructor(){super(...arguments),this.internalState=null,this.lifecycle=pi.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Pe(this.internalState);const n=this.internalState.viewport||this.context.viewport,r=qE(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,o]=XE(r,n.pixelProjectionMatrix);return e.length===2?[i,s]:[i,s,o]}unproject(e){return Pe(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Pe(this.internalState);const r=this.internalState.viewport||this.context.viewport;return DO(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}setShaderModuleProps(...e){for(const n of this.getModels())n.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===te.DEFAULT||e===te.LNGLAT||e===te.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Pe(e instanceof Uint8Array);const[n,r,i]=e;return n+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:o4(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=x0(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const n of this.props.extensions)e=x0(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&n)if(Array.isArray(r))for(const i of r)n.invalidateAll(i);else n.invalidateAll();if(n){const{props:i}=e,s=this.internalState.hasPickingBuffer,o=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:a,instancePickingColors:l}=n.attributes,c=a||l;c&&(o&&c.constant&&(c.constant=!1,n.invalidate(c.id)),!c.value&&!o&&(c.constant=!0,c.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,n){var r,i,s,o;n&&(e=new Error(`${n}: ${e.message}`,{cause:e})),(i=(r=this.props).onError)!=null&&i.call(r,e)||(o=(s=this.context)==null?void 0:s.onError)==null||o.call(s,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!k4({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){let n=!1;for(const r in e)e[r].layoutChanged()&&(n=!0);for(const r of this.getModels())this._setModelAttributes(r,e,n)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:n.data,numInstances:r,startIndices:i,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),r=Object.create(this.props);for(const i in n)Object.defineProperty(r,i,{value:n[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const r=Math.floor(tn.length/4);if(this.internalState.usesPickingColorCache=!0,r<n){n>I0&&Q.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),tn=ds.allocate(tn,n,{size:4,copy:!0,maxCount:Math.max(n,I0)});const i=Math.floor(tn.length/4),s=[];for(let o=r;o<i;o++)this.encodePickingColor(o,s),tn[o*4+0]=s[0],tn[o*4+1]=s[1],tn[o*4+2]=s[2]}e.value=tn.subarray(0,n*4)}_setModelAttributes(e,n,r=!1){var a;if(!Object.keys(n).length)return;if(r){const l=this.getAttributeManager();e.setBufferLayout(l.getBufferLayouts(e)),n=l.getAttributes()}const i=((a=e.userData)==null?void 0:a.excludeAttributes)||{},s={},o={};for(const l in n){if(i[l])continue;const c=n[l].getValue();for(const u in c){const f=c[u];f instanceof _e?n[l].settings.isIndexed?e.setIndexBuffer(f):s[u]=f:f&&(o[u]=f)}}e.setAttributes(s),e.setConstantAttributes(o)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,s=r||i,o=s&&n.attributes&&n.attributes[s.id];if(o&&o.value){const a=o.value,l=this.encodePickingColor(e);for(let c=0;c<n.length;c++){const u=s.getVertexOffset(c);a[u]===l[0]&&a[u+1]===l[1]&&a[u+2]===l[2]&&this._disablePickingIndex(c)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,i=n||r;if(!i)return;const s=i.getVertexOffset(e),o=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(o-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,r=e||n;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==tn.buffer&&(r.value=tn.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Pe(!this.internalState),Pe(Number.isFinite(this.props.coordinateSystem)),Ye(C4,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new R4({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Q.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new QD(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Ye(M4,this,this===e);const{state:n,internalState:r}=e;this!==e&&(this.internalState=r,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Ye(x4,this,e),!e)return;const n=this.props,r=this.context,i=this.internalState,s=r.viewport,o=this._updateUniformTransition();i.propsInTransition=o,r.viewport=i.viewport||s,this.props=o;try{const a=this._getUpdateParams(),l=this.getModels();if(r.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const u of this.props.extensions)u.updateState.call(this,a,u);const c=this.getModels()[0]!==l[0];this._postUpdate(a,c)}finally{r.viewport=s,this.props=n,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){Ye(I4,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:n=null,uniforms:r={},parameters:i={}}){this._updateAttributeTransition();const s=this.props,o=this.context;this.props=this.internalState.propsInTransition||s;const a=this.props.opacity;r.opacity=Math.pow(a,1/2.2);try{if(n){const{isActive:u,isAttribute:f}=n.picking;this.setModuleParameters(n),this.setShaderModuleProps({picking:{isActive:u,isAttribute:f}})}const{getPolygonOffset:l}=this.props,c=l&&l(r)||[0,0];o.device.setParametersWebGL({polygonOffset:c});for(const u of this.getModels())u.setParameters(i);o.device.withParametersWebGL(i,()=>{const u={renderPass:e,moduleParameters:n,uniforms:r,parameters:i,context:o};for(const f of this.props.extensions)f.draw.call(this,u,f);this.draw(u)})}finally{this.props=s}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const i in e)if(e[i]){let s=!1;switch(i){case"dataChanged":const o=e[i],a=n[i];o&&Array.isArray(a)&&(n.dataChanged=Array.isArray(o)?a.concat(o):o,s=!0);default:n[i]||(n[i]=e[i],s=!0)}s&&Ye(P4,this,i,e)}const r=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=r,n.somethingChanged=r||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){var i;const r=GD(e,n);if(r.updateTriggersChanged)for(const s in r.updateTriggersChanged)r.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(r.transitionsChanged)for(const s in r.transitionsChanged)this.internalState.uniformTransitions.add(s,n[s],e[s],(i=e.transitions)==null?void 0:i[s]);return this.setChangeFlags(r)}validateProps(){JD(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(n.highlightColor=r(e)),this.setShaderModuleProps({picking:n}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new XD(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:r,oldProps:i}=e;this.setNeedsRedraw(),this._updateAttributes();const s=this.state.model;s!=null&&s.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:l}=r;if(n||i.autoHighlight!==o||i.highlightedObjectIndex!==a||i.highlightColor!==l){const c={};Array.isArray(l)&&(c.highlightColor=l),(n||i.autoHighlight!==o||a!==i.highlightedObjectIndex)&&(c.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:c})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(n=n||i,n)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}};Gc.defaultProps=N4,Gc.layerName="Layer";let dr=Gc;const F4="compositeLayer.renderLayers",Fg=class Fg extends dr{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||n}getSubLayerRow(e,n,r){return e.__source={parent:this,object:n,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(r,i)=>r&&r.__source?(n.index=r.__source.index,e(r.__source.object,n)):e(r,i)}return e}getSubLayerProps(e={}){var M;const{opacity:n,pickable:r,visible:i,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:f,wrapLongitude:h,positionFormat:d,modelMatrix:m,extensions:T,fetch:A,operation:g,_subLayerProps:p}=this.props,_={id:"",updateTriggers:{},opacity:n,pickable:r,visible:i,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:f,wrapLongitude:h,positionFormat:d,modelMatrix:m,extensions:T,fetch:A,operation:g},w=p&&e.id&&p[e.id],R=w&&w.updateTriggers,x=e.id||"sublayer";if(w){const k=this.props[ar],F=e.type?e.type._propTypes:{};for(const U in w){const j=F[U]||k[U];j&&j.type==="accessor"&&(w[U]=this.getSubLayerAccessor(w[U]))}}Object.assign(_,e,w),_.id=`${this.props.id}-${x}`,_.updateTriggers={all:(M=this.props.updateTriggers)==null?void 0:M.all,...e.updateTriggers,...R};for(const k of T){const F=k.getSubLayerProps.call(this,k);F&&Object.assign(_,F,{updateTriggers:Object.assign(_.updateTriggers,F.updateTriggers)})}return _}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let r=this.internalState.subLayers;const i=!r||this.needsUpdate();if(i){const s=this.renderLayers();r=gs(s,Boolean),this.internalState.subLayers=r}Ye(F4,this,i,r);for(const s of r)s.parent=this}};Fg.layerName="CompositeLayer";let Ic=Fg;class Mw{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:n={}}=e;this.typedArrayManager=ds,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:r={},getGeometry:i,geometryBuffer:s,positionFormat:o,dataChanged:a,normalize:l=!0}=this.opts;if(this.data=n,this.getGeometry=i,this.positionSize=s&&s.size||(o==="XY"?2:3),this.buffers=r,this.normalize=l,s&&(Pe(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),l||(r.vertexPositions=s)),this.geometryBuffer=r.vertexPositions,Array.isArray(a))for(const c of a)this._rebuildGeometry(c);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?vw(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:r,buffers:i,_attributeDefs:s,typedArrayManager:o}=this;for(const a in s)if(a in i)o.release(r[a]),r[a]=null;else{const l=s[a];l.copy=n,r[a]=o.allocate(r[a],e,l)}}_forEachGeometry(e,n,r){const{data:i,getGeometry:s}=this,{iterable:o,objectInfo:a}=Lu(i,n,r);for(const l of o){a.index++;const c=s?s(l,a):null;e(c,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:r,instanceCount:i}=this;const{data:s,geometryBuffer:o}=this,{startRow:a=0,endRow:l=1/0}=e||{},c={};if(e||(n=[0],r=[0]),this.normalize||!o)this._forEachGeometry((f,h)=>{const d=f&&this.normalizeGeometry(f);c[h]=d,r[h+1]=r[h]+(d?this.getGeometrySize(d):0)},a,l),i=r[r.length-1];else if(r=s.startIndices,i=r[s.length]||0,ArrayBuffer.isView(o))i=i||o.length/this.positionSize;else if(o instanceof _e){const f=this.positionSize*4;i=i||o.byteLength/f}else if(o.buffer){const f=o.stride||this.positionSize*4;i=i||o.buffer.byteLength/f}else if(o.value){const f=o.value,h=o.stride/f.BYTES_PER_ELEMENT||this.positionSize;i=i||f.length/h}this._allocate(i,!!e),this.indexStarts=n,this.vertexStarts=r,this.instanceCount=i;const u={};this._forEachGeometry((f,h)=>{const d=c[h]||f;u.vertexStart=r[h],u.indexStart=n[h];const m=h<r.length-1?r[h+1]:i;u.geometrySize=m-r[h],u.geometryIndex=h,this.updateGeometryAttributes(d,u)},a,l),this.vertexCount=n[n.length-1]}}const D4=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,B4=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * opacity * vColor.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,U4=1024,L4=4,M0=()=>{},O0={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},z4={x:0,y:0,width:0,height:0};function V4(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function W4(t,e,n,r){const i=Math.min(n/e.width,r/e.height),s=Math.floor(e.width*i),o=Math.floor(e.height*i);return i===1?{data:e,width:s,height:o}:(t.canvas.height=o,t.canvas.width=s,t.clearRect(0,0,s,o),t.drawImage(e,0,0,e.width,e.height,0,0,s,o),{data:t.canvas,width:s,height:o})}function Xo(t){return t&&(t.id||t.url)}function j4(t,e,n,r){const{width:i,height:s,device:o}=t,a=o.createTexture({format:"rgba8unorm",width:e,height:n,sampler:r}),l=o.createCommandEncoder();return l.copyTextureToTexture({source:t,destination:a,width:i,height:s}),l.finish(),t.destroy(),a}function k0(t,e,n){for(let r=0;r<e.length;r++){const{icon:i,xOffset:s}=e[r],o=Xo(i);t[o]={...i,x:s,y:n}}}function H4({icons:t,buffer:e,mapping:n={},xOffset:r=0,yOffset:i=0,rowHeight:s=0,canvasWidth:o}){let a=[];for(let l=0;l<t.length;l++){const c=t[l],u=Xo(c);if(!n[u]){const{height:f,width:h}=c;r+h+e>o&&(k0(n,a,i),r=0,i=s+i+e,s=0,a=[]),a.push({icon:c,xOffset:r}),r=r+h+e,s=Math.max(s,f)}}return a.length>0&&k0(n,a,i),{mapping:n,rowHeight:s,xOffset:r,yOffset:i,canvasWidth:o,canvasHeight:V4(s+i+e)}}function $4(t,e,n){if(!t||!e)return null;n=n||{};const r={},{iterable:i,objectInfo:s}=Lu(t);for(const o of i){s.index++;const a=e(o,s),l=Xo(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!r[l]&&(!n[l]||a.url!==n[l].url)&&(r[l]={...a,source:o,sourceIndex:s.index})}return r}class X4{constructor(e,{onUpdate:n=M0,onError:r=M0}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._textureParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=L4,this._canvasWidth=U4,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=n,this.onError=r}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?Xo(e):e;return this._mapping[n]||z4}setProps({loadOptions:e,autoPacking:n,iconAtlas:r,iconMapping:i,textureParameters:s}){var o;e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),i&&(this._mapping=i),r&&((o=this._texture)==null||o.delete(),this._texture=null,this._externalTexture=r),s&&(this._textureParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const r=Object.values($4(e,n,this._mapping)||{});if(r.length>0){const{mapping:i,xOffset:s,yOffset:o,rowHeight:a,canvasHeight:l}=H4({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=i,this._xOffset=s,this._yOffset=o,this._canvasHeight=l,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._textureParameters||O0})),this._texture.height!==this._canvasHeight&&(this._texture=j4(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||O0)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}_loadIcons(e){const n=this._canvas.getContext("2d",{willReadFrequently:!0});for(const r of e)this._pendingCount++,uc(r.url,this._loadOptions).then(i=>{const s=Xo(r),o=this._mapping[s],{x:a,y:l,width:c,height:u}=o,{data:f,width:h,height:d}=W4(n,i,c,u);this._texture.setSubImageData({data:f,x:a+(c-h)/2,y:l+(u-d)/2,width:h,height:d}),o.width=h,o.height=d,this._texture.generateMipmap(),this.onUpdate()}).catch(i=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:i})}).finally(()=>{this._pendingCount--})}}const Ow=[0,0,0,255],Y4={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:Ow},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}},eu=class eu extends dr{getShaders(){return super.getShaders({vs:D4,fs:B4,modules:[ca,ua]})}initializeState(){this.state={iconManager:new X4(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:Ow},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var d;super.updateState(e);const{props:n,oldProps:r,changeFlags:i}=e,s=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:l,getIcon:c,textureParameters:u}=n,{iconManager:f}=this.state;if(typeof o=="string")return;const h=o||this.internalState.isAsyncPropLoading("iconAtlas");f.setProps({loadOptions:n.loadOptions,autoPacking:!h,iconAtlas:o,iconMapping:h?a:null,textureParameters:u}),h?r.iconMapping!==n.iconMapping&&s.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&f.packIcons(l,c),i.extensionsChanged&&((d=this.state.model)==null||d.destroy(),this.state.model=this._getModel(),s.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:r,sizeMaxPixels:i,sizeUnits:s,billboard:o,alphaCutoff:a}=this.props,{iconManager:l}=this.state,c=l.getTexture();if(c){const u=this.state.model;u.setBindings({iconsTexture:c}),u.setUniforms(e),u.setUniforms({iconsTextureDim:[c.width,c.height],sizeUnits:Yr[s],sizeScale:n,sizeMinPixels:r,sizeMaxPixels:i,billboard:o,alphaCutoff:a}),u.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Wt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ps({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var r;const n=(r=this.getCurrentLayer())==null?void 0:r.props.onIconError;n?n(e):Q.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:r,anchorX:i=n/2,anchorY:s=r/2}=this.state.iconManager.getIconMapping(e);return[n/2-i,r/2-s]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:r,width:i,height:s}=this.state.iconManager.getIconMapping(e);return[n,r,i,s]}};eu.defaultProps=Y4,eu.layerName="IconLayer";let Mc=eu;const K4=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
radiusMinPixels, radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
lineWidthMinPixels, lineWidthMaxPixels
);
outerRadiusPixels += stroked * lineWidthPixels / 2.0;
float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
if (billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,q4=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
uniform bool filled;
uniform float stroked;
uniform bool antialiasing;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (stroked > 0.5) {
float isLine = antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (filled) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (!filled) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,N0=[0,0,0,255],Z4={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:N0},getLineColor:{type:"accessor",value:N0},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},tu=class tu extends dr{getShaders(){return super.getShaders({vs:K4,fs:q4,modules:[ca,ua]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var n;super.updateState(e),e.changeFlags.extensionsChanged&&((n=this.state.model)==null||n.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:n,radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,stroked:o,filled:a,billboard:l,antialiasing:c,lineWidthUnits:u,lineWidthScale:f,lineWidthMinPixels:h,lineWidthMaxPixels:d}=this.props,m=this.state.model;m.setUniforms(e),m.setUniforms({stroked:o?1:0,filled:a,billboard:l,antialiasing:c,radiusUnits:Yr[n],radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,lineWidthUnits:Yr[u],lineWidthScale:f,lineWidthMinPixels:h,lineWidthMaxPixels:d}),m.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Wt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ps({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}};tu.defaultProps=Z4,tu.layerName="ScatterplotLayer";let Qd=tu;const kw={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function Nw(t,e,n={}){return Q4(t,n)!==e?(G4(t,n),!0):!1}function Q4(t,e={}){return Math.sign(J4(t,e))}const F0={x:0,y:1,z:2};function J4(t,e={}){const{start:n=0,end:r=t.length,plane:i="xy"}=e,s=e.size||2;let o=0;const a=F0[i[0]],l=F0[i[1]];for(let c=n,u=r-s;c<r;c+=s)o+=(t[c+a]-t[u+a])*(t[c+l]+t[u+l]),u=c;return o/2}function G4(t,e){const{start:n=0,end:r=t.length,size:i=2}=e,s=(r-n)/i,o=Math.floor(s/2);for(let a=0;a<o;++a){const l=n+a*i,c=n+(s-1-a)*i;for(let u=0;u<i;++u){const f=t[l+u];t[l+u]=t[c+u],t[c+u]=f}}}function Ut(t,e){const n=e.length,r=t.length;if(r>0){let i=!0;for(let s=0;s<n;s++)if(t[r-n+s]!==e[s]){i=!1;break}if(i)return!1}for(let i=0;i<n;i++)t[r+i]=e[i];return!0}function Jd(t,e){const n=e.length;for(let r=0;r<n;r++)t[r]=e[r]}function Yo(t,e,n,r,i=[]){const s=r+e*n;for(let o=0;o<n;o++)i[o]=t[s+o];return i}function Gd(t,e,n,r,i=[]){let s,o;if(n&8)s=(r[3]-t[1])/(e[1]-t[1]),o=3;else if(n&4)s=(r[1]-t[1])/(e[1]-t[1]),o=1;else if(n&2)s=(r[2]-t[0])/(e[0]-t[0]),o=2;else if(n&1)s=(r[0]-t[0])/(e[0]-t[0]),o=0;else return null;for(let a=0;a<t.length;a++)i[a]=(o&1)===a?r[o]:s*(e[a]-t[a])+t[a];return i}function Cl(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function Fw(t,e){const{size:n=2,broken:r=!1,gridResolution:i=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:a=t.length}=e||{},l=(a-o)/n;let c=[];const u=[c],f=Yo(t,0,n,o);let h,d;const m=Bw(f,i,s,[]),T=[];Ut(c,f);for(let A=1;A<l;A++){for(h=Yo(t,A,n,o,h),d=Cl(h,m);d;){Gd(f,h,d,m,T);const g=Cl(T,m);g&&(Gd(f,T,g,m,T),d=g),Ut(c,T),Jd(f,T),tB(m,i,d),r&&c.length>n&&(c=[],u.push(c),Ut(c,f)),d=Cl(h,m)}Ut(c,h),Jd(f,h)}return r?u:u[0]}const D0=0,eB=1;function Dw(t,e=null,n){if(!t.length)return[];const{size:r=2,gridResolution:i=10,gridOffset:s=[0,0],edgeTypes:o=!1}=n||{},a=[],l=[{pos:t,types:o?new Array(t.length/r).fill(eB):null,holes:e||[]}],c=[[],[]];let u=[];for(;l.length;){const{pos:f,types:h,holes:d}=l.shift();nB(f,r,d[0]||f.length,c),u=Bw(c[0],i,s,u);const m=Cl(c[1],u);if(m){let T=B0(f,h,r,0,d[0]||f.length,u,m);const A={pos:T[0].pos,types:T[0].types,holes:[]},g={pos:T[1].pos,types:T[1].types,holes:[]};l.push(A,g);for(let p=0;p<d.length;p++)T=B0(f,h,r,d[p],d[p+1]||f.length,u,m),T[0]&&(A.holes.push(A.pos.length),A.pos=el(A.pos,T[0].pos),o&&(A.types=el(A.types,T[0].types))),T[1]&&(g.holes.push(g.pos.length),g.pos=el(g.pos,T[1].pos),o&&(g.types=el(g.types,T[1].types)))}else{const T={positions:f};o&&(T.edgeTypes=h),d.length&&(T.holeIndices=d),a.push(T)}}return a}function B0(t,e,n,r,i,s,o){const a=(i-r)/n,l=[],c=[],u=[],f=[],h=[];let d,m,T;const A=Yo(t,a-1,n,r);let g=Math.sign(o&8?A[1]-s[3]:A[0]-s[2]),p=e&&e[a-1],_=0,w=0;for(let R=0;R<a;R++)d=Yo(t,R,n,r,d),m=Math.sign(o&8?d[1]-s[3]:d[0]-s[2]),T=e&&e[r/n+R],m&&g&&g!==m&&(Gd(A,d,o,s,h),Ut(l,h)&&u.push(p),Ut(c,h)&&f.push(p)),m<=0?(Ut(l,d)&&u.push(T),_-=m):u.length&&(u[u.length-1]=D0),m>=0?(Ut(c,d)&&f.push(T),w+=m):f.length&&(f[f.length-1]=D0),Jd(A,d),g=m,p=T;return[_?{pos:l,types:e&&u}:null,w?{pos:c,types:e&&f}:null]}function Bw(t,e,n,r){const i=Math.floor((t[0]-n[0])/e)*e+n[0],s=Math.floor((t[1]-n[1])/e)*e+n[1];return r[0]=i,r[1]=s,r[2]=i+e,r[3]=s+e,r}function tB(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function nB(t,e,n,r){let i=1/0,s=-1/0,o=1/0,a=-1/0;for(let l=0;l<n;l+=e){const c=t[l],u=t[l+1];i=c<i?c:i,s=c>s?c:s,o=u<o?u:o,a=u>a?u:a}return r[0][0]=i,r[0][1]=o,r[1][0]=s,r[1][1]=a,r}function el(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}const rB=85.051129;function iB(t,e){const{size:n=2,startIndex:r=0,endIndex:i=t.length,normalize:s=!0}=e||{},o=t.slice(r,i);Uw(o,n,0,i-r);const a=Fw(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const l of a)Lw(l,n);return a}function sB(t,e=null,n){const{size:r=2,normalize:i=!0,edgeTypes:s=!1}=n||{};e=e||[];const o=[],a=[];let l=0,c=0;for(let f=0;f<=e.length;f++){const h=e[f]||t.length,d=c,m=oB(t,r,l,h);for(let T=m;T<h;T++)o[c++]=t[T];for(let T=l;T<m;T++)o[c++]=t[T];Uw(o,r,d,c),aB(o,r,d,c,n==null?void 0:n.maxLatitude),l=h,a[f]=c}a.pop();const u=Dw(o,a,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(i)for(const f of u)Lw(f.positions,r);return u}function oB(t,e,n,r){let i=-1,s=-1;for(let o=n+1;o<r;o+=e){const a=Math.abs(t[o]);a>i&&(i=a,s=o-1)}return s}function aB(t,e,n,r,i=rB){const s=t[n],o=t[r-e];if(Math.abs(s-o)>180){const a=Yo(t,0,e,n);a[0]+=Math.round((o-s)/360)*360,Ut(t,a),a[1]=Math.sign(a[1])*i,Ut(t,a),a[0]=s,Ut(t,a)}}function Uw(t,e,n,r){let i=t[0],s;for(let o=n;o<r;o+=e){s=t[o];const a=s-i;(a>180||a<-180)&&(s-=Math.round(a/360)*360),t[o]=i=s}}function Lw(t,e){let n;const r=t.length/e;for(let s=0;s<r&&(n=t[s*e],(n+180)%360===0);s++);const i=-Math.round(n/360)*360;if(i!==0)for(let s=0;s<r;s++)t[s*e]+=i}function lB(t,e,n,r){let i;if(Array.isArray(t[0])){const s=t.length*e;i=new Array(s);for(let o=0;o<t.length;o++)for(let a=0;a<e;a++)i[o*e+a]=t[o][a]||0}else i=t;return n?Fw(i,{size:e,gridResolution:n}):r?iB(i,{size:e}):i}const cB=1,uB=2,ih=4;class fB extends Mw{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?lB(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(U0(e)){let r=0;for(const i of e)r+=this.getGeometrySize(i);return r}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&U0(e))for(const r of e){const i=this.getGeometrySize(r);n.geometrySize=i,this.updateGeometryAttributes(r,n),n.vertexStart+=i}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const r=this.attributes.segmentTypes,i=e?this.isClosed(e):!1,{vertexStart:s,geometrySize:o}=n;r.fill(0,s,s+o),i?(r[s]=ih,r[s+o-2]=ih):(r[s]+=cB,r[s+o-2]+=uB),r[s+o-1]=ih}_updatePositions(e,n){const{positions:r}=this.attributes;if(!r||!e)return;const{vertexStart:i,geometrySize:s}=n,o=new Array(3);for(let a=i,l=0;l<s;a++,l++)this.getPointOnPath(e,l,o),r[a*3]=o[0],r[a*3+1]=o[1],r[a*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,r=[]){const{positionSize:i}=this;n*i>=e.length&&(n+=1-e.length/i);const s=n*i;return r[0]=e[s],r[1]=e[s+1],r[2]=i===3&&e[s+2]||0,r}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:n}=this,r=e.length-n;return e[0]===e[r]&&e[1]===e[r+1]&&(n===2||e[2]===e[r+2])}}function U0(t){return Array.isArray(t[0])}const hB=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = capType;
} else {
vJointType = jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels) / 2.0);
vec3 width;
if (billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,dB=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
uniform float miterLimit;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,zw=[0,0,0,255],pB={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:zw},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},sh={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t},nu=class nu extends dr{getShaders(){return super.getShaders({vs:hB,fs:dB,modules:[ca,ua]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:sh,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:sh,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:sh,defaultValue:zw},instancePickingColors:{size:4,type:"uint8",accessor:(r,{index:i,target:s})=>this.encodePickingColor(r&&r.__source?r.__source.index:i,s)}}),this.setState({pathTesselator:new fB({fp64:this.use64bitPositions()})})}updateState(e){var o;super.updateState(e);const{props:n,changeFlags:r}=e,i=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){const{pathTesselator:a}=this.state,l=n.data.attributes||{};a.updateGeometry({data:n.data,geometryBuffer:l.getPath,buffers:l,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),r.dataChanged||i.invalidateAll()}r.extensionsChanged&&((o=this.state.model)==null||o.destroy(),this.state.model=this._getModel(),i.invalidateAll())}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r}=n,i=this.props.data;return i[0]&&i[0].__source&&(n.object=i.find(s=>s.__source.index===r)),n}disablePickingIndex(e){const n=this.props.data;if(n[0]&&n[0].__source)for(let r=0;r<n.length;r++)n[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:r,billboard:i,miterLimit:s,widthUnits:o,widthScale:a,widthMinPixels:l,widthMaxPixels:c}=this.props,u=this.state.model;u.setUniforms(e),u.setUniforms({jointType:Number(n),capType:Number(r),billboard:i,widthUnits:Yr[o],widthScale:a,miterLimit:s,widthMinPixels:l,widthMaxPixels:c}),u.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],n=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Wt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ps({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(n),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}};nu.defaultProps=pB,nu.layerName="PathLayer";let ep=nu;var Og={exports:{}};Og.exports=zu;Og.exports.default=zu;function zu(t,e,n){n=n||2;var r=e&&e.length,i=r?e[0]*n:t.length,s=Vw(t,0,i,n,!0),o=[];if(!s||s.next===s.prev)return o;var a,l,c,u,f,h,d;if(r&&(s=vB(t,e,s,n)),t.length>80*n){a=c=t[0],l=u=t[1];for(var m=n;m<i;m+=n)f=t[m],h=t[m+1],f<a&&(a=f),h<l&&(l=h),f>c&&(c=f),h>u&&(u=h);d=Math.max(c-a,u-l),d=d!==0?32767/d:0}return Ko(s,o,n,a,l,d,0),o}function Vw(t,e,n,r,i){var s,o;if(i===rp(t,e,n,r)>0)for(s=e;s<n;s+=r)o=L0(s,t[s],t[s+1],o);else for(s=n-r;s>=e;s-=r)o=L0(s,t[s],t[s+1],o);return o&&Vu(o,o.next)&&(Zo(o),o=o.next),o}function Zr(t,e){if(!t)return t;e||(e=t);var n=t,r;do if(r=!1,!n.steiner&&(Vu(n,n.next)||ve(n.prev,n,n.next)===0)){if(Zo(n),n=e=n.prev,n===n.next)break;r=!0}else n=n.next;while(r||n!==e);return e}function Ko(t,e,n,r,i,s,o){if(t){!o&&s&&AB(t,r,i,s);for(var a=t,l,c;t.prev!==t.next;){if(l=t.prev,c=t.next,s?_B(t,r,i,s):gB(t)){e.push(l.i/n|0),e.push(t.i/n|0),e.push(c.i/n|0),Zo(t),t=c.next,a=c.next;continue}if(t=c,t===a){o?o===1?(t=mB(Zr(t),e,n),Ko(t,e,n,r,i,s,2)):o===2&&yB(t,e,n,r,i,s):Ko(Zr(t),e,n,r,i,s,1);break}}}}function gB(t){var e=t.prev,n=t,r=t.next;if(ve(e,n,r)>=0)return!1;for(var i=e.x,s=n.x,o=r.x,a=e.y,l=n.y,c=r.y,u=i<s?i<o?i:o:s<o?s:o,f=a<l?a<c?a:c:l<c?l:c,h=i>s?i>o?i:o:s>o?s:o,d=a>l?a>c?a:c:l>c?l:c,m=r.next;m!==e;){if(m.x>=u&&m.x<=h&&m.y>=f&&m.y<=d&&Ni(i,a,s,l,o,c,m.x,m.y)&&ve(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function _B(t,e,n,r){var i=t.prev,s=t,o=t.next;if(ve(i,s,o)>=0)return!1;for(var a=i.x,l=s.x,c=o.x,u=i.y,f=s.y,h=o.y,d=a<l?a<c?a:c:l<c?l:c,m=u<f?u<h?u:h:f<h?f:h,T=a>l?a>c?a:c:l>c?l:c,A=u>f?u>h?u:h:f>h?f:h,g=tp(d,m,e,n,r),p=tp(T,A,e,n,r),_=t.prevZ,w=t.nextZ;_&&_.z>=g&&w&&w.z<=p;){if(_.x>=d&&_.x<=T&&_.y>=m&&_.y<=A&&_!==i&&_!==o&&Ni(a,u,l,f,c,h,_.x,_.y)&&ve(_.prev,_,_.next)>=0||(_=_.prevZ,w.x>=d&&w.x<=T&&w.y>=m&&w.y<=A&&w!==i&&w!==o&&Ni(a,u,l,f,c,h,w.x,w.y)&&ve(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;_&&_.z>=g;){if(_.x>=d&&_.x<=T&&_.y>=m&&_.y<=A&&_!==i&&_!==o&&Ni(a,u,l,f,c,h,_.x,_.y)&&ve(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;w&&w.z<=p;){if(w.x>=d&&w.x<=T&&w.y>=m&&w.y<=A&&w!==i&&w!==o&&Ni(a,u,l,f,c,h,w.x,w.y)&&ve(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function mB(t,e,n){var r=t;do{var i=r.prev,s=r.next.next;!Vu(i,s)&&Ww(i,r,r.next,s)&&qo(i,s)&&qo(s,i)&&(e.push(i.i/n|0),e.push(r.i/n|0),e.push(s.i/n|0),Zo(r),Zo(r.next),r=t=s),r=r.next}while(r!==t);return Zr(r)}function yB(t,e,n,r,i,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&PB(o,a)){var l=jw(o,a);o=Zr(o,o.next),l=Zr(l,l.next),Ko(o,e,n,r,i,s,0),Ko(l,e,n,r,i,s,0);return}a=a.next}o=o.next}while(o!==t)}function vB(t,e,n,r){var i=[],s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*r,l=s<o-1?e[s+1]*r:t.length,c=Vw(t,a,l,r,!1),c===c.next&&(c.steiner=!0),i.push(RB(c));for(i.sort(TB),s=0;s<i.length;s++)n=SB(i[s],n);return n}function TB(t,e){return t.x-e.x}function SB(t,e){var n=EB(t,e);if(!n)return e;var r=jw(n,t);return Zr(r,r.next),Zr(n,n.next)}function EB(t,e){var n=e,r=t.x,i=t.y,s=-1/0,o;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var a=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>s&&(s=a,o=n.x<n.next.x?n:n.next,a===r))return o}n=n.next}while(n!==e);if(!o)return null;var l=o,c=o.x,u=o.y,f=1/0,h;n=o;do r>=n.x&&n.x>=c&&r!==n.x&&Ni(i<u?r:s,i,c,u,i<u?s:r,i,n.x,n.y)&&(h=Math.abs(i-n.y)/(r-n.x),qo(n,t)&&(h<f||h===f&&(n.x>o.x||n.x===o.x&&wB(o,n)))&&(o=n,f=h)),n=n.next;while(n!==l);return o}function wB(t,e){return ve(t.prev,t,e.prev)<0&&ve(e.next,t,t.next)<0}function AB(t,e,n,r){var i=t;do i.z===0&&(i.z=tp(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,bB(i)}function bB(t){var e,n,r,i,s,o,a,l,c=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,r=n,a=0,e=0;e<c&&(a++,r=r.nextZ,!!r);e++);for(l=c;a>0||l>0&&r;)a!==0&&(l===0||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,l--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;n=r}s.nextZ=null,c*=2}while(o>1);return t}function tp(t,e,n,r,i){return t=(t-n)*i|0,e=(e-r)*i|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function RB(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Ni(t,e,n,r,i,s,o,a){return(i-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(r-a)>=(n-o)*(e-a)&&(n-o)*(s-a)>=(i-o)*(r-a)}function PB(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!CB(t,e)&&(qo(t,e)&&qo(e,t)&&xB(t,e)&&(ve(t.prev,t,e.prev)||ve(t,e.prev,e))||Vu(t,e)&&ve(t.prev,t,t.next)>0&&ve(e.prev,e,e.next)>0)}function ve(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Vu(t,e){return t.x===e.x&&t.y===e.y}function Ww(t,e,n,r){var i=nl(ve(t,e,n)),s=nl(ve(t,e,r)),o=nl(ve(n,r,t)),a=nl(ve(n,r,e));return!!(i!==s&&o!==a||i===0&&tl(t,n,e)||s===0&&tl(t,r,e)||o===0&&tl(n,t,r)||a===0&&tl(n,e,r))}function tl(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function nl(t){return t>0?1:t<0?-1:0}function CB(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Ww(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function qo(t,e){return ve(t.prev,t,t.next)<0?ve(t,e,t.next)>=0&&ve(t,t.prev,e)>=0:ve(t,e,t.prev)<0||ve(t,t.next,e)<0}function xB(t,e){var n=t,r=!1,i=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==t);return r}function jw(t,e){var n=new np(t.i,t.x,t.y),r=new np(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function L0(t,e,n,r){var i=new np(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Zo(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function np(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}zu.deviation=function(t,e,n,r){var i=e&&e.length,s=i?e[0]*n:t.length,o=Math.abs(rp(t,0,s,n));if(i)for(var a=0,l=e.length;a<l;a++){var c=e[a]*n,u=a<l-1?e[a+1]*n:t.length;o-=Math.abs(rp(t,c,u,n))}var f=0;for(a=0;a<r.length;a+=3){var h=r[a]*n,d=r[a+1]*n,m=r[a+2]*n;f+=Math.abs((t[h]-t[m])*(t[d+1]-t[h+1])-(t[h]-t[d])*(t[m+1]-t[h+1]))}return o===0&&f===0?0:Math.abs((f-o)/o)};function rp(t,e,n,r){for(var i=0,s=e,o=n-r;s<n;s+=r)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}zu.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var s=0;s<t[i].length;s++)for(var o=0;o<e;o++)n.vertices.push(t[i][s][o]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n};var IB=Og.exports;const MB=cp(IB),rl=kw.CLOCKWISE,z0=kw.COUNTER_CLOCKWISE,Jn={isClosed:!0};function OB(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function Gs(t){return"positions"in t?t.positions:t}function xl(t){return"holeIndices"in t?t.holeIndices:null}function kB(t){return Array.isArray(t[0])}function NB(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function FB(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function DB(t,e,n,r){for(let i=0;i<e;i++)if(t[n+i]!==t[r-e+i])return!1;return!0}function V0(t,e,n,r,i){let s=e;const o=n.length;for(let a=0;a<o;a++)for(let l=0;l<r;l++)t[s++]=n[a][l]||0;if(!FB(n))for(let a=0;a<r;a++)t[s++]=n[0][a]||0;return Jn.start=e,Jn.end=s,Jn.size=r,Nw(t,i,Jn),s}function W0(t,e,n,r,i=0,s,o){s=s||n.length;const a=s-i;if(a<=0)return e;let l=e;for(let c=0;c<a;c++)t[l++]=n[i+c];if(!DB(n,r,i,s))for(let c=0;c<r;c++)t[l++]=n[i+c];return Jn.start=e,Jn.end=l,Jn.size=r,Nw(t,o,Jn),l}function BB(t,e){OB(t);const n=[],r=[];if("positions"in t){const{positions:i,holeIndices:s}=t;if(s){let o=0;for(let a=0;a<=s.length;a++)o=W0(n,o,i,e,s[a-1],s[a],a===0?rl:z0),r.push(o);return r.pop(),{positions:n,holeIndices:r}}t=i}if(!kB(t))return W0(n,0,t,e,0,n.length,rl),n;if(!NB(t)){let i=0;for(const[s,o]of t.entries())i=V0(n,i,o,e,s===0?rl:z0),r.push(i);return r.pop(),{positions:n,holeIndices:r}}return V0(n,0,t,e,rl),n}function oh(t,e,n){const r=t.length/3;let i=0;for(let s=0;s<r;s++){const o=(s+1)%r;i+=t[s*3+e]*t[o*3+n],i-=t[o*3+e]*t[s*3+n]}return Math.abs(i/2)}function j0(t,e,n,r){const i=t.length/3;for(let s=0;s<i;s++){const o=s*3,a=t[o+0],l=t[o+1],c=t[o+2];t[o+e]=a,t[o+n]=l,t[o+r]=c}}function UB(t,e,n,r){let i=xl(t);i&&(i=i.map(a=>a/e));let s=Gs(t);const o=r&&e===3;if(n){const a=s.length;s=s.slice();const l=[];for(let c=0;c<a;c+=e){l[0]=s[c],l[1]=s[c+1],o&&(l[2]=s[c+2]);const u=n(l);s[c]=u[0],s[c+1]=u[1],o&&(s[c+2]=u[2])}}if(o){const a=oh(s,0,1),l=oh(s,0,2),c=oh(s,1,2);if(!a&&!l&&!c)return[];a>l&&a>c||(l>c?(n||(s=s.slice()),j0(s,0,2,1)):(n||(s=s.slice()),j0(s,2,0,1)))}return MB(s,i,e)}class LB extends Mw{constructor(e){const{fp64:n,IndexType:r=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:r,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=BB(e,this.positionSize);return this.opts.resolution?Dw(Gs(n),xl(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?sB(Gs(n),xl(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if(H0(e)){let n=0;for(const r of e)n+=this.getGeometrySize(r);return n}return Gs(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&H0(e))for(const r of e){const i=this.getGeometrySize(r);n.geometrySize=i,this.updateGeometryAttributes(r,n),n.vertexStart+=i,n.indexStart=this.indexStarts[n.geometryIndex+1]}else{const r=e;this._updateIndices(r,n),this._updatePositions(r,n),this._updateVertexValid(r,n)}}_updateIndices(e,{geometryIndex:n,vertexStart:r,indexStart:i}){const{attributes:s,indexStarts:o,typedArrayManager:a}=this;let l=s.indices;if(!l||!e)return;let c=i;const u=UB(e,this.positionSize,this.opts.preproject,this.opts.full3d);l=a.allocate(l,i+u.length,{copy:!0});for(let f=0;f<u.length;f++)l[c++]=u[f]+r;o[n+1]=i+u.length,s.indices=l}_updatePositions(e,{vertexStart:n,geometrySize:r}){const{attributes:{positions:i},positionSize:s}=this;if(!i||!e)return;const o=Gs(e);for(let a=n,l=0;l<r;a++,l++){const c=o[l*s],u=o[l*s+1],f=s>2?o[l*s+2]:0;i[a*3]=c,i[a*3+1]=u,i[a*3+2]=f}}_updateVertexValid(e,{vertexStart:n,geometrySize:r}){const{positionSize:i}=this,s=this.attributes.vertexValid,o=e&&xl(e);if(e&&e.edgeTypes?s.set(e.edgeTypes,n):s.fill(1,n,n+r),o)for(let a=0;a<o.length;a++)s[n+o[a]/i-1]=0;s[n+r-1]=0}}function H0(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const Hw=`uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;
in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project_uCommonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (extruded) {
pos.z += props.elevations * elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * opacity);
} else {
vColor = vec4(colors.rgb, colors.a * opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,zB=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${Hw}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,VB=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${Hw}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,WB=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Oc=[0,0,0,255],jB={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Oc},getLineColor:{type:"accessor",value:Oc},material:!0},il={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t},ru=class ru extends dr{getShaders(e){return super.getShaders({vs:e==="top"?zB:VB,fs:WB,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[ca,bM,ua]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:n}=this.props;const{_full3d:r}=this.props;e.isGeospatial&&n===te.DEFAULT&&(n=te.LNGLAT);let i;n===te.LNGLAT&&(r?i=e.projectPosition.bind(e):i=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new LB({preproject:i,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const s=this.getAttributeManager(),o=!0;s.remove(["instancePickingColors"]),s.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:il,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,stepMode:"dynamic",transition:il,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:il,accessor:"getFillColor",defaultValue:Oc},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:il,accessor:"getLineColor",defaultValue:Oc},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(a,{index:l,target:c})=>this.encodePickingColor(a&&a.__source?a.__source.index:l,c)}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r}=n,i=this.props.data;return i[0]&&i[0].__source&&(n.object=i.find(s=>s.__source.index===r)),n}disablePickingIndex(e){const n=this.props.data;if(n[0]&&n[0].__source)for(let r=0;r<n.length;r++)n[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:r,wireframe:i,elevationScale:s}=this.props,{topModel:o,sideModel:a,wireframeModel:l,polygonTesselator:c}=this.state,u={...e,extruded:!!n,elevationScale:s};l&&i&&(l.setInstanceCount(c.instanceCount-1),l.setUniforms(u),l.draw(this.context.renderPass)),a&&r&&(a.setInstanceCount(c.instanceCount-1),a.setUniforms(u),a.draw(this.context.renderPass)),o&&r&&(o.setVertexCount(c.vertexCount),o.setUniforms(u),o.draw(this.context.renderPass))}updateState(e){var a;super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:r,changeFlags:i}=e,s=this.getAttributeManager();(i.extensionsChanged||n.filled!==r.filled||n.extruded!==r.extruded)&&((a=this.state.models)==null||a.forEach(l=>l.destroy()),this.setState(this._getModels()),s.invalidateAll())}updateGeometry({props:e,oldProps:n,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){const{polygonTesselator:s}=this.state,o=e.data.attributes||{};s.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged,full3d:e._full3d}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:n,extruded:r}=this.props;let i,s,o;if(n){const a=this.getShaders("top");a.defines.NON_INSTANCED_MODEL=1;const l=this.getAttributeManager().getBufferLayouts({isInstanced:!1});i=new Wt(this.context.device,{...a,id:`${e}-top`,topology:"triangle-list",uniforms:{isWireframe:!1},bufferLayout:l,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(r){const a=this.getAttributeManager().getBufferLayouts({isInstanced:!0});s=new Wt(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:a,uniforms:{isWireframe:!1},geometry:new ps({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),o=new Wt(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:a,uniforms:{isWireframe:!0},geometry:new ps({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[s,o,i].filter(Boolean),topModel:i,sideModel:s,wireframeModel:o}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}};ru.defaultProps=jB,ru.layerName="SolidPolygonLayer";let ip=ru;function HB({data:t,getIndex:e,dataRange:n,replace:r}){const{startRow:i=0,endRow:s=1/0}=n,o=t.length;let a=o,l=o;for(let h=0;h<o;h++){const d=e(t[h]);if(a>h&&d>=i&&(a=h),d>=s){l=h;break}}let c=a;const f=l-a!==r.length?t.slice(l):void 0;for(let h=0;h<r.length;h++)t[c++]=r[h];if(f){for(let h=0;h<f.length;h++)t[c++]=f[h];t.length=c}return{startRow:a,endRow:a+r.length}}function $B(t,e){if(!t)return null;const n="startIndices"in t?t.startIndices[e]:e,r=t.featureIds.value[n];return n!==-1?XB(t,r,n):null}function XB(t,e,n){const r={properties:{...t.properties[e]}};for(const i in t.numericProps)r.properties[i]=t.numericProps[i].value[n];return r}function YB(t,e){const n={points:null,lines:null,polygons:null};for(const r in n){const i=t[r].globalFeatureIds.value;n[r]=new Uint8ClampedArray(i.length*3);const s=[];for(let o=0;o<i.length;o++)e(i[o],s),n[r][o*3+0]=s[0],n[r][o*3+1]=s[1],n[r][o*3+2]=s[2]}return n}const KB=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf) {
float distance = alpha;
alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);
if (outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
color = mix(outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,ah=192/256,$0=[],qB={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},iu=class iu extends Mc{getShaders(){return{...super.getShaders(),fs:KB}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(n,{index:r,target:i})=>this.encodePickingColor(r,i)}})}updateState(e){super.updateState(e);const{props:n,oldProps:r}=e;let{outlineColor:i}=n;i!==r.outlineColor&&(i=i.map(s=>s/255),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!n.sdf&&n.outlineWidth&&Q.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:n,smoothing:r,outlineWidth:i}=this.props,{outlineColor:s}=this.state,o=i?Math.max(r,ah*(1-i)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:ah,outlineBuffer:o,gamma:r,sdf:!!n,outlineColor:s},super.draw(e),n&&i){const{iconManager:a}=this.state,l=a.getTexture(),c=this.state.model;l&&(c.setUniforms({outlineBuffer:ah}),c.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):$0}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):$0}};iu.defaultProps=qB,iu.layerName="MultiIconLayer";let sp=iu;const _o=1e20;class ZB{constructor({fontSize:e=24,buffer:n=3,radius:r=8,cutoff:i=.25,fontFamily:s="sans-serif",fontWeight:o="normal",fontStyle:a="normal"}={}){this.buffer=n,this.cutoff=i,this.radius=r;const l=this.size=e+n*4,c=this._createCanvas(l),u=this.ctx=c.getContext("2d",{willReadFrequently:!0});u.font=`${a} ${o} ${e}px ${s}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(e){const n=document.createElement("canvas");return n.width=n.height=e,n}draw(e){const{width:n,actualBoundingBoxAscent:r,actualBoundingBoxDescent:i,actualBoundingBoxLeft:s,actualBoundingBoxRight:o}=this.ctx.measureText(e),a=Math.ceil(r),l=0,c=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-s))),u=Math.min(this.size-this.buffer,a+Math.ceil(i)),f=c+2*this.buffer,h=u+2*this.buffer,d=Math.max(f*h,0),m=new Uint8ClampedArray(d),T={data:m,width:f,height:h,glyphWidth:c,glyphHeight:u,glyphTop:a,glyphLeft:l,glyphAdvance:n};if(c===0||u===0)return T;const{ctx:A,buffer:g,gridInner:p,gridOuter:_}=this;A.clearRect(g,g,c,u),A.fillText(e,g,g+a);const w=A.getImageData(g,g,c,u);_.fill(_o,0,d),p.fill(0,0,d);for(let R=0;R<u;R++)for(let x=0;x<c;x++){const M=w.data[4*(R*c+x)+3]/255;if(M===0)continue;const k=(R+g)*f+x+g;if(M===1)_[k]=0,p[k]=_o;else{const F=.5-M;_[k]=F>0?F*F:0,p[k]=F<0?F*F:0}}X0(_,0,0,f,h,f,this.f,this.v,this.z),X0(p,g,g,c,u,f,this.f,this.v,this.z);for(let R=0;R<d;R++){const x=Math.sqrt(_[R])-Math.sqrt(p[R]);m[R]=Math.round(255-255*(x/this.radius+this.cutoff))}return T}}function X0(t,e,n,r,i,s,o,a,l){for(let c=e;c<e+r;c++)Y0(t,n*s+c,s,i,o,a,l);for(let c=n;c<n+i;c++)Y0(t,c*s+e,1,r,o,a,l)}function Y0(t,e,n,r,i,s,o){s[0]=0,o[0]=-_o,o[1]=_o,i[0]=t[e];for(let a=1,l=0,c=0;a<r;a++){i[a]=t[e+a*n];const u=a*a;do{const f=s[l];c=(i[a]-i[f]+u-f*f)/(a-f)/2}while(c<=o[l]&&--l>-1);l++,s[l]=a,o[l]=c,o[l+1]=_o}for(let a=0,l=0;a<r;a++){for(;o[l+1]<a;)l++;const c=s[l],u=a-c;t[e+a*n]=i[c]+u*u}}const QB=32,JB=[];function GB(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function eU({characterSet:t,getFontWidth:e,fontHeight:n,buffer:r,maxCanvasWidth:i,mapping:s={},xOffset:o=0,yOffset:a=0}){let l=0,c=o;const u=n+r*2;for(const f of t)if(!s[f]){const h=e(f);c+h+r*2>i&&(c=0,l++),s[f]={x:c+r,y:a+l*u+r,width:h,height:u,layoutWidth:h,layoutHeight:n},c+=h+r*2}return{mapping:s,xOffset:c,yOffset:a+l*u,canvasHeight:GB(a+(l+1)*u)}}function $w(t,e,n,r){var s;let i=0;for(let o=e;o<n;o++){const a=t[o];i+=((s=r[a])==null?void 0:s.layoutWidth)||0}return i}function Xw(t,e,n,r,i,s){let o=e,a=0;for(let l=e;l<n;l++){const c=$w(t,l,l+1,i);a+c>r&&(o<l&&s.push(l),o=l,a=0),a+=c}return a}function tU(t,e,n,r,i,s){let o=e,a=e,l=e,c=0;for(let u=e;u<n;u++)if((t[u]===" "||t[u+1]===" "||u+1===n)&&(l=u+1),l>a){let f=$w(t,a,l,i);c+f>r&&(o<a&&(s.push(a),o=a,c=0),f>r&&(f=Xw(t,a,l,r,i,s),o=s[s.length-1])),a=l,c+=f}return c}function nU(t,e,n,r,i=0,s){s===void 0&&(s=t.length);const o=[];return e==="break-all"?Xw(t,i,s,n,r,o):tU(t,i,s,n,r,o),o}function rU(t,e,n,r,i,s){let o=0,a=0;for(let l=e;l<n;l++){const c=t[l],u=r[c];u?(a||(a=u.layoutHeight),i[l]=o+u.layoutWidth/2,o+=u.layoutWidth):(Q.warn(`Missing character: ${c} (${c.codePointAt(0)})`)(),i[l]=o,o+=QB)}s[0]=o,s[1]=a}function iU(t,e,n,r,i){var A;const s=Array.from(t),o=s.length,a=new Array(o),l=new Array(o),c=new Array(o),u=(n==="break-word"||n==="break-all")&&isFinite(r)&&r>0,f=[0,0],h=[0,0];let d=0,m=0,T=0;for(let g=0;g<=o;g++){const p=s[g];if((p===`
`||g===o)&&(T=g),T>m){const _=u?nU(s,n,r,i,m,T):JB;for(let w=0;w<=_.length;w++){const R=w===0?m:_[w-1],x=w<_.length?_[w]:T;rU(s,R,x,i,a,h);for(let M=R;M<x;M++){const k=s[M],F=((A=i[k])==null?void 0:A.layoutOffsetY)||0;l[M]=d+h[1]/2+F,c[M]=h[0]}d=d+h[1]*e,f[0]=Math.max(f[0],h[0])}m=T}p===`
`&&(a[m]=0,l[m]=0,c[m]=0,m++)}return f[1]=d,{x:a,y:l,rowWidth:c,size:f}}function sU({value:t,length:e,stride:n,offset:r,startIndices:i,characterSet:s}){const o=t.BYTES_PER_ELEMENT,a=n?n/o:1,l=r?r/o:0,c=i[e]||Math.ceil((t.length-l)/a),u=s&&new Set,f=new Array(e);let h=t;if(a>1||l>0){const d=t.constructor;h=new d(c);for(let m=0;m<c;m++)h[m]=t[m*a+l]}for(let d=0;d<e;d++){const m=i[d],T=i[d+1]||c,A=h.subarray(m,T);f[d]=String.fromCodePoint.apply(null,A),u&&A.forEach(u.add,u)}if(u)for(const d of u)s.add(String.fromCodePoint(d));return{texts:f,characterCount:c}}class Yw{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function oU(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const Xi={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:oU(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},K0=1024,q0=.9,Z0=1.2,Kw=3;let kc=new Yw(Kw);function aU(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const r=kc.get(t);if(!r)return n;for(const i in r.mapping)n.has(i)&&n.delete(i);return n}function lU(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function Q0(t,e,n,r){t.font=`${r} ${n}px ${e}`,t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function cU(t){Q.assert(Number.isFinite(t)&&t>=Kw,"Invalid cache limit"),kc=new Yw(t)}class uU{constructor(){this.props={...Xi}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:n}=this.props;return(e*Z0+n*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const n=aU(this._key,this.props.characterSet),r=kc.get(this._key);if(r&&n.size===0){this._atlas!==r&&(this._atlas=r);return}const i=this._generateFontAtlas(n,r);this._atlas=i,kc.set(this._key,i)}_generateFontAtlas(e,n){const{fontFamily:r,fontWeight:i,fontSize:s,buffer:o,sdf:a,radius:l,cutoff:c}=this.props;let u=n&&n.data;u||(u=document.createElement("canvas"),u.width=K0);const f=u.getContext("2d",{willReadFrequently:!0});Q0(f,r,s,i);const{mapping:h,canvasHeight:d,xOffset:m,yOffset:T}=eU({getFontWidth:A=>f.measureText(A).width,fontHeight:s*Z0,buffer:o,characterSet:e,maxCanvasWidth:K0,...n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset}});if(u.height!==d){const A=f.getImageData(0,0,u.width,u.height);u.height=d,f.putImageData(A,0,0)}if(Q0(f,r,s,i),a){const A=new ZB({fontSize:s,buffer:o,radius:l,cutoff:c,fontFamily:r,fontWeight:`${i}`});for(const g of e){const{data:p,width:_,height:w,glyphTop:R}=A.draw(g);h[g].width=_,h[g].layoutOffsetY=s*q0-R;const x=f.createImageData(_,w);lU(p,x),f.putImageData(x,h[g].x,h[g].y)}}else for(const A of e)f.fillText(A,h[A].x,h[A].y+o+s*q0);return{xOffset:m,yOffset:T,mapping:h,data:u,width:u.width,height:u.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:r,buffer:i,sdf:s,radius:o,cutoff:a}=this.props;return s?`${e} ${n} ${r} ${i} ${o} ${a}`:`${e} ${n} ${r} ${i}`}}const fU=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,hU=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
uniform bool stroked;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,dU={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}},su=class su extends dr{getShaders(){return super.getShaders({vs:fU,fs:hU,modules:[ca,ua]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var r;super.updateState(e);const{changeFlags:n}=e;n.extensionsChanged&&((r=this.state.model)==null||r.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:n,sizeScale:r,sizeUnits:i,sizeMinPixels:s,sizeMaxPixels:o,getLineWidth:a}=this.props;let{padding:l}=this.props;l.length<4&&(l=[l[0],l[1],l[0],l[1]]);const c=this.state.model;c.setUniforms(e),c.setUniforms({billboard:n,stroked:!!a,padding:l,sizeUnits:Yr[i],sizeScale:r,sizeMinPixels:s,sizeMaxPixels:o}),c.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,1,1,0,1];return new Wt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ps({topology:"triangle-fan-webgl",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}};su.defaultProps=dU,su.layerName="TextBackgroundLayer";let op=su;const J0={start:1,middle:0,end:-1},G0={top:1,center:0,bottom:-1},lh=[0,0,0,255],pU=1,gU={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:lh},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Xi.characterSet},fontFamily:Xi.fontFamily,fontWeight:Xi.fontWeight,lineHeight:pU,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:lh},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:lh},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}},ou=class ou extends Ic{constructor(){super(...arguments),this.getBoundingRect=(e,n)=>{let{size:[r,i]}=this.transformParagraph(e,n);const{fontSize:s}=this.state.fontAtlasManager.props;r/=s,i/=s;const{getTextAnchor:o,getAlignmentBaseline:a}=this.props,l=J0[typeof o=="function"?o(e,n):o],c=G0[typeof a=="function"?a(e,n):a];return[(l-1)*r/2,(c-1)*i/2,r,i]},this.getIconOffsets=(e,n)=>{const{getTextAnchor:r,getAlignmentBaseline:i}=this.props,{x:s,y:o,rowWidth:a,size:[l,c]}=this.transformParagraph(e,n),u=J0[typeof r=="function"?r(e,n):r],f=G0[typeof i=="function"?i(e,n):i],h=s.length,d=new Array(h*2);let m=0;for(let T=0;T<h;T++){const A=(1-u)*(l-a[T])/2;d[m++]=(u-1)*l/2+A+s[T],d[m++]=(f-1)*c/2+o[T]}return d}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new uU},this.props.maxWidth>0&&Q.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:n,oldProps:r,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==r.lineHeight||n.wordBreak!==r.wordBreak||n.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:r}=this.props,{fontAtlasManager:i,characterSet:s}=this.state,o={...e,characterSet:s,fontFamily:n,fontWeight:r};if(!i.mapping)return i.setProps(o),!0;for(const a in o)if(o[a]!==i.props[a])return i.setProps(o),!0;return!1}_updateText(){var l;const{data:e,characterSet:n}=this.props,r=(l=e.attributes)==null?void 0:l.getText;let{getText:i}=this.props,s=e.startIndices,o;const a=n==="auto"&&new Set;if(r&&s){const{texts:c,characterCount:u}=sU({...ArrayBuffer.isView(r)?{value:r}:r,length:e.length,startIndices:s,characterSet:a});o=u,i=(f,{index:h})=>c[h]}else{const{iterable:c,objectInfo:u}=Lu(e);s=[0],o=0;for(const f of c){u.index++;const h=Array.from(i(f,u)||"");a&&h.forEach(a.add,a),o+=h.length,s.push(o)}}this.setState({getText:i,startIndices:s,numInstances:o,characterSet:a||n})}transformParagraph(e,n){const{fontAtlasManager:r}=this.state,i=r.mapping,s=this.state.getText,{wordBreak:o,lineHeight:a,maxWidth:l}=this.props,c=s(e,n)||"";return iU(c,a,o,l*r.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:n,getText:r,fontAtlasManager:{scale:i,atlas:s,mapping:o},styleVersion:a}=this.state,{data:l,_dataDiff:c,getPosition:u,getColor:f,getSize:h,getAngle:d,getPixelOffset:m,getBackgroundColor:T,getBorderColor:A,getBorderWidth:g,backgroundPadding:p,background:_,billboard:w,fontSettings:R,outlineWidth:x,outlineColor:M,sizeScale:k,sizeUnits:F,sizeMinPixels:U,sizeMaxPixels:j,transitions:X,updateTriggers:$}=this.props,K=this.getSubLayerClass("characters",sp),je=this.getSubLayerClass("background",op);return[_&&new je({getFillColor:T,getLineColor:A,getLineWidth:g,padding:p,getPosition:u,getSize:h,getAngle:d,getPixelOffset:m,billboard:w,sizeScale:k,sizeUnits:F,sizeMinPixels:U,sizeMaxPixels:j,transitions:X&&{getPosition:X.getPosition,getAngle:X.getAngle,getSize:X.getSize,getFillColor:X.getBackgroundColor,getLineColor:X.getBorderColor,getLineWidth:X.getBorderWidth,getPixelOffset:X.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:$.getPosition,getAngle:$.getAngle,getSize:$.getSize,getFillColor:$.getBackgroundColor,getLineColor:$.getBorderColor,getLineWidth:$.getBorderWidth,getPixelOffset:$.getPixelOffset,getBoundingRect:{getText:$.getText,getTextAnchor:$.getTextAnchor,getAlignmentBaseline:$.getAlignmentBaseline,styleVersion:a}}}),{data:l.attributes&&l.attributes.background?{length:l.length,attributes:l.attributes.background}:l,_dataDiff:c,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new K({sdf:R.sdf,smoothing:Number.isFinite(R.smoothing)?R.smoothing:Xi.smoothing,outlineWidth:x/(R.radius||Xi.radius),outlineColor:M,iconAtlas:s,iconMapping:o,getPosition:u,getColor:f,getSize:h,getAngle:d,getPixelOffset:m,billboard:w,sizeScale:k*i,sizeUnits:F,sizeMinPixels:U*i,sizeMaxPixels:j*i,transitions:X&&{getPosition:X.getPosition,getAngle:X.getAngle,getColor:X.getColor,getSize:X.getSize,getPixelOffset:X.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:$.getText,getPosition:$.getPosition,getAngle:$.getAngle,getColor:$.getColor,getSize:$.getSize,getPixelOffset:$.getPixelOffset,getIconOffsets:{getTextAnchor:$.getTextAnchor,getAlignmentBaseline:$.getAlignmentBaseline,styleVersion:a}}}),{data:l,_dataDiff:c,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(e){cU(e)}};ou.defaultProps=gU,ou.layerName="TextLayer";let ap=ou;const Il={circle:{type:Qd,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Mc,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:ap,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Ml={type:ep,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},lp={type:ip,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function js({type:t,props:e}){const n={};for(const r in e)n[r]=t.defaultProps[e[r]];return n}function ch(t,e){const{transitions:n,updateTriggers:r}=t.props,i={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const s in e){const o=e[s];let a=t.props[s];s.startsWith("get")&&(a=t.getSubLayerAccessor(a),i.updateTriggers[o]=r[s],n&&(i.transitions[o]=n[s])),i[o]=a}return i}function _U(t){if(Array.isArray(t))return t;switch(Q.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return Q.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function ev(t,e,n={}){const r={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:i=0,endRow:s=t.length}=n;for(let o=i;o<s;o++){const a=t[o],{geometry:l}=a;if(l)if(l.type==="GeometryCollection"){Q.assert(Array.isArray(l.geometries),"GeoJSON does not have geometries array");const{geometries:c}=l;for(let u=0;u<c.length;u++){const f=c[u];tv(f,r,e,a,o)}}else tv(l,r,e,a,o)}return r}function tv(t,e,n,r,i){const{type:s,coordinates:o}=t,{pointFeatures:a,lineFeatures:l,polygonFeatures:c,polygonOutlineFeatures:u}=e;if(!yU(s,o)){Q.warn(`${s} coordinates are malformed`)();return}switch(s){case"Point":a.push(n({geometry:t},r,i));break;case"MultiPoint":o.forEach(f=>{a.push(n({geometry:{type:"Point",coordinates:f}},r,i))});break;case"LineString":l.push(n({geometry:t},r,i));break;case"MultiLineString":o.forEach(f=>{l.push(n({geometry:{type:"LineString",coordinates:f}},r,i))});break;case"Polygon":c.push(n({geometry:t},r,i)),o.forEach(f=>{u.push(n({geometry:{type:"LineString",coordinates:f}},r,i))});break;case"MultiPolygon":o.forEach(f=>{c.push(n({geometry:{type:"Polygon",coordinates:f}},r,i)),f.forEach(h=>{u.push(n({geometry:{type:"LineString",coordinates:h}},r,i))})});break}}const mU={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function yU(t,e){let n=mU[t];for(Q.assert(n,`Unknown GeoJSON type ${t}`);e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}function qw(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function sl(t){return t.geometry.coordinates}function vU(t,e){const n=qw(),{pointFeatures:r,lineFeatures:i,polygonFeatures:s,polygonOutlineFeatures:o}=t;return n.points.data=r,n.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),n.points.getPosition=sl,n.lines.data=i,n.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),n.lines.getPath=sl,n.polygons.data=s,n.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),n.polygons.getPolygon=sl,n.polygonsOutline.data=o,n.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),n.polygonsOutline.getPath=sl,n}function TU(t,e){const n=qw(),{points:r,lines:i,polygons:s}=t,o=YB(t,e);return n.points.data={length:r.positions.value.length/r.positions.size,attributes:{...r.attributes,getPosition:r.positions,instancePickingColors:{size:3,value:o.points}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines.data={length:i.pathIndices.value.length-1,startIndices:i.pathIndices.value,attributes:{...i.attributes,getPath:i.positions,instancePickingColors:{size:3,value:o.lines}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines._pathType="open",n.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygons._normalize=!1,s.triangles&&(n.polygons.data.attributes.indices=s.triangles.value),n.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygonsOutline._pathType="open",n}const SU=["points","linestrings","polygons"],EU={...js(Il.circle),...js(Il.icon),...js(Il.text),...js(Ml),...js(lp),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}},au=class au extends Ic{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:n}){if(!n.dataChanged)return;const{data:r}=this.props,i=r&&"points"in r&&"polygons"in r&&"lines"in r;this.setState({binary:i}),i?this._updateStateBinary({props:e,changeFlags:n}):this._updateStateJSON({props:e,changeFlags:n})}_updateStateBinary({props:e,changeFlags:n}){const r=TU(e.data,this.encodePickingColor);this.setState({layerProps:r})}_updateStateJSON({props:e,changeFlags:n}){const r=_U(e.data),i=this.getSubLayerRow.bind(this);let s={};const o={};if(Array.isArray(n.dataChanged)){const l=this.state.features;for(const c in l)s[c]=l[c].slice(),o[c]=[];for(const c of n.dataChanged){const u=ev(r,i,c);for(const f in l)o[f].push(HB({data:s[f],getIndex:h=>h.__source.index,dataRange:c,replace:u[f]}))}}else s=ev(r,i);const a=vU(s,o);this.setState({features:s,featuresDiff:o,layerProps:a})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r,sourceLayer:i}=n;return n.featureType=SU.find(s=>i.id.startsWith(`${this.id}-${s}-`)),r>=0&&i.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(n.index=this.props.data.points.globalFeatureIds.value[r]),n}_updateAutoHighlight(e){const n=`${this.id}-points-`,r=e.featureType==="points";for(const i of this.getSubLayers())i.id.startsWith(n)===r&&i.updateAutoHighlight(e)}_renderPolygonLayer(){var o;const{extruded:e,wireframe:n}=this.props,{layerProps:r}=this.state,i="polygons-fill",s=this.shouldRenderSubLayer(i,(o=r.polygons)==null?void 0:o.data)&&this.getSubLayerClass(i,lp.type);if(s){const a=ch(this,lp.props),l=e&&n;return l||delete a.getLineColor,a.updateTriggers.lineColors=l,new s(a,this.getSubLayerProps({id:i,updateTriggers:a.updateTriggers}),r.polygons)}return null}_renderLineLayers(){var l,c;const{extruded:e,stroked:n}=this.props,{layerProps:r}=this.state,i="polygons-stroke",s="linestrings",o=!e&&n&&this.shouldRenderSubLayer(i,(l=r.polygonsOutline)==null?void 0:l.data)&&this.getSubLayerClass(i,Ml.type),a=this.shouldRenderSubLayer(s,(c=r.lines)==null?void 0:c.data)&&this.getSubLayerClass(s,Ml.type);if(o||a){const u=ch(this,Ml.props);return[o&&new o(u,this.getSubLayerProps({id:i,updateTriggers:u.updateTriggers}),r.polygonsOutline),a&&new a(u,this.getSubLayerProps({id:s,updateTriggers:u.updateTriggers}),r.lines)]}return null}_renderPointLayers(){var a;const{pointType:e}=this.props,{layerProps:n,binary:r}=this.state;let{highlightedObjectIndex:i}=this.props;!r&&Number.isFinite(i)&&(i=n.points.data.findIndex(l=>l.__source.index===i));const s=new Set(e.split("+")),o=[];for(const l of s){const c=`points-${l}`,u=Il[l],f=u&&this.shouldRenderSubLayer(c,(a=n.points)==null?void 0:a.data)&&this.getSubLayerClass(c,u.type);if(f){const h=ch(this,u.props);let d=n.points;if(l==="text"&&r){const{instancePickingColors:m,...T}=d.data.attributes;d={...d,data:{...d.data,attributes:T}}}o.push(new f(h,this.getSubLayerProps({id:c,updateTriggers:h.updateTriggers,highlightedObjectIndex:i}),d))}}return o}renderLayers(){const{extruded:e}=this.props,n=this._renderPolygonLayer(),r=this._renderLineLayers(),i=this._renderPointLayers();return[!e&&n,r,i,e&&n]}getSubLayerAccessor(e){const{binary:n}=this.state;return!n||typeof e!="function"?super.getSubLayerAccessor(e):(r,i)=>{const{data:s,index:o}=i,a=$B(s,o);return e(a,i)}}};au.layerName="GeoJsonLayer",au.defaultProps=EU;let Nc=au;const uh=512,wU=Math.PI/180;function Zw({map:t,gl:e,deck:n}){if(t.__deck)return t.__deck;const r=n==null?void 0:n.props._customRender,i=n==null?void 0:n.props.onLoad,s=Jw({...n==null?void 0:n.props,_customRender:()=>{t.triggerRepaint(),r==null||r("")}});let o;return(!n||n.props.gl===e)&&(Object.assign(s,{gl:e,width:null,height:null,touchAction:"unset",viewState:Qo(t)}),n!=null&&n.isInitialized?nv(n,t):s.onLoad=()=>{i==null||i(),nv(o,t)}),n?(o=n,n.setProps(s),n.userData.isExternal=!0):(o=new $o(s),t.on("remove",()=>{Qw(t)})),o.userData.mapboxLayers=new Set,t.__deck=o,t.on("render",()=>{o.isInitialized&&xU(o,t)}),o}function nv(t,e){const n=()=>{t.isInitialized?IU(t,e):e.off("move",n)};e.on("move",n)}function Qw(t){var e;(e=t.__deck)==null||e.finalize(),t.__deck=null}function Jw(t){return{...t,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...t.parameters},views:t.views||[new Pc({id:"mapbox"})]}}function AU(t,e){t.userData.mapboxLayers.add(e),kg(t)}function bU(t,e){t.userData.mapboxLayers.delete(e),kg(t)}function RU(t,e){kg(t)}function PU(t,e,n){let{currentViewport:r}=t.userData,i=!1;r||(r=Gw(t,e,!0),t.userData.currentViewport=r,i=!0),t.isInitialized&&t._drawLayers("mapbox-repaint",{viewports:[r],layerFilter:({layer:s})=>n.id===s.id||s.props.operation.includes("terrain"),clearStack:i,clearCanvas:!1})}function Qo(t){var i;const{lng:e,lat:n}=t.getCenter(),r={longitude:(e+540)%360-180,latitude:n,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch(),padding:t.getPadding(),repeat:t.getRenderWorldCopies()};return(i=t.getTerrain)!=null&&i.call(t)&&CU(t,r),r}function CU(t,e){if(t.getFreeCameraOptions){const{position:n}=t.getFreeCameraOptions();if(!n||n.z===void 0)return;const r=t.transform.height,{longitude:i,latitude:s,pitch:o}=e,a=n.x*uh,l=(1-n.y)*uh,c=n.z*uh,u=Vo([i,s]),f=a-u[0],h=l-u[1],d=Math.sqrt(f*f+h*h),m=o*wU,T=1.5*r,A=m<.001?T*Math.cos(m)/c:T*Math.sin(m)/d;e.zoom=Math.log2(A);const g=T*Math.cos(m)/A,p=c-g;e.position=[0,0,p/Rl(s)]}else typeof t.transform.elevation=="number"&&(e.position=[0,0,t.transform.elevation])}function Gw(t,e,n=!0){return new Wo({id:"mapbox",x:0,y:0,width:t.width,height:t.height,...Qo(e),nearZMultiplier:n?.02:.1,nearZ:e.transform._nearZ/e.transform.height,farZ:e.transform._farZ/e.transform.height})}function xU(t,e){const{mapboxLayers:n,isExternal:r}=t.userData;if(r){const i=Array.from(n,u=>u.id),o=gs(t.props.layers,Boolean).some(u=>u&&!i.includes(u.id));let a=t.getViewports();const l=a.findIndex(u=>u.id==="mapbox"),c=a.length>1||l<0;(o||c)&&(l>=0&&(a=a.slice(),a[l]=Gw(t,e,!1)),t._drawLayers("mapbox-repaint",{viewports:a,layerFilter:u=>(!t.props.layerFilter||t.props.layerFilter(u))&&(u.viewport.id!=="mapbox"||!i.includes(u.layer.id)),clearCanvas:!1}))}t.userData.currentViewport=null}function IU(t,e){t.setProps({viewState:Qo(e)}),t.needsRedraw({clearRedrawFlags:!0})}function kg(t){if(t.userData.isExternal)return;const e=[];t.userData.mapboxLayers.forEach(n=>{const r=n.props.type,i=new r(n.props);e.push(i)}),t.setProps({layers:e})}class MU{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,n){this.map=e,this.deck=Zw({map:e,gl:n,deck:this.props.deck}),AU(this.deck,this)}onRemove(){this.deck&&bU(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&RU(this.deck)}render(){PU(this.deck,this.map,this)}}const fh="__UNDEFINED__";function ol(t,e,n,r){if(!t||!e||!t.style||!t.style._loaded)return;const i=gs(r,Boolean);if(n!==r){const a=gs(n,Boolean),l=new Set(a.map(c=>c.id));for(const c of i)l.delete(c.id);for(const c of l)t.getLayer(c)&&t.removeLayer(c)}for(const a of i){const l=t.getLayer(a.id);l?(l.implementation||l).setProps(a.props):t.addLayer(new MU({id:a.id,deck:e}),a.props.beforeId)}const s=t.style._order,o={};for(const a of i){let{beforeId:l}=a.props;(!l||!s.includes(l))&&(l=fh),o[l]=o[l]||[],o[l].push(a.id)}for(const a in o){const l=o[a];let c=a===fh?s.length:s.indexOf(a),u=a===fh?void 0:a;for(let f=l.length-1;f>=0;f--){const h=l[f],d=s.indexOf(h);d!==c-1&&(t.moveLayer(h,u),d>c&&c++),c--,u=h}}}class OU{constructor(e){this._handleStyleChange=()=>{ol(this._map,this._deck,this._props.layers,this._props.layers)},this._updateContainerSize=()=>{if(this._map&&this._container){const{clientWidth:i,clientHeight:s}=this._map.getContainer();Object.assign(this._container.style,{width:`${i}px`,height:`${s}px`})}},this._updateViewState=()=>{const i=this._deck;i&&(i.setProps({viewState:Qo(this._map)}),i.isInitialized&&i.redraw())},this._handleMouseEvent=i=>{const s=this._deck;if(!s||!s.isInitialized)return;const o={type:i.type,offsetCenter:i.point,srcEvent:i},a=this._lastMouseDownPoint;switch(!i.point&&a&&(o.deltaX=i.originalEvent.clientX-a.clientX,o.deltaY=i.originalEvent.clientY-a.clientY,o.offsetCenter={x:a.x+o.deltaX,y:a.y+o.deltaY}),o.type){case"mousedown":s._onPointerDown(o),this._lastMouseDownPoint={...i.point,clientX:i.originalEvent.clientX,clientY:i.originalEvent.clientY};break;case"dragstart":o.type="panstart",s._onEvent(o);break;case"drag":o.type="panmove",s._onEvent(o);break;case"dragend":o.type="panend",s._onEvent(o);break;case"click":o.tapCount=1,s._onEvent(o);break;case"dblclick":o.type="click",o.tapCount=2,s._onEvent(o);break;case"mousemove":o.type="pointermove",s._onPointerMove(o);break;case"mouseout":o.type="pointerleave",s._onPointerMove(o);break;default:return}};const{interleaved:n=!1,...r}=e;this._interleaved=n,this._props=r}setProps(e){this._interleaved&&e.layers&&ol(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._deck.setProps(this._interleaved?Jw(this._props):this._props)}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const n=document.createElement("div");return Object.assign(n.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=n,this._deck=new $o({...this._props,parent:n,viewState:Qo(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),n}_onAddInterleaved(e){const n=e.painter.context.gl;return n instanceof WebGLRenderingContext&&Q.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=Zw({map:e,gl:n,deck:new $o({...this._props,gl:n})}),e.on("styledata",this._handleStyleChange),ol(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){const e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){var n;e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),(n=this._deck)==null||n.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),ol(e,this._deck,this._props.layers,[]),Qw(e)}getDefaultPosition(){return"top-left"}pickObject(e){return Pe(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return Pe(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return Pe(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}const kU="https://raw.githubusercontent.com/kkornakiewicz/walks-fe/main/edges.json",NU="https://raw.githubusercontent.com/kkornakiewicz/walks-fe/main/nodes.json",FU={latitude:41.38685633118305,longitude:2.1696874299405295,zoom:13,bearing:0,pitch:30},DU="https://basemaps.cartocdn.com/gl/positron-gl-style/style.json";function BU(t){return vs(()=>new OU(t)).setProps(t),null}function UU(){const[t,e]=W.useState(null),[n,r]=W.useState(null),[i,s]=W.useState(null),[o,a]=W.useState(!0),[l,c]=W.useState(null),[u,f]=W.useState(null),h=T=>{T!=null?f(T.properties.osmid):f(null)},d=T=>T.properties.osmid===u?[112,41,99]:[250,128,114,140];W.useEffect(()=>{(async()=>{try{const A=await fetch(kU);if(!A.ok)throw new Error(`HTTP error! Status: ${A.status}`);const g=await A.json();r(g),a(!1)}catch(A){c(A.message),a(!1)}})()},[]),W.useEffect(()=>{(async()=>{try{const A=await fetch(NU);if(!A.ok)throw new Error(`HTTP error! Status: ${A.status}`);const g=await A.json();s(g),console.log(g),a(!1)}catch(A){c(A.message),a(!1)}})()},[]);const m=[new Nc({id:"map",data:n,pickable:!0,getLineColor:d,getLineWidth:8,autoHighlight:!0,onClick:T=>e(T.object),onHover:T=>h(T.object),updateTriggers:{getLineColor:[u]},beforeId:"watername_ocean"}),new Nc({id:"nodes",data:i,getFillColor:[255,255,255],autoHighlight:!0,getLineWidth:8,beforeId:"watername_ocean"})];return ze.createElement(ze.Fragment,null,ze.createElement(MP,null),ze.createElement(wR,{initialViewState:FU,mapStyle:DU},t&&ze.createElement(AR,{key:t.properties.osmid,style:{zIndex:10},longitude:t.geometry.coordinates[0][0],latitude:t.geometry.coordinates[0][1],maxWidth:"400px"},ze.createElement("p",null,t.properties.name)),ze.createElement(BU,{layers:m}),ze.createElement(bR,{position:"top-left"})))}const LU=document.body.appendChild(document.createElement("div"));pS(LU).render(ze.createElement(UU,null));export{VU as c,cp as g};
